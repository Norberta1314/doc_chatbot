# 安装与调试 
## TCF部署TECS Director 
概述 : 
#### 产品概述 
TECS Director定位ICT融合的电信级云管理平台，提供对私有云、公有云和混合云整合管理的产品，既能支持运营商NFV的CT场景（NFVIM），也能为IT场景及行业应用提供ICT融合的解决方案，并为运营商提供面向企业的类公有云的服务整体解决方案。
借助TECS Director，客户可以将多个数据中心的异构资源整合，物理分布、逻辑统一，实现多数据中心资源池的统一纳管、统一编排和运维；开放IaaS服务能力；基于VDC和组织的运营能力，通过资源服务化，服务差异化、自动化，从而构建多租户异构云混合云，为用户提供统一的运营管理门户和自服务门户。TECS Director在整个TECS系统中的位置如[图1]所示。
图1  TECS Director的定位
#### 部署架构 
TECS Director总体部署架构如[图2]所示。
图2  TECS Director部署架构
部署组成： 
DaisySeed： 部署工具。用户同DaisySeed工具交互完成整个Director系统的部署； DaisySeed自身安装灵活，既可以安装在PC机也可以虚机，既有windows版本也有linux版本； 
基础设施： 部署目标。Director支持部署在裸机或者虚机上，裸机和虚机对应不同的节点，网络，存储配置，以及不同的部署模板；  
软件系统： 部署对象。Director的软件系统，包含内嵌的TCF平台，数据库与中间件和Director应用； 
Daisy：软件系统的一部分，负责同DaisySeed交互协同，完成整个Director系统的部署； 同时，Daisy 也是后续Director升级入口工具。 
TECS Director的物理机部署时序如[图3]所示。
图3  部署时序（物理机）
### 部署前准备 
#### 节点及规格 
##### 虚机场景 
虚机场景下节点规格参见[表1]。
场景|节点|部署规模|管理规模|Paas规格
---|---|---|---|---
vCPU（core）|内存（GB）|存储（GB）
---|---|---
通用场景|单节点|tiny|<=100主机  ，等效1000虚机|24|128|600
三节点|通用场景|tiny|<=100主机  ，等效1000虚机|840|24|128
small|三节点|通用场景|101~500主机 ， 等效5000虚机|2000|24|128
六节点|通用场景|medium|501~1000主机， 等效10000虚机|控制节点2000计算节点1500|24|128
九节点|通用场景|large|1000~2000主机，等效20000虚机|控制节点2000计算节点1500|24|128
CCM场景|三节点|tiny|<=100主机 ，等效1000虚机|16|64|700
MEO场景|六节点|large|1000~2000主机，等效20000虚机|20|128|600
磁盘分区参见[表2]。
盘符|分区|挂载目录|空间规格(GB)|说明
---|---|---|---|---
vda系统盘|根分区|/|40|OS根分区|使用默认值，用户无需修改
/paasdata/offline分区|vda系统盘|/paasdata/offline|100|/paasdata/offline分区|使用默认值，用户无需修改
PaaS分区|vda系统盘|/paasdata|220|PaaS分区、 应用版本镜像、容器运行空间|使用默认值，用户无需修改
调测日志|vda系统盘|/var/zte-log|>20|记录Director服务调测日志|使用默认值，用户无需修改
vdb数据盘|PG|/paasdata/op-comsrv/data/PostgreSQL_VNPM|>72|PG的log 32 GB + 40 GB业务数据|可修改，当取最小值时仅考虑能安全部署起来的空间，不做业务量的评估（现场实际使用大小需要规划给出参考HLD）
PGCache|vdb数据盘|/paasdata/op-comsrv/data/PostgreSQLCACHE_VNPM|>40|PG的log 32 GB|可修改，当取最小值时仅考虑能安全部署起来的空间，不做业务量的评估（现场实际使用大小需要规划给出参考HLD）
ES|vdb数据盘|/paasdata/op-comsrv/data/ES-5.4.3|>40|ES清理最小监控粒度|可修改，当取最小值时仅考虑能安全部署起来的空间，不做业务量的评估（现场实际使用大小需要规划给出参考HLD）
Cassandra|vdb数据盘|/paasdata/volume/cassandra|>30|tiny规格时取最小值|可修改，当取最小值时仅考虑能安全部署起来的空间，不做业务量的评估（现场实际使用大小需要规划给出参考HLD）
Kafka|vdb数据盘|/paasdata/op-comsrv/data/Apache-Kafka/kafka-director-external|>30|tiny规格时取最小值|可修改，当取最小值时仅考虑能安全部署起来的空间，不做业务量的评估（现场实际使用大小需要规划给出参考HLD）
GlusterFS|vdb数据盘|/glusterdata/volumedata|>60|OKI默认配置最小值|可修改，当取最小值时仅考虑能安全部署起来的空间，不做业务量的评估（现场实际使用大小需要规划给出参考HLD）
##### 物理机场景 
物理机场景下节点规格参见[表1]。
场景|节点|部署规模|管理规模|Paas规格
---|---|---|---|---
vCPU（core）|内存（GB）|存储（GB）
---|---|---
通用场景|单节点|tiny|<=100主机 ，等效1000虚机|24|128|600
三节点|通用场景|small|<=1000主机 ，等效10000虚机|2000|24|128
六节点|通用场景|medium|1001~2000主机，等效20000虚机|控制节点2000计算节点1500|24|128
九节点|通用场景|large|2001~6000主机，等效60000虚机|控制节点2000计算节点1500|24|128
十二节点|通用场景|20k|大于6000主机，等效60000虚机|控制节点2000计算节点1500|24|128
MEO场景|六节点|large|2001~6000主机，等效60000虚机|20|128|600
磁盘分区参见[表2]（部署所需最小磁盘空间规划，现场实际使用大小需要规划给出参考HLD）。
分区|挂载目录|空间规格(GB)|说明
---|---|---|---
根分区|/|40|OS根分区|使用默认值，用户无需修改
/paasdata/offline分区|/paasdata/offline|100|/paasdata/offline分区|使用默认值，用户无需修改
PaaS分区|/paasdata|220|PaaS分区、 应用版本镜像、容器运行空间|使用默认值，用户无需修改
调测日志|/var/zte-log|20|记录Director服务调测日志|使用默认值，用户无需修改
PG|/paasdata/op-comsrv/data/PostgreSQL_VNPM|>72|PG的log 32 GB + 40 GB业务数据|可修改，当取最小值时仅考虑能安全部署起来空间，不做业务量的评估（现场实际使用大小需要规划给出参考HLD）
PGCache|/paasdata/op-comsrv/data/PostgreSQLCACHE_VNPM|>40|PG的log 32 GB|可修改，当取最小值时仅考虑能安全部署起来空间，不做业务量的评估（现场实际使用大小需要规划给出参考HLD）
ES|/paasdata/op-comsrv/data/ES-5.4.3|>40|ES清理最小监控粒度|可修改，当取最小值时仅考虑能安全部署起来空间，不做业务量的评估（现场实际使用大小需要规划给出参考HLD）
Cassandra|/paasdata/volume/cassandra|>30|tiny规格时取最小值|可修改，当取最小值时仅考虑能安全部署起来空间，不做业务量的评估（现场实际使用大小需要规划给出参考HLD）
Kafka|/paasdata/op-comsrv/data/Apache-Kafka/kafka-director-external|>30|tiny规格时取最小值|可修改，当取最小值时仅考虑能安全部署起来空间，不做业务量的评估（现场实际使用大小需要规划给出参考HLD）
GlusterFS|/glusterdata/volumedata|>60|OKI默认配置最小值|可修改，当取最小值时仅考虑能安全部署起来空间，不做业务量的评估（现场实际使用大小需要规划给出参考HLD）
#### 网络规划 
##### 虚机容灾场景 
虚机容灾场景的组网图如[图1]所示。
图1  组网图
网络平面配置参见[表1]。
网络平面|IP地址个数|IP配置方法|描述|备注
---|---|---|---|---
北向网络|1|人工规划，系统安装时自动配置|客户端访问Director portal网络，以及北向上报网络|SLB 托管网络
TecsClient网络（南向网络）|1|人工规划，系统安装时自动配置|Director访问TCF网络|SLB 托管网络
Public API网络（南向网络）|1|人工规划，系统安装时自动配置|Director访问TCF网络|SLB 托管网络
运维网络（net-api）|5|手动配置3个固定IP到环境并固化到文件，1个VIP系统安装时自动配置|节点SSH和NTP服务网络平面|主机网络，3个固定IP，1个VIPDaisySeed 需要1个需要同对端运维网络互通
GR-NET|1|人工规划，系统安装时自动配置|异地容灾网络|需要配置同对端GR-NET互通
内部网络（net-iapi）|地址池：N+2+20（N = 节点个数）|每个节点的net_api网络ip（规划的前N+2）； 当前版本约束需要多出2个地址，否则会部署失败。其余20个规划PaaS内部组件VIP使用。|PaaS内部网络，东西向流量|-
容灾需要配置防火墙开启，参见[表2]。
网络平面|源|目的|开放端口|作用
---|---|---|---|---
GR-NET|站点1 SLB IP|站点2 SLB IP|3011,3012|NDR Https
GR-NET|站点2 SLB IP|站点1 SLB IP|3011,3012|NDR Https
GR-NET|站点2 SLB IP|站点1 SLB IP|cpaas 1043 / TCF  18888|心跳
GR-NET|站点1 SLB IP|站点2 SLB IP|cpaas 1043 / TCF  18888|心跳
GR-NET|站点1 SLB IP|站点2 SLB IP|(4500-4608)/(4610-4999)|中间件容灾数据
GR-NET|站点2 SLB IP|站点1 SLB IP|(4500-4608)/(4610-4999)|中间件容灾数据
运维网络|站点1 三层子网|站点2 三层子网|7001|两地点到点通信
运维网络|站点2 三层子网|站点1 三层子网|7001|两地点到点通信
##### 虚机非容灾场景 
###### 通用场景 
通用场景的网络配置组网图如[图1]所示。
图1  通用场景组网图
通用场景的网络平面配置参见[表1]。
网络平面|IP地址个数|IP配置方法|描述|备注
---|---|---|---|---
北向网络|1|人工规划，系统安装时自动配置|客户端访问Director portal网络，以及北向上报网络|SLB 托管网络
TecsClient网络（南向网络）|1|人工规划，系统安装时自动配置|Director访问TECS的TECSCLIENT平面|SLB 托管网络
PubApi网络（南向网络）|1|人工规划，系统安装时自动配置|Director访问TECS的PUBLICAPI平面|SLB 托管网络
运维网络（net-iapi）|5|手动配置3个固定IP到环境并固化到文件，1个VIP系统安装时自动配置|节点SSH和NTP服务网络平面、Director访问对象存储的S3平面（DNS）|主机网络，3个固定IP，1个VIPDaisySeed 需要1个
内部网络（net-api）|地址池：N+2+20（N = 节点个数）|每个节点的net_api网络ip（规划的前N+2）， 当前版本约束需要多出2个地址，否则会部署失败其余20个规划PaaS内部组件VIP使用|PaaS内部网络，东西向流量|-
##### 物理机容灾场景 
物理机容灾场景的网络配置组网图如[图1]所示。
图1  组网图
网络平面配置参见[表1]。
逻辑网络平面|承载物理网口|IP地址个数|IP配置方法|描述|备注
---|---|---|---|---|---
北向/运维网络平面|外部物理网口（bond0）|5|手动设3个固定ip到控制节点，临时配置不能固化，其他2个浮动ip系统安装时自动配置|客户端访问Director网络，Dirctor访问NTP-Server网络|平台运维和北向业务网络合一地址：3+1+1平台运维：3个固定地址，1个VIP业务SLB 1个地址
Tecs Client网络（南向网络）|外部物理网口（bond0）|1|人工规划，系统安装时自动配置|Director访问TECS，以及Provider上报网络平面|SLB业务1个地址
Public Api网络（南向网络）|外部物理网口（bond0）|1|人工规划，系统安装时自动配置|Director访问TECS，以及Provider上报网络平面|SLB业务1个地址
Sto-Data网络（存储网络数据面）|存储物理网口（bond2）|N(N为节点个数)|人工规划，系统安装时自动配置|外置存储数据平面|可选： 如果使用本地盘，则不需要规划该平面
Sto-Mgt网络（存储网络管理面）|存储物理网口（bond2）|3|人工规划，系统安装时自动配置|外置存储管理平面|可选： 如果是预置卷（提前建好了卷），则不需要规划该平面
PXE网络（部署网络）|内部物理网口（bond1）|>N+1(N为节点个数)|人工规划，在DaisySeed侧配置地址池|按照裸机操作系统所用网络平面|vlan需要配置成同交换机端口native vlan一致
内部网络池（Net-API网络）|内部物理网口（bond1）|PaaS自动分配|人工规划20个连续的VLANID ，1000个IP并配置|TCF 内部网络管理分配|物理机场景使用underlay网络，每个租户网络是独立vlan
GR-Net|外部物理网络（eth0）|1|人工规划，系统安装时自动配置|中间容灾网络（FTP/PG/ES）|-
GR-Cassandra|外部物理网络（eth0）|N(N为节点个数)|自动分配|cassandra异地容网络|这个是应用网络，需要站点间互通
带外网络平面（BMC网络）|DaisySeed需要接入|1|人工规划|部署裸机，重启服务器使用|部署裸机，重启服务器使用
容灾需要配置防火墙开启，参见[表2]。
网络平面|源|目的|开放端口|作用
---|---|---|---|---
GR-NET|站点1 SLB IP|站点2 SLB IP|3011,3012|NDR Https
GR-NET|站点2 SLB IP|站点1 SLB IP|3011,3012|NDR Https
GR-NET|站点2 SLB IP|站点1 SLB IP|cpaas 1043 / TCF  18888|心跳
GR-NET|站点1 SLB IP|站点2 SLB IP|cpaas 1043 / TCF  18888|心跳
GR-NET|站点1 SLB IP|站点2 SLB IP|(4500-4608)/(4610-4999)|中间件容灾数据
GR-NET|站点2 SLB IP|站点1 SLB IP|(4500-4608)/(4610-4999)|中间件容灾数据
GR-Cassandra|站点1 三层子网|站点2 三层子网|7001|两地点到点通信
GR-Cassandra|站点2 三层子网|站点1 三层子网|7001|两地点到点通信
##### 物理机非容灾场景 
物理机非容灾场景的网络配置组网图如[图1]所示。
图1  组网图
网络平面配置参见[表1]。
逻辑网络平面|承载物理网口|IP地址个数|IP配置方法|描述|备注
---|---|---|---|---|---
北向网络|外部物理网口（bond0）|6|手动设3个固定ip到控制节点，临时配置不能固化，其他2个浮动ip系统安装时自动配置|客户端访问Director网络，Dirctor访问NTP-Server网络|平台运维和北向业务网络合一地址：3+1+1+1；平台运维：3个固定地址，1个VIP业务SLB 1个地址DaisySeed 1个地址
TecsClient网络（南向网络）|外部物理网口（bond0）|1|人工规划，系统安装时自动配置|Director访问TECS，以及Provider上报网络平面|SLB业务一个地址
PubApi网络（南向网络）|外部物理网口（bond0）|1|人工规划，系统安装时自动配置|Director访问TECS，以及Provider上报网络平面|SLB业务一个地址
Sto-Data网络（存储网络数据面）|存储物理网口（bond2）|N(N为节点个数)|人工规划，系统安装时自动配置|外置存储数据平面|可选： 如果使用本地盘，则不需要规划该平面
Sto-Mgt网络（存储网络管理面）|存储物理网口（bond2）|3|人工规划，系统安装时自动配置|外置存储管理平面|可选： 如果是预置卷（提前建好了卷），则不需要规划该平面
PXE网络|内部物理网口（bond1）|>N(N为节点个数)|人工规划，在DaisySeed侧配置地址池；|按照裸机操作系统所用网络平面|vlan需要配置成同交换机端口native vlan一致
内部网络池（Net-API）|内部物理网口（bond1）|PaaS自动分配|人工规划20个连续的VLANID ，1000个IP并配置|TCF 内部网络管理分配|物理机场景使用underlay网络，每个租户网络是独立vlan
带外网络|DaisySeed使用|1|人工配置|安装操作系统，使用带外启动裸机|-
#### 版本及节点配置 
##### 软件版本 
TECS Director以V8.22.30.07为例 ， TCF以7.22.10.11为例。安装前需要准备的软件参见[表1]。
版本包|版本包示例|备注
---|---|---
PaaS版本包|TCFV7.22.10.11_PICTV7.22.10.11_20220602020802_paas.tar.gz|-
OpenJDK版本包|TCFV7.22.10.11_PICT-3rdparty-V7.22.10.11_20220602020802_paas.tar.gz|-
公共服务包|TCFV7.22.10.11_PICTV7.22.10.11_20220602020802_techsrv.tar.gz|-
Mimosa镜像|TCFV7.22.10.11_Mimosa-x86_64-CGSL-8.2-043278-OES-FI.iso|daisyseed和Director的裸机OS镜像
OS升级工具包|TCFV7.22.10.11_tools.tar|包含daisyseed版本包
Daisy版本包|TCFV7.22.10.11_daisy-2020.7.22.10-6.0.60101.el7.x86_64.rpm|-
公共组件包|TCFV7.22.10.11_common-service-ume-TECSV7.22.10_rel-2841.tar.gz|-
Director版本包|Director-V8.22.30.07.x64-TCF-20220620203000.tar|-
Director  JDK包|Director_3rdparty_20220309120000-x64-TCF-openjdk.tar|-
模板|Director-Deploy-ConfigFiles-V8.22.30.07.n202208090205.zip|-
##### 虚机场景节点准备 
###### TECS资源池节点准备 
摘要 : 
介绍虚机场景TECS资源池节点准备。 
步骤 : 
创建项目
使用admin账号登陆TECS，选择系统管理→项目
，打开项目页面，如[图1]所示。
图1  项目页面
单击添加项目按钮，打开添加项目页面，如[图2]所示。
图2  添加项目页面
根据预置节点环境资源规划，填写参数。单击创建按钮，完成创建。
 说明： 
项目配额根据规划的节点规模自行配置（考虑到需要创建paas-st虚机和daisyseed虚机，项目配额应适当放大），实例数、端口数、网络数等根据实际规划配置，可适当放大。如果不限制使用大小，可填写“-1”。 
创建用户
选择系统管理→用户
，打开用户页面。
单击创建用户按钮，打开创建用户页面。
根据预置节点环境资源规划，填写参数，其中项目填写上面创建的项目名称，角色选择“prj_manager”，单击创建按钮，完成创建。
添加虚机规格
选择云管理→计算→规格
，打开规格页面，如[图3]所示。
图3  规格页面
单击添加虚机规格按钮，打开添加虚机规格页面。
根据环境规划添加需要的虚机规格，包括daisyseed虚机类型和TECS Director节点虚机类型，根据TECS资源池实际配置信息注意是否需要打开绑核巨页（注意daisyseed虚机规格为4核8G、50G硬盘）。
创建网络
退出admin租户，使用上一步创建成功的用户登录。选择项目管理→网络
，打开网络页面，如[图4]所示。
图4  网络页面
单击添加网络按钮，打开添加网络页面。
根据规划的组网创建net_api(内部网络)，net_iapi（SSH运维网络），net_public（南向public网络），net_north(北向和tecsclient网络)，ip需用户自己规划，注意添加子网时关闭DHCP。 
 说明： 
端口IP可以创建（增加虚机的时候指定分配某个端口IP），也可以不创建（增加虚机的时候随机分配端口ip）。 
若创建网络时需要指定VLANID，需要以admin用户登录进行创建网络，创建时可以指定VLANID。 
上传镜像
选择项目管理→镜像
，打开镜像页面。
单击上传镜像按钮，打开上传镜像页面，如[图5]所示。
图5  上传镜像页面
在此页面上传daisyseed虚机镜像和节点虚机OS镜像（daisyseed虚机和节点虚机使用相同镜像文件）。 
 说明： 
虚机需要的OS镜像必须为qcow2格式，所以要将制品库中的iso镜像下载至本地win机器，使用7z工具解压，解压后找到qcow2格式镜像文件。 
创建云盘
 说明： 
本地盘部署时可跳过该步骤。 
选择项目管理→存储→云硬盘
，打开云硬盘页面。
单击添加云硬盘按钮，打开添加云硬盘页面，如[图6]所示。
图6  添加云硬盘页面
（可选）创建虚机使用的系统盘和数据盘（若通过镜像创建虚机，则这里不用创建）。创建系统盘，镜像选择上传的虚机Mimosa镜像，容量根据规划实际填写，数量根据节点个数填写。创建数据盘，选择没有源，空白云硬盘，容量根据规划实际填写，数量根据节点个数填写。
 说明： 
系统盘容量必须大于430 GB。 
创建数据盘，镜像为空，容量根据规划实际填写，数量根据节点个数填写。 
创建虚机
选择项目管理→计算→虚机
，打开虚机页面。
单击添加虚机按钮，打开添加虚机页面，如[图7]所示。
图7  添加虚机页面
创建虚机，启动源选择从云硬盘启动（如果步骤18没有创建系统盘，则选择从镜像启动），规格选择之前创建的TECS Director节点规格，创建虚机。
创建daisyseed虚机，启动源选择从云硬盘启动，规格选择之前创建的daisyseed规格，创建虚机。
虚机挂载网络
单击虚机名称打开虚机详情页面，切换至硬件→端口
页签。
单击添加按钮，打开选择网络对话框，如[图8]所示。
图8  选择网络对话框
勾选网络并单击确定，为虚机和daisyseed虚机挂载网络。
控制节点1和控制节点2挂载net_api（内部网络），net_iapi（SSH运维），net_north（北向网络），TecsClient网络，public API（南向public）容灾网络（可选），存储数据面网络（可选） 
控制节点3挂载net_api（内部网络），net_iapi（SSH运维）两个网络平面。 
所有计算节点虚机仅需要挂载net_api（内部网络） 
虚机挂载net_api内部网络和net_iapi运维网络需要指定端口IP（前面步骤已经创建的端口），挂载其他网络平面选择系统自动分配IP 
（可选）挂载云硬盘
 说明： 
如果选择从镜像创建虚机，则跳过步骤27~29。 
在虚机详情页面，切换至硬件→数据盘
页签。
单击添加按钮，打开添加数据盘对话框，如[图9]所示。
图9  添加数据盘对话框
勾选云硬盘，单击确定按钮。
虚机网络固化
固化net_api地址，进入虚机/etc/sysconfig/network-scripts目录下，拷贝ifcfg-lo文件并重命名为ifcfg- ethX，执行vi命令修改文件，内容参考如[图10]所示。
图10  文件内容
 说明： 
net_api对应ethX，可以通过mac地址确认。 
执行与上一步相同的操作，固化net_iapi地址。 
设置虚机所有网卡文件中BOOTPROTO的值为static，不启用dhcp，如[图11]所示。
图11  设置BOOTPROTO
执行service network restart，查看网卡上IP地址已经生效，如[图12]所示。
图12  查看配置生效
###### vmware资源池节点准备 
摘要 : 
介绍虚机场景VMWARE资源池节点准备。 
前提 : 
已完成分布式交换机的创建。 
步骤 : 
上传镜像
单击切换页标签至存储→文件→新建文件夹
，创建iso文件夹如[图1]所示。
图1  创建iso文件夹
单击上载文件，选择需要上传的文件，单击确定开始上传。上完成后可以看到上传的镜像，如[图2]所示。
图2  已上传的iso镜像文件
创建网络
右键单击已创建的分布式交换机，在弹出的菜单栏选择分布式端口组→新建分布式端口组
。
在弹出的新建分布式端口组设置向导页面完成分布式端口组设置。
设置名称和位置。 
单击NEXT按钮，在配置设置页签设置新端口组的常规设置。
 说明： 
保持默认设置即可。 
单击NEXT按钮，在即将完成页签确认设置的参数无误后单击FINISHED按钮完成创建。
创建虚机
 说明： 
 创建一个虚机即可，其他虚机节点可在该虚机节点执行完vmwaretools安装后克隆创建。 
 右键单击要创建虚机的集群，在菜单栏单击新建虚拟机。
在弹出的虚拟机创建向导完成虚拟机的创建。 
选择创建类型。 
单击NEXT按钮，在选择名称和文件夹页填写虚拟机名称及创建后的位置。
单击NEXT按钮，在选择计算资源页选择计算资源并进行兼容性检查。
单击NEXT按钮，在选择存储页选择当前集群中的存储设备并进行兼容性检查。
单击NEXT按钮，在选择兼容性页保持默认选项。
单击NEXT按钮，在选择客户机操作系统页选择centeOS 8（以安装Linux为例）。
单击NEXT按钮，在自定义硬件页单击添加新设备，选择硬盘，添加硬盘。
输入CPU、内存，硬盘大小。 
 说明： 
第一块是系统盘需要大于等于430 G，第二块是数据盘根据HLD规划设置大小。 
选择网络为net_api(内部网络)，适配器类型为VMXNET 3，如[图3]所示。
图3  选择适配器类型
驱动选择数据存储ISO文件，弹出选择文件如[图4]所示，勾选上传的ISO操作系统文件，单击确定。
图4  选择ISO操作系统文件
如[图5]所示，勾选链接...，首次虚机开机后会读取ISO文件，进行操作系统的安装。
图5  勾选连接ISO文件
切换到虚拟机选项页签，在引导选项的固件选择BIOS，如[图6]所示。
图6  虚拟机选项
单击NEXT按钮，进入即将完成页确定设置准确无误后，单击FINISH按钮，完成虚拟机的创建。
如[图7]所示，单击按钮操作虚机开机。
图7  虚机开机
虚机开机后，单击启动Web控制台按钮打开控制台。
按上下键将光标移动至Partitions，如[图8]所示，按回车键进入分区界面。
图8  选择Partitions
按上下键将光标移动至Change Partitions Size，按回车键，设置Customize partition为No。
按Esc键返回控制台，移动光标至Network，按回车键，根据网络规划配置net_api（内部网络）信息。
内部网络是双栈，则任选ipv4或ipv6其一配置即可。以下为配置ipv4 net_api为例： 
如[图9]所示，protocol version 选择IPv4。
图9  protocol version
如[图10]所示，plane选择management plane。
图10  plane
如[图11]所示，设置bond mode 和single mode。
图11  设置bond mode 和single mode
设置完成，如[图12]所示。
图12  Network设置完成
按上下键将光标移动至Install，按回车键开始系统安装，如[图13]所示。
图13  安装系统
系统安装完成，弹出如[图14]所示提升。
图14  完成操作系统安装
完成系统安装后，右键单击虚机，弹出操作菜单，选择启动→关闭电源
，如[图15]所示。
图15  关闭虚机电源
虚机关机后，右键单击虚机，弹出操作菜单，选择编辑设置。
在弹出的编辑虚机界面，设置CD/DVD驱动器为客户端设备，单击确定完成设置。
单击按钮，操作虚机开机。
安装VMware-Tools
虚拟机启动成功后，界面提示安装VMware-Tools提示框，如[图16]所示。
图16  安装VMware-Tools提示框
单击安装VMware-Tools...，弹出挂载光驱确认框，如[图17]所示。
图17  挂载vmwware tool工具光驱
单击挂载按钮，安装VMware-Tools...链接消失，挂载成功。
单击启动WEB控制台，进入控制台。
同时按Alt和F2键，弹出登录提示界面，如[图18]所示。
图18  登录提示界面
登录账号：ubuntu/UbuntU1!2@3#4$ 
执行sudo -i切换到root用户，执行如下命令：
 说明： 
#”后面的文字为说明文字请勿直接复制。 
`mkdir -p /mnt/cdrom              创建挂载点
mount /dev/cdrom /mnt/cdrom   挂载光驱
cd /mnt/cdrom                 进入目录
tar -zxvf VMwareTools-10.0.6-3560309.tar.gz -C /tmp   解压vmware-tools压缩包到/tmp目录中，
                                                        其中版本号根据当前环境上实际版本进行更换
cd /tmp                       进入解压目录    
cd vmware-tools-distrib       进入安装目录 
./vmware-install.pl          执行安装命令，一路回车即可 
reboot                        安装完成后重启虚机操作系统` 
 说明： 
执行后若出现挂载光驱失败或者光驱内找不到文件，则检查虚机的驱动器是否设置为客户端设备，设置方法参见[步骤15]~[步骤16]。
重新设置后再执行上述操作。 
执行完成后，返回界面，界面没有未安装VMware-Tools的提示。
克隆虚机
以[创建虚机]创建的虚机为模板，右键单击虚机，在弹出的菜单栏选择克隆→克隆到虚机...
。
在弹出虚机克隆向导完成虚机克隆。 
在选择名称和文件夹页，输入虚机名称，选择虚机位置，如[图19]所示。
图19  选择名称和文件夹
单击NEXT按钮，在选择计算资源页选择目标计算资源，如[图20]所示。
图20  选择计算资源
单击NEXT按钮，在选择存储页选择存储，如[图21]所示。
图21  选择存储
单击NEXT按钮，在选择克隆选项页选择克隆选项，如[图22]所示。
图22  选择克隆选项
单击NEXT按钮，在即将完成页查看克隆虚机信息。
单击FINISH按钮，完成虚机克隆。
重复[步骤26]依次完成剩余虚机节点的克隆操作。
挂载网络
 右键单击虚机，在弹出的菜单栏选择编辑设置，弹出编辑设置页面。
在虚拟硬件页签的右侧单击添加新设备下拉框，选择网络→网络适配器
，如[图23]所示。
图23  添加网络适配器
选择需要挂载的网络，单击确定完成网络挂载。
 说明： 
挂载网络时必须严格按照网络的先后顺序进行挂载。 
控制节点1和控制节点2虚机依次（顺序不能变）挂载 net_iapi（运维网络）,net_north（北向网络），TecsClient网络，Public API（南向public），容灾网络（可选），存储数据面网络（可选）。 
控制节点3虚机挂载net_iapi（运维网络）。 
所有计算节点虚机不需要再挂载网络（计算节点仅需要内部网络，在虚机创建步骤已经完成）。 
虚机网络挂载完成后，在虚机摘要页签的虚拟机硬件区域可看到网络全部挂载完毕，如[图24]所示。
图24  虚拟机硬件网络适配器
固化网络
 说明： 
需要固化的网络为net_api(内部网络)、net_iapi(运维网络)，其他网络不需要固化 （固化的IP地址在网络规划时已经确定）。 
确认虚机网卡挂载网络。 
在虚机摘要页签的虚拟机硬件区域，单击网络适配器可查看mac地址和网络信息对应关系，如[图25]所示。
图25  查看mac地址和网络信息对应关系
登录到虚机节点，执行ifconfig -a，可查看虚机网卡的mac地址，如[图26]所示。
图26  查看虚机网卡的mac地址
通过mac地址就可以确定虚机网卡挂载的网络信息。 
固化net_api(内部网络)地址。 
进入虚机/etc/sysconfig/network-scripts目录下，net_api网卡文件已经存在。
查看文件是否需要补充IP信息，如果缺少就要补齐。如是双栈，则ipv4和ip6地址都要存在，下图为双栈net_api网卡文件固化信息。 
（可选）固化net_iapi(运维网络)地址。 
拷贝ifcfg-lo文件并重命名为ifcfg- ensX修改文件增加IP信息，net_iapi对应哪个ensX可以参考前面步骤。
 说明： 
仅在控制节点执行，计算节点没有运维网络不需要执行该步骤。 
设置虚机所有网卡文件中BOOTPROTO的值为static，不启用dhcp。 
复位网络。执行service network restart，执行ifconfig查看网卡上ip地址已经生效，如[图27]所示。
图27  查看网卡上ip地址
创建虚机快照
 说明： 
虚机快照可在Director部署失败后快速恢复虚机到初始未安装状态。 
切换至虚机快照页签，单击生成快照，如[图28]所示。
图28  生成快照
在生成快照页面，修改快照名称，描述等信息，如[图29]所示。
图29  修改快照信息
单击创建按钮，生成快照如[图30]所示。
图30  已生成的快照
##### 网卡固化（可选） 
网卡固化操作仅在虚机场景下执行。SSH到有版本包的节点上，进入/paasdata/<director版本包>/install-script/mytools/nic_curing目录下，执行如下命令： 
`mkdir -p /etc/udev/rules.d
cp nic_name.sh /root/
cp 10-nic-name.rules /etc/udev/rules.d
cd /root && sh nic_name.sh` 
每个节点重复执行上述操作。 
#### 准备模板 
摘要 : 
TECS Director使用daisyseed工具来部署，所以需要定义模板。首先手动编辑模板文件（excel格式），根据环境HLD规划，填写模板中的参数，最后一键生成daiyseed工具可识别的tcf模板文件。
步骤 : 
参考[软件版本]，获取并解压模板包，解压后的文件如[图1]所示。
图1  模板文件
双击打开Deploy_Summary_Template_年月日.xlsm文件，模板打开时需要启用宏。 
依次填写UserLLD、网络配置和节点配置这三个sheet页。
填写UserLLD，如[图2]所示。
图2  UserLLD
 说明： 
UserLLD模板填写注意事项： 
版本配置默认无法修改，模板随版本制作时，已经自动填上配套的版本文件（如果需要修改版本配置，则可以通过编辑summary_version_list.json，编辑完成后关闭Deploy_Summary_Template_年月日.xlsm后重新打开，即可完成自动填充） 
"对接第三方IaaS" 选择否 
“控制节点规格”中硬盘大小需要设置为服务器或虚机所有硬盘大小之和。 
“PXE”和“PXE#子网掩码”daisyseed服务器上PXEserver的地址和掩码 ，PXE地址池用户自己规划分配给被部署节点使用，地址池需要和“PXE”地址在同一个网段内。 
存储配置根据环境规划进行设置大小。“部署方式”为裸机时，支持在多硬盘分区操作，在控制节点存储配置中的配额后添加具体的硬盘名，例如80|/dev/sdb；注意分区大小之和不能超过该分区总大小，比如sdb上有PG 100 G  kafka有100G 则sdb要大于210 G=100+100+10（多预留10 G）“部署方式”为预置节点时，默认是2块盘（vda/vdb）,存储配置都在vdb上，6个分区的总和要小于节点上vdb盘大小-10（预留10G空间），若只有1块盘时，在生成的paas模板中的节点存储模板sheet页中将对应的/dev/vdb修改成/dev/vda；6个分区的总和要小于节点上sda（或vda)实际大小减去430 G ，例如：节点sda有1.2 T大小，则填写的6个分区总和要小770 G（1200-430） 
共享存储卷ElasticSearch备份：如果非容灾环境则默认值20 G，如果容灾环境配置为50 G。FTP：如果需要上传使用镜像文件，则可以最大给到共享存储卷的80%，如果没有镜像文件，则使用默认值100 G。 
“版本信息” 检查版本信息是否和实际获取到的版本相同，如果版本不一致，需要手动修改模板中版本信息。               
填写网络配置，物理机网络配置如[图3]所示，租户网络配置（可选）如[图4]所示，虚机网络配置如[图5]所示。
图3  网络配置（物理机）
 说明： 
物理机场景注意事项： 
物理机场景模板不支持单网卡组网，一定要bond组网 
外部网络 包括运维网络、北向网络、TECS Client网络、Public API网络、容灾网络、Sto-Mgt网络（存储网络管理面） 
内部网络 包括 NET-API网络 
存储网络 包括Sto-Data网络（存储网络数据面） 
VIP和地址池中的地址不能重复 
VIP、地址池、网关、 路由下一跳地址都要在cidr范围内 
“运维网络”VIP填写运维网络浮动IP，地址池填写分配给三个节点的运维IP地址 
“内部网络”VIP分配50个地址，地址池要写两段，第一段地址分配20个，第二段地址分配1024-20-50=954个左右 
“Director北向”“Director Public Api”“Director Tecs Client”“容灾网络”VIP设置为空，地址填写在地址池中，并写成地址段格式，例如 1.1.1.1-1.1.1.1 
容灾场景注意事项： 
"容灾功能" 选择 开启 
“容灾网络”，只能选择单栈（ipv4或者ipv6） 
casssandra容灾网络对端地址要依次写出来用逗号隔开，建议写9个，便于后续扩容节点 
图4  配置租户网络
 说明： 
配置租户网络注意事项： 
“是否配置租户网络”选择开启，用户即可配置租户网络：在关闭容灾功能的情况下，可配置的租户网络为3个：opcs、zenap、director；在开启容器功能的情况下可配置的租户网络为4个：opcs、zenap、director和openpalette-extention。 
租户网络的vlan必须在内部网络的vlan范围内，并且cidr不可与内部网络的cidr相同，租户网络之间的cidr也不可配置相同。 
在生成模板后，其中director-VM.xlsx模板的裸机租户网络sheet页中会显示配置的租户网络信息。 
网络平面为共网络平面时： 
内外部使用的网卡为同一对，此时所有的物理网络平面的名称都为physnet0。 
在生成模板后，其中的paas-VM.xlsx模板的应用网络配置sheet页中，基础网络名称也是physnet0（与内部网络的物理网络平面名称一致）。 
图5  网络配置（虚机）
 说明： 
虚机场景注意事项： 
运维网络”VIP填写运维网络浮动IP，地址池填写预置虚机所有节点的真实运维IP地址（固化到虚机网卡文件的net_iapi运维网络地址） 
内部网络”VIP分配20个地址，地址池至少填写12+2个地址，地址池中前N个（节点个数）地址为固化到虚机网卡文件的net_api内部网络地址 
“Director北向”VIP默认不填，地址池填写北向网络IP地址（若TecsClient、PublicApi 和北向三网独立，那么填写规则和北向一致） 
VIP和地址池中的地址不能重复 
VIP、地址池、网关、 路由下一跳地址都要在对应cidr范围内 
业务网络（北向网络、publiapi网络、tecsclient网络、容灾网络、对象存储管理网络等）中地址池信息中填写规划的地址信息 
容灾场景注意事项： 
"容灾功能" 选择 开启 
“容灾网络”，只能选择单栈（ipv4或者ipv6） 
填写节点配置，物理机节点配置如[图6]所示，虚机节点配置如[图7]所示。
图6  节点配置（物理机）
图7  节点配置（虚机）
 说明： 
物理机场景注意事项： 
“Host Name”不能有下划线 
网络平面MANAGEMENT是指内部网络（NET-API） 
网络平面TECSClient是指运维网络 
Port Name写端口名称，但E9000刀片则需要写mac地址，其他类型服务器写端口名称即可（如果该网络是bond模式，则可填写bond中任意端口） 
部署的服务器为E9000刀片时，Server Type需要选择ZTE-E9000-G4-BLADE。（选择ZTE-E9000-G4会导致部署出现报错） 
外接存储场景注意事项（仅涉及预置卷场景，非预置卷不涉及）iscsi target：值为 “<iscsi地址>:3260”  ipv6地址要加中括号，例如"[2025:806::32:101]:3260" 。支持多路径，用英文逗号分隔，例如“192.168.64.2:3260,192.168.64.3:3260”设备名称：   磁阵卷时，从磁阵上查到卷的wwn，如下图。需要注意，主机侧multipath -l看到的卷wwn前面会多一个数字'3'，配置时，'3'不能带ceph卷时，值的格式为"rbd/<存储池pool名称>/<卷名称>"iqn名称：可以自己定义，但是要确保节点唯一iqn名称定义后，在磁阵或ceph上创建主机或映射组时，需要用到主机iqn时，就使用这里自定义的值在部署过程中OS安装完成以后、iscsi登录磁阵或ceph之前，会固化到主机的/etc/iscsi/initiatorname.iscsi文件中 
虚机场景注意事项： 
“Host Name”不能有下划线（可置空） 
net_api_ip填写预置虚机内部网络地址的真实地址（即节点固化到网卡文件的内部网络net_api地址）。 
net_iapi_ip填写预置虚机运维网络地址的真实地址（即节点固化到网卡文件的内部网络net_api地址）。 
网络平面北向、PublicApi、容灾网络、对象存储管理网络 ，对应Director挂载网络使用的网卡mac地址 
虚机uuid需要填写预置虚机对应的真实的id 
切换到UserLLD页面，单击检查按钮，对模板数据进行校验，弹出对话框提示检查通过。
单击开始按钮，选择生成的目录位置，会同时生成1个配置文件（seed_cmd_config.ini）和4个模板文件（daisyseed-BM.xlsx、director-BM.xlsx、paas-BM.xlsx、tecs-BM.xlsx），模板文件需要手动保存关闭。
 说明： 
vmware资源池部署Director，需要手动修改paas-VM.xlsx文件才能使用，否则会部署失败。 
修改方法： 
开由summary生成的paas-VM.xlsx，找到“节点配置”sheet页，查看“存储配置模板”中使用模板信息。 
在“节点存储模板”sheet页，找到对应的模板内容，修改dev/vdX为dev/sdX（X为a或b）。 
#### daisyseed准备 
##### Linux虚机场景daisyseed准备 
摘要 : 
介绍虚机场景daisyseed准备。 
步骤 : 
搭建daisyseed部署机。 
上传daisyseed工具包。注意需要Daisyseed主机和paas的net_iapi网络打通（步骤1搭建daisyseed虚机时已经打通）。 
本地解压TCFV7.22.10.06P01_tools.tar,解压后进入daisyseed目录，找到daisyseed_linux_TECSV7.22.10_rel_1081.tar 
将daisyseed_linux_TECSV7.22.10_rel_1081.tar上传至daisyseed虚机/root下 
创建/root/daisyseed_v3/目录（注意:虚机创建后，可能已经存在daisyseed_v3目录，需要先手动删除rm -rf daisyseed_v3） 
解压版本：cd /root/daisyseed_v3/ && tar -xf /root/daisyseed_linux_*.tar 
对齐版本目录：mv /root/daisyseed_v3/daisyseed_linux_* /root/daisyseed_v3/daisyseed 
更新daisyseed虚机依赖库。 
`cd /root/daisyseed_v3/daisyseed/daisyseed_env_pkg
sh prepare_mimosa8.2.sh` 
上传配置模板。 
上传paas、tecs、daisyseed、director四个模板到daisyseed虚机/root/daisyseed_v3/daisyseed/config_files目录下。 
上传配置文件seed_cmd_config.ini到 /root/daisyseed_v3/daisyseed/daisyseed/template目录下。 
上传版本包到/root/daisyseed_v3/daisyseed/versions目录下。 
##### Windows系统daisyseed准备 
摘要 : 
介绍Windows系统daisyseed准备。 
前提 : 
准备一台Windows系统设备（可以是笔记本、台式机、服务器、虚机等） 
至少一个目录剩余空间大于30G  
该设备网络需要和节点的PXE网络、BMC网络和SSH运维网络互通 
步骤 : 
解压TCFV7.22.10.09_tools.tar。 
在解压后的目录中找到daisyseed目录，将daisyseed_win_TECSV7.22.10_rel_1363.7z上传到Windows系统设备上，放在剩余空间大于30G的目录，并执行解压。 
在daisyseed解压后的目录中找到config_files目录，将[准备模板]中生成的.xlsx模板文件上传到此目录下。
将[准备模板]中生成的seed_cmd_config.ini上传到\daisyseed\template目录。
上传版本到version目录。 
### 执行部署 
#### 命令行部署 
摘要 : 
介绍在linux系统下如何使用命令行执行部署。 
步骤 : 
执行部署，分为两种情况： 
重新部署停止Daisyseedsudo ps -ef|grep -E "app.py" |grep -v grep|awk '{print $2}'|xargs -i kill -9 {}清理前一次部署状态Install Statecd /root/daisyseed_v3/daisyseed/daisyseed/output/state/
rm -rf *启动 Daisyseednohup python3 /root/daisyseed_v3/daisyseed/daisyseed/app.py > seed.log 2>&1 &启动部署（前面步骤执行完，建议等待30秒，再执行）python3 /root/daisyseed_v3/daisyseed/daisyseed/seed_cmd.py 
/root/daisyseed_v3/daisyseed/daisyseed/template/seed_cmd_config.ini 
断点续装python3 /root/daisyseed_v3/daisyseed/daisyseed/seed_cmd.py /root/daisyseed_v3
/daisyseed/daisyseed/template/seed_cmd_config.ini --redeploy=no 
查询部署日志 
SSH到daisyseed，切换到root用户，执行如下命令查询部署进展（部署时长大概需要180-240分钟左右） 
`tail -f /root/daisyseed_v3/daisyseed/daisyseed/output/daisyseed.log` 
出现如下的日志代表部署完成。 
登录账户： 
`director  portal ：https://<tecsclient IP>/uportal    admin /Zenap_123!@
tcf portal : https://<运维网络浮动IP>:1043/ngportal   admin /Keystone123    
director/Keystone123
daisy portal：https://<运维网络浮动IP>:18080  dmin /Keystone123` 
查看PaaS控制节点部署日志（此日志不一定在首节点，需要查看每个节点）： 
`tail -f /var/log/cosmos_deploy.log` 
如果PaaS部署失败初步定位 
`pdm-cli task list
pdm-cli task show uuid|grep fail` 
查询PaaS是否部署成功 
`pdm-cli paas_status get` 
#### 图形界面部署 
摘要 : 
介绍Windows系统下如何使用图形界面进行部署。 
步骤 : 
进入daisyseed目录，双击Daisyseed.bat，打开DaisySeed图形界面，如[图1]所示。
图1  DaisySeed图形界面
单击普通模式下的使用，单击切换至安装部署页面，如[图2]所示。
图2  安装部署页面
场景选择网产品，应用勾选director，安装方式：物理机选择默认安装，虚机选择预制节点并部署，模板类型选择分离模板，Daisyseed模板选择刚才上传到config_files目录下的daisyseed-BM.xlsx，TECS模板选择tecs-BM.xlsx，OpenPalette模板选择paas-BM.xlsx，director模板选择director-BM.xlsx。
单击确定按钮，在弹出的确认框中再次单击确定。可能会弹出警告检查项不过，如[图3]所示，预留端口和全零监听报错可以忽略，其他报错查看模板配置是否配置错误。
图3  警告
如果确认没问题，可以忽略报错 ，单击继续部署，页面上显示部署进度，如[图4]所示。
图4  部署进度
等待一定时间（一般3.5小时，根据硬件规模和性能的差异时间可能有差异），所有步骤部署完成。 
登录账户： 
`director  portal ：https://<tecsclient IP>/uportal    admin /Zenap_123!@
tcf portal : https://<运维网络浮动IP>:1043/ngportal   admin /Keystone123   
director/Keystone123
daisy portal：https://<运维网络浮动IP>:18080  admin /Keystone123` 
### 部署后处理 
#### 安全加固 
安全加固的操作，参见《安全加固操作指南》。
#### 系统license申请和导入 
参考《TECS Director License申请操作指南》进行license申请和导入。
### FAQ 
#### Daisyseed搭建 
##### 物理机Linux系统daisyseed准备 
摘要 : 
介绍物理机Linux系统daisyseed准备。 
步骤 : 
搭建daisyseed部署机
以5300服务器搭建daisyseed为例，登录服务器BMC界面，选择设置→启动方式
，启动设备选择光驱，如[图1]所示。
图1  设置启动方式
进入服务器KVM界面，加载镜像文件到虚拟光驱，如[图2]所示。
图2  加载镜像文件
选择Power→Reset Server
，重启服务器，进入配置页面，如[图3]所示。
图3  配置页面
移动光标到Partitions，回车，移动光标到Change Partition Size，回车，设置Customize partition为No，如[图4]所示。
图4  设置
移动光标到Network，配置network ，根据网络规划，配置的大网ip，选择网卡，单双栈，ip地址，掩码、网关等信息。 
移动光标选择Install，安装daisyseed操作系统，如[图5]所示。安装完成后，默认登录用户密码为：ubuntu/UbuntU1!2@3#4$   用sudo -i切换到root用户。
图5  安装操作系统
安装后配置
（可选）扩容根分区。 
ssh登录daisyseed，切换到root用户，df -h查看磁盘分区。根分区剩余空间不能小于30G，否则需要扩容。 
##### 虚机linux系统daisyseed搭建 
摘要 : 
介绍虚机linux系统daisyseed搭建的方法。 
步骤 : 
使用admin账号登陆TECS，选择云管理→计算→规格
，打开规格页面。
单击添加虚机规格按钮，打开添加虚机规格页面。
创建daisyseed虚机规格（4核8G、50G硬盘），根据TECS资源池实际配置信息注意是否需要打开绑核巨页。 
（可选）端口ip可以创建（增加虚机的时候指定分配某个端口IP），也可以不创建（增加虚机的时候随机分配端口ip），选择项目管理→网络
，打开网络页面。找到tecslient网络和net_iapi运维网络，添加端口。
选择项目管理→存储→云硬盘
，打开云硬盘页面。
单击添加云硬盘按钮，打开添加云硬盘页面。
创建云硬盘，镜像使用和director节点相同镜像。 
选择项目管理→计算→虚机
，打开虚机页面。
单击添加虚机按钮，打开添加虚机页面。
创建虚机，选择从云硬盘启动创建虚机，选择上面步骤创建的云硬盘和端口。 
固化网络，将tecslient和net_iapi的IP地址固化到ifcfg-X网卡文件中，如[图1]所示。
图1  固化网络
（可选）扩充分区。查看daisyseed的根分区/，如果剩余空间小于30G，则需要进行扩容操作将剩余空间扩到大于30 G即可。 
##### daisyseed分区扩容 
###### 虚机扩容 
`[root@3c2627fe74ee49c4807c3fdf3c819c84 ~] fdisk /dev/vda
Welcome to fdisk (util-linux 2.32.1).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.
GPT PMBR size mismatch (41943039 != 209715199) will be corrected by write.
The backup GPT table is not on the end of the device. This problem will be corrected 
by write.
Command (m for help): n
Partition number (6-128, default 6):                                             
//使用默认值
First sector (41943007-209715166, default 41943040):   
//使用默认值                   
Last sector, +sectors or +size{K,M,G,T,P} (41943040-209715166, default 209715166): 
//使用默认值
Created a new partition 6 of type 'Linux filesystem' and of size 80 GiB.
Command (m for help): t
Partition number (1-6, default 6):                    //使用默认值
Partition type (type L to list all types): 8e            
Type of partition 6 is unchanged: Linux filesystem.
Command (m for help): w
The partition table has been altered.
Syncing disks.
[root@3c2627fe74ee49c4807c3fdf3c819c84 ~] partprobe
[root@3c2627fe74ee49c4807c3fdf3c819c84 ~]  pvcreate /dev/vda6        
数字6根据实际调整，由前面步骤Partition number确定的
  0
  Physical volume "/dev/vda6" successfully created.
[root@3c2627fe74ee49c4807c3fdf3c819c84 ~] vgextend vg_sys /dev/vda6           
数字6根据实际调整，由前面步骤Partition number确定的
  0
  Volume group "vg_sys" successfully extended
[root@3c2627fe74ee49c4807c3fdf3c819c84 ~] vgs                查询有79G可以进行扩容
  VG     PV LV SN Attr   VSize  VFree
  vg_sys   3   1   0 wz--n- 98.87g 79.99g
[root@3c2627fe74ee49c4807c3fdf3c819c84 ~]  lvextend -L +79G /dev/mapper/vg_sys-lv_root
  Size of logical volume vg_sys/lv_root changed from <18.88 GiB (4833 extents) to 
<97.88 GiB (25057 extents).
  Logical volume vg_sys/lv_root successfully resized.
[root@3c2627fe74ee49c4807c3fdf3c819c84 ~] vgchange -a y vg_sys
  1 logical volume(s) in volume group "vg_sys" now active
[root@3c2627fe74ee49c4807c3fdf3c819c84 ~] resize2fs /dev/mapper/vg_sys-lv_root
resize2fs 1.45.4 (23-Sep-2019)
Filesystem at /dev/mapper/vg_sys-lv_root is mounted on /; on-line resizing required
old_desc_blocks = 3, new_desc_blocks = 13
The filesystem on /dev/mapper/vg_sys-lv_root is now 25658368 (4k) blocks long.
[root@3c2627fe74ee49c4807c3fdf3c819c84 ~] df -h                 //root扩容成功   
Filesystem                  Size  Used Avail Use% Mounted on
devtmpfs                    3.7G     0  3.7G   0% /dev
tmpfs                       3.7G     0  3.7G   0% /dev/shm
tmpfs                       3.7G  580K  3.7G   1% /run
tmpfs                       3.7G     0  3.7G   0% /sys/fs/cgroup
/dev/mapper/vg_sys-lv_root   97G  3.4G   89G   4% /
/dev/vda3                   976M  166M  744M  19% /boot
/dev/vda2                   100M   18M   83M  18% /boot/efi
tmpfs                       746M     0  746M   0% /run/user/1000` 
###### 物理机扩容 
扩充VG 
` 原先硬盘还有 60G+ 的空间，通过fdisk在场面将未使用空间重新做个主分区。
[root@opencos_103 mapper] fdisk /dev/sda Welcome to fdisk (util-linux 2.23.2).
Changes will remain in memory only, until you decide to write them.Be careful 
before using the write command.
Command (m for help): nPartition type:p primary (3 primary, 0 extended, 1 free)e 
extendedSelect (default e): pSelected partition 4 First sector (151975936-286677119, 
default 151975936): Using default value 151975936Last sector, +sectors or +size
{K,M,G} (151975936-286677119, default 286677119): Using default value 
286677119Partition 4 of type Linux and of size 64.2 GiB is set
Command (m for help): tPartition number (1-4, default 4): 4Hex code (type L 
to list all codes): 8eChanged type of partition 'Linux' to 'Linux LVM'
Command (m for help): wThe partition table has been altered!
Calling ioctl() to re-read partition table.
WARNING: Re-reading the partition table failed with error 16: Device or resource 
busy.The kernel still uses the old table. The new table will be used atthe next reboot 
or after you run partprobe(8) or kpartx(8)Syncing disks.[root@opencos_103 mapper]
 重新发现一下硬盘分区
[root@opencos_103 ~] partprobe
 上面步骤新增了一个/dev/sda4 的分区，在上面创建 pv
[root@opencos_103 mapper] pvcreate /dev/sda4Physical volume "/dev/sda4" 
successfully created
 /盘是在 vg_sys 这个vg，所以将新增盘扩充到 vg_sys 这个vg 中
[root@opencos_103 mapper] vgextend vg_sys /dev/sda4Volume group "vg_sys" 
successfully extended
 扩充后，vg_sys大小改变了
[root@opencos_103 mapper] vgsVG PV LV SN Attr VSize VFree cinder-volumes 
1 0 0 wz--n- 20.11g 20.11gvg_sys 2 2 0 wz--n- 116.18g 64.23g
[root@opencos_103 mapper] df -kFilesystem 1K-blocks Used Available Use% 
Mounted on/dev/mapper/vg_sys-lv_root 51474912 6397064 42440024 14% 
/devtmpfs 8117320 0 8117320 0% /devtmpfs 8161104 0 8161104 0% 
/dev/shmtmpfs 8161104 42232 8118872 1% /runtmpfs 8161104 0 8161104 0% 
/sys/fs/cgroup/dev/sda1 388480 119076 244828 33% /boot` 
扩充LV（不建议对TECS 操作系统进行根目录进行扩充，可能导致系统启动失败） 
` 给 / 盘扩充 60G 空间
[root@opencos_103 mapper] lvextend -L +64G /dev/mapper/vg_sys-lv_rootExtending 
logical volume lv_root to 114.00 GiBLogical volume lv_root successfully resized
[root@opencos_103 mapper] vgchange -a y vg_sys2 logical volume(s) in volume 
group "vg_sys" now active
 此时还没有成功，还需要执行下一步
[root@opencos_103 mapper] resize2fs /dev/mapper/vg_sys-lv_root` 
命令执行成功 
`resize2fs 1.42.9 (28-Dec-2013)
Filesystem at /dev/mapper/vg_sys-lv_root is mounted on /; on-line resizing required
old_desc_blocks = 7, new_desc_blocks = 15
The filesystem on /dev/mapper/vg_sys-lv_root is now 29884416 blocks long.` 
命令执行失败 
执行失败后，执行 xfs_growfs -p -F  /dev/mapper/ncl-lv_P 命令 
`[root@opencos_103 mapper] df -h
Filesystem Size Used Avail Use% Mounted on
/dev/mapper/vg_sys-lv_root 113G 6.2G 101G 6% /
devtmpfs 7.8G 0 7.8G 0% /dev
tmpfs 7.8G 0 7.8G 0% /dev/shm
tmpfs 7.8G 42M 7.8G 1% /run
tmpfs 7.8G 0 7.8G 0% /sys/fs/cgroup
/dev/sda1 380M 117M 240M 33% /boot` 
` lvcreate创建卷组全部大小的逻辑卷LV
[root@host-10-47-205-42 ~] vgdisplay vg_irosdb
--- Volume group ---
VG Name vg_irosdb
System ID 
Format lvm2
Metadata Areas 1
Metadata Sequence No 1
VG Access read/write
VG Status resizable
MAX LV 0
Cur LV 0
Open LV 0
Max PV 0
Cur PV 1
Act PV 1
VG Size 100.00 GiB
PE Size 4.00 MiB
Total PE 25599
Alloc PE / Size 0 / 0 
Free PE / Size 25599 / 100.00 GiB
VG UUID rLVvv3-sJmc-8l8h-pkld-VrOA-UuEN-7yZcG3
[root@host-10-47-205-42 ~] lvcreate -l 25599 -n lv_irosdb vg_irosdb
Logical volume "lv_irosdb" created.` 
#### 单独部署TECS Director 
摘要 : 
本节介绍如何在不重新部署TCF平台版本的情况下部署TECS Director版本。通常适用于新版本TECS Director的重新安装。
步骤 : 
登录首节点，将JDK包和TCF-Director版本包上传到首节点，比如上传到/home/ubuntu。 
将TCF-Director版本包解压到/paasdata目录下。 
`tar -xvf /home/ubuntu/Director-V8.22.10.06.x64-TCF-20220325063000.tar -C 
/paasdata/` 
将JDK包解压到/paasdata/版本包/sources/director/director_commonimage_V1.0.0/base-images目录下。 
`tar -xvf /home/ubuntu/20220309120000-x64-TCF-openjdk.tar -C /paasdata/
Director-V8.22.10.06.x64-MEO/sources/director/director_commonimage_V1.0.0/
base-images/` 
复制配置文件到新版本解压目录下。 
老版本该路径：/paasdata/版本包/install-script/config/下的deployConfig.ini和cassandra_gr_network.json文件，复制到新版本相同路径下。 
执行部署前检查：（在install-script目录下执行） 
`sh check_before_install.sh
[root@paas-controller1:/paasdata/Director-V8.21.40.06.x64-TCF/install-script]$ sh 
check_before_install.sh
Please enter the number of nodes used by Director(1-3):   //输入环境的节点数
Please input tecs tcfportal page admin user password:         
//输入登录tecs tcf界面admin用户的密码
Please input tecs tcfportal page director user default password:     
//设置director用户登录tecs tcf
界面的密码（director用户此时还不存在，通过这个输入设置后续该用户登录密码）` 
执行部署：（在install-script目录下执行） 
IT子场景部署命令 （仅适用于TCF通用版本）nohup sh deploy.sh install scene=IT & 
CT子场景部署命令（仅适用于TCF通用版本）nohup sh deploy.sh install scene=CT & 
IT+CCM 场景部署命令：（适用于TCF通用版本、CCM版本、MEO版本）nohup sh deploy.sh install & 
#### 卸载TECS Director 
摘要 : 
介绍如何卸载TECS Director。 
步骤 : 
登录部署节点（有版本包的节点）。 
进入/paasdata/Director-VXXX/install-script目录： 
`[root@paas-controller-1:/home]$ cd /paasdata/Director-V8.22.20.04.x64-TCF/
install-script/ 
[root@paas-controller-1:/paasdata/Director-V8.22.20.04.x64-TCF/install-script]$` 
执行卸载操作： 
`[root@paas-controller-1:/home]$ nohup sh deploy.sh uninstall &` 
#### 部署网络不通常见遇到的问题 
问题描述：pdm-cli部署前检查报错，cat /root/nodes文件不对，网口注入信息错误。查看conf.json文件中场景为预置节点，不是"scenariotype": "baremetal"原因：paas模板文件中“容器平台承载类型”配置preset_node是错误的，应该为baremetal 
问题描述：os安装跳过pxe，直接开始bootstrap原因：seed_cmd_config.ini 配置文件中 preset=1，需要设置为空。;preset表示预置节点，默认为空，表示非预置，填1表示预置 
问题描述：daisyseed主机和paas节点主机ens4f0网卡都配置了native vlan 99，但是网卡上配置地址不通。原因：交换板native vlan和trunk vlan重叠了。switchport trunk native vlan 99，switchport trunk vlan 10-4000，使用no switchport trunk vlan 99，删除99的vlan后，地址可以ping通。 
问题描述：pxe发现是dhcp只试了一个就跳过了。原因：pxe网卡未设置，只有ens44f0为enable。设置PXE 开机F2→Advance-PXE， 根据mac地址确定ens4f0网卡，选择enable。 
问题描述：dhcp获取地址后没有下载操作系统文件，daisyseed显示dhcp超时。原因：daisyseed模板中mac地址错误，填写的不是dhcp网卡的地址。E9000刀片需要填写ip的网卡刚好是pxe的网卡的mac。 
#### 配置和更改外部时钟源 
摘要 : 
为保证时钟同步，TECS Director需配置外部时钟源。
本节介绍TECS Director时钟服务器状态检查及外部时钟源配置过程。
前提 : 
配置或者更改时钟前需要ssh登录到相应的控制节点。 
步骤 : 
检查chrony状态和时钟差
在该控制节点执行如下命令检查环境时钟服务是否正常。 
service chronyd status
返回状态为active，说明时钟服务正常，如[图1]所示。
图1  时钟服务正常示意
执行如下命令检查时钟服务器状态。 
chronyc sources
如[图2]所示，表示时钟服务器状态正常。
图2  时钟服务器状态正常示意
执行如下命令检查节点时间是否与当前时间一致，如[图3]所示。
pdm-cli date get
图3  检查节点时间是否与当前时间一致
如果...|那么...
---|---
时间差大于10分钟|转至步骤4
时间差小于等于10分钟|转至步骤6
执行如下命令，调整将节点时间，使节点与时钟服务器时间差小于等于10分钟，如[图4]所示。
pdm-cli date set <date> <time>
图4  调整节点时间
执行如下命令，整系统复位，如[图5]所示。
pmd-cli reboot
图5  整系统复位
登录Director的daisy界面。选择云配置→系统配置
，进入系统配置页面。
在时钟与时区页签的外部时钟同步配置区域，配置外部服务IP和Key，如[图6]所示。
图6  配置外部时钟同步IP
单击保存按钮，完成外部时钟源配置。
结果 : 
登录到director的控制节点上，执行如下命令，可查看当前时钟服务器状态，以^*开头表示时钟服务器状态正常，如[图7]所示。
chronyc sources -v 
图7  外部时钟配置结果
## 硬件配置 
### 基本概念 
TECS_Director_Hardware_Configuration 
#### 逻辑结构 

TECS Director是中兴通讯推出的电信级云管理平台，其核心理念在于物理位置分布，逻辑统一。逻辑统一即实现资源的整合和统一管理。
TECS Director系统的逻辑结构如[图1]所示。
图1  逻辑结构
 
TECS Director通过接口适配器接入多个数据中心的资源（包括物理资源+虚拟资源），构建分布式云资源池，对云资源池进行资源统一编排、管理和监控。 
 
TECS Director包括运维平台和运营平台。运维和运营平台即相互独立，又彼此关联、协同运转。
运维平台实现对所有数据中心的资源进行统一管理、调度和运维支持，并实现分权分域的管理。
运营平台提供运营支撑和统一的运营呈现界面。
 
 
门户系统是用户展示/运营/运维数据的系统，包括客户门户、运维管理门户、运营管理门户。
客户门户实现用户订购云服务，并对已有的虚拟化资产进行管理，包括虚拟资源的使用和释放等。例如对于虚拟机，用户可以进行启动、停止以及重启等操作，也可以释放这台虚拟机。
运维管理门户对云资源进行统一管理和维护，包括虚拟资源和物理资源的统一管理、异构虚拟资源的统一管理、资源的自动化配置、资源的监控和拓扑展示等。运维管理平台是为运营平台提供支撑，保证数据中心所支撑的业务的连续性。
运营管理门户提供账户管理、业务管理、资源管理和计费管理等功能。
 
 
TECS Director提供API开放能力，通过基于VDC或OpenStack原生的编程接口将分布式云资源池和服务提供给用户。 
 
#### 组网架构 
TECS Director的组网架构如[图1]所示。
图1  TECS Director的组网架构
TECS Director统一调度用户的虚拟化业务，通过DC内的各ZTE TECS OpenStack北向接口，下发各类VDC虚拟化资源的管理需求。 
TECS Director完成VDC管理，一个VDC可跨多个物理DC，一个物理DC可被多个VDC共享。租户无需关注DC，VDC是租户需要关注的最底层设施。 
各VDC是互相隔离的，每个VDC具备独立的租户通信网络和IP地址空间，甚至独立的管理。租户基于各自的VDC开发其业务，互不干扰。 
### 配置HP C7000硬件 
摘要 : 
本节介绍HP C7000相关的硬件配置信息，步骤如下： 
启动KVM 
时区配置 
RAID设置 
步骤 : 
启动KVM
登录OA管理界面，在默认机架图中，单击要管理的刀片，如[图1]所示。
图1  启动KVM-1
进入刀片菜单，在左侧导航栏单击iLO，如[图2]所示。
图2  启动KVM-2
单击Remote Console，启动KVM，如[图3]所示。
图3  启动KVM-3
配置时区
 说明： 
C7000机框是通过OA客户端管理网络从VIP提供的时钟服务器同步时钟，完成设备的时钟管理和同步。
登录OA管理界面，在左侧导航栏中选择Enclosure Information→Enclosure Settings→Date and Time 
，进入Date and Time页面。
选择Network Time Protocol (NTP) Settings ，填写客户提供的NTP服务器Primary NTP Server和Secondary NTP Server地址（可以只填写Primary NTP Server，建议主备两个都填写），再根据设备所在时区选择Time Zone，单击Apply保存，如[图4]所示。
图4  NTP设置
设置RAID
 说明： 
刀片默认为两块硬盘，要求配置成RAID1，配置之前检查RAID设置。 
在Device Bays菜单下，选择刀片，单击iLO，在右侧的窗口，选择Web Administration，如[图5]所示。
图5  Web Administration查询
单击左侧的System Information，在右侧窗口，单击Storage页签。如[图6]所示。
图6  Logical Drive信息
若未创建RAID，按如下方法设置： 
Reset重启刀片，按F10，进入Intelligent Provisioning界面，如[图7]所示。
图7  重启刀片-1
用上下键选择HP Smart Storage Administrator，在键盘上敲击回车，如[图8]所示。
图8  重启刀片-2
加载完毕后，如[图9]所示。
图9  重启刀片-3
单击Perform Maintenance，如[图10]所示。
图10  重启刀片-4
单击HP Smart Storage Administrator（SSA），如[图11]所示。
图11  重启刀片-5
单击Smart Array P244br，如[图12]所示。
图12  重启刀片-6
单击Configure，进入如[图13]所示界面。
图13  重启刀片-7
单击Arrays，检查Array配置，若出现No arrays found on the selected controller，则单击Create Array创建RAID，如[图14]所示。
图14  重启刀片-8
勾选Select All，选择硬盘，单击Create Array，出现Create Logical Drive页面，如[图15]所示。
图15  Create Logical Drive-1
选择RAID 1，单击Create Logical Drive，单击Finish，完成配置，如[图16]所示。
图16  Create Logical Drive-2
配置完成后，单击右上角图标退出，单击OK，如[图17]所示。
图17  完成配置
单击右上角图标，选择Reboot，重启刀片，如[图18]所示。
图18  重启刀片
### 配置ZTE E9000硬件 
摘要 : 
本节介绍ZTE E9000相关的硬件配置信息，步骤如下： 
启动KVM 
时区配置 
RAID设置 
步骤 : 
启动KVM
在刀片管理页面单击Blade进入Blade页面，单击要管理的刀片（本文以Blade15为例），在系统管理页面单击Go to iSAC（单击此处连接至iSAC），如[图1]所示。
图1  刀片管理
启动KVM。 
 说明： 
启动KVM前，java需要增加链接允许。 
单击KVM，进入KVM子页，单击Start KVM启动KVM，如[图2]所示。
图2  启动KVM
单击电源按钮，复位单板，如[图3]所示。
图3  复位单板
选择Power Reset，重启电源，如[图4]所示。
图4  重启电源
单击OK。
配置时区
在刀片管理界面单击Chassis子页，进入Chassis页面。
在左侧导航栏选择Chassis Configure→Time Setting
，在日期栏调整时间到当地时间，如[图5]所示。
图5  设置时间
设置好日期、时间、时区后，单击设置按钮，单击确定关闭提示框完成时间设置。
设置机框NTP服务如[图6]所示。
在Time Source Synchronization（同步时钟源）下勾选NTP Enable，打开NTP服务。 
在NTP Server Address（NTP服务器地址）中填写当前可用的NTP服务源地址。若此配置不正确或其它NTP请求异常，此机框会产生如下告警：SNTP请求失败告警(8392707)。 
根据相应提示填写Synchronous Cycle (Millisecond）（NTP服务同步周期（毫秒）)。 
当本地时间，即EBS机框时间(Time)中时间与NTP服务器源时间差超过Error Threshold(Millisecond)(误差阀值（毫秒）)的配置，则会上报同步告警：时钟同步超出门限告警(8392706)，此配置为0时，表示不上报告警。 
图6  设置机框NTP服务
设置RAID
将刀片插入机框，开始上电。 
一段时间后如果看到有以下的信息，如果信息表格中PRODUCT列的第二行内容是Logical Volume，表示已经做了镜像，如图7所示。图7  RAID配置-开始镜像 
如果看到以下信息，倒数第一行和第二行的PRODUCT不是Logical Volume时，表示还没有做镜像，如图8所示。图8  RAID配置-未做镜像 
若没有做镜像，重启系统，单击KVM区域，按Crtl+c，如[图9]所示。
图9  RAID配置-重启系统
出现如[图10]所示界面，选择Eval Board回车。
图10  RAID配置-4
 说明： 
如果是系统盘做RAID，需要设置boot order。 
进入Adapter Properties–SAS2008的界面，选择RAID Properties，回车，如[图11]所示。
图11  RAID配置-5
进入Select New Array Type–SAS2008界面，选Create RAID 1 Volume，回车，如[图12]所示。
图12  RAID配置-6
进入Create New Volume–SAS2008界面，移动光标到0号盘RAID Disk位置，按空格键，按c键确认创建volume，如[图13]所示。
图13  RAID配置-7
此时0号盘的RAID Disk变成Yes，如[图14]所示。
图14  RAID配置-8
上下键选择1号盘，按空格键，如[图15]所示。
图15  RAID配置-9
按C键确认创建volume，如[图16]所示。
图16  RAID配置-10
此时0号盘和1号盘的RAID Disk都变成Yes，按C键，创建RAID，如[图17]所示。
图17  RAID配置-11
选择Save changes then exit this menu，如[图18]所示。
图18  RAID配置-12
回退到Adapter Properties – SAS2008的界面，如[图19]所示。
图19  RAID配置-13
按两次ESC回退两次，出现退出提示界面，如[图20]所示。
图20  RAID配置-14
选择Exit the Configuration Utility and Reboot，单板会自动重启。
### 配置ZTE R5300硬件 
摘要 : 
本节介绍ZTE R5300相关的硬件配置信息，步骤如下： 
启动KVM 
时区配置 
RAID设置 
其中，R5300存在SAS3008和LSI9361两种硬盘，两种硬盘的RAID设置方式不同。 
步骤 : 
启动KVM
在BMC管理页面单击KVM进入KVM页面，单击左侧导航栏KVM
→KVM
，单击Start KVM按钮，如[图1]所示。
图1  启动KVM
单击上方的电源按钮选择Power Reset重启服务器，如[图2]所示。
图2  重启服务器
单击kvm区域，等待服务器复位，在如[图3]所示界面按F2/DEL键，进入BIOS设置。
图3  开机启动界面
配置时区
在BMC管理界面选择Device→Server→Device Configuration→Time Configuration
查看当地时间和时区，如[图4]所示。
图4  服务器时区设置界面
重启服务器进入BIOS配置主菜单，在System Time和System Date选项中使用+/-修改服务器时间，完成后按F10保存退出，如[图5]所示。
图5  服务器时间设置-1
在BMC Web界面勾选NTP Enable，输入NTP服务器IP地址，单击右上角的按钮保存，服务器会定时自动同步NTP服务器上的时间信息，如[图6]所示。
图6  服务器时间设置-2
（可选）设置SAS3008 RAID
启动KVM，参见[图1]。
将服务器上电。 
一段时间后如果看到有以下的信息，PRODUCT是Logical Volume时，表示已经做了镜像，如图7所示。图7  已配RAID硬盘的回显信息 
如果看到以下信息，倒数第一行和第二行的PRODUCT不是Logical Volume时，表示还没有做镜像，如图8所示。图8  未配RAID硬盘的打印信息 
若没有做镜像，重启系统，在如[图9]所示界面，按Crtl+c进入RAID卡配置界面手动配置RAID。
图9  进入RAID卡配置界面提示信息
当服务器使用两块硬盘时建议配置RAID1，当超过两块硬盘时（例如配四块硬盘时）建议配置RAID10。
在如[图10]所示界面，回车进入Adapter Properties – SAS3008的界面。
图10  RAID卡配置-1
进入Adapter Properties–SAS3008的界面，选择RAID Properties，回车，如[图11]所示。
图11  Select New Array Type – SAS3008界面
进入Select New Array Type–SAS3008界面，选Create RAID 1 Volume，回车，如[图12]所示。
图12  创建RAID界面
进入Create New Volume–SAS3008界面，移动光标到0号盘RAID Disk位置，按空格键，如[图13]所示。
图13  RAID配置界面
将两块硬盘的RAID Disk状态都修改为Yes后，按C键出现如下界面，选择Save changes then exit this menu确认创建volume，如[图14]所示。
图14  保存配置界面
确认操作后会出现正在创建RAID提示，之后会回退到Adapter Properties – SAS3008的界面，如[图15]所示。
图15  正在创建RAID
再次进入RAID Properties菜单确认创建的RAID状态是否正常，如[图16]所示。
图16  RAID参数查看界面
按Esc键直到回退到如[图17]所示界面，选择Exit the Configuration Utility and Reboot，稍后服务器会自动重启。
图17  重启服务器
（可选）设置LSI 9361 RAID
将服务器上电，在RAID卡初始化阶段按Ctrl+R进入LSI9361的BIOS配置界面，如[图18]所示。
图18  进入RAID卡配置界面提示信息
进入SAS 9361-8i BIOS配置界面可以查看到硬盘信息如[图19]所示，按键选项参见[表1]。
图19  SAS 9361-8i BIOS配置主界面
按键|功能说明
---|---
F1|显示所在特定屏幕的帮助。
F2|显示可以为所选设备执行的命令列表。此键仅在VD Mgmt、PD Mgmt和Foreign View菜单中可用。启用的命令以白色突出显示，禁用的命令以灰色突出显示。
F5|刷新目前所在的屏幕。
F11|在控制器之间切换。
F12|显示所有可用控制器的列表，也可以滚动到下一个控制器。
<Ctrl><N>|显示下一个菜单屏幕。
<Ctrl><P>|显示上一个菜单屏幕。
<Ctrl><S>|设置在控制器屏幕中的应用快捷键。
<Tab>|将光标移动到下一个控件。
<Shift><Tab>|将光标移动到屏幕或对话框上的上一个控件。
<Enter>|允许在列表框中选择菜单项、按钮、复选框和值。
<Esc>|关闭屏幕或窗口。按两次Esc退出Ctrl-R实用程序。
Up Arrow|将光标移动到下一个菜单选项。
Down Arrow|将光标移动到下一级菜单项或下一级菜单。
Right Arrow|打开子菜单，从菜单标题移动到第一个子菜单，或移动到子菜单中的第一个项目。右箭头也会在弹出窗口中关闭菜单列表。
Left Arrow|关闭子菜单，从菜单项移动到菜单标题或从子菜单移动到更高级别菜单。
Spacebar|允许选择菜单项，按钮和复选框。
MegaRAID SAS 9361-8i创建RAID（以RAID1为例），将光标移动到AVAGO MegaRAID SAS 9361-8i，按F2弹出操作菜单，选择Create Virtual Drive，如[图20]所示。
图20  创建RAID界面
在Create New VD页面依次进行如下设置，如[图21]所示。
图21  RAID配置界面
在Create New VD页面依次进行如下设置：
参数名称|设置说明
---|---
RAID Level|将光标移动至RAID Level后，选择RAID-1。
Drives|按Space键选择RAID1成员盘，选择后对应硬盘前的【】内会出现X号，表示此盘已被选择；（RAID0至少需要选择一块硬盘，RAID1需要选择两块硬盘，RAID5至少需要三块硬盘，RAID6和RAID10至少需要四块硬盘），当服务器使用两块硬盘时建议配置RAID1，当超过两块硬盘时（例如配四块硬盘时）建议配置RAID10。
Size|选择RAID组成员盘后，Size栏会自动更新此RAID的大小，RAID1的容量即为一块硬盘的大小。
Name|给RAID组命名，用于区别其他的RAID组。
如果需要配置更详细的RAID参数，可将光标移动至Advanced处，单击进入RAID参数配置界面，如[图22]所示。
图22  RAID参数选择界面
参数名称|设置说明
---|---
Strip Size|条带大小是位于驱动器组中单个虚拟驱动器上的条带部分。条带支持64 KB，128 KB，256 KB，512 KB或1 MB的大小。
Read Policy|虚拟驱动器属性，可选择Always Read Ahead或者No Read Ahead。Always Read Ahead：允许控制器先于所请求的数据顺序读取，并允许控制器将附加数据存储在高速缓冲存储器中。控制器需要频繁读取的数据。即使“始终预读”策略加速了顺序数据的读取，但当访问随机数据时改善很小。No Read Ahead：禁用控制器的预读取功能。
Write Policy|选择以下选项之一以指定此虚拟驱动器的写入策略。Write Back with BBU：在此模式下，控制器向主机发送数据传输完成信号，控制器缓存接收事务中的所有数据。如果选择回写策略并且电池是不存在，则固件将禁用回写策略。Write Through：在此模式下，控制器向主机发送数据传输完成信号，驱动器子系统接收事务中的所有数据。Always Write Back：在此模式下，控制器向主机发送数据传输完成信号，控制器缓存接收事务中的所有数据。
I/O Policy|I / O策略适用于特定虚拟驱动器上的读取。不会影响预读缓存。Cached：在此模式下，所有读取都缓存在高速缓存中。缓存I / O提供更快的处理。Direct：在此模式下，读取不会缓存在高速缓存存储器中。 数据同时传输到缓存和主机。如果再次读取相同的数据块，则从高速缓存存储器中读取。直接I / O确保缓存和主机包含相同的数据。
Disk cache policy|为此虚拟驱动器选择高速缓存设置Enable：开启驱动器缓存。Disable：关闭驱动器缓存。Unchanged：可以基于启用/禁用驱动器高速缓存将驱动器高速缓存策略更新为Unchanged。
Emulation|允许将虚拟驱动器上的仿真类型设置为默认或无。Forced选项强制仿真在控制器上设置。可能的选项是Default、Disabled或者Forced。
Initialize|Volume的快速初始化，一般要勾选，清除原来硬盘信息；如果要保留硬盘原有数据，则不要勾选。
Configure HotSpare|创建热备盘，如不使用即不勾选。
Disable BGI|背景初始化。
完成RAID参数配置后，单击OK即可成功创建RAID，且自动返回到VD Mgmt界面，并且会有初始化完成的提示，如[图23]所示。
图23  RAID初始化完成提示信息
单击OK，创建完成的RAID1信息，如[图24]所示。
图24  配置完成后的RAID组信息
## 配置指南 
概述 : 
TECS_Director_Data_Configuration_Guide 
#### 配置指南概述 
TECS Director支持对云资源进行统一管理和维护，包括用户安全管理、资源纳管、运维管理和运营管理。
用户安全管理是TECS Director的重要组成部分。通过安全管理，系统管理员可以管理用户、角色、账户规则，从而实现拥有不同权限的用户对不同网络资源的访问和管理。详情参见“安全管理”。 
资源纳管是物理上分布的资源构建成逻辑上统一的云资源池，进行资源统一管理。详情参见“资源配置管理”、“公有云管理”和“系统管理”。 
运维管理为系统的运维管理人员提供集中性能、集中告警和日志分析等运维手段。为监控人员提供性能仪表盘监视云平台的运行性能状态。针对运维管理的详细操作，参见“操作指南”。 
运营管理提供运营支撑，统一呈现运营界面，提供了符合客户组织模型的运营管理体系。用户可以根据需求定制化各种服务，满足用户多样化的业务场景。详情参见“组织和VDC管理”和“虚机发布管理”。 
登录TECS Director
在Google Chrome浏览器地址栏中输入管理门户网站网址https://*.*.*.*/uportal（*应修改为现场实际TECS Director的Tecs Client平面的浮动IP），打开TECS Director管理门户网页。
输入用户名、密码和验证码，单击登录按钮。
 说明： 
用户第一次登录TECS Director时，需要使用预设的超级管理员账户登录，创建操作所需的用户。系统预设的超级管理员账户默认登录名为admin，默认密码为Zenap_123!@#。 
用户第一次登录系统时将被要求修改密码。 
用户第一次登录系统后，需导入许可证，操作步骤参见“导入许可证”。 
### 安全管理 
安全管理是TECS Director的重要组成部分。通过安全管理，系统管理员可以管理用户、角色、账户规则，从而实现拥有不同权限的用户对不同网络资源的访问和管理，保障TECS Director系统正常、可靠地持续运行。
#### 安全管理简介 

用户组、用户、角色、操作集和资源分组的关系模型如[图1]所示。
图1  安全管理关系模型
 
用户组表示一组用户的集合。 
 
用户是终端用户或者API调用者，用户至少隶属于一个用户组，如果创建时候不分配，则会属于系统的默认用户分组。 
 
角色是系统中权限的范围，包括可以管理的资源范围和操作范围，角色分配给用户后，用户拥有该角色范围内的权限。 
 
操作集是系统中各种增删改查等操作权限组成的集合，是组成角色的一部分。 
 
资源与业务相关，图标、菜单等都可以抽象为资源。 
 
#### 角色管理 
作为电信级云管理平台，TECS Director系统定义了提供方和使用方2大类用户角色。提供方提供资源和服务，使用方使用资源和服务。这2大类用户角色又可以详细划分为如下角色。
角色类别|角色名称|角色功能
---|---|---
提供方|安全管理员|进行安全数据维护、调整资源所属组织,没有业务相关权限。
系统管理员|提供方|不具备维护安全信息的权限,除此之外对管理系统及被管网络有不受限制的完全访问权。
系统维护员|提供方|不具备维护安全信息及管理系统的权限,除此之外具有被管网络的所有权限。
系统操作员|提供方|可进行一般的配置修改,不能对管理系统本身进行备份恢复等维护工作,不能修改敏感的资源配置信息。
系统监控员|提供方|可对网络信息进行浏览。
领域管理员|提供方|接入数据中心的资源，构建和管理云资源池。组织VDC生命周期管理。
业务经理|提供方|组织VDC生命周期管理。
工单指派人|提供方|查看审计日志，查看及指派工单。
工单处理人|提供方|处理工单。
级联云管管理员|提供方|查询报表和云管级联。
使用方|组织管理员/子组织管理员|用户生命周期管理和组织资源管理监控，发布虚机。
端用户|使用方|自服务门户操作、管理。
##### 新建操作集 
摘要 : 
操作集为角色具有的操作权限，是组成角色的一部分。 
本节介绍新建操作集的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→角色管理
，打开角色管理页面，如[图1]所示。
图1  角色管理页面
单击操作集，切换到操作集页签，如[图2]所示。
图2  操作集页签
单击+新建操作集按钮，打开新建操作集页面，如[图3]所示。
图3  新建操作集页面
在基本信息中填写操作集名等信息，在操作集分配情况中分配该操作集具备的权限。
单击新建按钮，完成操作集的创建。
结果 : 
新建完成的操作集出现在角色管理页面中操作集页签下的操作集列表中。
##### 修改操作集 
摘要 : 
修改已成功创建的操作集，除操作集名以外，操作集相关的其它属性均可以修改。 
本节介绍修改操作集的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。 
已新建操作集。 
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→角色管理
，打开角色管理页面。
单击操作集，切换到操作集页签，如[图1]所示。
图1  操作集页签
单击待修改操作集操作列下的修改按钮，打开修改操作集页面，如[图2]所示。
图2  修改操作集
根据规划修改对应参数，单击确定按钮，完成操作集修改。
结果 : 
修改完的操作集信息更新在角色管理页面操作集页签下的操作集列表中。
##### 删除操作集 
摘要 : 
对于不再需要的操作集，用户可以删除操作集。 
本节介绍删除操作集的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。 
已新建操作集。 
相关信息 : 
 小心！ 
删除某个操作集会导致关联该操作集的角色发生权限变化，拥有这些角色的登录用户会被强制注销。 
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→角色管理
，打开角色管理页面。
单击操作集，切换到操作集页签，如[图1]所示。
图1  操作集页签
单击待删除操作集操作列下的删除按钮，打开删除操作集对话框，如[图2]所示。
图2  删除操作集
单击删除按钮，完成操作集的删除，系统右上角出现删除成功的提示框。
结果 : 
已删除的操作集不再显示在角色管理页面操作集页签下的操作集列表中。
##### 新建角色 
摘要 : 
根据设定的安全管理规划，创建需要的角色。 
本节介绍新建角色的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→角色管理
，打开角色管理页面，如[图1]所示。
图1  角色管理页面
单击角色页签下的+新建角色按钮，打开请选择您要创建的角色窗口，如[图2]所示。
图2  选择创建的角色
根据规划选择要创建的角色。 
创建区域安全管理员角色。选中区域安全管理员角色前的单选框，单击确定按钮，打开新建角色页面，如图3所示。图3  新建区域安全管理员填写角色名称等基本信息，并选择分配给该角色的权限。 说明：其中，如果勾选锁定该角色右侧的复选框，该角色中设置的权限对用户不生效。单击新建按钮，完成区域安全管理员的创建。 
创建其他角色选中其他角色前的单选框，单击确定按钮，打开新建角色页面，如图4所示。图4  新建其他角色在基本信息中，填写角色名称等信息。 说明：其中，如果勾选锁定该角色右侧的复选框，该角色中设置的权限对用户不生效。权限分配中的两个信息框，左侧为资源列表，右侧为操作集列表（安全管理员权限除外）。在左侧资源列表中选中待分配操作集的资源，在右侧操作集列表中选择分配的操作集。（可选）将鼠标移动到某个资源右侧，将出现两个按钮，如图5所示，可以为该资源快捷设置权限。图5  快捷设置权限按钮按钮说明设置当前资源的权限与其上级节点一致。同步当前资源的下级节点权限与当前资源一致。每个资源左侧的图标含义如下：图标说明当前资源的权限设置已跟随上级节点。当前资源的权限设置未跟随上级节点。单击新建按钮，完成其他角色的创建。 
结果 : 
新建完成的角色显示在角色管理页面中角色页签下的角色列表里。
##### 修改角色 
摘要 : 
修改已成功创建的角色，除角色名称以外，角色相关的其它属性均可以修改。 
本节介绍修改角色的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。 
已新建角色。 
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→角色管理
，打开角色管理页面。
在角色页签下的角色列表中，单击待修改角色操作列下的修改按钮，打开修改角色页面，如[图1]所示。
图1  修改角色页面
根据规划修改对应参数，单击确定按钮，完成角色修改。
结果 : 
修改完的角色信息更新在角色管理页面角色页签下的角色列表中。
##### 查看角色分配用户 
摘要 : 
角色管理支持查看分配了当前角色的用户。 
本节介绍查看角色分配用户的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。 
已创建角色。 
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→角色管理
，打开角色管理页面。
单击操作列下的查看用户按钮，打开查看用户页面，查看系统默认角色或用户新建角色分配的用户，如[图1]所示。
图1  查看角色分配用户
单击关闭按钮，关闭查看页面。
##### 删除角色 
摘要 : 
对于不再需要的角色，用户可以删除角色。 
本节介绍删除角色的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。 
已新建角色。 
相关信息 : 
系统默认角色无法删除。 
如果用户（非上级系统下发）只分配了该角色，则用户会被删除，已登录的用户会被强制注销。如果用户还分配了其他角色或角色集，则只删除该角色。 
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→角色管理
，打开角色管理页面。
在角色页签下的角色列表中，单击待删除角色操作列下的更多→删除
按钮，打开删除角色对话框，如[图1]所示。
图1  删除角色
单击删除按钮，完成角色的删除，系统右上角出现删除成功的提示框，如[图2]所示。
图2  删除成功
结果 : 
已删除的角色不再显示在角色管理页面角色页签下的角色列表中。
##### 复制角色 
摘要 : 
用户可通过复制角色功能创建权限一致的新角色。 
本节介绍复制角色的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。 
已新建角色。 
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→角色管理
，打开角色管理页面。
在角色页签下的角色列表中，单击被复制角色操作列下的更多→复制
按钮，打开复制角色对话框，如[图1]所示。
图1  复制角色
根据规划填写角色名称等信息。
单击确定按钮，完成角色的复制。
结果 : 
复制完成后，新的角色信息更新在角色管理页面角色页签下的角色列表中。
#### 用户管理 

通过用户管理，系统管理员可以新建、查询、修改、删除用户，为用户分配权限等。 
实际操作中，可以使用已创建用户的用户名和密码登录TECS Director系统，在其赋予的权限范围内实现配置及操作。
##### 新建用户 
摘要 : 
安全管理员用户在TECS Director中新建用户后，用户可以使用新创建的账户登录，在其拥有的权限范围内进行操作。
本节介绍新建用户的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。
相关信息 : 
新建领域管理员用户时，在权限分配的角色中需要勾选领域管理员和安全管理员。 
新建组织管理员用户时，在权限分配的角色中需要勾选组织管理员、安全管理员和工单处理人，具体参见添加组织管理员。 
新建子组织管理员用户时，在权限分配中需要勾选子组织管理员和安全管理员，具体参见创建子组织管理员。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→安全管理→用户管理
，打开用户管理页面，如[图1]所示。
图1  用户管理页面
单击+新建用户按钮，打开新建用户页面，默认显示基本信息页签，如[图2]所示。
图2  新建用户-基本信息
根据规划填写参数，部分参数说明参见[表1]。
参数|说明
---|---
用户名|新建用户的用户名，即该用户的登录名称。
随机密码|如果采用自定义密码，密码和确认密码为必填项。如果采用随机密码。勾选随机密码前的复选框，新建用户页面如图3所示。其中用户名和电子邮箱为必填项，系统生成的随机密码将以邮箱形式通知。
密码|用户登录时必须输入的口令，长度必须满足所选账户规则的要求。
用户规则|选择账户规则，默认使用默认规则。
用户组|选择用户所属用户组，默认为根用户组。
同时登录数限制|设置使用该用户名同时登录TECS Director的用户数量。默认为1个用户，2个用户同时登录就会被限制，用户可根据实际需要进行修改。如果选择全局选项，对该用户的同时登录限制数量和参数配置中的全局配置保持一致。关于同名用户同时登录限制的全局配置，参见“配置参数”。
图3  新建用户-基本信息（采用随机密码）
单击下一步按钮，切换到权限分配页签，如[图4]所示。
图4  新建用户-权限分配
根据规划选择租户和角色。
单击新建按钮，完成新用户的创建，系统弹出新建用户成功的提示，如[图5]所示。
图5  新建用户成功
结果 : 
新建完成的用户将显示在用户管理页面的所有用户列表中。
##### 修改用户 
摘要 : 
修改已成功创建的用户信息，除用户名以外，用户相关的其它属性均可以修改。 
本节介绍修改用户的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。 
已经创建用户。 
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→用户管理
，打开用户管理页面，如[图1]所示。
图1  用户管理页面
在所有用户列表中，单击待修改用户操作列下的修改按钮，打开修改用户页面，默认显示基本信息页签，如[图2]所示。
图2  修改用户-基本信息
根据规划修改对应参数，单击下一步按钮，切换至权限分配页签，如[图3]所示。
图3  修改用户-权限分配
根据规划修改对应参数，单击确定按钮，完成用户修改。
结果 : 
修改完的用户信息将更新在用户管理页面所有用户列表中。
##### 删除用户 
摘要 : 
对于不需要的用户，系统管理员可以执行删除用户的操作。 
前提 : 
使用安全管理员账户登录TECS Director。 
已新建用户。 
相关信息 : 
系统默认的admin管理员无法删除。 
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→用户管理
，打开用户管理页面。
在所有用户列表中，单击待删除用户操作列下的删除按钮，打开删除用户对话框，如[图1]所示。
图1  删除用户
单击删除按钮，完成用户删除，系统右上角出现删除成功的提示框，如[图2]所示。
图2  删除成功
结果 : 
已删除的角色不再显示在用户管理页面所有用户列表中。
##### 复制用户 
摘要 : 
用户可通过复制用户功能创建权限相同的新用户。 
本节介绍复制用户的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。 
已新建用户。 
相关信息 : 
系统默认的admin管理员无法复制。 
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→用户管理
，打开用户管理页面。
在所有用户列表中，单击被复制用户操作列下的更多→复制
按钮，打开复制用户对话框，如[图1]所示。
图1  复制用户
根据规划填写复制用户参数。 
单击复制按钮，完成用户复制，系统右上角出现复制用户成功提示框，如[图2]所示。
图2  复制用户成功
结果 : 
复制完成后，新的用户信息更新在用户管理页面所有用户列表中。
##### 查看用户权限 
摘要 : 
用户管理支持查看所有已创建用户的权限。 
本节介绍查看用户权限的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→用户管理
，打开用户管理页面。
根据规划查看用户的权限。 
如果...|那么...
---|---
查看系统默认admin用户权限|单击admin操作列下的权限按钮。
查看安全管理员创建的用户权限|选择待查看用户操作列下的更多→权限。
打开查看用户权限对话框，其中显示了该用户具有的权限，如[图1]所示。
图1  查看用户权限
##### 修改当前用户密码 
摘要 : 
TECS Director支持修改当前登录系统的用户密码。
本节介绍修改当前用户密码的步骤。 
步骤 : 
使用正确的账户密码登录TECS Director系统。
单击顶部导航菜单的按钮，在弹出的菜单中选择修改密码，打开当前用户密码设置页面，如[图1]所示。
图1  当前用户密码设置
根据规划输入相关参数，单击确定按钮，完成密码修改。
##### 批量修改密码 
摘要 : 
用户管理支持批量修改用户的密码，所有被选用户的密码被修改为同一密码。 
本节介绍批量修改密码的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。
相关信息 : 
只能批量修改不具有系统管理员和安全管理员角色的用户密码。 
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→用户管理
，打开用户管理页面，如[图1]所示。
图1  用户管理页面
在所有用户操作区内，单击批量修改密码按钮，打开批量修改密码页面，如[图2]所示。
图2  批量修改密码
根据规划填写修改的密码，并勾选待修改密码用户左侧的复选框，将用户添加到右侧已选项列表中。 
单击确定按钮，完成用户密码批量修改，系统右上角出现批量修改密码成功的提示框，如[图3]所示。
图3  批量修改密码成功
##### 新建用户组 
摘要 : 
用户组可以进行用户的划分。 
本节介绍新建用户组的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→用户管理
，打开用户管理页面。
单击用户组/个图标，切换至用户组页面，如[图1]所示。
图1  用户组页面
将鼠标移到待添加用户组的根节点上，根节点的右侧出现按钮，单击按钮，打开新建用户组对话框，如[图2]所示。
图2  新建用户组
根据规划填写用户组相关参数。 
单击新建按钮，完成用户组创建，系统右上角出现新建用户组成功的提示框，如[图3]所示。
图3  新建用户组成功
相关任务 : 
在用户组页面，新建完成的用户组支持以下操作： 
如果...|那么...
---|---
修改用户组|单击用户组名称，右侧用户组信息操作区中显示当前用户组的信息。单击修改按钮，用户组信息变为可编辑状态。其中，用户组名称所属用户组不可修改。根据规划修改对应参数，单击确定按钮，完成用户组修改。
删除用户组|单击用户组名称，右侧用户组信息操作区中显示当前用户组的信息。单击删除按钮，打开删除对话框。在删除对话框中单击删除按钮，完成用户组的删除。
##### 管理登录用户 
摘要 : 
用户管理支持管理登录用户，包括查看登录用户信息、强制退出及设置登录用户告警门限。 
本节介绍管理登录用户的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。 
当前系统有用户登录。 
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→用户管理
，打开用户管理页面。
单击登录用户会话数图标，切换至登录用户会话数页面，如[图1]所示。
图1  登录用户会话数
登录用户列表中显示了当前登录用户的用户名、客户端IP、登录时间和闲置时间信息。 
（可选）采用以下任一方法强制退出当前用户。 
单击待强制退出用户操作列下的强制退出按钮。 
勾选多个用户左侧的复选框，单击列表上方的强制退出按钮，对用户进行批量强制退出。 
（可选）设置登录用户数告警门限。 
单击登录用户会话数告警门限设置按钮，打开登录用户会话数告警门限设置对话框，如[图2]所示。
图2  登录用户会话数告警门限设置
根据规划设置相关参数。登录用户会话数达到告警门限时，系统将产生相应告警。 
单击确定按钮。
##### 解锁用户 
摘要 : 
用户在某些操作下会被锁定，例如在登录输入的错误密码次数较多时，系统会提示该用户被锁定，当用户锁定超过账号规则中的锁定时长后，用户会自动解锁。如需手动解锁用户，需要安全管理员登录后进行操作。 
本节介绍手动解锁用户的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。 
系统存在被锁定用户。 
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→用户管理
，打开用户管理页面。
单击锁定用户/人图标，切换至当前锁定用户操作区，如[图1]所示。
图1  当前锁定用户
当前锁定用户列表中显示了被锁定用户的用户名、锁定者IP和锁定时间信息。
单击待解锁用户操作列下的解锁按钮，完成被锁定用户的解锁，系统右上角出现解锁成功提示框，如[图2]所示。
图2  解锁成功
##### 批量导入组织用户 
摘要 : 
组织用户包括组织管理员、子组织管理员和端用户。TECS Director支持组织管理员通过导入文件的方式，批量导入组织用户。
本节介绍批量导入组织用户的步骤。 
前提 : 
使用组织管理员登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运维→租户资源管理→组织管理
，打开组织管理页面，选择要添加用户的组织，单击组织名称，打开组织详情页面，如[图1]所示。
图1  组织详情页面
单击更多→导入用户
按钮，打开导入用户页面，如[图2]所示。
图2  导入用户页面
（可选）如果没有用户数据文件，用户可下载用户模板，自定义后导入。 
单击下载用户模板，下载用户模板文件。
打开用户模板文件，根据提示填写相关参数，如[图3]所示。
图3  用户模板文件
 说明： 
在角色列下填写组织管理员、子组织管理员或端用户，为组织添加具有相应权限的用户。 
一个模板内可填写多条用户信息，一行数据即为一条用户信息。 
保存编辑好的模板文件。 
单击上传文件，在弹出的对话框中选择已有的子组织模板文件。
 说明： 
模板文件仅支持.xlsx格式，一次只能上传一个文件。
单击对话框中的打开按钮，上传子组织模板文件。
根据规划选择是否打开重复数据覆盖开关。
如果...|那么...
---|---
不打开重复数据覆盖开关|如果模板中用户名称和系统中已有用户重复，则导入失败，失败原因为用户已存在。
打开重复数据覆盖开关|如果模板中用户名称和系统中已有用户重复，则导入成功，系统自动将模板中的用户覆盖原有用户。
根据规划填写用户初始密码和确认初始密码，此密码为导入用户首次登录TECS Director的验证口令。
单击导入按钮，完成用户的导入，系统提示导入用户完成，并显示用户的导入情况，如[图4]所示。
图4  导入用户完成提示
相关任务 : 
在导入用户页面，可在用户数据导入结果区域查看导入用户的状态及结果。
#### 账户规则 

账户规则规定了账号的密码策略、锁定规则、账号策略及允许登录IP范围等规则。不同账号可以有不同的账号规则，在账户规则页面，安全管理员可以进行账户规则的新建、修改、删除等操作。
##### 新建账户规则 
摘要 : 
本节介绍新建账户规则的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→安全管理→账户规则
，打开账户规则页面，如[图1]所示。
图1  账户规则页面
单击+新建规则按钮，打开新建账户规则页面，如[图2]所示。
图2  新建账户规则
根据规划设置账户规则。 
单击新建按钮，完成账户规则的创建，系统右上角出现新建账户规则成功提示框，如[图3]所示。
图3  新建账户规则成功
结果 : 
新建完成的账户规则将显示在账户规则页面的账户规则列表中。
相关任务 : 
在账户规则页面，新建完成的账户规则支持如下操作：
如果...|那么...
---|---
快捷启用强密码检测|打开该账户规则强密码列下的开关。
快捷禁用强密码检测|关闭该账户规则强密码列下的开关。
快捷设置首次登录时必须修改密码|打开该账户规则首次登录时必须修改密码列下的开关。
快捷设置首次登录时不用修改密码|关闭该账户规则首次登录时必须修改密码列下的开关。
快捷设置锁定规则|单击该规则锁定规则列下的菜单，在出现的下拉菜单中选择永不锁定、暂时锁定或永久锁定。
##### 修改账户规则 
摘要 : 
本节介绍修改账户规则的步骤。 
前提 : 
使用安全管理员账户登录TECS Director
相关信息 : 
系统预设的默认规则和API访问规则无法修改。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→安全管理→账户规则
，打开账户规则页面。
单击待修改账户规则操作列下的修改按钮，打开修改账户规则页面，如[图1]所示。
图1  修改账户规则
修改账户规则页面与新建账户规则页面形式一致，根据规划修改相关参数。其中，规则名称不可修改。 
单击确定按钮，完成账户规则的修改，系统右上角出现修改账户规则成功的提示框，如[图2]所示。
图2  修改账户规则成功
##### 删除账户规则 
摘要 : 
本节介绍删除账户规则的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。
相关信息 : 
系统预设的默认规则和API访问规则无法删除。 
删除账户规则后，该规则关联的用户，其账户规则都变为默认账户规则。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→安全管理→账户规则
，打开账户规则页面。
单击待删除账户规则操作列下的删除按钮，打开删除对话框，如[图1]所示。
图1  删除账户规则
单击确定按钮，完成账户规则的删除，系统右上角出现删除成功的提示框，如[图2]所示。
图2  删除成功
##### 绑定用户 
摘要 : 
绑定用户功能可以为用户设置相应的账户规则。 
本节介绍为账户规则绑定用户的步骤。 
前提 : 
使用安全管理账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→安全管理→账户规则
，打开账户规则页面。
单击绑定用户按钮，打开绑定用户页面，如[图1]所示。
图1  绑定用户
在账户规则下拉菜单中选择待设置的账户规则。
在左侧所有用户列表中选中待绑定的用户，选中的用户出现在右侧已选用户列表中。 
单击确定按钮，完成用户的绑定。系统右上角出现绑定用户成功的提示框，如[图2]所示。
图2  绑定用户成功
#### 配置参数 
摘要 : 
参数配置包括认证相关配置、登录横幅相关配置及接入系统配置。 
本节介绍配置参数的步骤。 
前提 : 
使用安全管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏的按钮，选择更多→安全管理→参数配置
，打开参数配置页面，如[图1]所示。
图1  参数配置
单击修改按钮，参数配置页面变为可编辑状态，如[图2]所示。
图2  编辑参数
根据规划设置相关参数。 
单击确定按钮，完成参数配置。系统右上角出现修改成功提示框，如[图3]所示。
图3  修改成功
#### 配置认证方式 
摘要 : 
认证方式配置包括本地、RADIUS、LDAP/LDAPS、LDAP/LDAPS+本地、4A票据和天翼云认证，用户可根据规划进行相应的配置。
前提 : 
使用超级管理员账户登录TECS Director。
相关信息 : 
认证方式配置默认的认证方式是本地。 
使用RADIUS认证时，登录TECS Director所使用用户的用户名及密码是保存在RADIUS服务器上的，但是服务器上需要同步创建相同用户，以便于为该用户分配TECS Director中的角色。例如，用于登录TECS Director的用户名为test，那么需要在服务器中创建test用户，并为其分配相应角色。 
使用LDAP/LDAPS认证方式，LDAP采用目录方式保存数据。LDAP认证把用户数据放在LDAP服务器上，通过LDAP服务器上的数据对用户进行认证处理。 
使用LDAP/LDAPS+本地认证方式，优先使用LDAP/LDAPS认证方式，如果失败则采用本地认证方式。 
步骤 : 
单击TECS Director顶部导航菜单的按钮，选择更多→安全管理→认证方式配置
，打开认证方式配置页面，如[图1]所示。
图1  认证方式配置页面
单击修改按钮，认证方式配置页面的参数变为可编辑状态，如[图2]所示。
图2  配置认证方式
根据规划在认证方式下拉菜单中选择相应的认证方式，并配置相关参数。
如果...|那么...
---|---
选择Radius认证方式|参见步骤4.~6.。
选择LDAP/LDAPS认证方式|参见步骤7.~9.。
选择LDAP/LDAPS+本地认证方式|参见步骤10.~12.。
在认证方式下拉列表框中选择Radius，认证方式配置页面如[图3]所示。
图3  Radius认证方式
根据规划配置相关参数，部分参数说明参见[表1]。
参数|说明
---|---
Radius服务器IP地址|Radius服务器所在机器地址（例如 10.62.106.220）
Radius服务器端口|Radius服务器端口（一般是1812）
Radius密钥|认证服务器的秘钥
单击确定按钮，完成认证方式的配置。系统右上角出现修改认证方式成功的提示框，如[图4]所示。
图4  修改认证方式成功
在认证方式下拉列表框中选择LDAP/LDAPS，认证方式配置页面如[图5]所示。
图5  认证方式配置
根据规划配置相关参数，部分参数说明参见[表2]。
参数|说明
---|---
用户基底|DC=zte,DC=intra
用户DN后缀|@zte.intra
用户角色|系统监控员
证书文件和密码|证书需要从LDAP服务器获取
单击确定按钮，完成认证方式的配置。系统右上角出现修改认证方式成功的提示框，如[图6]所示。
图6  修改认证方式成功
在认证方式下拉列表框中选择LDAP/LDAPS+，认证方式配置页面如[图7]所示。
图7  LDAP/LDAPS+本地认证方式
根据规划配置相关参数，部分参数说明参见[表3]。
参数|说明
---|---
用户基底|DC=zte,DC=intra
用户DN后缀|@zte.intra
用户角色|系统监控员
证书文件|证书文件需要从LDAP服务器获取
证书密码|证书密码需要从LDAP服务器获取
 说明： 
用户基底和用户DN后缀仅供参考，现场以对接的ladp服务器参数为准。 
单击确定按钮，完成认证方式的配置。系统右上角出现修改认证方式成功的提示框，如[图8]所示。
图8  修改认证方式成功
在认证方式下拉列表框中选择天翼云，认证方式配置页面如[图9]所示。
图9  天翼云认证方式
参照[图9]中示例配置相关参数，单击确定按钮，完成认证方式的配置。
#### 管理密钥 
摘要 : 
介绍如何启用密钥中心功能以及管理业务私钥。 
步骤 : 
选择更多→系统管理→配置中心→系统配置
，进入系统配置页面。
选择安全设置→密钥管理
，打开密钥管理配置页面，如[图1]所示。
图1  密钥管理
单击修改，系统询问是否启用密钥中心，如[图2]所示。
图2  启用密钥中心
选择是，单击确定，系统提示启用秘钥中心，将无法关闭。单击确定，启用密钥中心。
刷新界面，选择配置中心→密钥管理
，打开密钥管理页面，如[图3]所示。
图3  密钥管理
密钥管理中列出了各应用对应的业务私钥，单击操作栏的更新按钮，更新密钥。
单击操作栏的查看密钥按钮，查看密钥，如[图4]所示。
图4  查看密钥
### 资源配置管理 
在TECS Director系统中，Domain是一组物理DC（Data Center）的集合，这些DC具有相同的治理模型。Domain由领域管理员统一管理，形成一个统一入口、资源统一调度的联邦。
领域管理员可对资源进行纳管配置，流程如[图1]所示。
图1  领域管理员资源纳管配置流程
#### 添加数据中心 
摘要 : 
数据中心是为一个或多个组织安置、管理、支持那些被认为至关重要的计算、网络和存储资源的设施。 
本节描述添加数据中心的配置过程。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→数据中心→概览
，打开数据中心页面，如[图1]所示。
图1  数据中心页面
单击+添加数据中心按钮，打开添加数据中心页面，如[图2]所示。
图2  添加数据中心页面
根据规划填写相关参数。 
 说明： 
位置为数据中心所在城市名字的全拼。 
系统默认的数据中心组为default，如需添加新的数据中心组，参见设置分域。 
单击添加按钮提交信息，等待数秒，在返回的数据中心页面显示新增的数据中心。
单击已添加的数据中心名称，打开数据中心详情页面，如[图3]所示。
图3  数据中心详情页面
在数据中心详情页面，可查看该如下5个子页面，参见[表1]。
页面名称|说明
---|---
概览|查看该DC下的资源信息、基本信息和资源统计。
故障回溯|可以使用时间段、告警发生/恢复时间、云环境和对象类型作为查询条件，查询相应的告警信息。
对接环境|可以查看云环境、容器云、物理环境和网络环境信息。单击云环境名称，可以查看云环境的虚拟资源和物理资源详情。
虚拟资源|查看该DC下的虚拟资源详情。
容器资源|查看该DC下的容器资源详情。
物理资源|查看该DC下的物理资源详情。
相关任务 : 
在数据中心详情页面，单击基本信息栏中的，可编辑数据中心的基本信息，如[图4]所示。
图4  编辑数据中心
#### 配置云环境 
##### 添加云环境 
摘要 : 
云环境是指能够从虚拟化的资源池中向用户或者各种应用系统按需提供计算能力、存储能力或者虚拟机服务等的数据环境。用户创建主机集群或虚机前必须先创建云环境。 
本节描述添加云环境的配置过程。 
前提 : 
使用领域管理员账户登录TECS Director。 
已在OpenStack端创建对接用户。具体操作参见在TECS OpenStack创建对接用户。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→数据中心→云环境
，打开云环境页面，如[图1]所示。
图1  云环境页面
单击+添加云环境按钮，打开添加云环境页面，如[图2]所示。
图2  添加云环境页面
 说明： 
若输入的不是https协议，离开输入框时，会弹出“建议使用安全性较高的HTTPS为非加密传输协议”的提示。 
根据规划填写相关参数，参数说明参见[表1]。
参数|说明
---|---
云环境名称|根据规划填写。
物理位置|云环境所在的物理位置。
类型|包括openstack+kvm、openstack+vcenter、openstack+cas和openstack+vsuite。
供应商|云环境的供应商。
数据中心名称|该云环境所属数据中心名称。
可用区|候选可用区列表是数据中心规划创建且未被其他云环境使用的可用区，若无空闲可用区，请编辑数据中心进行增加。
Openstack认证URL|填写访问Openstack原生API接口的认证URL。如果为keystone下沉前的版本（对应3.17.15之前版本和6.10.10.03之前的版本）：https://IP:443 (其中IP为云环境的public api浮动地址)如果为keystone下沉后的版本（对应3.17.15之后版本和6.10.10.03之后的版本以及tecs7.0系列版本）：https://IP:5000 (其中IP为云环境的public api浮动地址)
Provider认证URL|填写访问Openstack原生API接口的认证URL。如果为keystone下沉前的版本（对应3.17.15之前版本和6.10.10.03之前的版本）：https://IP:443 (其中IP为云环境的public api浮动地址)如果为keystone下沉后的版本（对应3.17.15之后版本和6.10.10.03之后的版本以及tecs7.0系列版本）：https://IP:5000 (其中IP为云环境的public api浮动地址)
Provider门户URL|填写跳转到Provider门户的URL。https://IP:443 (其中IP为provider的tecsclient浮动地址，端口一般为443，较新的版本为44300，也可以支持自定义端口，如果daisy上看不到知名端口改配页，则端口填写为443)。
Keystone版本|底层Keystone的版本号。
默认租户|一般默认为admin，由TECS OpenStack侧提供。
用户名|TECS OpenStack的登录用户名。对接参数，由TECS OpenStack侧提供。
密码|TECS OpenStack的登录密码。对接参数，由TECS OpenStack侧提供。
描述|根据规划填写。
 说明： 
填写内容应与OpenStack中的设置相符。 
单击添加按钮提交信息，等待数秒，在返回的云环境页面显示新增的云环境。
相关任务 : 
在云环境页面的云环境列表中，可对云环境进行如下操作：
单击云环境名称，打开云环境详情页面，支持查看云环境的概览、虚拟资源和物理资源等详情。对于V3的云环境，还支持查看云环境的项目详情及绑定的用户情况。 
在操作列中，选择相应的下拉菜单项可对云环境进行删除、编辑、编辑标签、设置部署策略、单点登录和重置密码操作。 说明：当对接的云环境密码发生变更后，需要在TECS Director上重置该云环境的密码。 
在操作列中，单击配置中心，可为云环境设置云硬盘类型、资源等级、网络、功能开关、证书、对接信息和API版本信息，如图3所示。图3  云环境配置中心 说明：其中，云环境和TECS Director对接时，可以配置认证方式为单向认证或双向认证。单向认证为TECS Director认证云环境的根证书。双向认证为TECS Director和云环境互相认证双方证书。证书管理的具体操作参见管理证书。若在对接信息中配置了虚拟化层门户URL，则云环境详情页出现登录IECS按钮，支持跳转至IECS。 
##### 配置云环境单点登录 
摘要 : 
单点登录是指用户只需登录TECS Director，即可无密码访问已添加的云环境。
本节介绍配置云环境单点登录的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
创建用户组
登录provider云环境，选择系统管理→组
，打开组页面，如[图1]所示。
图1  组
单击创建组按钮，选择项目和角色都是admin，创建成功后如[图2]所示。
图2  创建组
获取IDP ID
登录云环境daisy界面，选择云配置→SSO配置
，进入SSO配置页面，如[图3]所示。
图3  SSO配置页面
单击增加按钮，弹出添加IDP对话框，如[图4]所示。
图4  添加IDP
根据规划填写IPD Metadata URL。
 说明： 
最新的TECS Director版本用https://192.168.183.245/api/v1.0/vrm/saml2/metadata，其中192.168.183.245 为TECS Director的publicApi浮动地址。
IDP ID不用填写，系统会自动生成。
单击增加按钮，在云环境创建用户组，如[图5]所示。
图5  创建用户组
填写参数，用户类型选择临时用户，属性名填写openstack_user，用户组所在域名选择Default，用户组名选择步骤1~2中创建的用户组，单击确认按钮，完成用户组创建。
在添加IDP页面下方的用户组列表中，单击详细信息，打开IDP详细页面，如[图6]所示，图中红色标注的即为对接参数IDP ID。
图6  IDP详细页面
开启单点登录开关
单击TECS Director顶部菜单栏中的按钮，选择基础设施→数据中心
，打开数据中心页面，在左侧导航树中选择数据中心→云环境
，打开云环境页面，如[图7]所示。
图7  云环境页面
选择要配置单点登录的云环境，单击操作列下的配置中心，打开配置中心页面，如[图8]所示。
图8  配置中心页面
切换到功能开关页签，如[图9]所示。
图9  功能开关页签
打开单点登录开关，单击确认按钮。
配置单点登录
在云环境页面，选择要配置单点登录的云环境，单击操作列下的单点登录，弹出设置单点登录对话框，如[图10]所示。
图10  设置单点登录页面
服务提供方Url是自动生成的（若端口自动生成的是443需要改成5000），填写IDP ID，IDP ID获取方法参见步骤8。 
单击添加，增加本地用户和外部映射关系。用户名选择admin，VIM上用户组选择daisy配置步骤6中的用户组。
单击确认，完成云环境单点登录的配置。
 说明： 
在TECS Director上单击云环境的URL(url的地址是provider的publicAPI浮动地址)跳转若出现402 Payment Required错误，则需要在provider上加白名单，执行/var/lib/provider/scripts/provider_ky_host_ip_whitelist.sh   add "10.229.124.110:40051" 命令，其中10.229.124.110为TECS Director web登录地址。
##### 配置DPM及DRS 
摘要 : 
DRS（Dynamic Resource Scheduler）和DPM（Dynamic Power Management）属于vmware vSphere资源管理中的功能。
DRS（Dynamic Resource
Scheduler）为自动阈值调度系统，当系统在资源集群内的某些节点资源使用率（CPU、内存）超过设置的阀值后，可以通过虚机迁移等手段，将虚拟机从高负载节点迁移到低负载的节点，均衡集群内各节点的资源使用，以保证服务质量。
DPM（Dynamic Power Management）为动态电源管理系统。 
当系统在资源集群内某些节点的资源使用率（CPU、内存）低于设置的阀值后，出于节约能源的考虑，可以将虚拟机通过热迁移集中到某些节点上，提高资源利用率，同时把空闲节点下电，来达到节约能耗的效果。
当系统在资源集群内某些节点的资源使用率（CPU、内存）高于设置的阀值后，将已下电的节点上电，通过DRS将虚拟机从高负载节点迁移到空闲节点，以保证服务质量。
在TECS中，可以集成开源watcher项目来实现类似的DRS、DPM功能。Watcher是OpenStack的一个资源优化项目，为基于OpenStack的云环境提供灵活的、可扩展的资源优化服务。
本节介绍配置DPM和DRS的步骤。 
前提 : 
TECS OpenStack环境需要KVM的环境，并且已安装有watcher组件。 
使用领域管理员账户登录TECS Director。 
步骤 : 
打开DRS/DPM开关
单击TECS Director顶部菜单栏中的按钮，选择基础设施→数据中心→云环境
，打开云环境页面，如[图1]所示。
图1  云环境页面
单击待设置云环境操作列下的配置中心按钮，打开配置中心页面，如[图2]所示。
图2  设置功能开关
单击功能开关，切换至功能开关页签，如[图3]所示。
图3  功能开关页签
打开DRS/DPM后的开关，如[图4]所示。
图4  开启DRS/DPM功能
单击确认按钮，打开DRS/DPM功能。
配置DRS功能
单击TECS Director顶部菜单栏中的按钮，选择基础设施→计算
，默认打开可用域页面，在左侧导航树中选择计算→主机集群
，打开主机集群页面，如[图1]所示。
图5  主机集群页面
单击满足要求的主机集群名称，进入主机集群详情页面，如[图6]所示。
图6  主机集群详情页面
单击动态资源调度，进入动态资源调度子页面，如[图7]所示。
图7  动态资源调度
单击+添加策略按钮，打开创建DRS调度策略对话框，如[图8]所示。
图8  创建DRS调度策略
根据规划设置各个参数阈值，具体说明参见[表1]。
参数名称|定义
---|---
CPU上限阀值|主机CPU使用率（百分比）如果主机的CPU使用率超过此门限执行基于CPU资源的动态资源均衡。设置为100表示关闭基于CPU资源的动态资源均衡功能。
CPU下限阀值|主机CPU使用率（百分比）如果主机的CPU使用率低于此门限执行基于CPU资源的动态资源集中。设置为0表示关闭基于CPU资源的动态资源集中功能。
内存上限阀值|主机内存使用率（百分比）如果主机的内存使用率超过此门限执行基于内存资源的动态资源均衡。设置为100表示关闭基于内存资源的动态资源均衡功能。
内存下限阀值|主机内存使用率（百分比）如果主机的内存使用率低于此门限执行基于内存资源的动态资源均衡。设置为0表示关闭基于内存资源的动态资源集中功能。
时间间隔|策略执行的时间间隔，默认值为5分钟。设置值不能小于5分钟。
执行方式|设置自动还是手动方式执行优化动作。自动方式在策略检测到有需要进行动态资源优化的主机时，会自动执行优化操作。手动方式则只生成优化操作建议，需要手动触发资源优化操作。
单击调度策略，在右侧操作栏下面的各个按钮，可以对调度策略进行相关操作。
单击进入调度记录页面，查看生成的具体调度记录。
单击操作列下的子任务按钮，可查看子任务的详情。
配置DPM功能
在导航栏中选择计算节点，打开主机集群页面。
单击满足要求的主机集群名称，进入主机集群详情页面。
单击动态电源管理，进入动态电源管理子页面，如[图9]所示。
图9  动态电源调度
单击添加策略按钮，进入创建DPM调度策略页面，如[图10]所示。
图10  创建DPM调度策略
根据规划设置各个参数阈值，具体说明参见[表2]。
参数名称|说明
---|---
空占比|空闲主机和已使用主机数量的百分比若空闲主机的数量超过了设置的阀值，会将超出的主机下电以节约能源。若空闲主机的数量低于了设置的阀值，会将已下电的主机上电以保证服务质量。最少保留一个空闲主机。
时间间隔|策略执行的时间间隔，默认值为5分钟。设置值不能小于5分钟。
执行方式|设置自动还是手动方式执行优化动作。自动方式在策略检测到有需要进行动态电源管理的主机时，会自动执行上（下）电操作。手动方式则只生成优化操作建议，需要手动触发上（下）电操作。
单击调度策略，在右侧操作栏下面的各个按钮，可以对调度策略进行相关操作。
单击进入调度记录页面，查看生成的具体调度记录。
单击操作列下的子任务按钮，可查看子任务的详情。
#### 添加容器云 
摘要 : 
本节描述添加容器云的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→数据中心→容器云
，打开容器云页面，如[图1]所示。
图1  容器云页面
单击+添加容器云按钮，打开添加容器云页面，如[图2]所示。
图2  添加容器云
根据规划填写相关参数。 
参数|说明
---|---
容器云名称|根据规划填写。
类型|支持openpalette和openstack+k8s。
数据中心名称|选择容器云所属的数据中心。
可用区|候选可用区列表是数据中心规划创建且未被其他容器云使用的可用区，若无空闲可用区，请编辑数据中心进行增加。
认证URL|与openpalette对接的URL地址。对接参数，由openpalette对接方提供。
用户名|openpalette的登录用户名。对接参数，由openpalette侧提供。
密码|openpalette的登录密码。对接参数，由openpalette侧提供。
描述|根据规划填写。
单击添加按钮，完成容器云的添加。
结果 : 
等待数秒，参数正确的容器云状态栏变为。
相关任务 : 
在容器云列表的操作列中，可对已有的容器云进行删除、编辑、编辑标签和重置密码操作。
#### 添加网络环境 
摘要 : 
本节描述添加网络环境的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→数据中心→网络环境
，打开网络环境页面，如[图1]所示。
图1  网络环境页面
单击+添加网络环境按钮，打开添加网络环境页面，如[图2]所示。
图2  添加网络环境
根据规划填写相关参数，单击确认按钮，完成网络环境的添加。
相关任务 : 
网络亚健康监测
在添加网络环境页面，网络云环境添加可以支持的配置为U31、netinsight和U31+netinsight，如[图3]所示。
图3  添加网络环境页面
单击U31、netinsight等网络链接，可以跳转页面，如[图4]示。
图4  网络链接跳转页面
#### 添加主机集群 
摘要 : 
主机集群是指多台主机集合在一起的一个群组，对外表现为一个整体的资源实体。当需要调用主机集群内的资源时，这些资源由集群内的主机共同承担。 
本节描述添加主机集群的配置过程。 
 小心！ 
VMware环境不能移入移出集群。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→计算
，默认打开可用域页面，在左侧导航树中选择计算→主机集群
，打开主机集群页面，如[图1]所示。
图1  主机集群页面
单击+添加主机集群按钮，打开添加主机集群页面，如[图2]所示。
图2  添加主机集群页面
根据规划选择或填写相关信息，单击添加按钮，添加主机集群。
在数据中心页面中单击某个待查看的主机名称，进入该主机的信息页面，查看主机是否归属于某个主机集群，即所属主机集群是否为空。
（可选）为主机集群选择物理网络。 
在主机集群列表的操作列选择下拉菜单项编辑，打开编辑主机集群对话框，如[图3]所示。
图3  编辑主机集群
根据规划设置物理网络参数，单击确认按钮。
相关任务 : 
在主机集群页面中，单击操作列中的设置预留比例，可以对该集群的CPU和内存设置预留比例，如图4所示。图4  设置预留比例 
在主机集群页面中，单击操作列中的设置超分比例，可以对该集群的内核、内存和磁盘设置超分比例，如图5所示。图5  设置超分比例 
在左侧功能导航树中，选择计算→主机，打开主机页面，可进行如下操作。如果...那么...查看主机信息单击某个主机名称，进入该主机的信息页面，可查看主机是否归属于某个主机集群将主机移入主机集群在操作下拉列表框中单击移入/移出集群按钮，打开移入/移出集群页面。在主机集群下拉框中选择需要移入的主机集群。单击确认按钮。将主机移出主机集群在操作下拉列表框中单击移入/移出集群按钮，打开移入/移出集群页面。在主机集群下拉框中删除已有的主机集群。单击确认按钮。显示主机节点的可信状态单击右侧展开按钮，勾选可信状态选项。 说明：移入集群功能只适用于支持opencos的云环境。 
#### 添加SDN 
摘要 : 
SDN是软件定义网络（SDN）中的应用程序，负责流量控制。SDNC是基于OpenFlow等协议，允许服务器告诉交换机向哪里发送数据包。
云管平台所使用的SDN网络，包括SDN网络控制器和SDN网络管理中心。
SDN网络控制器是SDNC，用来管理控制SDN网络设备的数据流转发行为。 
SDN网络管理中心简称SDN网管，是指用来配置管理控制SDN网络设备的管理中心。 
本节描述添加SDN的操作步骤。
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
添加SDNC
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→网络
，默认打开SDN页面，如[图1]所示。
图1  SDN页面
在SDNC页签中单击+添加SDNC按钮，打开添加SDNC页面，如[图2]所示。
图2  添加SDNC
根据规划填写参数，参数说明参见[表1]。
参数|说明
---|---
名称|根据规划填写。
DC|SDNC所属DC。
IP版本|访问SDNC的网络协议，根据SDNC的地址进行选择。
认证URL|访问SDNC的地址，由SDNC管理员提供。
用户名|登录SDNC的用户名，由SDNC管理员提供。
密码|登录SDNC的密码，由SDNC管理员提供。
控制器厂商|根据规划选择厂商。
控制器型号|根据规划选择型号。
单击添加按钮。
添加SDN网管
切换至SDN网管页签，单击+添加SDN网管按钮，打开添加SDN网管页面，如[图3]所示。
图3  添加SDN网管
根据规划填写参数，参数说明参见[表2]。
参数|说明
---|---
SDN网管名称|根据规划填写。
所属厂家|SDN网管所属的厂家。
DC|SDN网管所属DC。
IP版本|访问SDN网管的网络协议，根据SDN网管的地址进行选择。
SDN网管URL|访问SDN网管的地址，由SDN网管管理员提供。
用户名|登录SDN网管的用户名，由SDN网管管理员提供。
密码|登录SDN网管的密码，由SDN网管管理员提供。
单击添加按钮。
#### 配置云网络 
云网络是指云环境所在的虚拟网络，包括网络、子网、路由器等。 
##### 添加云环境网络 
摘要 : 
TECS Director的云环境网络包括添加云环境网络、添加云环境子网和添加云环境端口。
本节描述添加网络的操作步骤。 
前提 : 
云环境已配置物理网络。 
使用获得相应操作权限的账户登录TECS Director。 
步骤 : 
添加网络
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→网络
，默认打开SDN页面。在左侧导航树中选择网络→云网络
，打开云网络页面，如[图1]所示。
图1  云网络页面
在网络页签下，单击+添加网络按钮，打开添加网络页面，如[图2]所示。
图2  添加网络
单击显示高级设置，显示更多可填参数，如[图3]所示。
图3  显示高级设置
 说明： 
如果全局安全组开关打开，可以设置端口安全组开关，此开关可以打开或者关闭。 
如果全局安全组开关关闭，则端口安全组开关不能进行打开设置。 
全局安全组开关在daisy中进行设置。 
（可选）如果添加的是外部网络，勾选外部网络选项。
图4  勾选外部网络
根据规划填写其他参数，单击添加按钮。
添加子网
在网络页签下，单击网络列表中的网络名称，打开该网络的详情页面，默认显示基本信息页签，如[图5]所示。
图5  网络详情页面
单击子网，进入子网页签。
单击添加子网按钮，打开添加子网页面，如[图6]所示。
图6  添加子网
根据规划填写参数，单击添加按钮。
添加云环境端口
在网络页签下，单击网络列表中的网络名称，打开该网络的详情页面，切换至端口页签。
单击添加端口按钮，打开添加端口页面，如[图7]所示。
图7  添加端口
 说明： 
如果全局安全组开关打开，可以设置端口安全组开关，此开关可以打开或者关闭。端口安全组开关打开时，可选择安全组。
如果全局安全组开关关闭，则端口安全组开关不能进行打开设置。
全局安全组开关在daisy中进行设置。 
根据规划填写参数，单击添加按钮。
##### 添加云环境子网池 
摘要 : 
本节描述添加云环境子网池的操作步骤。 
前提 : 
使用获得相应操作权限的账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→网络
，默认打开SDN页面。在左侧导航树中选择网络→云网络
，打开云网络页面。
单击子网池，切换至子网池页签，如[图1]所示。
图1  子网池
单击+添加子网池按钮，打开添加子网池页面，如[图2]所示。
图2  添加子网池
根据规划填写参数，单击添加按钮。
##### 添加云环境路由器 
摘要 : 
路由是指云环境使用的路由器，包括相应网络的网关和端口等。 
本节描述添加云环境路由器的操作步骤。 
前提 : 
使用获得相应操作权限的账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→网络
，默认打开SDN页面。在左侧导航树中选择网络→云网络
，打开云网络页面。
单击路由器，切换至路由器页签。
单击+添加路由器按钮，打开添加路由器页面，如[图1]所示。
图1  添加路由器
根据规划填写参数，单击添加按钮。
##### 添加VLAN池 
摘要 : 
VLAN池是指VLAN的集合，一个VLAN池包含多个VLAN。
本节描述添加云网络中VLAN池的操作步骤。
前提 : 
使用获得相应操作权限的账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→网络
，默认打开SDN页面。在左侧导航树中选择网络→云网络
，打开云网络页面。
单击VLAN池，切换至VLAN池页签。
单击+添加VLAN池按钮，打开添加VLAN池页面，如[图1]所示。
图1  添加VLAN池
根据规划填写参数，单击添加按钮。
##### 添加QoS策略 
摘要 : 
QoS策略是指云环境使用的服务质量保证策略定义，包括QoS策略、QoS DSCP和QoS带宽。
本节介绍配置网络QoS策略的操作步骤
前提 : 
使用获得相应操作权限的账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→网络
，默认打开SDN页面。在左侧导航树中选择网络→云网络
，打开云网络页面。
单击Qos策略，切换至Qos策略页签。
单击添加Qos策略按钮，打开添加Qos策略页面，如[图1]所示。
图1  添加Qos策略
根据规划填写参数，单击添加按钮。
##### 查看云网络拓扑 
摘要 : 
TECS Director支持云网络拓扑，可以可视化呈现云网络的需求、虚拟网络、子网、路由器之间的关系。
本节介绍查看云网络拓扑的步骤。 
前提 : 
使用获得相应操作权限的账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运维→拓扑→云网络拓扑
，打开云网络拓扑页面，如[图1]所示。
图1  云网络拓扑
鼠标移动到对应的图标上就会自动显示此对象的详细信息，中间核心图标ZTE System代表TECS Director系统，第一层图标代表DC，第二层图标代表云环境，如[图2]所示。
图2  对象详细信息
单击某个云环境图标，进入此云环境网络拓扑界面，可以看到路由、内部网络和外部网络以及防火墙之间的关系图，如[图3]所示。
图3  云环境拓扑
鼠标移动到对应的图标上就会自动显示网络对象的详细信息，如[图4]所示。
图4  网络对象详细信息
单击拓扑中的网络、路由或防火墙图标，可以查看该网络对象的详细信息。 
单击网络图标，弹出网络配置界面，单击查看详情，弹出拓扑界面可以看到此网络上挂的虚机、所在路由和防火墙关系。 
单击路由图标，弹出路由配置界面，单击查看详情，弹出拓扑界面可以看到此路由挂的网络和防火墙信息。 
单击防火墙图标，弹出拓扑界面，可以看到防火墙和路由关系图。 
#### 上传镜像 
摘要 : 
通过此操作上传的镜像可被各个组织使用。 
本节介绍上传镜像的操作步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
相关信息 : 
TECS Director中领域管理员和组织管理员都支持上传镜像操作，领域管理员上传的镜像支持所有组织使用；组织管理员上传的VDC镜像只支持本组织使用。组织管理员上传VDC镜像的操作步骤参见[上传VDC镜像（可选）]。
镜像源文件支持本地文件、ftp网络文件和http(s)网络文件上传三种方式。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→镜像
，默认打开云镜像页面。在左侧导航树中选择镜像→镜像仓库
，打开镜像仓库页面。
单击+上传镜像按钮，打开上传镜像页面，如[图1]所示。
图1  上传镜像
根据不同的上传方式，选择执行如下操作。 
如果...|那么...
---|---
选择本地文件方式|在镜像源中单击本地文件。根据规划设置镜像参数，单击上传按钮。
选择ftp网络文件方式|在镜像源中单击ftp网络文件，弹出FTP参数配置对话框，如图2所示。根据规划配置FTP参数，单击确认按钮。根据规划配置剩余的镜像参数，单击上传按钮。
选择http(s)网络文件方式|在镜像源中单击http(s)网络文件，弹出HTTP参数配置对话框，如图3所示。根据规划配置HTTP参数。（可选）单击URL检测按钮，可检查填写的URL是否连通。单击确认按钮。根据规划配置剩余的镜像参数，单击上传按钮。
图2  FTP参数配置
图3  HTTP参数配置
相关任务 : 
镜像上传完成后可执行如下操作： 
如果...|那么...
---|---
删除镜像|在云镜像列表中单击需删除镜像所在行的删除按钮，删除镜像的同时即取消发布该镜像。
查看镜像详情|在云镜像或文件仓库页面中单击镜像名称，可查看镜像详情和镜像发布信息。
编辑镜像|在文件仓库页面中，单击某个镜像操作列下拉菜单中的编辑按钮，可编辑镜像名称、最小磁盘、最小内存、元数据等参数。
清理镜像|在云镜像页面，单击右上角的镜像清理，打开镜像清理页面。单击切换页签可以查看不同时间段内未使用的镜像，可对镜像进行删除和批量删除操作。
#### 发布镜像 
摘要 : 
通过此操作将上传至镜像仓库的镜像发布至云环境。 
本节介绍发布镜像的步骤。 
前提 : 
镜像已上传至镜像仓库并通过审核。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→镜像
，默认打开云镜像页面，如[图1]所示。
图1  云镜像页面
单击发布镜像按钮，打开发布镜像页面，如[图2]所示。
图2  发布镜像页面
单击选择镜像文件，选择一个镜像，并按规划配置参数，单击发布按钮，完成发布。
#### 虚机规格管理 
虚机规格用来描述创建一个虚机时申请的计算资源大小，包括虚拟内核、虚拟内存和虚拟磁盘。 
目前虚机规格分为本地规格和云规格。本地规格是领域管理员通过云管创建的本地虚机规格，云规格是云上实际具有的规格。本地规格可以选择发布到具体的云环境，成为云规格。 
##### 创建虚机规格 
摘要 : 
本节描述创建虚机规格的操作步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→计算→规格
，打开规格页面，默认显示本地规格页签，如[图1]所示。
图1  规格页面
单击创建本地规格按钮，打开创建本地规格页面，如[图2]所示。
图2  创建本地规格
根据规划设置参数，单击创建按钮。
相关任务 : 
如果…|那么…
---|---
删除虚机规格|在虚机规格列表的操作列中单击删除按钮，可删除已创建的虚机规格。
发布虚机规格|在虚机规格列表的操作列中，单击下拉菜单项发布，可发布已创建的虚机规格。
##### 创建加速硬件规格 
摘要 : 
本节描述创建加速硬件规格的操作步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→计算→规格
，打开规格页面，单击切换至加速硬件规格页签，如[图1]所示。
图1  加速硬件规格页签
单击添加加速硬件规格按钮，打开添加加速硬件规格页面，如[图2]所示。
图2  添加加速硬件规格页面
根据规划设置参数，在裸金属加速卡参数配置区域单击右上角+号可以添加多条配置信息，单击添加按钮。
##### 发布虚机规格 
摘要 : 
TECS Director支持向指定云环境发布虚机规格。
本节描述发布虚机规格的操作步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→计算→规格
，打开规格页面。
（可选）单击列表中某个虚机规格名称，可查看该虚机规格的详细信息，包括基本信息和已发布云环境列表，如[图1]所示。
图1  查看某个虚机规格信息
在本地规格列表中，对于需要发布的虚机规格，单击操作列下的发布，打开发布页面，如[图2]所示。
图2  发布虚机规格页面
选择发布虚机规格的云环境，已选择的云环境会呈现在右侧已选云环境区域框中，单击确认完成发布，如[图3]所示。
图3  选择云环境
相关任务 : 
在左侧功能导航树中，选择虚机规格→云规格，打开云规格页面，可查询发布的虚机规格情况，如图4所示。图4  云规格页面 
在本地规格页面，对于某个虚机规格，单击操作列下的删除，可删除该虚机规格，同时可以选择是否删除云上的虚机规格，如图5所示。图5  删除虚机规格 
在本地规格页面，对于某个虚机规格，单击操作列下的配置扩展属性按钮，可对虚机规格的属性进行编辑，如图6所示。本地规格的修改会同步到已发布云环境的云规格。图6  配置扩展属性 
在本地规格页面，单击右上角的查看历史任务按钮，可查看发布虚机规格、删除本地规格、配置扩展属性的操作记录及完成情况，如图7所示。图7  查看历史任务 
#### 使用heat模板创建虚机 
摘要 : 
TECS Director支持使用heat模板创建虚机、网络等资源。heat模板包括模板源和客户化参数两个yaml文件，用户将创建资源所需的参数配置在heat模板中，可以在TECS Director中使用heat模板实现资源创建。
本节介绍使用heat模板创建虚机的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→计算
，打开计算页面。在左侧功能导航树中选择计算→栈
，打开栈页面，如[图1]所示。
图1  栈页面
单击添加栈按钮，打开添加栈页面，如[图2]所示。
图2  添加栈页面
根据规划配置相关参数，并选择模板源文件和客户化参数文件。
单击添加按钮，完成虚机创建。
结果 : 
创建完成的虚机可以在虚机页面中进行查看。
#### 添加云硬盘QoS 
摘要 : 
本节介绍添加云硬盘QoS的步骤。
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→存储
，默认打开云硬盘页面。
在左侧功能导航树中，选择存储→云硬盘QoS
，打开云硬盘QoS页面，如[图1]所示。
图1  云硬盘QoS页面
单击＋添加云硬盘QoS按钮，打开添加云硬盘QoS页面，如[图2]所示。
图2  添加云硬盘添加云硬盘QoS
 说明： 
实施者可以选择front-end和back-end。
front-end：表示前端限速，即磁盘限速由计算侧控制。 
back-end：表示后端限速，即磁盘限速由存储设备控制。 
根据规划填写相关参数，单击添加按钮。
#### 添加云硬盘类型 
摘要 : 
云硬盘类型代表云硬盘的一种类型，用户创建云硬盘时需要制定云硬盘类型才能创建。 
本节描述添加云硬盘类型的操作步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→存储
，默认打开云硬盘页面。
在左侧功能导航树中，选择存储下的云硬盘类型，打开云硬盘类型页面，如[图1]所示。
图1  云硬盘类型页面
单击+添加云硬盘类型按钮，打开添加云硬盘类型页面，如[图2]所示。
图2  添加云硬盘类型
根据规划设置参数，单击添加按钮。
云硬盘加密
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→存储
，默认打开云硬盘页面。
进入需要的云硬盘类型详情页面，单击更多→配置加密类型
按钮，如[图3]所示。
图3  云硬盘类型页面
在配置加密类型页面，根据规划设置参数，单击确认按钮，如[图4]所示。
图4  配置加密类型页面
相关任务 : 
在云硬盘类型列表的操作列中单击删除按钮，可删除已创建的云硬盘类型。 
在云硬盘类型列表的操作列中单击配置云硬盘QoS，可为云硬盘类型配置QoS，如图5所示。添加云硬盘QoS的方法参见添加云硬盘QoS。图5  操作列配置云硬盘QoS 
在左侧功能导航树中，选择存储下的云硬盘，打开云硬盘页面，可查看所有云环境中的云硬盘。 
在云硬盘页面，切换至云硬盘快照标签页，可查看云硬盘快照信息。 
#### 添加共享文件类型 
摘要 : 
共享文件类型（Manila）代表文件存储的一种类型，在创建文件存储前，需要添加共享文件类型。 
本节描述添加共享文件类型的操作步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→存储
，默认打开云硬盘页面。
在左侧功能导航树中，选择存储下的共享文件类型，打开共享文件类型页面，如[图1]所示。
图1  共享文件类型页面
单击添加共享文件类型按钮，打开添加共享文件类型页面，如[图2]所示。
图2  添加共享文件类型页面
根据规划设置参数，单击添加按钮。
相关任务 : 
在共享文件类型列表的操作列中单击删除按钮，可删除已创建的共享文件类型。 
在左侧功能导航树中，选择存储→共享文件，打开共享文件页面，可查看所有云环境的共享文件。 
在左侧功能导航树中，选择存储→共享文件存储池，打开共享文件存储池页面，可查看所有云环境的的共享文件存储池信息。 
#### 发布裸金属 
摘要 : 
裸金属是没有安装操作系统的一组硬件资源（例如刀片等），可供直接部署并进行管理。 
本节描述发布裸金属的操作步骤。 
前提 : 
使用获得相应操作权限的账户登录TECS Director。
相关信息 : 
发布裸金属的步骤中需要使用多种角色权限，具体如下： 
步骤|角色权限
---|---
上传镜像|领域管理员
发布虚机规格|领域管理员
添加服务器|Provider系统操作权限
注册服务器|领域管理员
创建带裸金属配额的VDC|领域管理员/业务经理
发布裸金属|组织/子组织管理员
裸金属的关机、开机、删除|组织/子组织管理员
步骤 : 
上传镜像-裸金属
参见[上传镜像]中的操作步骤，上传镜像文件，如[图1]所示。
 说明： 
裸金属镜像包括内核镜像、内存镜像和操作系统镜像三种类型，上传时都需要勾选ironic使用。
如果...|那么...
---|---
上传内核镜像|镜像格式和容器格式选择aki
上传内存镜像|镜像格式和容器格式选择ari
上传操作系统镜像|根据实际选择镜像格式和容器格式
图1  上传镜像-裸金属
在云镜像页面中单击发布镜像按钮，打开发布镜像页面。
单击选择镜像文件按钮，打开镜像文件详情页面，选择需要发布该镜像的云环境。
单击确认按钮，进入发布镜像页面。
单击发布，发布云镜像。
创建虚机规格-裸金属
参见[创建虚机规格]中的操作步骤，创建虚机规格。
勾选裸金属选项，并且虚机规格需要与裸金属主机的规格一致。
单击创建按钮。
添加服务器
使用领域管理员账户登录TECS Director，单击TECS Director顶部菜单栏中的按钮，选择基础设施→数据中心→云环境
，打开云环境页面。
找到在[3]中发布了裸金属镜像的云环境，单击URL列的网址，跳转到Provider系统的硬件管理页面，如[图2]所示。
图2  硬件管理
在左侧导航栏中单击服务器→架式服务器
节点，打开架式服务器页面。
单击添加按钮，打开添加机架服务器页面，如[图3]所示。
图3  添加机架服务器
填入服务器的参数信息，单击确定按钮。
添加完成后，在左侧导航树上单击服务器→概览
，打开服务器概览页面。
在服务器列表中找到刚添加的服务器，单击操作列的设置主机类型，打开修改主机类型对话框，如[图4]所示。
图4  修改主机类型
将主机类型设置为未分配，单击确定按钮。
注册服务器
使用领域管理员账户登录TECS Director，在导航栏中选择物理设备→服务器
，默认打开概览页面。
在服务器列表中找到之前添加的服务器项，单击操作列中的注册按钮，打开注册服务器页面，如[图5]所示。
图5  注册服务器
设置内核镜像和内存镜像，部署驱动类型选择PXE，单击注册按钮。
在导航栏中选择基础设施→计算
节点，在左侧导航栏中单击计算→裸金属服务器
 ，打开裸金属服务器页面，可以看到刚才注册的裸金属处于inpsecting状态，等待注册完成。
注册完成后，裸金属状态切换为manageable，单击操作列的状态迁移，如[图6]所示，弹出状态迁移页面。
图6  裸金属状态
在状态迁移页面，选择操作下拉列表框中的provide，完成裸金属纳管，如[图7]所示。此时裸金属状态切换为available。
图7  裸金属状态迁移
创建带裸金属配额的VDC
参见[创建VDC]中操作步骤添加VDC，在设置资源配额时设置裸金属数量。
发布裸金属
使用组织管理员账户登录TECS Director，单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织管理
，打开组织管理页面，选择待发布裸金属的组织，单击组织名称，打开组织详情页面，如[图8]所示。
图8  组织详情页面
单击详情页面中的裸金属图标，打开裸金属页面。
单击+发布裸金属按钮，打开发布裸金属页面，如[图9]所示。
图9  发布裸金属
选择带裸金属配额的VDC，云环境、裸金属规格、操作系统镜像和网卡等信息，单击发布裸金属按钮。发布完成后裸金属状态显示为active。
相关任务 : 
在裸金属列表的操作列选择不同的菜单项，可对裸金属进行硬重启、软重启、关机、开机、删除、锁定、解锁操作。 
发布完成的裸金属支持编辑VIP在组织详情页面中单击虚拟机图标，打开虚拟机页面。单击虚拟机的名字，打开该虚拟机的详情页面。单击网卡，切换到网卡页签，如图10所示。图10  网卡页签单击网卡IP所在行操作列中的下拉列表框，选择配置VIP，弹出配置VIP对话框。根据规划配置相关参数，单击保存按钮。 
#### 绑定裸金属端口 
摘要 : 
本节描述裸金属端口绑定的配置过程。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→计算
，默认打开可用域页面，在左侧导航树中选择计算→裸金属服务器
，打开裸金属服务器页面，如[图1]所示。
图1  裸金属页面
（可选）如果待绑定裸金属状态列下的状态不是manageable，则单击操作列下的状态迁移，在打开的状态迁移对话框中选择manageable，单击确认，如[图2]所示。
图2  修改裸金属状态
 说明： 
只有当裸金属的状态为manageable时，才能进行绑定操作。如果状态迁移对话框中没有manageable选项，则联系研发人员进行查改。 
对于待绑定端口的裸金属，单击操作列下的设置bonding，进入该裸金属的信息页面，如[图3]和[图4]所示。
图3  设置bonding
图4  裸金属信息页面
（可选）如果没有裸金属需要绑定的端口组，则先创建需要的端口组。 
在端口组选项卡页面中单击创建端口组，如[图5]所示。
图5  创建端口组
根据规划填写参数，单击添加按钮。
单击端口选项卡，对于待绑定的端口，在操作列下单击绑定组，打开绑定组页面，如[图6]所示。
图6  绑定端口组
如果没有需要绑定的端口组，可单击绑定组页面上的创建端口组进行端口组创建，操作方法同步骤4。
选择需要绑定的端口组，单击绑定。
相关任务 : 
在裸金属页面单击某个裸金属名称，可进入该裸金属的详细信息页面。 
在某个裸金属详细页信息面中，单击端口组选项卡可查看端口组信息，单击，如图7所示，可查看更多端口组信息（例如：MAC地址，端口数，模式，uuId，描述），如图8所示。图7  查看端口组信息图8  端口组信息 
在端口选项卡页面中，在操作列下单击解绑定，打开解绑定对话框，单击解绑可将裸金属端口与端口组解绑。图9  裸金属端口解绑 
#### 配置安全管理中心 
摘要 : 
本节介绍安全管理中心的配置过程。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→虚拟资源→安全
，默认打开安全组页面，在左侧导航树中选择安全→管理中心
，打开管理中心页面，如[图1]所示。
图1  管理中心页面
单击切换至安全管理中心页签。
单击添加安全管理中心按钮，打开添加安全管理中心页面，如[图2]所示。
图2  添加安全管理中心页面
输入参数，单击添加按钮，完成配置。
#### 添加网络资源 
摘要 : 
介绍如何创建集群的网络资源。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→容器资源→集群管理
，默认打开集群管理页面，在左侧导航树中选择资源预置，打开资源预置页面，如[图1]所示。
图1  资源预置页面
单击添加资源按钮，打开添加网络页面，如[图2]所示。
图2  添加网络页面
选择云环境、网络类型，其中网络类型可以选择MANAGEMENT、DATA、STORAGE，根据所选的网络类型，填写其他参数，单击添加按钮，完成网络资源创建。
#### 添加对接配置 
摘要 : 
介绍如何创建集群的对接配置。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→容器资源→集群管理
，默认打开集群管理页面，在左侧导航树中选择资源预置，打开资源预置页面，如[图1]所示。
图1  资源预置页面
单击切换至对接配置页签，如[图2]所示。
图2  对接配置
单击添加按钮，打开添加对接配置页面，如[图3]所示。
图3  添加对接配置页面
选择云环境、项目，填写选中项目的用户名称和用户密码，单击添加按钮，完成创建。
#### 添加镜像资源 
摘要 : 
介绍如何为集群预置镜像资源。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→数据中心→云环境远程管理
，默认打开版本管理页面，如[图1]所示。
图1  版本管理页面
单击上传版本按钮，打开上传版本页面，如[图2]所示。
图2  上传版本页面
单击本地文件右侧的选择文件按钮，选择本地文件进行上传。
单击TECS Director顶部菜单栏中的按钮，选择基础设施→容器资源→集群管理
，默认打开集群管理页面，在左侧导航树中选择资源预置，打开资源预置页面，如[图3]所示。
图3  资源预置页面
单击切换至镜像资源页签，单击添加资源按钮，打开镜像管理页面，如[图4]所示。
图4  镜像管理页面
选择云环境，填写VIM ID，版本选择刚才上传的版本，单击添加按钮，完成镜像资源创建。
#### 管理集群规格 
摘要 : 
介绍如何添加集群规格。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→容器资源→集群管理
，默认打开集群管理页面，单击切换至规格页签，如[图1]所示。
图1  规格页签
单击添加规格按钮，打开添加规格页面，如[图2]所示。
图2  添加规格页面
选择规格类型，填写相关参数，单击添加按钮，完成规格创建。
回到规格页面，在下拉菜单中选择节点规格、存储规格、集群规格，列表中显示对应的规格。
相关任务 : 
编辑/删除规格： 
单击操作列的编辑/删除按钮，可以对规格进行编辑/删除操作。
#### 创建容器集群 
摘要 : 
介绍如何创建容器集群。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择基础设施→容器资源→集群管理
，默认打开集群管理页面，如[图1]所示。
图1  集群页面
单击创建集群，打开创建集群页面，如[图2]所示。
图2  创建集群页面
填写名称，选择集群模式、对接配置等参数。按照规划信息添加节点组配置、存储配置等。单击添加，开始创建集群。
集群创建一般需要2-3个小时。集群创建成功后，状态显示为online。 
相关任务 : 
可以对创建成功的集群进行以下操作： 
如果...|那么...
---|---
扩容、缩容、删除集群|单击操作列的扩容/缩容/删除按钮。
为集群创建用户|单击集群名称，进入详情页面。切换至用户页签，单击创建用户按钮，打开创建用户页面。填写用户相关信息，单击创建按钮。
为集群创建用户组|单击集群名称，进入详情页面。切换至用户组页签，单击创建组按钮，打开创建组页面。填写用户组相关信息，单击创建按钮。
为集群创建租户|单击集群名称，进入详情页面。切换至租户页签，单击添加项目按钮，打开添加项目页面。填写项目相关信息，单击添加按钮。
维护节点|单击集群名称，进入详情页面。切换至节点维护页签。在操作列，可以对集群节点进行详情查看、开机、关键、重启、硬关机、硬重启、设置维护模式、取消维护模式等操作。
### 组织和VDC管理 
TECS Director支持领域管理员和业务经理分别进行组织和VDC的配置管理，两者创建的组织互相独立，但可指定同一个组织管理员进行管理。组织和VDC的配置流程如[图1]所示。
图1  配置流程
 说明： 
只有领域管理员可进行设置云环境资源等级操作。 
#### 设置云环境资源服务等级（可选） 
摘要 : 
TECS Director支持将云环境下的资源设置为不同的服务等级，后续添加的组织、VDC、虚机及云盘可根据需求选择相应服务等级的资源。
设置资源等级的方法分为通过云环境设置和通过创建资源组设置。 
本节介绍设置云环境资源服务等级的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
通过云环境设置资源服务等级单击TECS Director顶部菜单栏中的按钮，选择基础设施→数据中心→云环境，打开云环境页面，如图1所示。图1  云环境页面在云环境页面，对于要设置资源组的云环境，单击操作列下的配置中心，打开配置中心页面，如图2所示。图2  配置中心页面单击资源等级选项卡或者编辑资源等级，切换至资源等级页签，如图3所示。图3  编辑资源等级根据规划设置相应的资源等级，单击确认按钮。 
通过创建资源组设置资源服务等级单击TECS Director顶部菜单栏中的按钮，选择基础设施→数据中心，打开数据中心页面，在左侧导航树中选择数据中心→云环境，打开云环境页面，如图4所示。图4  云环境页面单击资源组选项卡，切换至资源组页签，如图5所示。图5  资源组页签单击创建资源组按钮，如图6所示。图6  创建资源组根据规划填写资源组名称，选择服务等级和类型，页面显示对应类型未分组的自由资源，如图7所示。图7  资源组勾选要设置的资源，单击创建按钮，完成资源等级的设置。 
相关任务 : 
在资源组页签中，单击操作列下拉菜单中的编辑按钮，可对资源组中的资源等级进行编辑。
 说明： 
资源组有资源被VDC引用时，服务等级不能修改。
#### 添加组织 

组织是指VDC使用人，即云资源和服务的使用方，可以是一个单位或一个单位的一个组织，一个组织可以关联多个VDC，组织由组织管理员来管理。
用户可以在TECS Director门户在线添加组织，或者使用模板批量导入组织。
##### 在线添加组织 
摘要 : 
本节描述在线添加组织的步骤。 
前提 : 
已创建资源组。 
使用获得相应操作权限的账户登录TECS Director。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织管理
，打开组织管理页面，如[图1]所示。
图1  组织管理页面
单击添加组织按钮，打开添加组织-基本信息页面，填写组织名称和组织域，并选择至少一个已有用户作为组织管理员，如[图2]所示。
图2  添加组织-基本信息
单击下一步按钮，切换至添加组织-选择可用区页签，为组织设置可用区，如[图3]所示。
图3  添加组织-选择可用区
单击下一步按钮，切换至添加组织-设置配额页签，根据规划设置配额，如[图4]所示。
图4  添加组织-设置配额
 说明： 
设置组织配额之前需要注册和发布相应产品，参见注册和发布产品
。
单击下一步按钮，切换至添加组织-分配VDC（可选）页签，可以为组织分配VDC，如[图5]所示。
图5  添加组织-分配VDC（可选）
单击下一步按钮，切换至添加组织-检查确认页签，确认之前设置是否正确，如[图6]所示。
图6  添加组织-检查确认
单击确认按钮，完成组织的创建。
相关任务 : 
在组织列表的操作列中，选择菜单项删除，打开确认提示框。单击删除按钮，可删除已创建的组织。
##### 批量导入组织 
摘要 : 
TECS Director支持领域管理员通过导入文件的方式，批量导入组织。
本节介绍批量导入组织的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织管理
，打开组织管理页面，如[图1]所示。
图1  组织管理页面
单击导入组织按钮，打开导入组织页面，如[图2]所示。
图2  导入组织页面
（可选）如果没有组织数据文件，用户可下载组织模板，自定义后导入。 
单击下载组织模板，下载组织模板文件。
打开组织模板文件，根据提示填写相关参数，如[图3]所示。
图3  组织模板文件
 说明： 
一个模板内可填写多条组织信息，一行数据即为一条组织信息。 
保存编辑好的模板文件。 
单击上传文件，在弹出的对话框中选择已有的组织模板文件。
 说明： 
模板文件仅支持.xlsx格式，一次只能上传一个文件。
单击对话框中的打开按钮，上传组织模板文件。
根据规划选择是否打开重复数据覆盖开关。
如果...|那么...
---|---
不打开重复数据覆盖开关|如果模板中组织名称和系统中已有组织重复，则导入失败，失败原因为组织已存在。
打开重复数据覆盖开关|如果模板中组织名称和系统中已有组织重复，则导入成功，系统自动将模板中的组织覆盖原有组织。
单击导入按钮，完成组织的导入，系统提示导入组织完成，并显示组织的导入情况，如[图4]所示。
图4  导入组织完成提示
相关任务 : 
在导入组织页面，可在组织数据导入结果区域查看导入组织的状态及结果。
#### 创建VDC 
摘要 : 
VDC（Virtual Data Centers）是一组虚拟资源的容器，是IaaS云向租户（组织）提供资源的基本单位。
本节描述如何创建VDC。
前提 : 
使用领域管理员账户登录TECS Director。
相关信息 : 
VDC具备以下特征：
VDC是独立的实体，具备自身的IP地址、自身的通信网络、甚至有自身的管理系统等。 
1个物理DC可以被多个VDC共享。 
1个VDC可以跨多个物理DC。 
VDC包含资源和服务两方面内容。 
VDC能提供端到端的业务。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→VDC
，打开VDC页面，如[图1]所示。
图1  VDC页面
单击+创建VDC按钮，打开创建VDC页面，在基本信息选项卡页面中，填写配置参数，如[图2]所示。
图2  创建VDC-基本信息
 说明： 
只能选择当前登录用户拥有的VDC域。 
单击下一步按钮，进入选择云环境选项卡，为VDC选择云环境，如[图3]所示。
图3  创建VDC-选择云环境
单击下一步按钮，进入资源配置选项卡页面，依次配置云环境下的配额、计算资源、存储资源、网络资源和项目名称参数，如[图4]所示。
图4  创建VDC-资源配置
 说明： 
其中，网络资源中可添加的物理网络为云环境侧已配置的物理网络。 
单击项目名称设置下的开关，选择云环境上已有租户，可以将已有的项目纳管进来，如[图5]所示。
图5  设置项目名称
 说明： 
使用已建租户创建VDC，设置修改的配额会同步更改到对应租户上。
单击下一步按钮，进入检查确认选项卡页面，检查创建VDC的参数是否正确。
单击创建按钮，完成VDC的创建。
相关任务 : 
VDC创建完成后，在VDC页面可对其执行如下操作：
如果…|那么…
---|---
查看VDC详情|在VDC列表中单击VDC名称，打开VDC详情页面。可以查看基本信息和资源配置信息。在配额和资源信息区域框中单击调整配额按钮，可修改该VDC的资源及配额信息。
删除VDC|在VDC列表中单击操作列中的删除按钮，打开确认提示框。单击确认按钮。
绑定项目|选择未绑定项目的VDC，在VDC列表中单击操作列中的绑定&解绑项目按钮，打开绑定&解绑项目页面。单击绑定按钮，选择项目上已有的租户，对云环境上已有租户进行绑定。
解绑项目|选择已有绑定项目的VDC，在VDC列表中单击操作列中的绑定&解绑项目按钮，打开绑定&解绑项目页面。单击解绑对现在绑定租户解绑。
延迟删除|在VDC列表中单击操作列中的资产数据配置按钮，打开资产数据配置页面。配置VDC1和VDC2的ECS实例保留策略分别为“立即删除”和“永久保留，待管理员手动删除”，其中，CMBD类型不为强制配置。
#### 绑定VDC和云环境用户（可选） 
摘要 : 
在V3云环境下创建的VDC支持VIM用户管理，VDC可以绑定由TECS Director接管的云环境用户。绑定的用户可以在VDC内创建资源。
本节介绍绑定VDC和云环境用户的步骤。
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
接管云环境用户
单击TECS Director顶部菜单栏中的按钮，选择基础设施→数据中心→云环境
，打开云环境页面，如[图1]所示。
图1  云环境页面
单击云环境名称，进入该云环境详情页面，如[图2]所示。
图2  云环境详情页面
切换到用户页签，页签中显示了该云环境的所有用户，如[图3]所示。
图3  云环境用户
选择要接管的用户，单击操作列下的配置对接参数按钮，弹出配置对接参数对话框，如[图4]所示。
图4  配置对接参数
在密码框和确认密码框中输入该用户的密码，单击保存按钮。配置过密码的用户，是否接管列下的状态转变为是，如[图5]所示。
图5  配置密码完成
绑定VDC和云环境用户
单击TECS Director顶部菜单栏中的按钮，选择租户资源管理→VDC
，打开VDC页面，如[图6]所示。
图6  VDC页面
选择与步骤[2]云环境关联的VDC，单击操作列下的VIM用户管理按钮，弹出VIM用户管理页面，如[图7]所示。
左侧用户是在云环境页面中配置过密码的接管用户，右侧是已绑定该VDC的云环境用户。
图7  VIM用户管理
单击接管用户行的按钮，将该接管用户和VDC绑定，绑定后的用户出现在右侧的用户列表中。
单击保存，完成VDC和云环境用户的绑定。
相关任务 : 
在VIM用户管理页面，单击右侧用户行的按钮，可将VDC与云环境用户解绑，解绑后的用户出现在左侧的用户列表中。
#### 绑定VDC和云环境租户 
摘要 : 
TECS Director提供对VDC和云环境已有租户的绑定操作。
本节介绍绑定VDC和云环境租户的步骤。
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→VDC
，打开VDC页面，如[图1]所示。
图1  VDC页面
选择要绑定的VDC，单击操作列下拉菜单中的绑定&解绑项目，打开绑定&解绑项目页面，如[图2]所示。
图2  绑定&解绑项目页面
选择租户所在云环境，单击操作列下的绑定按钮，弹出绑定项目对话框，如[图3]所示。
图3  绑定项目页面
勾选要绑定的租户，单击确认按钮，完成VDC和云环境租户的绑定。
相关任务 : 
在VDC页面中，选择已经绑定租户的VDC，单击操作列下拉菜单中的绑定&解绑项目，可对已绑定租户进行解绑操作。
#### 添加组织管理员 
摘要 : 
系统在创建组织管理员时绑定相应组织。 
本节描述为组织添加管理员的操作步骤。 
前提 : 
使用获得相应操作权限的账户登录TECS Director。 
已创建组织。 
相关信息 : 
TECS Director支持批量导入组织管理员，具体步骤参见[批量导入组织用户]。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→安全管理→用户管理
，打开用户管理页面，如[图1]所示。
图1  用户管理页面
单击+新建用户按钮，打开新建用户页面，默认显示基本信息页签，如[图2]所示。
图2  新建用户-基本信息
根据规划填写参数，具体说明参见[新建用户]。
单击下一步按钮，切换到权限分配页签，如[图3]所示。
图3  新建用户-权限分配
在系统选择框中删除本地系统/默认租户，在系统下拉框中选择需要绑定的组织，在角色选择框中勾选组织管理员、安全管理员和工单处理人。
单击新建按钮，完成组织管理员的添加。
相关任务 : 
在用户管理页面，单击操作列下的操作按钮，可对该组织管理员进行修改、删除、复制、查看用户权限和设置日志查看范围操作。
#### 添加组织用户 
摘要 : 
当需要为组织添加用户时，除了在用户管理中修改用户的角色，还可以通过人员权限管理中的组织用户页面直接添加，在人员权限管理中添加用户的同时为用户授予产品访问权限。
步骤 : 
在导航中选择运营→租户资源管理→人员权限管理
，默认打开组织用户页面，如[图1]所示。
图1  组织用户页面
单击添加用户按钮，弹出添加用户对话框，如[图2]所示。
图2  添加用户对话框
选择用户来源并输入用户名，选择要操作的组织和角色，在产品访问权限区域可以为用户授予产品访问权限，单击确认按钮，完成组织用户的添加。
相关任务 : 
为用户添加权限：单击操作列的添加权限，打开新增授权页面，选择授权范围和权限，单击确认按钮。 
移除组织用户：单击操作列的移除用户，在确认对话框中单击确认按钮。 
#### 绑定组织和VDC 
摘要 : 
本节介绍为组织绑定VDC的步骤。
前提 : 
已创建组织。 
已创建VDC。 
使用获得相应操作权限的账户登录TECS Director。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织管理
，打开组织管理页面。
单击要绑定VDC的组织名称，进入组织详情页面，切换到VDC子页面，如[图1]所示。
图1  组织详情页面
单击+绑定VDC按钮，打开绑定VDC页面，页面显示了可绑定的VDC列表，如[图2]所示。
图2  绑定VDC页面
单击绑定按钮，完成组织和VDC的绑定。
#### 申请VDC 
摘要 : 
本节介绍为组织申请VDC的步骤。
前提 : 
已创建组织。 
使用获得相应操作权限的账户（组织管理员、组织业务员等）登录TECS Director。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织管理
，打开组织管理页面。
单击组织名称，进入组织详情页面。 
切换至VDC页签，单击申请VDC按钮，打开申请VDC页面，如[图1]所示。
图1  申请VDC
输入名称、选择地域及可用区，单击提交按钮，完成申请。
相关任务 : 
申请扩容、迁移、退订VDC： 
如果...|那么...
---|---
扩容VDC|单击操作列的更多→扩容，打开扩容VDC页面。填写相关申请内容，单击提交按钮。
迁移VDC|单击操作列的更多→迁移，打开迁移VDC页面。填写相关申请内容，单击提交按钮。
退订VDC|单击操作列的更多→退订，弹出退订确认框。单击退订按钮。
#### 修改组织配额 
摘要 : 
介绍修改组织配额的步骤。 
前提 : 
已创建组织 
使用获得相应操作权限的账户登录TECS Director。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织管理
，打开组织管理页面，单击组织名称，打开组织详情页面，默认显示资源配额页签，如[图1]所示。
图1  资源配额页签
单击设置配额，重新选择云环境，并设置配额。
### 子组织管理 
组织管理员管理子组织的流程如[图1]所示。
图1  配置流程
#### 创建子组织 

用户可以在TECS Director门户在线创建子组织，或者使用模板批量创建子组织。
##### 创建子组织 
摘要 : 
本节描述在线创建子组织的步骤。 
前提 : 
使用组织管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织管理
，打开组织管理页面，单击组织名称，打开组织详情页面，如[图1]所示。
图1  组织详情页面
单击+创建组织按钮，打开创建组织对话框，如[图2]所示。
图2  创建组织
根据规划在名称输入框中输入子组织名称，在描述输入框中输入子组织的简要描述，单击确定按钮完成子组织的创建。
相关任务 : 
创建完成的子组织下可继续创建下级的子组织。 
##### 批量导入子组织 
摘要 : 
TECS Director支持组织管理员通过导入文件的方式，批量导入子组织。
本节介绍批量导入子组织的步骤。 
前提 : 
使用组织管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织管理
，打开组织管理页面，单击组织名称，打开组织详情页面，如[图1]所示。
图1  组织详情页面
单击导入组织按钮，打开导入组织页面，如[图2]所示。
图2  导入子组织页面
（可选）如果没有子组织数据文件，用户可下载子组织模板，自定义后导入。 
单击下载组织模板，下载子组织模板文件。
打开子组织模板文件，根据提示填写相关参数，如[图3]所示。
图3  子组织模板文件
 说明： 
一个模板内可填写多条子组织信息，一行数据即为一条子组织信息。 
保存编辑好的模板文件。 
单击上传文件，在弹出的对话框中选择已有的子组织模板文件。
 说明： 
模板文件仅支持.xlsx格式，一次只能上传一个文件。
单击对话框中的打开按钮，上传子组织模板文件。
根据规划选择是否打开重复数据覆盖开关。
如果...|那么...
---|---
不打开重复数据覆盖开关|如果模板中子组织名称和系统中已有子组织重复，则导入失败，失败原因为子组织已存在。
打开重复数据覆盖开关|如果模板中子组织名称和系统中已有子组织重复，则导入成功，系统自动将模板中的子组织覆盖原有子组织。
单击导入按钮，完成子组织的导入，系统提示导入组织完成，并显示子组织的导入情况，如[图4]所示。
图4  导入子组织完成提示
相关任务 : 
在导入组织页面，可在组织数据导入结果区域查看导入组织的状态及结果。
#### 创建子组织管理员 
摘要 : 
本节描述了创建子组织管理员的步骤。 
前提 : 
使用组织管理员账户登录TECS Director。 
已创建子组织。 
相关信息 : 
TECS Director支持批量导入子组织管理员，具体步骤参见[批量导入组织用户]。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→安全管理→用户管理
，打开用户管理页面，如[图1]所示。
图1  用户管理页面
单击+新建用户按钮，打开新建用户页面，默认显示基本信息页签，如[图2]所示。
图2  新建用户-基本信息
根据规划填写基本信息参数，具体说明参见[新建用户]。
单击下一步按钮，切换到权限分配页签，如[图3]所示。
图3  新建用户-权限分配
根据规划选择权限分配信息。 
 说明： 
创建子组织管理员，在角色中需要勾选子组织管理员和安全管理员。
单击新建按钮，完成子组织管理员创建。
#### 给子组织分配VDC 
摘要 : 
本节描述了给子组织分配VDC的步骤。
前提 : 
使用组织管理员账户登录TECS Director。 
已创建子组织和子组织管理员。 
相关信息 : 
给子组织分配VDC的方式是将所属组织中已有的VDC分配给子组织。组织中的VDC共有3种使用状态，参见[表1]。
使用状态|说明
---|---
空闲|VDC未被占用，可分配给子组织或设置为共享状态
独占|VDC已经分配了子组织，无法再被其他子组织使用
共享|VDC可以被所有子组织使用
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织管理
，打开组织管理页面。
在左侧的功能导航树中选择子组织所属的组织，打开该组织详情页面，默认显示资源配额页签，如[图1]所示。
图1  组织详情页面
单击VDC，切换至VDC页签，如[图2]所示。
图2  VDC页签
选择需要分配的VDC，单击操作列中的更多→分配
，打开分配页面，如[图3]所示。
图3  分配子组织页面
 说明： 
只能将使用状态为空闲的VDC分配给子组织。
勾选分配的子组织，单击+分配按钮，完成VDC的分配。
#### 创建端用户 
摘要 : 
端用户用于登录自服务门户，用户在创建端用户时可以绑定相应的组织或子组织。 
本节描述创建端用户的操作步骤。 
前提 : 
使用获得相应操作权限的账户登录TECS Director。 
已创建组织或子组织。 
相关信息 : 
TECS Director支持批量导入端用户，具体步骤参见[批量导入组织用户]。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→安全管理→用户管理
，打开用户管理页面，如[图1]所示。
图1  用户管理页面
单击+新建用户按钮，打开新建用户页面，默认显示基本信息页签，如[图2]所示。
图2  新建用户-基本信息
根据规划填写基本信息参数，具体参数说明参见[新建用户]。
 说明： 
用户规则选择EndUserRule。
单击下一步按钮，切换到权限分配页签，如[图3]所示。
图3  新建用户-权限分配
在租户下拉框中选择需要绑定的组织或子组织，在角色选择框中勾选端用户。
单击新建按钮，完成端用户的添加。
相关任务 : 
在用户管理页面，单击操作列下的操作按钮，可对该端用户进行修改、删除、复制、查看用户权限和设置日志查看范围操作。
#### 删除子组织 
摘要 : 
删除子组织前必须先释放与该子组织关联的VDC、删除下级子组织。
本节描述删除子组织的步骤. 
前提 : 
使用组织管理员账号登录TECS Director。 
已释放与该子组织关联的VDC。 
已删除该子组织的所有下级子组织。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织管理
，打开组织管理页面。
在左侧功能导航树中单击需要删除的子组织节点，打开该子组织详情页面，如[图1]所示。
图1  子组织详情页面
在子组织页面，单击右上角的删除按钮，弹出删除对话框，如[图2]所示。
图2  删除子组织
单击删除按钮，删除子组织。
### 虚机发布管理 
TECS Director支持组织管理员/子组织管理员发布本组织/子组织所使用的虚机。两者操作步骤类似，本节以组织管理员的操作步骤为例进行描述。
发布虚机的操作流程，如[图1]所示。
图1  发布虚机流程
 说明： 
虚机等资源已在MANO上创建，TECS Director与MANO对接后，在TECS Director上可进行资源的查询操作。
#### 上传VDC镜像（可选） 
摘要 : 
在TECS Director中组织管理员除了可以使用公共镜像外，也可以上传、查询本组织专用的VDC镜像文件。在镜像管理列表中可以查看来源，状态，云环境等相关信息。
本节介绍上传VDC镜像的步骤。
前提 : 
使用组织管理员账户登录TECS Director。
相关信息 : 
镜像源文件支持本地文件、FTP网络文件和http（s）网络文件三种方式上传。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织资源管理
，打开组织资源管理页面，单击组织名称，打开组织的详情页面，如[图1]所示。
图1  组织资源管理页面
单击详情页面中的镜像图标，打开镜像页面，默认显示私有镜像页签，如[图2]所示。
图2  镜像页面
单击镜像仓库，切换至镜像仓库页签，如[图3]所示。
图3  文件仓库
单击+上传镜像按钮，打开上传镜像页面。
根据规划选择镜像源文件并填写相关参数。 
单击上传按钮，完成VDC镜像的上传。
相关任务 : 
在镜像页面的镜像列表中，已上传的VDC镜像支持以下操作：
在操作列中选择不同的下拉菜单项，可对该镜像进行删除/编辑等操作。 
单击某个镜像名称，可查看该镜像详情。 
#### 添加虚机云网络 
摘要 : 
创建虚机前，需要添加云网络。 
本节介绍添加虚机云网络的步骤。 
前提 : 
使用组织管理员账户登录TECS Director。
步骤 : 
添加云网络
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织资源管理
，打开组织资源管理页面，单击组织名称，打开组织的详情页面，如[图1]所示。
图1  组织资源管理页面
单击详情页面中的云网络图标，打开云网络页面，默认显示网络页签，如[图2]所示。
图2  云网络页面
单击添加网络按钮，打开添加网络页面，如[图3]所示。
图3  添加云网络
单击显示高级设置，显示更多可填参数，如[图4]所示。
图4  显示高级设置
 说明： 
如果全局安全组开关打开，可以设置端口安全组开关，此开关可以打开或者关闭。 
如果全局安全组开关关闭，则端口安全组开关不能进行打开设置。 
全局安全组开关在daisy中进行设置。 
（可选）如果添加的是外部网络，勾选外部网络选项。
根据规划填写其他参数，单击添加按钮。
添加子网
在网络页签下，单击网络列表中的网络名称，打开该网络的详情页面，默认显示基本信息页签，如[图5]所示。
图5  网络详情页面
单击子网，进入子网页签。
单击添加子网按钮，打开添加子网页面，如[图6]所示。
图6  添加子网
根据规划填写参数，单击添加按钮。
添加云网络端口
在网络页签下，单击网络列表中的网络名称，打开该网络的详情页面，切换至端口页签。
单击添加端口按钮，打开添加端口页面，如[图7]所示。
图7  添加端口
 说明： 
如果全局安全组开关打开，可以设置端口安全组开关，此开关可以打开或者关闭。端口安全组开关打开时，可选择安全组。 
如果全局安全组开关关闭，则端口安全组开关不能进行打开设置。 
全局安全组开关在daisy中进行设置。 
根据规划填写参数，单击添加按钮。
添加浮动IP
在网络页签下，单击网络列表中的网络名称，打开该网络的详情页面，切换至浮动IP页签，如[图8]所示。
图8  浮动IP
 说明： 
创建网络时，需要勾选“是否共享”。 
单击添加浮动IP按钮，打开添加浮动IP页面，如[图9]所示。
图9  添加浮动IP
选择所属VDC、Qos带宽，单击添加按钮。
#### 添加安全组 
摘要 : 
一个DC内，有些网元应用需要启用安全组，通过规则控制实现虚机间的互通。
本节描述添加安全组的步骤。 
前提 : 
使用组织管理员账户登录TECS Director。 
daisy中全局安全组开关已打开。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织资源管理
，打开组织资源管理页面，单击组织名称，打开组织的详情页面，如[图1]所示。
图1  组织资源管理页面
单击安全组图标，打开安全组页面，如[图2]所示。
图2  安全组页面
单击添加安全组按钮，打开添加安全组页面，如[图3]所示。
图3  添加安全组页面
根据规划填写相关参数，单击添加按钮，完成安全组的添加。
相关任务 : 
在安全组页面的列表中，已添加的安全组可进行如下操作：
单击安全组的名称，进入该安全组的详情页面，查看该安全组的详细信息。 
在操作列中选择不同的下拉菜单项，可对该安全组进行编辑/删除等操作。 
#### 创建密钥对 
摘要 : 
TECS Director支持在组织下使用密钥对创建虚机、云硬盘和裸金属等资源。
本节介绍创建密钥对的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织资源管理
，打开组织资源管理页面，单击组织名称，打开组织的详情页面，如[图1]所示。
图1  组织资源管理页面
单击详情页面中的密钥对图标，打开密钥对页面，如[图2]所示。
图2  密钥对页面
单击添加密钥对按钮，打开添加密钥对页面，如[图3]所示。
图3  添加密钥对
根据规划配置相关参数，单击添加按钮。
相关任务 : 
发布虚机时可选择已创建的密钥对进行配置，具体操作参见[发布虚机]。
#### 创建云硬盘 
摘要 : 
TECS Director支持创建云硬盘，通过自定义云硬盘的大小和相关属性，提供一个完整的存储系统。
本节介绍创建云硬盘的步骤。 
前提 : 
使用组织管理员账户登录TECS Director。 
对应VDC和云环境下已存在云硬盘类型。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织资源管理
，打开组织资源管理页面，单击组织名称，打开组织的详情页面。
单击详情页面中的云硬盘图标，打开云硬盘页面，如[图1]所示。
图1  云硬盘页面
单击创建云硬盘按钮，打开创建云硬盘页面，如[图2]所示。
图2  添加云硬盘
根据规划填写云硬盘参数，单击创建按钮。
相关任务 : 
云硬盘页面中，在云硬盘列表的操作列下，可选择下拉菜单项对创建完成的云硬盘进行以下操作：
如果...|那么...
---|---
删除云硬盘|单击操作列的删除按钮。在弹出的删除云硬盘对话框中再次单击删除。
挂载云硬盘到虚机|单击操作列的下拉按钮并选择挂载。在弹出的挂载虚机对话框中选择一个虚机，单击确认按钮。
从虚机卸载云硬盘|单击操作列的下拉按钮并选择卸载。在弹出的卸载虚机对话框中，单击确认按钮。
调整云硬盘容量|单击操作列的下拉按钮并选择调整容量。在弹出的调整容量对话框中，输入新的大小，单击确认按钮。
编辑云硬盘|单击操作列的下拉按钮并选择编辑。在弹出的编辑对话框中，输入新的名称和描述，单击保存按钮。
编辑云硬盘总线类型|单击操作列的下拉按钮并选择编辑总线类型。在弹出的编辑总线类型对话框中，选择一个总线类型，单击保存按钮。
创建云硬盘快照|单击操作列的下拉按钮并选择创建快照。在弹出的创建快照对话框中，输入云硬盘快照名称，单击确认按钮。
云硬盘类型迁移|单击操作列的下拉按钮并选择云盘迁移。在弹出的云盘迁移对话框中，选择云硬盘类型，单击保存按钮。
转换云硬盘为镜像|单击操作列的下拉按钮并选择转换为镜像。在弹出的转换为镜像对话框中，输入镜像名称，单击确认按钮。
备份云硬盘|单击操作列的下拉按钮并选择云硬盘备份。在弹出的创建备份任务对话框中，输入名称，选择备份类型和全量保留个数，单击确定按钮。
#### 发布虚机 
摘要 : 
本节介绍发布虚机的操作步骤。 
前提 : 
使用组织管理员账户登录TECS Director。 
已上传并发布镜像。 
已创建网络。 
已创建虚机规格。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织资源管理
，打开组织资源管理页面，单击组织名称，打开组织的详情页面。
单击详情页面中的虚拟机图标，打开虚拟机页面，如[图1]所示。
图1  虚拟机页面
单击+发布虚机按钮，打开发布虚机-基本信息页面，根据规划填写相应参数，如[图2]所示。
图2  发布虚机-基本信息
 说明： 
组织管理员批量创建虚机的个数上限为50。 
选择不同的部署策略需设置不同的参数。
如果…|那么…
---|---
按云环境部署|根据需求选择云环境和虚机规格。
按VDC部署|根据需求选择VDC和虚机规格。
单击下一步按钮，打开发布虚机-启动源页面，为虚机选择启动源，如[图3]所示。
图3  发布虚机-启动源
单击下一步按钮，打开发布虚机-云硬盘页面，为虚机选择是否增加云硬盘，如[图4]所示。
图4  发布虚机-云硬盘
单击下一步按钮，打开发布虚机-网络页面，为虚机增加网卡，如[图5]所示。
图5  发布虚机-网络
单击下一步按钮，打开发布虚机-高级配置页面，如[图6]所示。
图6  发布虚机-高级配置
根据规划填写相应配置参数，用户可根据需要勾选秘钥对配置虚机，秘钥对的创建步骤参见[创建密钥对]。
单击发布虚机按钮。
相关任务 : 
发布完成的虚机可在虚机列表中进行以下操作：如果...那么...打开虚机控制台单击操作列的控制台按钮。在弹出的窗口中输入密码进入控制台。关闭虚机单击操作列的下拉按钮，选择关机。在弹出的关机对话框中，再次单击关机按钮。重启虚机硬重启：单击操作列的下拉按钮，选择硬重启。在弹出的硬重启对话框中，输入验证码，单击重启按钮。软重启：单击操作列的下拉按钮，选择软重启。在弹出的软重启对话框中，输入验证码，单击重启按钮。删除虚机单击操作列的下拉按钮，选择删除。在弹出的删除对话框中，如果需要删除虚机挂载的云硬盘，可以一并勾选，单击确认按钮。暂停虚机单击操作列的下拉按钮，选择暂停。在弹出的暂停对话框中，再次单击暂停按钮。挂起虚机单击操作列的下拉按钮，选择挂起。在弹出的挂起对话框中，再次单击挂起按钮。锁定虚机单击操作列的下拉按钮，选择锁定。在弹出的锁定对话框中，再次单击锁定按钮。修改虚机名称单击操作列的下拉按钮，选择修改名称。在弹出的修改名称对话框中，输入新名称，单击保存按钮。修改虚机类型单击操作列的下拉按钮，选择修改类型。在弹出的修改类型对话框中，选择新类型，单击保存按钮。调整虚机规格单击操作列的下拉按钮，选择规格调整。在弹出的规格调整对话框中，选择新的规格，单击保存按钮。在线扩容虚机单击操作列的下拉按钮，选择在线扩容。在弹出的在线扩容对话框中，选择新的规格，单击保存按钮。创建镜像快照单击操作列的下拉按钮，选择创建镜像快照。在弹出的创建镜像快照对话框中，选择创建方式，输入快照名称，单击确认按钮。配置CPU单击操作列的下拉按钮，选择CPU配置。在弹出的CPU配置对话框中，输入频率上限和频率下限，单击保存按钮。配置内存单击操作列的下拉按钮，选择内存配置。在弹出的内存配置对话框中，输入内存上限和内存下限，单击保存按钮。重建虚机单击操作列的下拉按钮，选择重建。在弹出的重建对话框中，选择镜像和磁盘分区方式，单击确认按钮。备份虚机单击操作列的下拉按钮，选择虚机备份。在弹出的创建备份任务对话框中，输入名称，选择备份类型、备份方式、保存天数，单击确定按钮。迁移/热迁移虚机单击操作列的下拉按钮，选择迁移或热迁移。在弹出的迁移或热迁移对话框中，选择可用域和主机，单击确认按钮。 
修改VNC密码虚机关机的状态下，单击虚机名称，进入虚机详情页面，在高级配置区域单击VNC密码右侧的图标，即可对VNC密码进行修改。 
#### 扩容虚机磁盘 
摘要 : 
介绍如何扩容虚机磁盘。 
步骤 : 
创建云硬盘并挂载到虚机。 
检查挂载结果，控制台或ssh登录查看挂载盘是否生效： 
`lsblk
` 
结果如[图1]所示（图中盘符名称为vdc，具体的名称需要根据具体环境查看，对后续操作有影响）。
图1  查看挂载盘
对新增盘创建pv： 
`pvcreate /dev/vdc
` 
结果如[图2]所示。
图2  创建pv
确定vg名称。查看当前节点lv信息： 
`lvs` 
结果如[图3]所示。主要查看当前节点中TECS Director所使用的vg名称，新盘需要加入到该vg中。
图3  lv信息
新盘加入vg： 
`vgextend vg_P_CdataES543 /dev/vdc` 
结果如[图4]所示。
图4  加入vg
使用命令： 
`vgs` 
查看vg对应的Size，确认增加了100G（所创云盘大小）左右的容量，如[图5]所示。
图5  查看容量
查询lv path。查看需要扩容的lv： 
`lvdisplay` 
结果如[图6]所示。
图6  查询lv path
对ES-5.4.3对应的lv扩容，如[图7]所示。
`lvextend -L +10G /dev/vg_P_CdataES543/lv_P_CdataES543` 
图7  扩容
刷新写入： 
`xfs_growfs /dev/vg_P_CdataES543/lv_P_CdataES543` 
结果如[图8]所示。
图8  刷新写入
查看结果，可以看到ES-5.4.3的磁盘空间已经增加，如[图9]所示。
图9  结果
执行扩容脚本。 
执行脚本路径：/paasdata/{TECS Director版本包}/install-script/mytools/scale
执行命令： 
`nohup sh scale.sh &` 
显示打印如[图10]所示。
图10  执行成功
查看分区情况。进入扩容的节点，执行lsblk查看分区情况，可以看到刚刚扩容的公共服务及其扩容后的大小，如[图11]所示。
图11  分区
### 公有云管理 
#### 接入公有云 
摘要 : 
TECS Director支持为外部供应商接入共有云。供应商是为组织安置、管理、支持部分重要的计算、网络和存储资源的设施。
本节介绍接入公有云的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
相关信息 : 
阿里云在每个可接入的地域提供一个或多个接入点，不同的接入点存在运营商限制。 
步骤 : 
添加供应商
单击TECS Director顶部菜单栏中的按钮，选择更多→公有云资源→供应商
，打开供应商页面。
单击+添加供应商按钮，打开添加供应商页面，如[图1]所示。
图1  添加供应商
根据规划设置参数，单击添加按钮。
 说明： 
当前版本供应商仅支持阿里云。 
添加接入点前需要先配置Internet代理。 
添加接入点
单击新添加的供应商，在供应商详情页面中选择接入点子页面。
单击+添加接入点按钮，打开添加接入点页面，如[图2]所示。
图2  添加接入点
 说明： 
访问密钥ID：与阿里云侧申请的密钥ID一致。 
访问密钥：与阿里云侧申请的密钥一致。 
根据规划设置参数，单击添加按钮。
单击接入点名称，可查看阿里云状态。当状态显示为正常时，代表接入阿里云成功。
绑定用户
对于要绑定用户的供应商，打开供应商详情页面，选择概况子页面。
在用户信息区域框中单击绑定按钮，打开绑定用户页面，如[图3]所示。
图3  绑定用户
勾选需要绑定的用户，单击绑定用户按钮。
相关任务 : 
在接入点子页面中，单击接入点名称右侧的图标，选择不同的下拉菜单项，可对该接入点进行编辑、删除操作。 
与供应商绑定完成的用户可使用该云环境下的资源和查看供应商下的基本信息、资源信息。 
#### 虚拟资源管理 
TECS Director中领域管理员和组织管理员都可对公有云中的资源进行管理，不同权限支持的操作如下。
##### Domain管理员登录 
虚拟资源|支持操作|步骤
---|---|---
虚机|查看虚机详情|在上方导航栏中选择资源中心-公有云→虚机节点，打开虚机页面。单击虚机名称，打开虚机详情页面。
云硬盘|查看云硬盘详情|在上方导航栏中选择资源中心-公有云→云硬盘节点，打开云硬盘页面。单击云硬盘名称，打开云硬盘详情页面。
专有网络|查看专有网络详情|在上方导航栏中选择资源中心-公有云→专有网络节点，打开专有网络页面。单击专有网络名称，打开专有网络详情页面。
##### 组织管理员登录 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织管理
，打开组织管理页面。
找到要管理的组织，单击组织名称，进入该组织的详情页面。 
根据规划选择以下操作。 
虚拟资源|支持操作|步骤
---|---|---
虚拟机|查看虚拟机详情、设置控制台密码，连接控制台，关机，开机。|单击虚拟机图表，打开虚拟机详情页面。在虚拟机列表的操作列中选择不同的下拉菜单项。
纳管存量虚机|虚拟机|单击虚拟机图表，打开虚拟机详情页面。单击纳管存量虚机按钮，打开纳管存量虚机页面。选择要查询的VDC，单击查询按钮，查看该VDC包含的虚机。在高级筛选中，可通过虚机名称、状态和云环境的关键字进行筛选。
云硬盘|查看云硬盘详情、删除云硬盘|单击云硬盘名称，打开云硬盘详情页面。在云硬盘列表的操作列中单击删除按钮。
专有网络|查看专有网络详情、创建、删除、编辑|参见添加专有网络。
 说明： 
控制台连接之前需先设置控制台密码。控制台密码为虚机ID前8位和虚机名称。 
#### 添加专有网络 
摘要 : 
专有网络是指用户基于阿里云创建的自定义私有网络，用户可以在自己创建的专有网络中创建和管理云产品实例。本节描述创建专有网络的操作步骤。 
前提 : 
使用组织管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运营→租户资源管理→组织管理
，打开组织管理页面。
找到待添加专有网络的组织，单击组织名称，进入该组织的详情页面。 
单击详情页面中的云网络图标，打开云网络页面，默认显示网络页签。
单击专有网络，切换至专有网络页签，如[图1]所示。
图1  专有网络页签
单击+添加网络按钮，打开添加专有网络页面，如[图2]所示。
图2  添加专有网络
根据规划填写参数，单击添加按钮，完成专有网络添加。
相关任务 : 
在专有网络页面的操作列，选择不同的下拉菜单项可对专有网络进行删除、编辑操作。
### 系统管理 
#### 配置北向参数 
摘要 : 
本节介绍设置北向相关参数的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
设置SOCKET参数
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→系统设置
，默认打开北向设置页面，如[图1]所示。
图1  北向设置页面
在SOCKET设置页签下，单击下方的修改按钮，心跳开关和心跳周期参数变为可修改状态，如[图2]所示。
图2  SOCKET设置
根据规划设置心跳开关和心跳周期。
 说明： 
心跳设置用于设置TECS Director是否需要向SNMP发送心跳消息。
单击确定按钮。
单击+添加SOCKET地址按钮，打开添加SOCKET地址页面，如[图3]所示。
图3  添加SOCKET地址
根据规划设置相关参数，单击确定按钮，完成SOCKET设置。
设置性能北向FTP服务器
单击性能北向FTP服务器设置，切换至性能北向FTP服务器设置页签，单击修改按钮，页面变为可编辑状态，如[图4]所示。
图4  性能北向FTP服务器配置
根据规划设置相关参数，单击保存按钮。
 说明： 
用户通过SFTP访问TECS Director北向运维浮动IP，获取性能北向文件。SFTP端口号 29952，默认只读账号和密码 pm/Perf#out1!
性能北向服务器的用户名为pm。 
FTP或SFTP登录后性能文件所在的路径为PM子目录。 
设置资源北向FTP服务器
单击资源北向FTP服务器设置页签，切换至资源北向FTP服务器设置，单击修改按钮，页面变为可编辑状态，如[图5]所示。
图5  资源北向FTP服务器设置
根据规划设置相关参数，单击保存按钮。
设置北向FTP服务器密码
单击TECS Director顶部菜单栏中的按钮，选择系统管理→配置中心
，默认打开系统配置页面。选择导航树中的内控管理，打开内控管理页面，如[图6]所示。
图6  内控管理
在资源列表中选择待修改的服务器，例如修改性能北向SFTP服务器密码，需找到名为pm的资源，单击修改密码按钮，出现修改密码输入框，如[图7]所示。
图7  修改密码
根据规划设置服务器密码和确认密码，单击确定按钮，完成北向FTP服务器密码设置。
配置日志北向Syslog
单击日志北向Syslog，切换至日志北向Syslog配置页签，如[图8]所示。
图8  Syslog配置
单击修改按钮，Syslog的配置变为可编辑页面，如[图9]所示。
图9  配置Syslog
根据规划配置相关参数，部分参数说明参见[表1]。
参数|说明
---|---
Syslog开关|是否开启北向Syslog的功能。
日志类型|北向上传syslog的日志类型选择，可以选择操作日志、安全日志、系统日志的一种或者多种。
协议格式|syslog的协议，可以选择RFC3164或者RFC5424。
单击保存按钮，完成配置。
单击添加Syslog地址，打开添加Syslog地址页面，如[图10]所示。
图10  添加Syslog地址
根据规划设置相关参数，单击创建按钮，完成Syslog服务的添加。
设置日志北向FTP服务器
单击日志北向FTP服务器设置，切换至日志北向FTP服务器设置页签，单击修改按钮，页面变为可编辑状态，如[图11]所示。
图11  日志北向FTP服务器设置
根据规划设置相关参数，单击保存按钮。
配置4A审计日志远程备份
单击4A审计日志远程备份配置，切换至4A审计日志远程备份配置页签，单击修改按钮，页面变为可编辑状态，如[图12]所示。
图12  4A审计日志远程备份配置
根据规划设置相关参数，单击保存按钮。
配置日志提醒北向设置
单击日志提醒北向配置，切换至日志提醒北向配置页签，打开北向开关，单击添加关北向地址按钮，弹出新增对话框，如[图13]所示。
图13  添加北向地址对话框
根据规划添加北向kafka地址，单击新增按钮，添加成功后默认启用，如[图14]所示。
图14  北向地址添加成功
配置资源北向对接
单击资源北向对接配置，切换至资源北向对接配置页签，单击修改按钮，弹出修改RabbitMq服务器配置对话框，如[图15]所示。
图15  修改RabbitMq服务器配置对话框
根据规划选择是否要向集团云管上报资源池，并设置相关参数，单击保存按钮。
 说明： 
开启上报后，系统将定时上报资源池。 
单击+添加待上报资源池按钮，打开添加待上报资源池页面，如[图16]所示。
图16  添加待上报资源池页面
根据规划选择要上报的资源池，并配置相关参数，单击添加按钮。
（可选）如果开启上报，单击全量同步按钮，完成资源池上报。
#### 配置南向参数 
摘要 : 
本节介绍设置南向的资源，性能及告警通道相关参数的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
设置性能南向FTP服务器
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→系统设置
，默认打开北向设置页面，在左侧导航树中选择系统设置→南向设置
，打开南向设置页面，如[图1]所示。
图1  南向设置页面
在性能南向FTP服务器设置页签中，单击+添加FTP服务器按钮，打开添加FTP服务器页面，如[图2]所示。
图2  添加FTP服务器-性能南向
根据规划设置配置参数，单击添加按钮，完成FTP服务器的设置。
设置资源南向FTP服务器
单击资源南向FTP服务器设置，切换至资源南向FTP服务器设置页签，单击+添加FTP服务器按钮，打开添加FTP服务器页面，如[图3]所示。
图3  添加FTP服务器-资源南向
根据规划设置配置参数，单击创建按钮。
设置告警SNMP V3
单击告警SNMPV3设置，切换至告警SNMPV3设置页签。
单击修改按钮，告警SNMP V3参数变为可编辑状态，如[图4]所示。
图4  设置告警SNMP V3
根据规划填写参数，设置接收PaaS的告警，参数说明参见[表1]。
PaaS端告警上报设置参见“对接PaaS的QoS告警
”。
参数名称|配置说明
---|---
SNMP协议类型|默认为V3
用户名|需要与PaaS中SNMP北向地址设置的用户名一致
安全级别|填写认证、加密
认证方式|需要与PaaS中SNMP北向地址设置的认证方式一致
加密方式|需要与PaaS中SNMP北向地址设置的加密方式一致
#### 配置第三方备份服务器 
摘要 : 
TECS Director支持将配置数据备份在第三方服务器上，修改之前需要将已经备份到本地的文件删除，否则不能修改。
本节介绍设置第三方备份服务器地址的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→系统设置
，默认打开北向设置页面，在左侧导航树中选择系统设置→第三方备份服务
，打开第三方备份服务页面。
单击修改按钮，页面变为可编辑状态，如[图1]所示。
图1  配置第三方备份服务
根据规划选择配置类型并填写相应参数，单击确认按钮。
#### 配置Internet代理 
摘要 : 
TECS Director支持配置公有云访问代理服务器的信息。
本节介绍配置Internet代理的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→系统设置
，默认打开北向设置页面，在左侧导航树中选择系统设置→Internet代理配置
，打开Internet代理配置页面。
单击修改按钮，页面变为可编辑状态，如[图1]所示。
图1  Internet代理配置
根据需要设置参数，单击保存按钮。
#### 设置DNS 
摘要 : 
DNS为TECS Director对接TECS OpenStack的域名服务器IP。
本节介绍设置DNS的步骤。
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→系统设置
，默认打开北向设置页面，在左侧导航树中选择系统设置→DNS设置
，打开DNS设置页面。
单击修改按钮，页面变成可编辑状态，如[图1]所示。
图1  DNS设置页面
在首选DNS服务器栏中输入系统所对接Openstack的域名服务器IP。
单击保存按钮，完成DNS设置。
相关任务 : 
TECS Director支持使用Openstack的域名进行对接。
在接入keystone版本为v3的云环境时，填写接入环境的用户名、域名和密码即可接入，如[图2]所示。
具体的对接步骤参见“对接TECS OpenStack
”。
图2  接入云环境
#### 设置分域 
摘要 : 
DC域/VDC域/组织域用于管理一组DC/VDC/组织。系统默认的DC域为dcPublic，默认的VDC域为vdcPublic，默认的组织域为orgPublic，用户可根据需要添加新的DC域/VDC域/组织域。
本节介绍添加DC域/VDC域/组织域的步骤。
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→系统设置
，默认打开北向设置页面，在左侧导航树中选择系统设置→分域设置
，打开分域设置页面，默认显示DC域页签，如[图1]所示。
图1  分域设置页面
添加DC域
单击+添加DC域按钮，弹出添加DC域对话框，如[图2]所示。
图2  添加数据中心组
根据规划填写参数，单击添加按钮，完成DC域的添加。
添加VDC域
在分域设置页面，切换至VDC域页签，如[图3]所示。
图3  VDC域页签
单击添加VDC域按钮，弹出添加VDC域对话框，如[图4]所示。
图4  添加VDC域
根据规划填写参数，单击添加按钮，完成VDC域的添加。
添加组织域
在分域设置页面，切换至组织域页签，如[图5]所示。
图5  组织域页签
单击添加组织域按钮，弹出添加组织域对话框，如[图6]所示。
图6  添加组织域
根据规划填写参数，单击添加按钮，完成组织域的添加。
相关任务 : 
在DC域列表的操作列中，可对DC域进行删除和编辑操作。 
在VDC域列表的操作列中，可对VDC域进行删除和编辑操作。 
在组织域列表的操作列中，可对组织域进行删除和编辑操作。 
 说明： 
系统默认的域无法删除和编辑。 
#### 管理证书 

TECS Director可为接入的云环境配置认证方式，包括单向认证和双向认证。
一个云环境对应一个根证书，根证书可以有多个。TECS Director端的证书为服务端证书，TECS Director只有一个服务端证书。
本节介绍管理证书的方式，包括添加根证书、修改服务端证书和更新证书。 
##### 添加根证书 
摘要 : 
本节介绍添加根证书的步骤。 
前提 : 
使用领域管理员登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→系统设置
，默认打开北向设置页面，在左侧导航树中选择系统设置→证书管理
，打开证书管理页面，如[图1]所示。
图1  证书管理页面
在根证书页签下，单击+添加证书按钮，打开添加证书对话框，如[图2]所示。
图2  添加证书
根据规划填写参数，单击确认按钮，完成证书添加。
##### 修改服务端证书 
摘要 : 
本节介绍修改服务端根证书的步骤。 
前提 : 
使用领域管理员登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→系统设置
，默认打开北向设置页面，在左侧导航树中选择系统设置→证书管理
，打开证书管理页面，默认显示根证书页签，如[图1]所示。
图1  证书管理页面
在证书管理页面，单击服务端证书，切换至服务端证书页签，如[图2]所示。
图2  服务端证书页签
单击修改按钮，打开修改证书对话框，如[图3]所示。
图3  修改证书
根据规划上传证书及私钥，单击确认按钮，完成证书的修改。
##### 更新证书 
摘要 : 
TECS Director支持本地更新证书和在线更新证书。
本节介绍更新证书的步骤。 
相关信息 : 
本地更新证书的操作在TECS Director环境中进行。 
在线更新证书的操作需要登录OpenPalette环境进行。OpenPalette提供一个服务器，用户将新的证书上传到服务器进行更新。 
步骤 : 
本地更新证书使用领域管理员登录TECS Director。单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→系统设置，默认打开北向设置页面，在左侧导航树中选择系统设置→证书管理，打开证书管理页面，如图1所示。图1  证书管理页面选择要更新的证书，单击操作列下拉菜单中的更新证书选项，打开更新证书页面，如图2所示。图2  更新证书页面单击上传证书按钮，选择新的证书文件。单击确认按钮，完成证书更新。 
在线更新证书登录OpenPalette环境。在左侧功能导航树中选择系统设置→证书中心，打开证书中心页面，默认显示证书管理页签，如图3所示。图3  证书中心页面单击证书配置按钮，打开证书配置页面，如图4所示。图4  证书配置页面单击修改按钮，证书配置页面的参数变为可编辑状态，如图5所示。图5  编辑证书配置参数编辑证书配置的相关参数及存放证书的CMPv2服务器相关参数，单击确定按钮。单击证书中心，返回证书中心页面。在证书管理页签下，单击消费者列下的msb，打开msb页面，如图6所示。图6  msb页面选择要更新的证书文件卡片，单击卡片底部的启用CMPv2服务，打开启用CMPv2服务页面，如图7所示。图7  启用CMPv2服务页面单击上传证书按钮，上传新的证书文件，并填写主题信息。单击确定按钮，完成证书在线更新。 
#### 修改公共服务密码 
摘要 : 
内控管理提供修改PaaS平台公共服务密码的功能。
本节介绍修改公共服务密码的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→配置中心
，默认打开系统配置页面，在左侧导航树中选择配置中心→内控管理
，打开内控管理页面，如[图1]所示。
图1  内控管理页面
选择要修改密码的公共服务，单击操作列下的修改密码按钮，弹出修改密码对话框，如[图2]所示。
图2  修改密码对话框
根据规划在密码中输入新的密码，并在确认密码栏中输入相同的密码。
 说明： 
密码必须包含大写字母、小写字母、数字和除@:/之外的特殊字符，且需满足密码策略要求。 
修改密码后可能会出现短暂业务中断，建议业务不繁忙时修改。 
单击确认按钮，完成公共服务密码的修改。
相关任务 : 
在内控管理页面中，可进行如下操作：
单击所有类型下拉菜单，可以根据服务类型筛选出对应的服务。 
单击密码策略配置按钮，可以查看并修改密码策略。 
#### 配置日志 
摘要 : 
TECS Director支持配置当前日志的存储时间，设置TECS Director是否采集云环境的日志信息，以及配置日志备份。
本节介绍配置日志的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
配置日志采集
单击TECS Director顶部菜单栏中的按钮，选择运维→日志→日志管理设置
，打开日志管理设置页面，默认显示全局设置页签。
单击修改设置按钮，页面变为可编辑状态，如[图1]所示。
图1  日志管理设置
根据规划填写参数，单击保存按钮，完成日志管理的全局设置，部分参数说明参见[表1]。
参数|说明
---|---
操作日志最大存储条数|范围10000~2000000
安全日志最大存储条数|范围10000~2000000
系统日志最大存储空间百分比|范围1%~80%
单击云环境设置，切换至云环境设置页签，如[图2]所示。
图2  云环境设置页签
单击云环境所在行操作列下的编辑按钮，打开编辑对话框，如[图3]所示。
图3  编辑对话框
根据规划设置采集开关，单击确定完成云环境设置。
配置日志备份恢复
 说明： 
日志业务数据的备份恢复需要区分PVC和非PVC场景，非PVC场景下日志业务数据仅支持自动备份，不支持手动备份和恢复操作。 
区分方法：SSH到控制节点，执行lsblk，如果存在/glusterdata/volumedata分区，则为PVC场景；否则，为非PVC场景。 
单击日志备份设置，切换至日志备份设置页签，如[图4]所示。
图4  日志备份设置页签
单击修改按钮，页面变为可编辑状态，如[图5]所示。
图5  修改日志备份配置
切换开关至开启，配置日志内容、任务周期等参数，单击保存按钮，完成日志备份的配置。
选择更多→系统管理→配置中心→内控管理
，打开内控管理页面，如[图6]所示。
图6  内控管理页面
找到资源名称为log的资源，单击操作列的修改密码，进行密码修改。
通过FTP工具登录TECS Director，用户名为log，密码为上一步骤修改的密码，端口29952。
找到/home/log路径，即可下载日志文件到本地。 
配置日志仓库
单击切换至日志仓库设置页签，如[图7]所示。
图7  日志仓库设置页签
单击新增仓库按钮，弹出新增仓库对话框，如[图8]所示。
图8  新增仓库对话框
填写名称，配置时间和大小，单击确认按钮。
配置日志解析规则
单击切换至日志解析规则设置页签，如[图9]所示。
图9  日志解析规则设置页签
单击新增规则按钮，打开新增规则页面，如[图10]所示。
图10  新增规则页面
填写规则名称，并配置其他参数，单击保存按钮。
对接第三方Kafka
单击切换至对接第三方Kafka页签，如[图11]所示。
图11  对接第三方Kafka页签
单击新增Kafka集群按钮，打开新增Kafka集群页面，如[图12]所示。
图12  新增Kafka集群页面
配置Kafka名称、集群地址、Topic、仓库，单击保存按钮。
#### 设置Qos告警 
摘要 : 
TECS Director支持设置Qos告警防抖时间及各项指标的告警阈值。
本节介绍设置Qos告警的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运维→告警管理→告警设置
，默认打开规则设置页面，在左侧导航树中选择告警设置→Qos告警设置
打开告警管理设置页面，如[图1]所示。
图1  告警管理设置页面
设置Qos告警防抖时间
单击Qos告警防抖配置下方的修改按钮，页面变为可修改状态，如[图2]所示。
图2  Qos告警防抖配置
根据规划修改Qos告警防抖配置，单击确认按钮，完成Qos告警防抖时间设置。
设置指标告警阈值
根据规划选择待设置的指标类型，包括VIM指标、VIM系统监控指标和管理系统监控指标。
在下拉菜单中选择待设置的云环境，指标列表显示对应的指标项。 
在指标列表中，单击某个基础设施名左侧的按钮，展开该基础设施的指标项，如[图3]所示。
图3  展开指标项
单击指标项右侧的修改按钮，打开修改告警阈值对话框，如[图4]所示。
图4  修改告警阈值
根据规划修改各项告警阈值，单击确认按钮，完成告警阈值的修改。
#### 管理日志提醒 
摘要 : 
TECS Director支持日志提醒功能，用户可根据需要自定义日志提醒规则。
本节介绍管理日志提醒的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
相关信息 : 
当日志中出现满足规则的信息时，会自动产生一条提醒供运维监控查询，此功能对告警分析有一定的补充作用。具体包含规则如下： 
创建日志提醒规则 
查看日志提醒规则 
启用/禁用/删除日志提醒规则 
编辑日志提醒规则 
查看日志提醒消息 
删除日志提醒消息 
步骤 : 
创建日志提醒规则
单击TECS Director顶部菜单栏中的按钮，选择运维→日志→日志分析
，打开日志分析页面，如[图1]所示。
图1  日志分析页面
单击页面右上方的创建日志提醒规则，打开创建日志提醒规则页面，如[图2]所示。
图2  创建日志提醒规则
输入名称、提醒级别等信息，单击创建。
查看及修改日志提醒规则
单击TECS Director顶部菜单栏中的按钮，选择日志→日志提醒
，打开日志提醒页面，如[图3]所示。
图3  日志提醒页面
单击页面右上角日志提醒规则管理按钮，打开日志提醒规则管理页面，如[图4]所示。
图4  日志提醒规则页面
勾选需要的日志提醒，单击启用\禁用\删除按钮，可以对提醒规则进行相应的操作。
单击列表中的日志提醒规则名称，进入日志提醒规则详情页面，如[图5]所示。
图5  日志提醒规则详情页面
单击修改按钮，页面参数变为可编辑状态，如[图6]所示。
图6  修改日志提醒规则
根据规划填写信息，单击保存按钮，完成日志提醒规则的修改。
查看日志提醒消息
单击TECS Director顶部菜单栏中的按钮，选择日志→日志提醒
，打开日志提醒页面。
单击日志提醒列表操作列中的查看按钮，弹出具体日志信息如[图7]所示。
图7  查看日志提醒消息
单击查看日志详情，可查看上报的具体日志信息。
删除日志提醒消息
单击TECS Director顶部菜单栏中的按钮，选择日志→日志提醒
，打开日志提醒页面。
单击日志提醒列表操作列中的删除按钮，可以删除日志提醒消息。
#### 备份恢复 
TECS Director支持数据备份及恢复。
##### 手工备份数据 
摘要 : 
TECS Director支持备份基础数据和大数据，大数据包括frpt报表数据、历史告警和通知、恢复日志和模型数据。
本节介绍手工备份数据的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→备份恢复
，默认打开手工备份页面，如[图1]所示。
图1  手工备份页面
备份基础数据
在基础数据备份页签，根据规划选择服务器路径和超时时间。
单击执行按钮，启动备份操作。备份进行时，基础数据备份列表中显示了各个微服务备份数据的执行进度。
备份业务数据
备份frpt报表数据 
在手工备份页面，切换至业务数据备份页签，如[图2]所示。
图2  业务数据备份页签
在frpt报表数据行，单击操作列下的配置按钮，打开Frpt报表数据页签，如[图3]所示。
图3  Frpt报表数据页签
在备份删除动作中选择仅备份，备份选择中勾选全部报表，根据规划选择服务器路径和超时时间。
单击执行按钮，启动报表大数据备份。备份完成后，执行结果中可以看到备份执行结果和文件名称，如[图4]所示。
图4  备份Frpt报表数据执行结果
备份历史告警和通知 
业务数据备份页签中，在告警行，单击操作列下的配置按钮，打开告警页签，如[图5]所示。
图5  告警页签
在备份删除动作中选择仅备份，根据规划选择其余参数。
单击执行按钮，启动历史告警和通知数据的备份。备份完成后，执行结果中可以看到备份执行结果和文件名称，如[图6]所示。
图6  备份历史告警和通知数据执行结果
备份恢复日志 
业务数据备份页签中，在备份恢复行，单击操作列下的配置按钮，打开备份恢复页签，如[图7]所示。
图7  备份恢复日志
在备份删除动作中选择仅备份，根据规划选择其余参数。
单击执行按钮，启动恢复日志备份。备份完成后，执行结果中可以看到备份执行结果和文件名称，如[图8]所示。
图8  备份恢复日志执行结果
备份模型数据 
业务数据备份页签中，在模型数据行，单击操作列下的配置按钮，打开模型数据页签，如[图9]所示。
图9  模型数据页签
根据规划选择服务器路径和超时时间
单击执行按钮，启动模型数据备份。备份完成后，执行结果中可以看到备份执行结果和文件名称，如[图10]所示。
图10  备份数据模型执行结果
##### 自动备份数据 
摘要 : 
TECS Director支持自动备份基础数据和大数据，大数据包括frpt报表数据、历史告警和通知、恢复日志和模型数据。
本节介绍自动备份数据的步骤。 
前提 : 
使用领域管理员登录TECS Director。
相关信息 : 
大数据备份默认为开启状态。 
大数据自动备份任务包含数据备份和对系统业务数据的清理设置。 
数据清理分为按时间清理和按容量清理。按时间清理是指系统业务数据存储达到设置的天数时，备份当前数据并清理超期数据，如设置按180天清理，当系统业务数据存储达到180天时，清理180天以前的数据。按空间清理是指系统业务数据存储达到设置的容量上限时开始清理，达到下限值时停止清理。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→备份恢复
，默认打开手工备份页面，在左侧功能导航树中选择备份恢复→自动备份
，进入自动备份页面，如[图1]所示。
图1  自动备份页面
备份基础数据
在自动备份页面，切换到基础数据自动备份页签，打开定时备份开关。
根据规划选择超时时间和执行周期
单击确定按钮，开启基础数据自动备份。
备份大数据
备份frpt报表数据 
在自动备份页面，切换到大数据自动备份页签，如[图2]所示。
图2  大数据自动备份页签
 说明： 
大数据备份默认为开启状态。 
在frpt报表数据行，单击操作列下的配置任务按钮，打开Frpt报表数据页签，如[图3]所示。
图3  Frpt报表数据页签
根据规划选择超时时间和执行周期。
在备份项与清理设置列表中，单击操作列下的修改按钮，弹出报表数据对话框，如[图4]所示。
图4  报表数据对话框
根据规划修改该备份项的清理时间，单击确定按钮，返回Frpt报表数据页签。
单击确定按钮，完成frpt报表数据自动备份设置。
备份历史告警和通知 
大数据自动备份页签中，在告警行单击操作列下的配置任务按钮，打开告警页签，如[图5]所示。
图5  告警页签
根据规划选择超时时间和执行周期。
在备份项与清理设置列表中，根据规划勾选需要进行备份的备份项。
单击操作列下的修改按钮，可对备份项的清理时间、清理容量及门限进行设置。
单击确定按钮，完成历史告警和通知的自动备份设置。
备份基础数据日志和大数据日志 
大数据自动备份页签中，在备份恢复行单击操作列下的配置任务按钮，打开备份恢复页签，如[图6]所示。
图6  备份恢复页签
根据规划选择超时时间和执行周期。
在备份项与清理设置列表中，根据规划勾选需要进行备份的备份项。
单击操作列下的修改按钮，可对备份项的清理时间进行设置。
单击确定按钮，完成基础数据日志和大数据日志自动备份设置。
备份模型数据 
大数据自动备份页签中，在模型数据行单击操作列下的配置任务按钮，打开模型数据页签，如[图7]所示。
图7  模型数据页签
根据规划选择超时时间和执行周期。
在备份项与清理设置列表中，单击操作列下的修改按钮，可对备份项的清理时间进行设置。
单击确定按钮，完成基础模型数据的自动备份设置。
##### 恢复数据 
摘要 : 
TECS Director支持恢复备份数据。
本节介绍恢复备份数据的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
打开数据恢复页面
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→备份恢复
，默认打开手工备份页面，在左侧功能导航树中选择备份恢复→数据恢复
，进入数据恢复页面，如[图1]所示。
图1  数据恢复页面
恢复基础数据
在基础数据恢复页签，根据规划填写相关参数。
单击执行按钮，开始执行基础数据恢复。
恢复大数据
恢复报表数据 
在数据恢复页面，切换到大数据恢复页签，如[图2]所示。
图2  大数据恢复页签
在大数据恢复列表中，勾选frpt报表数据，并根据规划选择服务器路径、备份文件和超时时间。
单击执行按钮，完成报表数据恢复。
恢复历史告警和通知数据 
大数据恢复页签中，在大数据恢复列表中，勾选告警，并根据规划选择服务器路径、备份文件和超时时间。
单击执行按钮，完成历史告警和通知数据恢复。
恢复日志数据 
大数据恢复页签中，在大数据恢复列表中，勾选备份恢复，并根据规划选择服务器路径、备份文件和超时时间。
单击执行按钮，完成日志数据恢复。
恢复模型数据 
大数据恢复页签中，在大数据恢复列表中，勾选模型数据，并根据规划选择服务器路径、备份文件和超时时间。
单击执行按钮，完成模型数据恢复。
##### 删除大数据 
摘要 : 
TECS Director支持删除大数据，包括frpt报表数据、历史告警和通知数据和备份恢复日志数据。
本节介绍删除大数据的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
打开页面
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→备份恢复
，默认打开手工备份页面，如[图1]所示。
图1  手工备份页面
在手工备份页面，切换至大数据备份页签，如[图2]所示。
图2  大数据备份页签
删除frpt报表数据
在frpt报表数据行，单击操作列下的配置按钮，打开Frpt报表数据页签，如[图3]所示。
图3  Frpt报表数据页签
在备份删除动作中选择仅删除，如[图4]所示。
图4  删除Frpt报表数据
根据规划选择删除过滤方式、备份选择和超时时间。
单击执行按钮，启动数据清理。
删除历史告警和通知数据
大数据备份页签中，在告警行，单击操作列下的配置按钮，打开告警页签。
在备份删除动作中选择仅删除，如[图5]所示。
图5  删除历史告警和通知数据
根据规划选择删除过滤方式、备份选择和超时时间。
单击执行按钮， 启动数据清理。
删除备份恢复日志数据
大数据备份页签中，在备份恢复行，单击操作列下的配置按钮，打开备份恢复页签。
在备份删除动作中选择仅删除，如[图6]所示。
图6  删除备份恢复日志数据
根据规划选择删除过滤方式、备份选择和超时时间。
单击执行按钮， 启动数据清理。
##### 配置备份选项 
摘要 : 
TECS Director支持配置备份选项，包括任务执行时间、备份文件清理、自定义服务器信息和异地服务器信息。
本节介绍配置备份选项的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→备份恢复
，默认打开手工备份页面，在左侧功能导航树中选择备份恢复→备份选项
，进入备份选项页面，如[图1]和[图2]所示。
图1  备份选项页面-1
图2  备份选项页面-2
在备份选项页面，单击底部的修改按钮，页面各选项变为可修改状态。
在任务执行时间下的执行时间中修改自动备份的执行时间。
 说明： 
这里设置的时间为基础数据自动备份的时间，大数据自动备份的时候自动延后一小时左右，具体时间系统自动算出。 
在备份文件清理下，设置基础数据和大数据的清理门限，可以根据时间设置门限，根据容量大小设置门限。
（可选）在自定义服务器信息下的自定义服务器中勾选启用。根据规划填写自定义服务器的相关参数。
 说明： 
在禁用情况下，用户只能选择默认服务器实现数据备份恢复业务；在启用情况下，用户可选择默认服务器或自定义服务器进行数据备份恢复业务。 
（可选）在异地服务器信息下的异地服务器中勾选启用。根据规划填写异地服务器的相关参数。
 说明： 
在禁用情况下，用户只能选择默认服务器或自定义服务器实现数据备份恢复业务；在启用情况下，用户可在备份时选择同时备份到异地服务器，在恢复时从异地服务器选择待恢复文件。 
单击确定按钮，完成备份选项配置。
##### 查看备份恢复日志 
摘要 : 
TECS Director支持查看备份恢复日志，用户可以查看每次执行备份恢复和容量清理的执行记录。
本节介绍查看备份恢复日志的步骤。 
前提 : 
使用领域管理员账户登录TECS Director
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→备份恢复
，默认打开手工备份页面，在左侧功能导航树中选择备份恢复→备份恢复日志
，进入备份恢复日志页面，如[图1]所示。
图1  备份恢复日志页面
在要查看的备份恢复任务所在行，单击详情列中的详情按钮，打开该任务的详情页面，可以查看具体执行内容和执行结果，如[图2]所示。
图2  备份恢复日志详情
#### 导入许可证 
摘要 : 
License会随版本发布，由客户购买。 
本节介绍导入许可证的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。 
已获得License文件。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→系统管理→系统设置
，默认打开北向设置页面，在左侧导航树中选择系统设置→License文件
，打开License文件页面，如[图1]所示。
图1  License文件页面
单击替换按钮，选择待导入的License文件，完成许可证导入。
相关任务 : 
如果需要更换许可证，在License文件页面左上角单击替换按钮。导入新的License文件即可，步骤和首次导入许可证的方法一致。
#### 诊断工具 
摘要 : 
本节介绍通讯故障诊断的方式。 
前提 : 
使用领域管理员账户登录TECS Director。 
网络、规划和镜像等都创建完毕。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择运维→运维分析→诊断工具
，打开通讯故障诊断页面，如[图1]所示。
图1  通讯故障诊断
单击选择诊断虚机网络，打开选择诊断对象页面，如[图2]所示。
图2  诊断对象选择
选择需要诊断的虚机网络。 
单击确认按钮，可看到所选虚机的网络拓扑。
单击开始诊断按钮。
#### 配置杀毒 
摘要 : 
本节介绍配置杀毒的方法。 
步骤 : 
登录TECS Director管理页面，选择更多→系统管理→配置中心
，默认打开系统配置页面，选择杀毒配置，如[图1]所示。
图1  杀毒配置
单击修改按钮，正确填写杀毒软件的URL及秘钥，单击确定按钮保存。配置完成后，选择系统设置→杀毒服务
，即可跳转到对应的杀毒软件服务页面。
#### 设置消息通知 
摘要 : 
本节介绍消息通知设置的方法。 
步骤 : 
设置消息通知
使用admin用户登录TECS Director管理页面，选择更多→系统管理→运营设置
，默认打开消息通知管理页面，如[图1]所示。
图1  消息通知管理
根据需要选择是否支持用户自定义控制，以及是否默认开启消息通知。 
接收消息通知
登录中兴云运营首页，单击右上角的控制台，单击导航按钮，选择消息中心→站内消息
，打开站内消息页面，查看接收到的消息通知，如[图2]所示。
图2  站内消息
自定义消息通知
登录中兴云运营首页，单击右上角的控制台，单击导航按钮，选择消息中心→消息接收管理
，打开消息接收管理页面，如[图3]所示。
图3  消息接收管理
根据需要勾选接收的站内消息类型。 
#### 管理公告和建议 
摘要 : 
介绍如何进行公告管理和建议管理。 
前提 : 
域管理员/业务经理/产品负责人登陆uportal页面。 
用户登陆userportal页面。 
步骤 : 
发布公告
单击TECS Director顶部菜单栏中的按钮，选择运营→消息中心→公告
，打开公告管理页面，如[图1]所示。
图1  公告管理页面
单击发布公告按钮，打开发布公告对话框，如[图2]所示。
图2  发布公告对话框
选择需要的类型，填写标题和内容。 
单击发布按钮，完成公告发布。
查看公告
单击userportal页面顶部菜单栏中的按钮，选择运营→消息中心→公告→全部公告
，打开全部公告页面查看到已发布的公告，如[图3]所示。
图3  查看公告
提交建议
单击userportal页面顶部菜单栏中的按钮，选择运营→支持与服务→建议管理
，打开我的建议页面。
单击提建议按钮，打开提建议对话框，如[图4]所示。
图4  提建议对话框
选择建议类型和关联产品/功能，填写标题和内容，并且上传附件。 
单击提交建议按钮，完成建议提交。
查看建议
单击userportal页面顶部菜单栏中的按钮，选择运营→支持与服务→建议管理
，打开我的建议页面，查看提交的建议和建议的处理情况，如[图5]所示。
图5  查看建议
评论建议
单击uportal页面顶部菜单栏中的按钮，选择运营→支持与服务→建议管理
，打开全部建议页面。
单击需要评论的建议，进入建议详情页面，如[图6]所示。
图6  建议详情页面
单击评论按钮，根据需要进行填写。
修改建议
单击uportal页面顶部菜单栏中的按钮，选择运营→支持与服务→建议管理
，打开全部建议页面。
单击需要修改的建议，进入建议详情页面。
单击编辑按钮，打开修改状态对话框，如[图7]所示。
图7  修改状态对话框
选择需要的状态，完成建议修改。 
#### 设置审批系统 
摘要 : 
本节介绍审批系统设置的方法。 
步骤 : 
设置审批系统规则参数
使用admin用户登录TECS Director管理页面，选择更多→系统管理→运营设置→审批系统管理
，打开审批系统管理页面，如[图1]所示。
图1  审批系统
切换至规则参数设置页签，如[图2]所示。
图2  规则参数设置
单击编辑按钮，可以新增规则或编辑已有规则。
审批流程配置
使用admin用户登录TECS Director管理页面，选择审批→审批流程配置→审批流程管理
，打开审批流管理页面，如[图3]所示。
图3  审批流管理
单击添加审批流按钮，打开添加审批流页面，如[图4]所示。
图4  添加审批流
填写名称，单击添加步骤添加审批步骤，单击添加按钮，完成审批流添加。
配置产品审批
使用admin用户登录TECS Director管理页面，选择审批→审批流程配置→产品审批配置
，打开产品审批配置页面，如[图5]所示。
图5  产品审批配置
单击操作列的配置按钮，显示产品关联的审批流程，如[图6]所示。
图6  审批流程
单击关联审批流程，打开关联审批流程页面，如[图7]所示。
图7  关联审批流程
选择一个审批流程，并选择一个条件关系，单击确定按钮，完成关联。
#### 配置资源 
摘要 : 
本节介绍配置资源的方法。 
步骤 : 
设置资源Kafka北向
使用admin用户登录TECS Director管理页面，选择更多→系统管理→配置中心
，默认打开系统配置页面，如[图1]所示。
图1  系统配置
在目录树中选择资源配置→资源Kafka北向设置
，打开详细配置页面，如[图2]所示。
图2  资源Kafka北向设置
单击修改按钮，设置好kafka的服务器ip及topic设置，单击确定按钮。配置完成后，在kafka服务器端查看数据是否接收正常及正确。
配置天翼云对接
使用admin用户登录TECS Director页面，单击顶部菜单栏中的按钮，选择更多→系统管理→配置中心→系统配置→资源配置→北向管理网元
，单击修改按钮，如[图3]所示。
图3  北向管理网元页面
根据需要修改应用名称、应用Key、应用秘钥、访问地址，单击确定按钮，如[图4]所示。
图4  完成北向管理网元的修改
转发U31染色接口
完成北向管理网元配置（天翼云对接配置）后，添加U31网络环境，如[图5]所示。
图5  添加U31网络环境
在U31页面上进行对接配置，如[图6]所示。
图6  对接配置
在U31页面上手动触发OVS染色请求，如[图7]所示。
图7  手动触发OVS染色请求
 说明： 
或在director节点上进入hardwareapigateway容器发送模拟请求。 
发送模拟请求curl命令 
curl -X POST -H "Content-Type:application/json" -d '{"oper":1,"data":[{"colorname":"color1","nemsg":[{"srcvmuuid":"AB12345678965","dstvmuuid":"defga11234","vrf":"1","inorout":0,"aclmsg":{"srcip":"10.156.17.1","dstip":"10.156.17.199","srcport":"","dstport":"","protocol":""}}],"dscp":12,"status":0,"param":""}]}' -H "emsip:10.229.77.225" -i "http://127.0.0.1:8224/api/v1.0/networkcloud/U31/setdscp" 
执行cat /var/zte-log/testlog/zte-hardwareapigateway/logs/all/hardwareapigateway.log，查看日志。 
Director转发消息到天翼云，header携带正确的网络环境名称，和天翼云url cmdb请求头数据，同时正确返回response消息到U31。需要成功对接真实天翼云环境，才可最终转发成功。 
#### 管理配额参数 
摘要 : 
域管理员和业务经理可以进行配额参数的管理。 
步骤 : 
登录TECS Director，选择更多→系统管理→运营设置→配额参数管理
，打开配额参数管理页面，如[图1]所示。
图1  配额参数管理页面
切换到产品页签，选择树状图中的节点并单击编辑按钮，进入编辑模式，如[图2]所示。
图2  编辑模式
按需进行配额项的添加、删除、修改操作，单击保存按钮完成配置。
#### 配置资源映射 
摘要 : 
介绍如何配置资源映射。 
步骤 : 
登录TECS Director，选择更多→系统管理→运营设置→资源映射配置
，打开资源映射配置页面，如[图1]所示。
图1  资源映射配置页面
注册规格
切换到规格设置页签，单击注册规格按钮，打开注册规格对话框，如[图2]所示。
图2  注册规格对话框
填写参数，单击确认按钮，完成规格注册。
添加镜像映射
切换到镜像设置页签，单击添加镜像映射按钮，打开添加镜像映射对话框，如[图3]所示。
图3  添加镜像映射对话框
填写参数，单击确认按钮。
单击操作列的关联，弹出关联镜像对话框，如[图4]所示。
图4  关联镜像对话框
选择左侧的镜像，勾选添加至右侧，单击确认按钮，完成关联镜像。
添加云盘类型映射
切换到云盘类型设置页签，单击添加云硬盘类型映射按钮，打开添加云硬盘类型映射对话框，如[图5]所示。
图5  添加云硬盘类型映射对话框
填写参数，单击确认按钮。
单击操作列的关联，弹出关联云硬盘类型对话框，如[图6]所示。
图6  关联云硬盘类型对话框
选择左侧的云硬盘类型，勾选添加至右侧，单击确认按钮，完成关联云硬盘类型。
配置本地系统盘
将原有环境进行升级，显示升级前创建的规格映射，本地盘未启动，如[图7]所示。
图7  修改规格映射页面
在修改规格映射页面，单击本地盘启动按钮，其中，本地盘大小设置无效。
 说明： 
订购时对规格增加描述说明，选择本地系统盘规格时隐藏系统云盘的配置。 
使用disk大小不为0的虚机规格做映射订购虚机，虚机订购成功（本地系统盘大小取的实际规格的disk大小）。 
使用disk大小为0的虚机规格做映射订购虚机，虚机订购成功（本地系统盘大小取镜像所使用的disk大小）。 
#### 网络协议栈改配 
##### 改配SLB地址 
摘要 : 
介绍如何改配SLB地址。 
步骤 : 
登录TCF的daisy界面，选择云配置→网络管理
，打开网络管理页面。单击切换至SLB网络改配页签，如[图1]所示。
图1  网络管理页面
单击下载按钮，下载模板到本地。
打开模板文件，修改模板里面需要改配的IP地址，保存表格。 
回到网络管理页面，单击选择文件，将修改后的模板文件导入，单击确定按钮，页面上会显示导入进度，如[图2]所示。
图2  导入模板文件
 说明： 
如果修改过程中提示请先终止其他任务，切换到系统当前任务页面，单击任务的中止任务按钮，将所有的任务进行终止，终止后切换回SLB网络改配页面重新执行改配操作。
SSH登录到有Director版本包的控制节点，切换到root用户，进入目录/paasdata/<director版本目录>/install-script/mytools/update_slb_ip/，执行nohup sh update_ip.sh &，执行时间约为40~70分钟。 
`[root@D218-control1:~]$ cd /paasdata/Director-V8.22.30.06.x64-TCF/install-script/mytools/
update_slb_ip/
[root@D218-control1:~]$ nohup sh update_ip.sh &` 
执行tail -f nohup.out查看执行结果，出现如[图3]所示的提示代表执行成功。
图3  执行成功
##### 改配运维地址 
摘要 : 
介绍如何改配运维地址。 
步骤 : 
登录TCF的daisy界面，选择云配置→网络管理
，打开网络管理页面，单击切换至基础网络改配页签，如[图1]所示。
图1  网络管理页面
单击下载按钮，弹出导出网络平面信息至Excel对话框，如[图2]所示。
图2  导出网络平面
选择导出的平面为net_iapi网络，单击确定按钮，下载模板到本地。
打开模板表格，可以看到当前环境上net_iapi网络平面的规划情况，如[图3]所示。
图3  net_iapi网络平面规划
根据自己的需求，对浮动IP和运维IP进行修改，保存表格。 
回到网络管理页面，单击选择文件，选择修改后的模板文件，单击确定导入，页面上会显示导入进度，如[图4]所示。
图4  导入模板文件
 说明： 
改配后，如果界面长期未刷新，则可以尝试使用新的浮动IP登录daisy界面。 
## 对接指南 
### 对接关系 
TECS_Director_Interconnection_Guide 
TECS Director与各个系统对接关系：
南向对接：U31 NMS、Alibaba Cloud、TECS OpenStack、Uniview、异厂家VIM、TCF双核云环境、容器云。 
北向对接：MANO、Superior Cloud。 
TECS Director与各个系统对接时，调用的TECS Director端口参见[端口开放列表]。
### 对接TECS OpenStack 
ZTE TECS包括五个组件：计算资源虚拟化（TECS Compute）、存储资源虚拟化（TECS Storage）、网络资源虚拟化（TECS Network）、基础设施云平台(TECS OpenStack/Provider)
和云管理平台 (TECS Director)，如[图1]所示。
图1  ZTE TECS组件
#### 在TECS OpenStack创建对接用户 
##### 在TECS OpenStack创建TECS 云管系统对接用户（V3.17.14） 
摘要 : 
本任务介绍了如何在TECS OpenStack创建TECS Director对接用户，TECS
OpenStack版本以V3.17.14为例。创建用户的方式和TECS OpenStack的版本相关。在TECS Director对接TECS
OpenSatck时，需要输入相关对接用户信息。
步骤 : 
以系统管理员账号登录到TECS OpenStack系统，选择系统管理→系统安全管理→用户
，打开用户管理页面，如[图1]所示。
图1  用户管理页面
单击创建用户按钮，打开创建用户页面，如[图2]所示。
图2  配置对接用户基本信息
配置对接用户基本信息，包括用户名、密码以及角色。 
 说明： 
角色设置为cloudManager。 
单击创建按钮完成配置。
##### 在TECS OpenStack创建TECS 云管系统对接用户（V3.17.15） 
摘要 : 
本任务介绍了如何在TECS OpenStack创建TECS Director对接用户，ECS
OpenStack版本以V3.17.15为例。创建用户的方式和TECS OpenStack的版本相关。在TECS Director对接TECS
OpenSatck时，需要输入相关对接用户信息。
步骤 : 
以系统管理员账号登录到TECS OpenStack系统，选择系统管理→身份→用户
，打开用户管理页面，如[图1]所示。
图1  用户管理页面
单击创建用户按钮，打开创建用户页面，如[图2]所示。
图2  配置对接用户基本信息
配置对接用户基本信息，包括域（选择域为Default）、用户名、密码。 
 说明： 
下次登录修改密码设置为关闭。
单击创建按钮完成创建用户。
在用户列表中，单击已创建用户操作列详情后下拉列表框，选择编辑角色，如[图3]所示。
图3  选择编辑角色
在编辑角色页面，如[图4]所示，项目选择admin，角色选择admin，单击保存完成配置。
图4  编辑角色页面
#### 采集TCF K+O日志 
摘要 : 
介绍采集TCF K+O日志的步骤。 
前提 : 
TECS Director已经接入TECS。
步骤 : 
登录TECS Director，选择日志→日志管理设置
，打开日志采集管理，切换到云环境设置页，如[图1]所示。
图1  日志采集管理
打开需要采集的云环境的虚拟资源系统日志采集开关。
登录TECS的daisy页面，选择云配置→服务管理
，打开服务管理页面，如[图2]所示。
图2  服务管理
单击切换按钮，启动日志收集服务。
登录TECS的页面，选择监控中心→运维设置→日志管理设置
，打开日志管理设置页面，切换至系统日志采集配置页签，如[图3]所示。
图3  系统日志采集配置
单击修改按钮，启动容器服务日志采集。
切换至第三方日志采集配置页签，打开Syslog服务开关和分布式存储日志采集开关，采集ceph和服务器、交换机等硬件设备的日志。
图4  第三方日志采集配置
（可选）如果采集不到TCF的tecs日志，则按照如下步骤进行排查。 
检查TECS Director和tecs是否采用ssl加密。
TECS Director是否SSL加密：查看TECS Director的log服务下的zindexer容器内，若/var/kafka/下有provider文件夹，并且provider文件下有证书文件，则TECS Director侧采用ssl加密方式，否则没有采用ssl加密方式。 
TECS是否SSL加密：/opt/elkk/kafka/config目录下server.properties文件有SSL://provider-ip:9093就是开启了ssl，否则没有采用ssl加密。 
修改TECS Director和tecs的SSL加密方式保持一致，要么两者都加密，要么两者都不加密，较新版本的TECS Director和tecs默认都采用加密方式。
若两者之间都采用加密有证书方式，则tecs要放开9092和9093端口，执行如下命令确认是否打开，和图片查询结果一致代表已经放开。 
iptables -L -n --line-number | grep 9092 
（在每个节点都要执行，包括控制节点和计算节点）放开9092和9093端口，操作如下： 
systemctl disable iptable-tools systemctl stop iptable-tools    
vi /etc/iptable-tool/iptables_data.csv 
把9092,INPUT,tcp,ACCEPT,management_net,kafka,provider改为9092,INPUT,tcp,ACCEPT,null,kafka,provider 
再添加一行9093,INPUT,tcp,ACCEPT,null,kafka,provider 
systemctl start iptable-tools 
systemctl enable iptable-tools 
查询结果已经放开成功 
#### 在TECS 云管系统对接TECS OpenStack 
摘要 : 
本任务介绍了如何在TECS Director上对接TECS OpenStack。
前提 : 
已创建对接用户。具体操作参见“[在TECS OpenStack创建对接用户]”。
步骤 : 
以领域管理员账户登录TECS Director系统。
在TECS Director系统首页，单击导航菜单，选择基础设施→数据中心→总览
，打开数据中心页面。
在数据中心页面，单击添加数据中心按钮，打开添加数据中心页面，如[图1]所示。
图1  配置数据中心信息
配置数据中心信息，单击添加按钮。
在数据中心页面，单击新建的数据中心，打开数据中心的详情页面，单击对接环境→云环境
，切换至云环境页签，如[图2]所示。
图2  数据中心详情页面
在云环境页签，单击添加云环境按钮，打开添加云环境页面，如[图3]所示。
图3  添加云环境页面
在添加云环境页面，配置云环境参数，如[图4]所示，参数说明参见[表1]。
图4  云环境参数配置实例
参数|说明
---|---
云环境名称|接入云环境的名称，用户自定义。
物理位置|云环境物理位置，可以根据实际的情况填写。
类型|接入云环境的类型，包括openstack + kvm , openstack + vcenter, openstack+ cas, openstack + vsuite，根据对接的云环境进行选择。
供应商|从下拉列表框中选择供应商名称。
可用区域|候选可用区列表是数据中心规划创建且未被其他云环境使用的可用区域，若无空闲可用区域，可到编辑数据中心增加。
Openstack认证URL|填写访问Openstack原生API接口的认证URL。如果为keystone下沉前的版本（对应3.17.15之前版本和6.10.10.03之前的版本）：https://IP:443 (其中IP为云环境的public api浮动地址)如果为keystone下沉后的版本（对应3.17.15之后版本和6.10.10.03之后的版本以及tecs7.0系列版本）：https://IP:5000 (其中IP为云环境的public api浮动地址)
Provider认证URL|填写访问Openstack原生API接口的认证URL。如果为keystone下沉前的版本（对应3.17.15之前版本和6.10.10.03之前的版本）：https://IP:443 (其中IP为云环境的public api浮动地址)如果为keystone下沉后的版本（对应3.17.15之后版本和6.10.10.03之后的版本以及tecs7.0系列版本）：https://IP:5000 (其中IP为云环境的public api浮动地址)
Provider门户URL|填写跳转到Provider门户的URL。 https://IP:443 (其中IP为provider的tecsclient浮动地址)。
用户名|TECS OpenStack上创建的用户名。
密码|TECS OpenStack上创建的用户的密码。
默认租户|默认为admin。
Keystone版本|从下拉列表框中选择，V2或V3。
描述|云环境的描述，用户自定义。
单击添加按钮，弹出提示框，如[图5]所示。
图5  提示框
单击提示框中的现在去配置中心文字，弹出配置中心对话框，如[图6]所示，配置各项参数，单击确认按钮。
图6  配置中心对话框
 说明： 
网络页签中的网络配置，需要输入虚拟网络类型和物理网络两个字段，如[图7]所示。
两个字段的具体判断依据如下： 
虚拟网络类型主要是flat、vlan或vxlan，具体支持哪个，可以到TECS OpenStack控制节点/etc/neutron/plugin.ini中查看tenant_network_types字段，例如tenant_network_types = flat,vlan,vxlan，代表底层云环境同时支持flat，vlan和vxlan三种网络类型。 
如果虚拟网络类型是vlan，需要输入物理网络，字段来源于/etc/neutron/plugin.ini中的network_vlan_ranges字段，例如network_vlan_ranges = default:1000:2499，说明物理网络应该填写为default。 
如果虚拟网络类型是vxlan，无需输入物理网络。 
如果虚拟网络类型是flat，需要输入物理网络，字段来源于/etc/neutron/plugin.ini中的flat_networks。商用环境一般不用flat，如需配置请跟TECS OpenStack确认。 
图7  网络配置
认证配置，详细操作参见[对接两个云环境双向认证]。
 说明： 
由于安全性的要求，TECS Director对接TECS
OpenStack时会要求进行认证配置。
认证配置包括单向认证和双向认证。需根据规划配置环境认证信息。 
TECS
Openstack和TECS Director两边认证配置需要一致。
TECS Director中云环境状态为Normal说明对接成功。
#### TECS OpenStack告警上报到TECS 云管系统配置说明 
##### 检查TECS OpenStack告警上报地址配置参数 
登录TECS OpenStack系统，打开系统管理→基本参数设置
页面，检查VIM参数的VIM IP，填写为TECS OpenStack的Public VIP。
##### 配置TECS OpenStack SNMP参数 
摘要本任务介绍了如何配置TECS OpenStack上报告警的地址。上报告警的地址是TECS Director地址，对应TECS Director南向网络平面地址。 
步骤 : 
登录TECS OpenStack系统，选择监控中心→运维设置→告警设置→北向设置
，打开TRAP设置页面，如[图1]所示。
图1  TRAP设置页面
单击TRAP设置区域的添加TRAP设置按钮，配置TRAP参数，如[图2]所示。参数说明参见[表1]。
图2  配置TRAP参数
参数|说明
---|---
IP地址|IP地址为TECS Director南向网络平面的浮动IP。TECS Director双机的物理地址，和检查TECS OpenStack告警上报地址配置参数中common_vim_ip同网段。
端口|配置为固定的40002。
SNMP协议类型|SNMP协议类型为v3。
用户名|用户名必须与TECS Director配一致置。
安全级别|安全级别包括：认证&加密、认证&不加密、不认证&不加密。
认证模式|认证模式必须与TECS Director配一致置。认证模式包括：MD5、SHA。
认证密码|认证密码必须与TECS Director配一致置。
加密模式|加密模式包括：AES、DES
加密密码|设置加密密码，密码长度不能小于8位。
配置结束，单击添加按钮。
单击启用按钮，启用TRAP功能，如[图3]所示。
图3  开启TRAP功能
在TECS Director系统，确认告警SNMP V3设置参数和TECS OpenStack保持一致，如[图4]所示。
图4  告警SNMP V3设置
#### 修改TECS OpenStack性能数据采集周期 
摘要 : 
本任务介绍了TECS Director对接不同的云环境后，如何修改云环境的性能数据采集粒度。
相关信息 : 
TECS Director对接的云环境类型为OpenStack + vCenter和OpenStack
+ vSuite时，需要登录到TECS OpenStack浮动IP所在节点机器，通过步骤中的命令修改性能采集数据的频率为10分钟。
步骤 : 
打开SSH登录软件（例如：双击MobaXterm.exe），SSH登录到TECS Openstack浮动IP所在节点机器，执行如下命令。 
`[root@tecs201 ~] curl -X PUT localhost:2000/api/v1.0/pmAgent/counter/polling/period -d 
"10"10
[root@tecs201 ~]
` 
执行成功后，通过如下命令进行查询，确保修改成功。 
`[root@tecs201 ~] curl -X GET localhost:2000/api/v1.0/pmAgent/counter/polling/period
10
[root@tecs201 ~]` 
#### 修改云环境配置项（可选） 
摘要 : 
TECS Director对接的云环境开启网络诊断功能后，TECS Director的网络诊断功能才能正常使用。本任务介绍了TECS Director对接不同的云环境后，如何开启云环境的网络诊断功能。（如果TECS Director需要开启云环境的网络诊断功能，则执行该章节，否则跳过该章节）
本节以对接TECS OpenStack为例介绍（此项操作需反馈给云环境维护人员，由云环境维护人员操作）。 
步骤 : 
打开SSH登录软件（例如：双击MobaXterm.exe），SSH登录到TECFS Openstack一个控制节 点上，修改TECS
OpenStack网络节点上/etc/neutron/neutron.conf 中的service_plugins配置，增加如下命令。
`service_plugins =***,diagnosis  //其中"***"代表原有配置。` 
重启neutron server服务。 
`systemctl restart neutron-server.service` 
### 对接TCF双核云环境 

本节介绍对接TCF双核云环境操作步骤，包括对接纯O云环境、对接纯K云环境， 对接K+O云环境。 
#### 对接纯O云环境 
摘要 : 
本节介绍对接纯O云环境的步骤，目的是纳管纯O环境下的各种计算、存储、网络资源等信息。 
步骤 : 
创建用户
在浏览器的地址栏中输入纯O云环境登录地址（https://IP/tcfportal），单击回车键。
在登录页面中输入用户名和密码，单击登录按钮，打开纯O云环境系统。
在纯O云环境系统首页，单击导航菜单，选择系统管理→身份→用户
，打开用户页面。
单击创建用户按钮，如[图1]所示。
图1  创建用户页面
填写用户基本信息，单击创建按钮，用户创建完成。
添加数据中心
在TECS Director系统，单击导航菜单，选择基础设置→数据中心→总览
，打开数据中心页面。
单击添加数据中心按钮，如[图2]所示。
图2  添加数据中心
填写数据中心参数，单击添加按钮。
添加云环境
单击新建的数据中心，打开数据中心详情页面，单击对接环境→云环境
，打开云环境页签。
单击添加云环境按钮，打开添加云环境页面。
填写云环境参数，如[图3]所示，参数说明参见[表1]。
图3  添加云环境
参数|说明
---|---
云环境名称|必填项填写云环境名称。
类型|选择openstock+kvm类型。
Openstack认证Url|为public API的ip地址，端口为5000。
Provider认证Url|为TECS Client的ip地址，端口号为443。
Provider门户Url|为TECS Client的ip地址，端口号为443。
用户名|输入要对接的用户名。
密码|输入要对接的密码。
Keystone 版本|选择V3。
单击添加按钮，返回云环境列表页面，状态列显示Normal表示纳管成功。
（可选）单击门户Url链接，如果报402错误，需设置一下白名单。
如果要通过tecs client和public api以外的IP访问TECS页面，例如做了地址或端口的映射，那么需要将映射后的IP和端口添加到白名单中。 
例如，tecsclient IP映射成10.1.1.2，端口443映射为10443，则需要在tecs client IP节点上手动执行如下命令，才可以正常纳管。 
纯O环境的命令是： 
/var/lib/provider/scripts/provider_ky_host_ip_whitelist.sh
 add    10.1.1.2    10443 
如果端口未映射，继续保持443，则需要执行下面命令： 
/var/lib/provider/script/provider_ky_host_ip_whitelist.sh
  add    10.1.1.2    443 
设置告警上报
在纯O云环境系统，单击导航菜单，选择监控中心→运维设置→告警设置
，打开告警设置页面。
在北向设置页签，SNMP用户设置区域，单击添加用户按钮，添加用户，如[图4]所示。
图4  添加用户
 说明： 
安全级别选择认证&加密，认证密码和加密密码与TECS Director保持一致。
在北向设置页签，SNMP TRAP设置区域，单击添加TRAP按钮，选择一个SNMP用户，添加TECS Director的ip地址和40002端口，如[图5]所示。
图5  添加TRAP
在TECS Director系统，单击导航菜单，选择系统设置→南向设置
，打开南向设置页面。
在告警SNMP V3设置页签，如[图6]所示，设置参数与纯O云环境中保持一致。
 说明： 
设置用户名与纯O云环境中的设置的一致，选择认证&加密，认证密码和加密密码与纯O云环境的一致，默认为Admin@123。
图6  告警SNMP V3设置
单击确定按钮，  TECS Director与纯O云环境对接成功。
#### 对接纯K云环境 
摘要 : 
本节介绍对接纯K云环境的步骤，目的是纳管纯K环境下的各种计算、存储、网络资源、硬件资源和容器资源等信息。 
步骤 : 
创建用户
在浏览器的地址栏中输入纯K云环境登录地址（https://IP/tcfportal），单击回车键。
在登录页面中输入用户名和密码，单击登录按钮，打开纯K云环境系统。
在纯K云环境系统首页，单击导航菜单，选择系统管理→身份→用户
，打开用户页面。
单击创建用户按钮，如[图1]所示。
图1  创建用户页面
填写用户基本信息，单击创建按钮，用户创建完成。
添加数据中心
在TECS Director系统，单击导航菜单，选择基础设置→数据中心→总览
，打开数据中心页面。
单击添加数据中心按钮，如[图2]所示。
图2  添加数据中心
填写数据中心参数，单击添加按钮。
添加容器云
单击新建的数据中心，打开数据中心详情页面，单击对接环境→容器云
，切换至容器云页签。
单击添加容器云按钮，打开添加容器云页面。
填写容器云参数，如[图3]所示，参数说明参见[表1]。
图3  添加容器云
参数|说明
---|---
容器云名称|必填项填写容器云名称。
类型|选择tcf-k8s类型。
认证URL|为TECS Client的ip地址，端口号为443。
门户URL|为TECS Client的ip地址，端口号为443。
用户名|输入要对接的用户名。
密码|输入要对接的密码。
Keystone版本|选择V3。
单击添加按钮，返回容器云列表页面，状态列显示Normal表示纳管成功。
（可选）单击URL链接，如果报402错误，需设置一下白名单。
如果要通过tecs client以外的IP访问TECS页面，例如做了地址或端口的映射，那么需要将映射后的IP和端口添加到白名单中。 
例如，tecsclient IP映射成10.1.1.2，端口443映射为10443，则需要在tecs client IP节点上手动执行如下命令，才可以正常纳管。 
纯K环境的命令是： 
/var/lib/provider/scripts/provider_ky_host_ip_whitelist.sh
add 10.1.1.2 10443 
如果端口未映射，继续保持443，则需要执行下面两条命令： 
/var/lib/provider/script/provider_ky_host_ip_whitelist.sh
add 10.1.1.2 443 
设置告警上报
在纯K云环境系统，单击导航菜单，选择监控中心→运维设置→告警设置
，打开告警设置页面。
在北向设置页签，SNMP用户设置区域，单击添加用户按钮，添加用户，如[图4]所示。
图4  添加用户
 说明： 
安全级别选择认证&加密，认证密码和加密密码与TECS Director保持一致。
在北向设置页签，SNMP TRAP设置区域，单击添加TRAP按钮，选择一个SNMP用户，添加TECS Director的ip地址和40002端口，如[图5]所示。
图5  添加TRAP
在TECS Director系统，单击导航菜单，选择系统设置→南向设置
，打开南向设置页面。
在告警SNMP V3设置页签，如[图6]所示，设置参数与纯K云环境中保持一致。
 说明： 
设置用户名与纯K云环境中的设置的一致，选择认证&加密，认证密码和加密密码与纯K云环境的一致，默认为Admin@123。
图6  告警SNMP V3设置
单击确定按钮， TECS Director与纯K云环境对接成功。
#### 对接K+O云环境 
摘要 : 
本节介绍对接K+O云环境的步骤，目的是纳管K+O环境下的各种计算、存储、网络资源、硬件资源和容器资源等信息。 
步骤 : 
创建用户
在浏览器的地址栏中输入K+O云环境登录地址（https://IP/tcfportal），单击回车键。
在登录页面中输入用户名和密码，单击登录按钮，打开K+O云环境系统。
在K+O云环境系统首页，单击导航菜单，选择系统管理→身份→用户
，打开用户页面。
单击创建用户按钮，如[图1]所示。
图1  创建用户页面
填写用户基本信息，单击创建按钮，用户创建完成。
添加数据中心
在TECS Director系统，单击导航菜单，选择基础设置→数据中心→总览
，打开数据中心页面。
单击添加数据中心按钮，如[图2]所示。
图2  添加数据中心
填写数据中心参数，单击添加按钮。
添加云环境
单击新建的数据中心，打开数据中心详情页面，单击对接环境→云环境
，打开云环境页签。
单击添加云环境按钮，打开添加云环境页面。
填写云环境参数，如[图3]所示，参数说明参见[表1]。
图3  添加云环境
参数|说明
---|---
云环境名称|必填项填写云环境名称。
类型|选择openstack+k8s类型。
Openstack认证Url|为public API的ip地址，端口为5000。
Provider认证Url|为TECS Client的ip地址，端口号为443。
Provider门户Url|为TECS Client的ip地址，端口号为443。
用户名|输入要对接的用户名。
密码|输入要对接的密码。
Keystone 版本|选择V3。
单击添加按钮，返回云环境列表页面，状态列显示Normal表示纳管成功。
设置告警上报
在K+O云环境系统，单击导航菜单，选择监控中心→运维设置→告警设置
，打开告警设置页面。
在北向设置页签，SNMP用户设置区域，单击添加用户按钮，添加用户，如[图4]所示。
图4  添加用户
 说明： 
安全级别选择认证&加密，认证密码和加密密码与TECS Director保持一致。
在北向设置页签，SNMP TRAP设置区域，单击添加TRAP按钮，选择一个SNMP用户，添加TECS Director的ip地址和40002端口，如[图5]所示。
图5  添加TRAP
在TECS Director系统，单击导航菜单，选择系统设置→南向设置
，打开南向设置页面。
在告警SNMP V3设置页签，如[图6]所示，设置参数与K+O云环境中保持一致。
 说明： 
设置用户名与K+O云环境中的设置的一致，选择认证&加密，认证密码和加密密码与K+O云环境的一致，默认为Admin@123。
图6  告警SNMP V3设置
单击确定按钮， TECS Director与K+O云环境对接成功。
### 对接MANO 
MANO指ZXUN vManager产品（简称为vManager），详见《ZXUN vManager 用户手册》。
 说明： 
本文仅介绍了和MANO对接时，TECS Director所进行的操作以及能提供的相关信息。关于MANO侧的对接操作，参见MANO相关配置手册。
#### 对接MANO工作流程 
概述 : 
本节介绍对接MANO的工作流程。 
##### 对接MANO工作流程 
添用admin用户登录系统，创建领域管理员DomainAdmin用户，以DomainAdmin用户账户登录TECS Director。
添加数据中心，添加云环境（TECS OpenStack/TECS Director），具体操作参见“[在TECS 云管系统对接TECS OpenStack]”。
创建资源组。 
创建VDC和组织，把VDC绑定到组织上，并给VDC绑定用户，配置组织管理员。
具体操作参见“配置VDC和组织
”。
通过查看云环境详细信息的URL链接来查询cloudenvid，具体操作参见“[获取云环境CloudEnvId信息]”。
对接配置完成后的验证及相关操作。 
使用组织管理员的用户名和密码以及创建VDC时默认创建的租户名（默认租户名为“VDC名称admin”）登录云环境（URL为POST http://云管系统IP:Port/CloudEnvId/v2.0/tokens），获取tokens和endpoint信息。具体操作参见“对接云环境”。使用获取的tokens和endpoint信息进行原生接口的访问。如果...那么...在云环境控制节点上执行docker ps -a | grep iag能够查询到结果的，例如[root@host-192-163-123-2 ~]# docker ps -a |grep iaga2b5848bad45 iag:20190131 "/bin/bash" 8 weeks ago Up 13 days iag_20190131云环境为TECSV3.17.15及之前版本。在云环境控制节点上执行docker ps -a | grep iag没有查询到结果的，例如[root@tecs201 ~]# docker ps -a |grep iag[root@tecs201 ~]#云环境为TECSV3.17.15P01及以后版本。 说明：对接云环境为TECSV3.17.15及之前版本的用https方式443端口对接。对接云环境为TECSV3.17.15P01及以后版本的用https方式5000端口对接。 
在TECS Director上配置性能北向FTP参数。具体操作参见“配置性能北向FTP参数”。 
在TECS Director上配置资源北向FTP参数。具体操作参见“配置资源北向FTP参数”。 
#### 获取云环境CloudEnvId信息 
摘要本任务介绍了如何获取云环境的CloudEnvId信息。 
步骤 : 
以领域管理员账户登录TECS Director系统。
单击导航按钮，选择基础设施→数据中心
，打开数据中心页面，按F12键。
在页面左侧导航树中，选择数据中心→云环境
，打开云环境页面，如[图1]所示。
图1  云环境页面
在Name区域框中找到并单击cloudenvs?state=all&forgerydefense。
单击Preview页签，查看对应云环境名称的云环境ID。
 说明： 
如[图1]所示，云环境名称为kvm54envv4的云环境ID为3691231c-2c63-4d96-8f73-608acf4d021e。
#### 对接云环境 
摘要 : 
本任务介绍了如何分析URL个体body，通过得到的token和endpoint信息来获取租户下的虚机列表。 
前提 : 
在执行该任务之前需要把对接方式修改为https方式。 
相关信息 : 
本任务中使用的配置数据参见[表1]。
配置参数|数值
---|---
TECS Director IP地址|10.62.48.69
组织管理员用户名|gu_org
组织管理员密码|Admin@123
默认租户信息tenantName|vdc-181-69-140admin
CloudEnvId|35ff01aa-7c0d-4d6e-b08f-f3ba2baed3de
步骤 : 
SSH到与接入云环境相通的任意Linux虚机上。 
 说明： 
例如TECS Director的某一个虚机上执行下面的命令。
获取token和endpoint。 
TECSV3.17.15及之前版本执行的命令： 
`curl -H "Content-Type:application/json" -X POST -d '{"auth": {"
passwordCredentials": {"username": "gu_org","password": "Admin@123"},"
tenantName": "vdc-181-69-140admin"}}'
https://10.47.205.216:443/35ff01aa-7c0d-4d6e-b08f-f3ba2baed3de/v2.0/tokens` 
TECSV3.17.15P01及以后版本执行的命令： 
`curl -H "Content-Type:application/json" -X POST -d '{"auth": {"
passwordCredentials": {"username": "gu_org","password": "Admin@123"},"
tenantName": "vdc-181-69-140admin"}}'
https://10.47.205.216:5000/35ff01aa-7c0d-4d6e-b08f-f3ba2baed3de/v2.0/tokens` 
使用步骤2返回的token id和endpoint信息来获取相关内容，例如nova下的虚机列表信息，举例如下： 
输入命令的body体： 
`curl -H "X-Auth-Token: 8de2e91da5fe49f5a3c66de86fff3c35" -X GET
https://10.47.205.216:8774/35ff01aa-7c0d-4d6e-b08f-f3ba2baed3de/v2.1/6f0d1ba022
1f476db08aa6e673b5e71c/servers
` 
返回的body体为虚机的具体信息： 
`{
"servers": [
{
"id": "b9ed405e-7795-4a76-8815-59811d390bc3",
"links": [
{
"href": "https://10.47.205.216:8774/35ff01aa-7c0d-4d6e-b08f-f3ba2baed3de/
v2.1/6f0d1ba0221f476db08aa6e673b5e71c/servers/b9ed405e-7795-4a76-8815-59811
d390bc3",
"rel": "self"
},
{
"href": "https://10.47.205.216:8774/35ff01aa-7c0d-4d6e-b08f-f3ba2baed3de/
6f0d1ba0221f476db08aa6e673b5e71c/servers/b9ed405e-7795-4a76-8815-59811d39
0bc3",
"rel": "bookmark"
}
],
"name": "vm-zfj-69"
}
]
}` 
#### 配置性能北向FTP参数 
摘要本任务介绍了如何在TECS Director侧配置性能北向FTP参数。配置FTP参数后，用户在MANO侧，可以通过FTP方式获取TECS Director的性能数据。 
步骤 : 
以Domain管理员账户登录TECS Director系统。
单击导航按钮，选择系统管理→系统设置
，打开北向设置页面。
单击性能北向FTP服务器设置页签，显示性能北向FTP服务器配置参数。
单击修改按钮，修改性能FTP服务器参数，如[图1]所示。性能北向FTP服务器参数说明参见[表1]。
图1  性能FTP服务器参数修改实例
参数|说明
---|---
开关|配置是否启用FTP功能。开：启用FTP功能。关：禁用FTP功能。
传输方式|配置性能数据文件的传输方式，包括SFTP和FTP。
本地服务器地址|合一部署时本地FTP服务器IP地址设置为127.0.0.1。分布式部署时，设置为REPO节点所在的IP。
本地服务器端口|本地FTP服务器端口配置为21。
文件保存天数|配置保存FTP文件的时间。
文件命名格式|配置在性能北向文件名中是否包含网元类型信息。TECS Director性能数据，为DIRECTOR。U31性能数据，为U31。
性能数据粒度|配置数据查询的测量周期。
文件生成周期|配置生成性能北向文件的周期。
开始时间|文件中第一条记录的开始时间。
结束时间|文件中最后一条记录的结束时间。
时区|选择生成北向文件的时区。本地时区：使用本地时区生成北向文件。格林威治时区：使用格林威治时区生成北向文件。
csv文件列名|配置列名的语言。
csv文件列名格式|配置列名的格式。默认值：指标ID
上报空间汇总结果|配置是否上报空间汇总结果。
上报指标配置|配置上报的指标。
修改结束，单击保存。
结果 : 
在MANO系统，用户可以通过FTP方式（用户名：ztepm， 密码：Aa888888）获取TECS Director的性能参数。
#### 配置资源北向FTP参数 
摘要本任务介绍了如何在TECS Director侧配置资源北向FTP参数。配置FTP参数后，用户在MANO侧，可以通过FTP方式获取TECS Director的资源数据。 
步骤 : 
以领域管理员账户登录TECS Director系统。
单击导航按钮，选择系统管理→系统设置
，打开北向设置页面。
单击资源北向FTP服务器设置页签，显示资源北向FTP服务器配置参数。
单击修改按钮，修改资源北向FTP服务器参数，如[图1]所示。资源FTP服务器参数说明参见[表1]。
图1  资源北向FTP服务器参数修改实例
参数|说明
---|---
开关|配置是否启用FTP功能。开：启用FTP功能。关：禁用FTP功能。
传输方式|配置资源数据文件的传输方式，包括SFTP和FTP。
本地服务器地址|合一部署时本地FTP服务器IP地址设置为127.0.0.1，分布式部署时，设置为REPO节点所在的IP。
本地服务器端口|本地FTP服务器端口配置为21。
文件保存天数|配置保存FTP文件的时间。
文件命名格式|配置在资源北向文件名中是否包含网元类型信息。TECS Director资源数据，为DIRECTOR。U31资源数据，为U31。
时区|选择生成北向文件的时区。本地时区：使用本地时区生成北向文件。格林威治时区：使用格林威治时区生成北向文件。
csv文件列名|配置列名的语言。
文件生成周期|配置生成资源北向文件的周期。
参数修改完毕，单击保存。
结果 : 
在MANO系统，用户可以通过FTP方式（用户名：ztepm， 密码：Aa888888）获取TECS Director的资源参数。
### 对接U31 NMS系统 
#### 配置性能南向FTP服务器参数 
摘要本任务介绍了如何在TECS Director侧配置性能南向FTP参数。配置FTP参数后，TECS Director可以通过FTP方式访问南向U31性能数据。 
步骤 : 
以Domain管理员账户登录TECS Director系统。
单击导航按钮，选择系统管理→系统设置
。
在页面左侧的功能导航树中，选择系统设置→南向设置
，打开南向设置页面，系统默认打开性能南向FTP服务器设置页签。
在性能南向FTP服务器设置页签，单击添加FTP服务器，打开添加FTP服务器页面，如[图1]所示。
图1  性能南向FTP配置参数
配置性能南向FTP参数，性能南向FTP配置参数说明参见[表1]。
 说明： 
性能南向FTP客户端设置页面的配置应和U31 NMS侧的配置保持一致。
TECS Director的配置性能文件产生粒度要不小于U31性能文件产生粒度。
U31上性能文件的生成必须为.csv格式。 
U31必须配置性能文件生成的延迟时间不大于U31性能文件产生粒度时间。 
参数|说明
---|---
传输方式|配置性能数据文件的传输方式，包括SFTP和FTP
开关|配置是否启用FTP功能开：启用FTP功能关：禁用FTP功能
服务器地址|U31 FTP服务器的IP地址
服务器端口|U31 FTP服务器的端口号
用户名|访问U31 FTP server服务器的用户名
密码|访问U31 FTP server服务器的密码
参数配置完毕后，单击添加按钮。
#### 配置资源南向FTP服务器参数 
摘要 : 
本任务介绍了如何在TECS Director侧配置资源南向FTP参数。配置FTP参数后，TECS Director可以通过FTP方式访问南向U31资源数据。
步骤 : 
以Domain管理员账户登录TECS Director系统。
单击导航按钮，选择系统管理→系统设置
。
在页面左侧的功能导航树中，选择系统设置→南向设置
，打开南向设置页面。
在资源南向FTP服务器设置页签，单击添加FTP服务器，打开添加FTP服务器页面。如[图1]所示。
图1  资源南向FTP配置参数
配置资源南向FTP服务器参数，资源南向FTP客户端参数说明参见[表1]。
参数|说明
---|---
传输方式|配置资源数据文件的传输方式，包括SFTP和FTP
开关|配置是否启用FTP功能开：启用FTP功能关：禁用FTP功能
服务器地址|U31 FTP服务器的IP地址
服务器端口|U31 FTP服务器的端口号
用户名|访问U31 FTP server服务器的用户名
密码|访问U31 FTP server服务器的密码
 说明： 
资源南向FTP服务器设置页面的配置应和U31 NMS侧的配置保持一致。
参数配置完毕后，单击添加按钮。
#### 配置日志对接 
摘要 : 
本任务介绍了如何在TECS Director侧配置日志北向Syslog和日志北向FTP服务器。配置FTP参数后，NMS可以查看TECS Director日志数据。
步骤 : 
配置日志北向Syslog
以Domain管理员账户登录TECS Director系统。
单击导航按钮，选择系统管理→系统设置
。
在页面左侧的功能导航树中，选择系统设置→北向设置
，打开北向设置页面。
在日志北向Syslog配置页签，单击修改按钮，如[图1]所示。
图1  日志北向Syslog配置页签
根据需要选择上报的日志类型和日志格式。
单击保存按钮。
单击添加Syslog地址按钮，弹出添加Syslog地址对话框，如[图2]所示。
图2  添加Syslog地址对话框
填写接收方地址（即NMS系统的IP地址）和端口，选择发送的协议类型。
单击创建按钮。
设置日志北向FTP服务器
在日志北向FTP服务器设置页签，单击修改按钮。
设置开关为开启状态，如[图3]所示。
图3  日志北向FTP服务器设置页签
设置日志北向FTP服务器信息。 
 说明： 
勾选需要上报的日志类型。 
设置发送周期。 
根据北向参数正确填写服务器信息。 
单击保存按钮。
### 对接阿里云 
#### 在阿里云获取对接密钥和密钥ID 
摘要 : 
本任务介绍了如何登录阿里云，获取密钥和密钥ID。在TECS Director接入阿里云时，需要输入这些信息。
步骤 : 
在浏览器地址栏输入阿里云地址https://account.aliyun.com/，输入用户名及密码，单击登录按钮，如[图1]所示。
图1  登录阿里云
登录系统后，单击控制台，如[图2]所示。
图2  登录控制台
在管理控制台页面，单击accesskeys，如[图3]所示。
图3  进入Access Key管理页面
弹出安全风险警告对话框，单击继续使用AccessKey按钮，如[图4]所示。
图4  安全风险警告对话框
在Access Key管理页面，单击创建Access
Key，如[图5]所示。按照系统提示继续操作。
图5  创建Access Key
Access Key ID创建完毕，单击显示列，显示Access Key
Secret信息，如[图6]所示。
 说明： 
本任务中获取的密钥ID为LTAI8G2OVW1Bps9X，密钥为wJlyAptp1px9PGZ3u2bl90jcilYNbU。
图6  显示Access Key Secret信息
相关任务 : 
查看当前Access Key ID的Access Key Secret信息。 
在Access Key管理页面，单击现有Access Key ID对应的显示按钮，弹出手机验证对话框，如[图7]所示。
图7  手机验证对话框
输入校验码，单击确定按钮，显示对应的Access Key Secret信息。
#### 配置云管系统连接Internet 
摘要 : 
本任务介绍如何将TECS Director系统连接到Internet网络。
可以在TECS Director系统中设置Internet代理或者使用专网的形式，将TECS Director系统和Internet连接起来。
步骤 : 
设置Internet代理连接Internet网络。以Domain管理员账户登录TECS Director系统。单击导航按钮，选择系统管理→系统设置，系统默认打开北向设置页面。在页面左侧的功能导航树中，单击Internet代理配置，打开Internet代理配置页面。单击修改按钮，修改代理服务器IP地址以及代理服务器端口，如图1所示。图1  代理服务器参数修改实例配置结束，单击保存按钮。 
TECS Director系统配置专网连接Internet。合一部署环境，需保证主备两个节点都配置有大网网络平面。同时主备两个节点可以Ping通Internet站点，以www.baidu.com.cn为例。[root@node1 ~]# ping www.baidu.com.cn 
PING www.a.shifen.com (180.97.33.107) 56(84) bytes of data. 
64 bytes from 180.97.33.107: icmp_seq=1 ttl=54 time=1.95 ms 
64 bytes from 180.97.33.107: icmp_seq=2 ttl=248 time=16.8 ms 
64 bytes from 180.97.33.107: icmp_seq=3 ttl=54 time=2.12 ms 
64 bytes from 180.97.33.107: icmp_seq=4 ttl=248 time=16.5 ms 
64 bytes from 180.97.33.107: icmp_seq=5 ttl=248 time=16.8 ms5节点环境，需保证主备TECS Director节点和PM节点配置有大网网络平面。可以Ping通Internet站点。 
#### 接入公有云 
摘要 : 
TECS Director支持为外部供应商接入共有云。供应商是为组织安置、管理、支持部分重要的计算、网络和存储资源的设施。
本节介绍接入公有云的步骤。 
前提 : 
使用领域管理员账户登录TECS Director。
相关信息 : 
阿里云在每个可接入的地域提供一个或多个接入点，不同的接入点存在运营商限制。 
步骤 : 
添加供应商
单击TECS Director顶部菜单栏中的按钮，选择更多→公有云资源→供应商
，打开供应商页面。
单击+添加供应商按钮，打开添加供应商页面，如[图1]所示。
图1  添加供应商
根据规划设置参数，单击添加按钮。
 说明： 
当前版本供应商仅支持阿里云。 
添加接入点前需要先配置Internet代理。 
添加接入点
单击新添加的供应商，在供应商详情页面中选择接入点子页面。
单击+添加接入点按钮，打开添加接入点页面，如[图2]所示。
图2  添加接入点
 说明： 
访问密钥ID：与阿里云侧申请的密钥ID一致。 
访问密钥：与阿里云侧申请的密钥一致。 
根据规划设置参数，单击添加按钮。
单击接入点名称，可查看阿里云状态。当状态显示为正常时，代表接入阿里云成功。
绑定用户
对于要绑定用户的供应商，打开供应商详情页面，选择概况子页面。
在用户信息区域框中单击绑定按钮，打开绑定用户页面，如[图3]所示。
图3  绑定用户
勾选需要绑定的用户，单击绑定用户按钮。
相关任务 : 
在接入点子页面中，单击接入点名称右侧的图标，选择不同的下拉菜单项，可对该接入点进行编辑、删除操作。 
与供应商绑定完成的用户可使用该云环境下的资源和查看供应商下的基本信息、资源信息。 
### 对接Uniview 
### 对接Uniview 
#### 在Uniview创建对接用户 

摘要 : 
本任务介绍如何在Uniview创建TECS Director对接用户。在TECS Director对接Uniview时，需要输入相关对接用户信息。
前提 : 
使用SysAdmin账号登录到Uniview。 
步骤 : 
以系统管理员账号登录到Uniview配置管理页面，选择系统管理→用户
，打开用户页面，如[图1]所示。
图1  用户页面
单击创建用户，打开创建用户页面，如[图2]所示。
图2  配置对接用户基本信息
配置对接用户基本信息，包括用户名、密码以及角色。 
 说明： 
角色设置为cloudManager。 
单击确定按钮，完成配置。
#### 在云管系统上对接Uniview 
摘要 : 
本任务介绍如何在TECS Director上对接Uniview。
前提 : 
已创建对接用户。具体操作参见“[在Uniview创建对接用户]”。
步骤 : 
以Domain管理员账户登录TECS Director系统。
单击导航按钮，选择基础设施→数据中心
，打开数据中心页面。
在数据中心页面，单击添加数据中心按钮，打开添加数据中心页面，如[图1]所示。
图1  添加数据中心页面
配置数据中心信息，单击添加按钮。
在数据中心页面，移动鼠标光标到新建数据中心区域，单击物理环境，如[图2]所示。
图2  选择物理环境
在物理环境页面，单击添加物理环境，如[图3]所示。
图3  添加物理环境
在添加物理环境页面，配置物理环境信息，如[图4]所示。
图4  添加物理环境
单击确定按钮，完成配置。
### 对接配置资源北向 

摘要 : 
本节介绍资源北向对接配置操作步骤。 
步骤 : 
以领域管理员账户登录TECS Director系统。
单击导航按钮，选择系统管理→系统设置
，系统默认打开北向设置页面。
单击资源北向对接配置页签，如[图1]所示。
图1  资源北向对接配置页面
单击修改按钮，弹出修改RabbitMq服务器配置对话框，如[图2]所示。
图2  修改RabbitMq服务器配置对话框
根据实际情况填写对接参数，单击保存按钮。
是否开启上报：设置为打开。
其它对接参数为上级北向集团云管的对接参数，需正确填写。 
单击添加待上报资源池按钮，弹出添加待上报资源池对话框，如[图3]所示。
图3  添加待上报资源池对话框
配置资源池信息，单击添加按钮。
资源池为需要上报的接入云环境的名称，从下拉列表中选择。
上报数据中心ID为对接参数，需正确填写。
### 对接异厂家VIM 
摘要 : 
本节介绍配置支持异厂家VIM管理及统一跳转的操作步骤。本任务以对接供应商为Red
Hat的云环境为例。
步骤 : 
以领域管理员账户登录TECS Director系统。
单击导航按钮，选择基础设施→数据中心
，打开数据中心页面。
在数据中心页面，单击添加数据中心，打开添加数据中心页面，如[图1]所示。
图1  配置数据中心信息
配置数据中心信息，配置结束，单击添加按钮。
在数据中心页面，单击新建的数据中心，打开数据中心详情页面，单击对接环境→云环境
，切换至云环境页签，如[图2]所示。
图2  数据中心详情页面
在云环境页面，单击添加云环境，打开添加云环境页面，如[图3]所示。
图3  添加云环境页面
在添加云环境页面，配置云环境参数，如[图4]所示。参数说明参见[表1]。
图4  云环境参数配置实例
参数|说明
---|---
云环境名称|接入云环境的名称，自定义。
物理位置|云环境物理位置，可以根据实际的情况填写。
类型|接入云环境的类型，可以是KVM和vcenter，目前选择KVM。
供应商|从下拉菜单中选择异厂家供应商名称，例如：China Mobile，REDHAT和HUA WEI。
可用区|候选可用区列表是数据中心规划创建且未被其他云环境使用的可用区，若无空闲可用区，可到编辑数据中心进行增加。
Openstack对接参数|Openstack对接参数
认证url|填写访问Openstack原生API接口的认证URL。
用户名/密码|填写用于和Openstack对接的用户名和密码。
默认租户|默认为admin。
Keystone版本|从下拉列表中选择，V2或V3
Provider对接参数|Provider对接参数
认证URL|填写访问Provider运维API接口的的URL。
门户URL|填写跳转到Provider门户的URL。
用户名/密码|填写用于和Provider对接的用户名和密码。
默认租户|默认为admin。
Keystone版本|从下拉列表中选择，V2或V3。
描述|云环境的描述，自定义。
单击添加按钮，系统提示成功添加云环境。在云环境页面显示新增异厂家的云环境信息，如[图5]所示。
图5  异厂家云环境
相关任务 : 
在云环境页面，单击新增异厂家云环境的门户Url链接，可以跳转到对应的异厂家Provider页面。
### 对接容器云 
摘要 : 
本任务介绍了如何在TECS Director上对接容器云。
步骤 : 
以Domain管理员账户登录TECS Director系统。
在TECS Director系统首页，单击导航菜单，选择基础设施→数据中心
，打开数据中心页面。
在数据中心页面，单击添加数据中心，打开添加数据中心页面，如[图1]所示。
图1  配置数据中心信息
配置数据中心信息，单击添加按钮。
在数据中心页面，单击新建的数据中心，打开数据中心详情页面，单击对接环境→容器云
，切换至容器云页签，如[图2]所示。
图2  容器云页签
在容器云页签，单击添加容器云，打开添加容器云页面，如[图3]所示。
图3  添加容器云页面
在添加容器云页面，配置容器云参数，如[图4]所示。参数说明参见[表1]。
图4  容器云参数配置页面
参数|说明
---|---
容器云名称|接入容器云的名称，用户自定义。
类型|接入云环境的类型，选择openpalette。
供应商|供应商选择ZTE。
物理位置|云环境物理位置，可以根据实际的情况填写。
可用区|候选可用区列表是数据中心规划创建且未被其他云环境使用的可用区域，若无空闲可用区域，可到编辑数据中心进行增加。
认证URL|填写访问PaaS管理门户URL。https://IP:1043(其中IP为容器云的浮动地址)。
用户名|填写Openpalette上管理员用户名。
密码|填写Openpalette上管理员用户的密码。
描述|容器云的描述，用户自定义。
单击添加按钮，系统提示添加成功。
### 对接LDAP 
摘要 : 
本节以LDAP/LDAPS+本地认证方式为例，介绍对接LDAP的操作步骤。
现场使用的对接参数，以实际对接的LDAP服务器为准。 
LDAP服务器地址可通过ping zte.intra域名得到。
前提 : 
已经获取对接参数。 
步骤 : 
以Domain管理员账户登录TECS Director系统。
在TECS Director系统首页，单击导航菜单，选择安全管理→认证方式配置
，打开认证方式配置页面。
在认证方式配置页面，单击修改按钮，打开认证方式配置修改页面，如[图1]所示。
图1  修改认证方式配置页面
修改认证方式配置参数。主要参数说明参见[表1]。
参数|说明
---|---
认证方式|LDAP/LDAPS：在LDAP认证失败后不再尝试本地登录。LDAP/LDAPS+本地：在LDAP认证失败后，如该用户在网管系统中存在，且创建来源不是LDAP时，尝试本地登录。
Windows Active Directory|不勾选时，用户基底与用户DN后缀一致。
固定用户DN后缀|勾选时使用固定用户DN后缀
用户基底|用户基底，例如：DC=zte,DC=intra
用户DN前缀|用户前缀，例如：CN=tester1
用户DN后缀|用户后缀，例如：@zte.intra
使用固定角色|勾选时：需要选取一个网管系统中的无租户角色，同步用户将以这个角色为准进行用户同步。不勾时：需要输入角色基底，后续同步用户时将到LDAP服务器中查询用户的角色，然后进行用户同步。
SSL/TSL|勾选时：使用SSL方式连接LDAP服务器，LDAP服务器端口填写SSL端口。不勾选时：使用非SSL方式连接LDAP服务器，LDAP服务器端口填写非SSL端口。
证书文件和密码|证书需要从LDAP服务器获取
 说明： 
标识名称（distinguished Name，DN）：对象在 Active Directory 内的完整路径，DN 有三个属性，分别是 CN，OU，DC。 
DC (Domain Component)：域名组件； 
CN (Common Name)：通用名称，一般为用户名或计算机名； 
OU (Organizational Unit)：组织单位； 
单击确定按钮。
### 对接RADIUS 
摘要 : 
介绍如何对接RADIUS。 
步骤 : 
安装配置FreeRadius
环境准备。 
Centos7 64-bit的linux系统，带GUI。 
Root可登录、SSH可访问。 
（可通过该centos7_radius.qcow2镜像直接起一个虚机，里面已经配置好radius，可以直接跳过步骤2~步骤5） 
设置服务器访问互联网。 
配置IP，设置好DNS（10.30.1.9） 
export http_proxy=http://10.41.70.8:80
打开firefox，输入http://10.41.70.8，进入公司的认证界面，输入工号和密码，返回认证成功。 
认证成功后，可以上网。 
关闭防火墙： 
systemctl disable firewalld
systemctl stop firewalld
安装freeradius。 
（可选）安装开发包： 
yum install -y install gcc gcc-c++ openssl openssl-devel pcre pcre-devel libtalloc-devel hiredis* ykclient libpcap libpcap-devel libnl-devel libnl net-snmp net-snmp-utils
安装freeradius。安装freeradius相关包： 
yum install -y freeradius*
安装后检查： 
` rpm -qa|grep freeradius
freeradius-devel-3.0.4-7.el7_3.x86_64
freeradius-mysql-3.0.4-7.el7_3.x86_64
freeradius-doc-3.0.4-7.el7_3.x86_64
freeradius-3.0.4-7.el7_3.x86_64
freeradius-postgresql-3.0.4-7.el7_3.x86_64
freeradius-python-3.0.4-7.el7_3.x86_64
freeradius-utils-3.0.4-7.el7_3.x86_64
freeradius-unixODBC-3.0.4-7.el7_3.x86_64
freeradius-krb5-3.0.4-7.el7_3.x86_64
freeradius-sqlite-3.0.4-7.el7_3.x86_64
freeradius-perl-3.0.4-7.el7_3.x86_64
freeradius-ldap-3.0.4-7.el7_3.x86_64` 
测试。修改/etc/raddb/users： 
vi /etc/raddb/users，找到这一行#steve Cleartext-Password:="testing" ，将前面的#去掉。
检查： 
`root@localhost etc] cat /etc/raddb/users|grep -v ^|grep -v ^$
steve   Cleartext-Password := "testing"
DEFAULT Framed-Protocol == PPP
        Framed-Protocol = PPP,
        Framed-Compression = Van-Jacobson-TCP-IP
DEFAULT Hint == "CSLIP"
        Framed-Protocol = SLIP,
        Framed-Compression = Van-Jacobson-TCP-IP
DEFAULT Hint == "SLIP"
        Framed-Protocol = SLIP` 
以调试方式启动freeradius： 
`radiusd -X
radiusd:  Opening IP addresses and Ports 
listen {
        type = "auth"
        ipaddr = *
        port = 0
   limit {
        max_connections = 16
        lifetime = 0
        idle_timeout = 30
   }
}
listen {
        type = "acct"
        ipaddr = *
        port = 0
   limit {
        max_connections = 16
        lifetime = 0
        idle_timeout = 30
   }
}
listen {
        type = "auth"
        ipv6addr = ::
        port = 0
   limit {
        max_connections = 16
        lifetime = 0
        idle_timeout = 30
   }
}
listen {
        type = "acct"
        ipv6addr = ::
        port = 0
   limit {
        max_connections = 16
        lifetime = 0
        idle_timeout = 30
   }
}
listen {
        type = "auth"
        ipaddr = 127.0.0.1
        port = 18120
}
Listening on auth address * port 1812 as server default
Listening on acct address * port 1813 as server default
Listening on auth address :: port 1812 as server default
Listening on acct address :: port 1813 as server default
Listening on auth address 127.0.0.1 port 18120 as server inner-tunnel
Opening new proxy socket 'proxy address * port 0'
Listening on proxy address * port 53032
Ready to process requests` 
新打开一个终端： 
`radtest steve testing localhost 0 testing123
Sending Access-Request Id 148 from 0.0.0.0:45266 to 127.0.0.1:1812
    User-Name = 'steve'
    User-Password = 'testing'
    NAS-IP-Address = 127.0.0.1
    NAS-Port = 0
    Message-Authenticator = 0x00
Received Access-Accept Id 148 from 127.0.0.1:1812 to 127.0.0.1:45266 length 20` 
如果输出Received Access-Accept说明成功了。 
安装mariadb。 
安装： 
yum install -y mariadb-server mysql-devel mysql-connector-odbc libdbi-dbd-mysql
启动mysql： 
systemctl enable mariadb
systemctl start mariadb
FreeRadius和mariadb对接。 
创建数据库并导入radius数据结构： 
` mysql -u root –p
Enter password: ---默认密码为空，直接回车
Welcome to the MariaDB monitor. Commands end with ; or \g.
Your MariaDB connection id is 8
Server version: 5.5.52-MariaDB MariaDB Server
Copyright (c) 2000, 2016, Oracle, MariaDB Corporation Ab and others.
Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.
MariaDB [(none)]> create database radius;
MariaDB [(none)]> grant all on radius.* to 'radius'@'localhost' identified by '
radpass';
MariaDB [(none)]> flush privileges;
MariaDB [(none)]> exit
 mysql -u root -p radius < /etc/raddb/mods-config/sql/main/mysql/schema.sql` 
建立组（在此新建组名称为user）： 
`use radius;
insert into radgroupreply (groupname,attribute,op,value) values ('user','Auth-Type',
':=','Local'); 
insert into radgroupreply (groupname,attribute,op,value) values ('user','Service-Type'
,':=','Framed-User'); 
insert into radgroupreply (groupname,attribute,op,value) values ('user','Framed-IP-
Address',':=','255.255.255.255'); 
insert into radgroupreply (groupname,attribute,op,value) values ('user','Framed-IP-
Netmask',':=','255.255.255.0');` 
建立用户（在此新建用户名为test，密码为testpwd）： 
`insert into radcheck (username,attribute,op,value) values ('test','Cleartext-Password'
,':=','testpwd');` 
将用户加入组中： 
`insert into radusergroup (username,groupname) values ('test','user');
exit` 
修改freeradius中的mysql认证配置： 
`cd /etc/raddb/mods-enabledln -s ../mods-available/sql sql` 
修改freeradius中的mysql配置： 
`vi /etc/raddb/mods-available/sql` 
找到driver = “rlm_sql_null”修改为driver = “rlm_sql_mysql”，将下面几行的注释去掉： 
`server = "localhost" 
port = 3306 
login = "radius" 
password = "radpass"` 
保存后退出。 
测试通过数据库做用户认证。 
以调试方式运行freeradius： 
`[root@localhost ]radiusd -X
……
Sending Access-Accept Id 214 from 127.0.0.1:1812 to 127.0.0.1:57740
Service-Type = Framed-User
Framed-IP-Address = 255.255.255.255
Framed-IP-Netmask = 255.255.255.0
(0) Finished request
Waking up in 0.3 seconds.
Waking up in 4.6 seconds.
(0) Cleaning up request packet ID 214 with timestamp +38
Ready to process requests` 
在另一终端执行： 
`[root@localhost etc] radtest test testpwd localhost 1812 testing123
Sending Access-Request Id 214 from 0.0.0.0:57740 to 127.0.0.1:1812
User-Name = 'test'
User-Password = 'testpwd'
NAS-IP-Address = 127.0.0.1
NAS-Port = 1812
Message-Authenticator = 0x00
Received Access-Accept Id 214 from 127.0.0.1:1812 to 127.0.0.1:57740 length 38
Service-Type = Framed-User
Framed-IP-Address = 255.255.255.255
Framed-IP-Netmask = 255.255.255.0` 
配置RADIUS服务器
Raidus服务器上添加需要认证的服务器。 
添加需要认证的服务器，比如vi /etc/raddb/clients.conf追加client 172.255.100.0/24{ secret = testing123(认证的密钥)} 
设置后172.255.100开头的IP地址的Provider/云管系统可以访问这个radius服务器。 
Raidus服务器创建用户。 
建立用户（在此新建用户名为radiususer1，密码为testpwd）： 
`insert into radcheck (username,attribute,op,value) values ('radiususer','Cleartext-
Password',':=',Admin@123');` 
将用户加入组中： 
`insert into radusergroup (username,groupname) values ('radiususer','Admin@123');
exit` 
配置云管系统 RADIUS服务器
Raidus服务器上添加需要认证的服务器。 
登录TECS Director。
选择安全管理→认证方式配置
，打开认证方式配置页面，修改认证方式为Radius，如[图1]所示。
图1  认证方式配置
填写参数。 
参数说明参见[表1]。
参数|说明
---|---
IP地址|Radius服务器所在机器地址（例如 10.62.106.220）
服务端口|Radius服务器端口（一般是1812）
秘钥|步骤5配置的secret的值（testing123）
超时时间|用户可以自定义（60）
验证类型|用户根据服务器实际情况（一般是PAP）
单击确认按钮，增加认证radius服务器配置，如[图2]所示。
图2  结果
配置外部用户登录。 
在radius服务器创建好的第三方用户，登录TECS Director。
例如插入的是radiususer/Admin@123，使用这个用户名密码登录。 
### 对接PaaS的QoS告警 
摘要 : 
TECS Director产品的QoS告警是由PaaS平台进行监控。当PaaS平台根据预定义阈值触发告警时，会通过SNMP Trap将告警发送给TECS Director进行呈现，因此需要完成PaaS平台告警北向上报配置以及TECS Director产品SNMP南向配置，从而实现上述QoS告警呈现。
前提 : 
已经获取PaaS平台登录用户名、密码。 
已经获取管登录TECS Director系统的管理员账户。 
步骤 : 
配置PaaS
SNMP北向
在浏览器地址输入栏中，输入PaaS平台环境登录地址（https://ip:1043/portaladmin），单击回车键。
输入用户名、密码，单击登录按钮，如[图1]所示。
图1  OpenPalette页面
在OpenPalette系统，选择系统设置→告警管理
，打开告警管理页面。
在告警管理页面，切换到SNMP北向地址页签，如[图2]所示。
图2  SNMP北向地址
单击添加SNMP北向地址按钮，打开添加SNMP北向地址页面，如[图3]所示。
图3  添加SNMP北向地址页面
配置添加SNMP北向地址参数，参数说明参见[表1]。
参数|说明
---|---
IP地址|填写TECS Director浮动地址
端口|填写40002
SNMP协议类型|选择SNMP v3版本
用户名|用户名需要与TECS Director的系统管理→南向设置→告警SNMPV3中设置的用户名一致
安全级别|选择认证&加密
认证模式|需要与TECS Director的系统管理→南向设置→告警SNMPV3设置中认证方式一致，建议填写MD5
认证密码|填写认证密码，需要与TECS Director的系统管理→南向设置→告警SNMPV3中设置一致。密码长度至少8位，必须包含大写字母、小写字母、数字和特殊符号中的三种
加密模式|需要与TECS Director的系统管理→南向设置→告警SNMPV3设置中加密方式一致，建议填写DES
加密密码|填写加密密码，需要与TECS Director的系统管理→南向设置→告警SNMPV3中设置一致。密码长度至少8位，必须包含大写字母、小写字母、数字和特殊符号中的三种
单击添加按钮。
配置云管系统 SNMP南向
在浏览器地址输入栏中，输入TECS Director环境登录地址（https://ip/uportal/），单击回车键。
输入用户名、密码，单击登录按钮。
在TECS Director系统首页，单击导航菜单，选择系统管理→系统设置→南向设置
，打开南向设置页面。
在南向设置页面，切换到告警SNMP V3设置页签，如[图4]所示。
图4  告警SNMP V3设置页签
单击修改按钮，设置参数，完成南向设置接收来自PaaS告警。
参数|说明
---|---
SNMP协议类型|填写V3
用户名|用户名需要与PaaS的系统管理→告警管理→SNMP北向地址中用户名一致
安全级别|选择认证&加密
认证模式|需要与PaaS的系统管理→告警管理→SNMP北向地址中认证方式一致
认证密码|填写认证密码，需要与PaaS的系统管理→告警管理→SNMP北向中设置一致。密码长度至少8位，必须包含大写字母、小写字母、数字和特殊符号中的三种
加密模式|需要与PaaS的系统管理→告警管理→SNMP北向地址中加密方式一致
加密密码|填写加密密码，需要与PaaS的系统管理→告警管理→SNMP北向中设置一致。密码长度至少8位，必须包含大写字母、小写字母、数字和特殊符号中的三种
单击确定按钮。
启用QoS告警
在OpenPalette系统，选择系统设置→告警管理
，打开告警管理页面。
在告警管理页面，切换到QoS配置页签，如[图5]所示。
图5  QoS配置页签
依次单击节点、磁盘分区、组件实例，参见[表3]建议设置QoS告警。
告警分类|告警名称|启用建议|阈值建议
---|---|---|---
节点|系统1分钟内平均负载|是|严重 4N/A重要 3N/A次要 2N/A警告 1N/A
网络流出字节速率|节点|否|严重 900000000Bps重要 750000000Bps次要 500000000Bps警告 300000000Bps
网络流入字节速率|节点|否|严重 900000000Bps重要 750000000Bps次要 500000000Bps警告 300000000Bps
磁盘占用率|节点|是|严重 90%重要 85%次要 80%警告 75%
内存总占用率|节点|是|严重 90%重要 85%次要 80%警告 75%
CPU占用率|节点|是|严重 90%重要 85%次要 80%警告 75%
CPU等待调度占用率|节点|是|严重 40%重要 30%次要 20%警告 10%
系统当前使用pid数目占用率|节点|是|严重 90%重要 85%次要 80%警告 75%
CPU等待I/O占用率|节点|是|严重 70%重要 60%次要 50%警告 40%
磁盘分区|分区占用率|是|严重 90%重要 85%次要 80%警告 75%
组件实例|内存总占用率|是|严重 90%重要 85%次要 80%警告 75%
CPU占用率|组件实例|是|严重 90%重要 85%次要 80%警告 75%
### 对接异地容灾 
摘要 : 
TECS Director管理系统支持异地容灾。
异地容灾可以在两个DC同步配置，日志，告警（不包含历史告警），镜像，操作日志，性能数据和报表。 
在主用站点发生灾难时，可以发起主备切换，备用DC可以切换为主，继续提供服务，数据不丢。 
步骤 : 
在浏览器地址输入栏中，输入主用站点容灾配置环境登录地址（https://<主用站点地址>:1043/myportal），单击回车键，如[图1]所示。
图1  登录主用站点
输入用户名、密码，单击登录按钮，如[图2]所示。
 说明： 
默认用户名为admin
，密码为PaaS1!2@3#4$。 
图2  选择异地容灾页面
单击新增按钮，如[图3]所示。
图3  新增站点对话框
输入新增站点配置参数信息，参数说明参见[表1]。
参数|说明
---|---
基本信息|角色|如果登录的是本地主用的异地容灾页面，则选择主。如果登录的是异地备用的异地容灾页面，则选择备。
节点名称|基本信息|用于区别主备节点，填写当前节点的名称。填写示例：上海
租户|基本信息|固定选director。
描述|基本信息|用于描述该节点的信息。
配置信息|用户名|ssm。
密码|配置信息|PaaS1!2@3#4$。
门户地址IP/端口|配置信息|登录该异地容灾页面的IP/端口（1043）。
参考步骤[1]~步骤[4]，登录备用站点异地容灾页面， 新增备用容灾站点。
参考步骤[1]重新登录主用站点，执行对端站点配置。
单击操作列的容灾按钮，打开容灾页面。
单击容灾页面右侧+，如[图4]所示，增加对端节点配置。
图4  增加对端节点配置
在配置对端节点页面，如[图5]所示，配置对端心跳检查参数，参数说明参见[表2]。
图5  配置对端节点
参数|说明
---|---
IP地址|对端IP地址。
端口|对端端口为1043。
用户名|用户名为对端PaaS系统的ssm用户账号。
密码|密码为对端PaaS系统的ssm用户账号密码（ssm用户密码PaaS1!2@3#4$ ）。
最大检查次数|最大检测次数：1~10。
检测间隔|检测间隔：1秒~30秒。
单击快速配置按钮，一键获取对端站点的相关信息。
（可选）如果对端系统的数据传递地址、命令控制地址有多个IP，需从下拉列表中选取。 
单击确定按钮，配置完成后即可看到主备两个站点信息，如[图6]所示。
图6  配置完成
配置容灾中间件。 
 说明： 
主备两个节点都需要执行下面步骤完成主备节点的中间件配置。 
在容灾页面的中间件区域，单击FTP操作列的配置按钮，如[图7]所示。
图7  配置参数设置页面（FTP）
保持默认配置，单击确定按钮，即可配置成功。
 说明： 
FTP配置完成，页面右上角会有“配置成功”的提示，返回到容灾页面 FTP可以进行的操作有配置、启动、和手动执行。
在容灾页面的中间件区域，单击PG操作列的配置按钮，如[图8]所示。
图8  配置参数设置页面（PG）
参数说明参见[表3]。
参数|说明
---|---
对端数据传输地址|填写对端节点的gr_net平面的浮动地址（SLB可访问地址）。
对端数据传输端口|填写对端节点数据传输端口号。
单击确定按钮。
### 配置资源北向接口对接 
摘要 : 
介绍如何配置资源北向接口对接。 
步骤 : 
单击TECS Director顶部菜单栏中的按钮，选择更多→安全管理→用户管理
，打开用户管理页面，如[图1]所示。
图1  用户管理页面
单击+新建用户按钮，打开新建用户页面，如[图2]所示。
图2  新建用户-基本信息
输入用户名“api-user”，密码“Admin@13”，用户规划选择“API访问规则”，同时登录数限制选择“不限制”，单击下一步按钮，打开新建用户-权限分配页面。
角色选择“系统管理员”，单击新建按钮，创建用户。
接口调用。 
`POST  /api/oauth2/v1/oauth/token
` 
英文名|中文名|位置|类型|取值范围及说明|必选/可选
---|---|---|---|---|---
grantType|鉴权类型|请求消息体|字符串|鉴权类型，申请Token时取值password|必选
userName|登录用户名|请求消息体|字符串|登录用户名说明：该用户关联的账号规则必须支持API方式登录，否则将禁止登陆|必选
value|登录密码|请求消息体|字符串|登录密码|必选
英文名|中文名|位置|类型|取值范围及说明|必选/可选
---|---|---|---|---|---
accessToken|访问Token|响应消息体|字符串|登录成功后，返回Token。当调用其他API接口时，需要在请求消息头中accessToken字段填写。|必选
expires|accessToken超时时间|响应消息体|数字|accessToken的超期时间，单位秒|必选
参数|类型|说明|可选|备注
---|---|---|---|---
code|int|Zenap内部规范错误码|M|-
message|String|错误码描述|M|比如：“User simultaneous login exceeded the limit”表示在线用户数超过限制，需要修改
 说明： 
请求头中在携带Token： 
申请token后，再发起rest接口请求时，需要在http请求头header中填写accessToken该值为该接口返回值中得到的accessToken值。 
accessToken如果已经过期，请求将返回401响应码。 
具体方法：curl -X POST -H "Content-Type: application/json" -d '{"grantType":"password","userName":"api-user","value":"Admin@13"}' https://xxxxx/api/oauth2/v1/oauth/token -k 
### 对接性能统计北向文件 
摘要 : 
介绍如何对接性能统计北向文件。 
步骤 : 
单击导航按钮，选择更多→系统管理→系统设置
，打开北向设置页面。
单击性能北向FTP服务器设置页签，显示性能北向FTP服务器配置参数。
单击修改按钮，修改性能FTP服务器参数，其中服务器位置选择本地，传输方式选择SFTP，如[图1]所示。
图1  性能FTP服务器参数修改实例
 说明： 
SFTP服务端地址：TECS Director北向运维浮动IP，SFTP端口号 29952，默认只读账号和密码 pm/Perf#out1! 
如果需要修改pm账号的密码，可以在更多→系统管理→配置中心→内控管理中，找到pm账号，单击操作列的修改密码，进行修改。 
### 配置告警SNMP北向对接 
摘要 : 
介绍如何配置告警SNMP北向对接。 
步骤 : 
单击导航按钮，选择运维→告警管理→告警设置→接口管理
，打开接口管理页面，如[图1]所示。
图1  接口管理页面
单击接口开通按钮，打开接口开通-选择规范接口页面，如[图2]所示。
图2  接口开通-选择规范接口页面
选择规范和接口，单击下一步按钮，打开接口开通-编辑规范接口页面，如[图3]所示。
图3  接口开通-编辑规范接口
单击接口名称，在右侧配置北向SNMP代理中的“服务端地址和端口号”并配置版本。 
单击下一步按钮，打开接口开通-预览页面，如[图4]所示。
图4  接口开通-预览页面
单击开通按钮，等待开通完成后，在页面上显示开通结果。
### 对接华三存储 
摘要 : 
介绍如何对接第三方华三存储提供的分布式对象存储服务的步骤。 
前提 : 
完成Director、TECS节点信息的收集。完成Director运营运维管理软件、TECS虚拟层软件部署。目前商用环境主推V6，由于华三存储只支持ipv4地址，需要在Director上增加V4管理面和存储数据面地址，以便能访问华三存储管理面和S3面地址，TECS上不需要，安装之前Director需要规划V4/6双栈。完成Director上纳管接入TECS云环境，如图1所示。图1  成功接入云环境 
完成华三分布式存储软件的安装，并且收集节点信息，参见表1。表1  收集节点信息名称详情管理面浮动188.5.123.202管理端口号80S3地址172.23.51.17DNS域名jmyd.object.com (通过域名来访问S3地址)S3端口号8082集群webhttps://188.5.123.202集群端口号80集群ID748fcb27-fe48-4112-8a4e-bc5aff587b90管理员账号jmyd_a管理员密码User@123对象用户jmydA01对象用户AKVZ54AJ3Q1DCEY8P0LZWF对象用户SK7Oi20GscaygGSRmsvoHKD1EE7B75Iso8uN0AyzCy 
检查存储管理网络和S3网络节点。在Director上检查是否可以端对端连通华三管理面地址以及华三S3面地址。在Director上配置华三对应的域名解析地址，路径更多→系统管理→系统设置→DNS设置。 
步骤 : 
配置并绑定VDC
创建VDC 
单击Director uportal页面顶部菜单栏中的按钮，选择运营→租户资源管理→VDC
，打开VDC页面。
单击+创建VDC按钮，打开创建VDC页面，在基本信息选项卡页面中，填写配置参数。
单击下一步按钮，进入选择云环境选项卡，为VDC选择云环境。
单击下一步按钮，进入资源配置选项卡页面，填写配置参数。
单击项目名称设置下的开关，选择云环境上已有租户，可以将已有的项目纳管进来。
单击下一步按钮，进入检查确认选项卡页面，检查创建VDC的参数是否正确，
单击创建按钮，完成VDC的创建。
VDC创建完成后，会在对应的TECS上创建一个租户，命名规则是<vdcname+admin>，需要登录到tecs上获取这个租户的id，获取命令为”openstack project list |grep vdcname“，如[图2]所示。
图2  获取命令
绑定VDC 
单击Director uportal顶部菜单栏中的按钮，选择运营→租户资源管理→组织管理
，打开组织管理页面。
单击要绑定VDC的组织名称，进入组织详情页面，切换到VDC子页面。
单击+绑定VDC按钮，打开+绑定VDC页面，页面显示了可绑定的VDC列表。
单击绑定按钮，完成组织和VDC的绑定，如[图3]所示。
图3  绑定VDC
发布对象存储服务
对象存储以微服务形式提供，需要在Director中上架zte-object服务。正常情况下，环境部署好后可以自动上架，若没有，需要手动上架，手动上架路径：运营→产品中心→产品目录→全部产品→搜索框搜索
，如[图4]所示。
图4  手动上架操作
若产品为非上架状态，单击操作列的重新发布和可用区管理，进行可用区的发布设置。
TECS注册对象存储服务
需要在TECS控制节点上操作，通过ssh登录控制节点，切换到root用户，source环境变量,通过以下命令进行资源配置。 
创建S3配置 
openstack user create s3     
openstack service create object-store --name s3  
openstack endpoint create s3 public unistor.jmyd.object.com:8082 
 说明： 
地址为S3面地址，参见[1673667697110.html#z37c59f7d03bb4617a8f76e1e244b8459__df7c3168-4321-432f-a40b-7dd7a7b0603e]。
创建H3C配置 
openstack user create h3c 
openstack service create object-store --name h3c   
openstack endpoint create h3c admin http://188.5.123.201:80 
 说明： 
地址为华三管理面地址，参见[1673667697110.html#z37c59f7d03bb4617a8f76e1e244b8459__df7c3168-4321-432f-a40b-7dd7a7b0603e]。
创建秘钥管理 
openstack credential create h3c '{"access": "admin", "secret": "Admin@123", "cluster_id": "748fcb27-fe48-4112-8a4e-bc5aff587b90"}' --type cert --project services 说明：admin/Admin@123为h3c管理面的用户名密码，cluster_id为存储集群ID ，参见1673667697110.html#z37c59f7d03bb4617a8f76e1e244b8459__df7c3168-4321-432f-a40b-7dd7a7b0603e。 
openstack credential create s3 '{"access": "VZ54AJ3Q1DCEY8P0LZWF", "secret": "7Oi20GscaygGSRmsvoHKD1EE7B75Iso8uN0AyzCy", "user": "jmydA$jmydA01"}' --type cert --project 7ac92fbf10ad4ea1b84126abb8f4ea07 说明：access/secret为H3C存储集群上对应用户的ak/sk，user部分jmydA$jmydA01为存储租户$租户下的用户，参见1673667697110.html#z37c59f7d03bb4617a8f76e1e244b8459__df7c3168-4321-432f-a40b-7dd7a7b0603eproject 为vdc对应的tecs租户上的id。 
登录对象存储客户端
正常登录对象存储，对外提供端访问路径为”40446/userportaliui“，如[图5]所示。
图5  登录对象存储客户端
### 参考 
#### 端口开放列表 
各系统调用TECS Director时的端口参见[表1]。
端口|协议|归属服务|发布方法|说明|网络平面
---|---|---|---|---|---
123|UDP(NTP)|PaaS平台|PaaS平台发布|对Provider提供NTP时钟同步服务（实际上就是MSB所在节点提供NtpServer）|北向
22|TCP|PaaS平台|PaaS平台发布|SSH|北向
1080|HTTP（不安全）|PaaS平台|PaaS平台发布|TECS Director自身运维Portal（PaaS平台Portal）|北向
1042|TCP|PaaS 软件仓库|调用MSB接口发布|PaaS 提供的docker pull/push 功能|北向
1043|HTTPS|PaaS平台|PaaS平台发布|TECS Director自身运维Portal（PaaS平台Portal）|北向
10080|HTTP（不安全）|apigateway|应用服务预留端口|Http对外（Web/对接客户）端口|北向
443|HTTPS|apigateway|应用服务预留端口|单向认证对外(Web/对接客户）端口|北向
80|http（不安全）|hybirdCloud|自服务门户http|自服务门户 （同控制节点合一场景）|北向
446|https|hybirdCloud|自服务门户https|自服务门户 （同控制节点合一场景）|北向
1161|UDP/SNMPv2（不安全）|FM|应用服务预留端口|SNMP Get获取告警（FM进程使用）|北向
29951|TCP/FTP（不安全）|FTP公共服务|公共服务端口|FTP性能数据北向|北向
29952|TCP|FTP公共服务|公共服务端口|SFTP性能数据北向|北向
29888|TCP|swr|应用服务预留端口|SWR-Out 用来发布到Openpallte，后者通过这个主动向SWR拉取控制消息|北向
40041|TCP|U31|调用MSB接口发布|U31 http拉远|北向
40042|TCP|U31|调用MSB接口发布|U31 https拉远|北向
29603|TCP|LOG|调用MSB接口发布|日志SFTP北向代理出口|北向
29998|TCP||调用MSB接口发布|NBM(VIM备份恢复)边缘云场景纳管NBM|北向
4955|HTTP/HTTPS|PaaS公共服务租户|应用服务端口预留|PaaS公共服务运维端口|北向
4956|HTTP/HTTPS|北向|PaaS公共服务租户|应用服务端口预留|PaaS公共服务运维端口
4957|HTTP/HTTPS|北向|PaaS公共服务租户|应用服务端口预留|PaaS公共服务运维端口
6080|TCP|apigateway|应用服务预留端口|虚机控制台，因为兼容纳管的云环境版本差异，所以对外暴漏多个端口；|北向
7110|TCP|apigateway|北向|应用服务预留端口|虚机控制台，因为兼容纳管的云环境版本差异，所以对外暴漏多个端口；
7140|TCP|apigateway|北向|应用服务预留端口|虚机控制台，因为兼容纳管的云环境版本差异，所以对外暴漏多个端口；
7170|TCP|apigateway|北向|应用服务预留端口|虚机控制台，因为兼容纳管的云环境版本差异，所以对外暴漏多个端口；
7200|TCP|apigateway|北向|应用服务预留端口|虚机控制台，因为兼容纳管的云环境版本差异，所以对外暴漏多个端口；
16080|TCP|apigateway|北向|应用服务预留端口|虚机控制台，因为兼容纳管的云环境版本差异，所以对外暴漏多个端口；
9131,  9141,  8776，8774,  9696,  8042,  9292,  9322,  9311,  8777,  8000,  9890, 8004,  5000,  9531,  35357,  9292,  10756,  6030,  8089,  36387,  36417,  9804, 9806,  10322,  10726,  9834,  9322,  9836,  9837,  10352,  35357, 8089|HTTP/HTTPS|apigateway|应用服务预留端口|广西电信；拉美7国；边缘云场景，Mano对接提供的Openstack原生端口（默认不开放）|北向
39920-4004040043-40350|TCP|VRM|调用MSB接口发布|MSB拉远资源池（每个资源池暴漏一个端口）（边缘云增加 200个云环境个数）|北向
40351-40400|TCP|预留|预留|预留|北向
29672~29800|TCP||调用MSB接口发布|TECS Director纳管Uniview|北向
40001|UDP/SNMP（不安全）|FM|应用服务预留端口|Provider告警上报(SNMP)（从MSB入）|南向
40002|UDP|FM|应用服务预留端口|Provider告警上报(SNMPv3)（从MSB入）|南向
35000|TCP|swr|应用服务预留端口|软件仓库Registry对南向openpallte的数据流|南向
29805|TCP|nid|应用服务预留端口|nid-sk对外资源池保留端口，网络探测使用|南向
29992|TCP/无SSL（不安全）|kafka|应用服务预留端口|kafka1南向上报，切PAAS平台后均从MSB入|南向
29993|TCP/无SSL（不安全）|kafka|应用服务预留端口|kafka2南向上报，切PAAS平台后均从MSB入|南向
29994|TCP/无SSL（不安全）|kafka|应用服务预留端口|kafka3南向上报，切PAAS平台后均从MSB入|南向
29995|TCP|kafka|应用服务预留端口|kafka3 ssl 南向上报，切PAAS平台后均从MSB入|南向
29996|TCP|kafka|应用服务预留端口|kafka3 ssl 南向上报，切PAAS平台后均从MSB入|南向
29997|TCP|kafka|应用服务预留端口|kafka3 ssl 南向上报，切PAAS平台后均从MSB入|南向
#### 对接云环境认证方式 
由于安全性的要求，TECS Director对接TECS OpenStack时会要求进行认证配置。认证配置包括单向认证和双向认证。
根据规划配置环境认证信息。 
TECS OpenStack和TECS Director两边认证配置需要一致。 
TECS Director中云环境状态为Normal说明对接成功。 
##### 对接单向认证云环境 
摘要 : 
本节以单个云环境单向认证为例介绍TECS Director对接TECS Openstack时进行认证配置操作步骤。
步骤 : 
在daisy系统中，选择云配置→证书管理
，如[图1]所示，查看外部证书认证方式是否为单向。
图1  外部认证方式查看
打开SSH登录软件（例如：双击MobaXterm.exe），登录到TECS Openstack一个控制节点上。
证书目录/etc/https/ssl_external/client，如[图2]所示，将client目录下的证书都下载下来。
图2  证书目录
添加根证书。 
在根证书页签，单击添加证书按钮，如[图3]所示。
图3  根证书页签
在添加证书对话框中，如[图4]所示，填写证书名称。
图4  添加证书
单击上传证书按钮，上传证书。
单击确认按钮。
在TECS Director系统，选择基础设施→数据中心→云环境
，打开云环境页面，如[图5]所示。
图5  云环境页面
选择需要配置认证的云环境，单击配置中心。
单击证书页签，如[图6]所示，设置认证方式为单向认证。
图6  证书子页签
单击确认按钮。
##### 对接双向认证云环境 
###### 对接单个云环境双向认证 
摘要 : 
本节以单个云环境双向认证为例介绍TECS Director对接TECS Openstack时进行认证配置操作步骤。
步骤 : 
在daisy系统中，选择云配置→证书管理
，如[图1]所示，查看外部证书认证方式是否为双向。
图1  外部认证方式查看
打开SSH登录软件（例如：双击MobaXterm.exe），登录到TECS Openstack一个控制节点上。
证书目录/etc/https/ssl_external/client，如[图2]所示，将client目录下的证书都下载下来。
图2  证书目录
在TECS Director中导入服务端证书。
在TECS Director系统，选择系统管理→系统设置→证书管理
，单击服务端证书页签，如[图3]所示。
图3  服务端证书页签
单击修改按钮，如[图4]所示，分别上传证书和私钥。
图4  修改证书对话框
 说明： 
服务端证书文件为client.pem，私钥文件为clientkey.pem。
单击确认按钮。
添加根证书。 
在根证书页签，单击添加证书按钮，如[图5]所示。
图5  根证书页签
在添加证书对话框中，如[图6]所示，填写证书名称。
图6  添加证书
单击上传证书按钮，上传证书。
 说明： 
根证书文件为ca.pem。
单击确认按钮。
在TECS Director系统，选择基础设施→数据中心→云环境
，打开云环境页面，如[图7]所示。
图7  云环境页面
选择需要配置认证的云环境，单击配置中心。
单击证书页签，如[图8]所示，设置认证方式为双向认证。
图8  证书子页签
单击确认按钮。
###### 对接两个云环境双向认证 
摘要 : 
本节以两个云环境双向认证为例介绍TECS Director对接TECS Openstack时进行认证配置操作步骤。
步骤 : 
对接第一个云环境
在daisy系统中，选择云配置→证书管理
，如[图1]所示，查看外部证书认证方式是否为双向。
图1  外部认证方式查看
打开SSH登录软件（例如：双击MobaXterm.exe），登录到TECS Openstack一个控制节点上。
证书目录/etc/https/ssl_external/client，如[图2]所示，将client目录下的证书都下载下来。
图2  证书目录
在TECS Director中导入服务端证书。
在TECS Director系统，选择系统管理→系统设置→证书管理
，单击服务端证书页签，如[图3]所示。
图3  服务端证书页签
单击修改按钮，如[图4]所示，分别上传证书和私钥。
图4  修改证书对话框
 说明： 
服务端证书文件为client.pem，私钥文件为clientkey.pem。
单击确认按钮。
添加根证书。 
在根证书页签，单击添加证书按钮，如[图5]所示。
图5  根证书页签
在添加证书对话框中，如[图6]所示，填写证书名称。
图6  添加证书
单击上传证书按钮，上传证书。
 说明： 
根证书文件为ca.pem。
单击确认按钮。
在TECS Director系统，选择基础设施→数据中心→云环境
，打开云环境页面，如[图7]所示。
图7  云环境页面
选择需要配置认证的云环境，单击配置中心。
单击证书页签，如[图8]所示，设置认证方式。
 说明： 
如果外部证书认证方式为双向，则TECS Director通过双向认证方式对接。
认证方式包括：单向认证、双向认证。 
图8  证书子页签
单击确认按钮。
对接第二个云环境
打开SSH登录软件（例如：双击MobaXterm.exe），登录到TECS Openstack一个控制节点上。
证书目录/etc/https/ssl_external/client，如[图2]所示，将client目录下的证书都下载下来。
添加根证书。 
在根证书页签，单击添加证书按钮，如[图9]所示。
图9  根证书页签
在添加证书对话框中，填写证书名称。
单击上传证书按钮，上传下载的根证书。
 说明： 
根证书文件为ca.pem。
单击确认按钮。
在TECS Director系统云环境列表配置中心配置证书。
在TECS Director系统，选择基础设施→数据中心→云环境→所有云环境
。
选择需要配置认证的云环境，单击配置中心。
单击证书页签，如[图8]所示，设置认证方式。
第二个云环境daisy页面合并证书
在第二个云环境daisy系统中，选择云配置→证书管理
，如[图10]所示，单击对接方的根证书后的下载按钮，下载对接根证书。
图10  下载对接根证书
合并第二个云环境和第一个云环境下载的ca.pem文件。
用记事本打开两个文件，把第一个云环境中下载的ca证书拷贝到第二个云中下载的ca证书里面，并保存，合并ca证书，如[图11]所示。
 说明： 
不能修改证书文件名称。 
图11  合并证书
在第二个云环境daisy系统中，选择云配置→证书管理
，如[图12]所示，再次导入合并后的根证书。
图12  上传合并后的根证书
单击对接方的根证书后的选择文件按钮，选择合并后的ca.pem文件。
单击上传按钮。
单击提交按钮。
 说明： 
可在页面下方查看文件上传进度，任务进度100%后则表示上传成功，可以再次下载以确认合并后的文件上传成功了。 
验证有效性。 
方法一：打开SSH登录软件（例如：双击MobaXterm.exe），登录到TECS OpenStack的控制节点上。进入到iag容器内。[root@host-192-201-1-151 ~]# docker exec  -it  580b4802b23c /bin/sh进入容器后查看文件是否合并后的内容。sh-4.2# cat /home/iag/nginx/conf/include/AuthConf/external/ca.pem 
方法二：从TECS控制节点/etc/https/ssl_external/server/ca.pem路径下获取文件查看合并的有效性。[root@host-192-201-1-151 ~]# cd /etc/https/ssl_external/server/
[root@host-192-201-1-151 server]# ll
total 16
-rw-r--r--. 1 tecs tecs 2541 Jan 14 11:53 ca.pem
-rw-r--r--. 1 tecs tecs 1679 Jan 14 11:53 serverkey.pem
-rw-r--r--. 1 tecs tecs 4230 Jan 14 11:53 server.pem
[root@host-192-201-1-151 server]#
[root@host-192-201-1-151 server]#
[root@host-192-201-1-151 server]# cat ca.pem
-----BEGIN CERTIFICATE-----
MIIDfTCCAmWgAwIBAgIJAIKkw5JMi7bRMA0GCSqGSIb3DQEBCwUAMFUxCzAJBgNV
BAYTAlVTMQ4wDAYDVQQIDAVVbnNldDEOMAwGA1UEBwwFVW5zZXQxDjAMBgNVBAoM
BVVuc2V0MRYwFAYDVQQDDA0xOTIuMjAzLjEuMTUzMB4XDTE5MDgxMjA4MTQ0M1oX
DTI5MDgwOTA4MTQ0M1owVTELMAkGA1UEBhMCVVMxDjAMBgNVBAgMBVVuc2V0MQ4w
DAYDVQQHDAVVbnNldDEOMAwGA1UECgwFVW5zZXQxFjAUBgNVBAMMDTE5Mi4yMDMu
MS4xNTMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQCro3U90Zn/hfxS
l1owVYsY96HRSLkYmJ3WcuMJiOnbf/1prnbQthZ8mBlSKHy0YMpus1Zpo0Dm3cyr
ZbuQNpNYCosgCiqwfESpLl485+IRBh45AXl6Lv+mr47gjXJsYTDvhJOSp2K8wlQA
7th6MDqpMV84YFLTcVrtEiJ2O9iTS7QFlZ9BL3/lw8M34afWpDba6z8NTXQYh+Xh
0fIVZVkTcVoZXAr5eFT2c1VD14ATAnHIR9s0ByYe0ZaWQ8Rig4Rey8nSF2vLR+aU
D+aIgv9HvzN4vOawsjDChwn97cAfw+l8QqZA0YN7OVB6xYzD4cYbobRB+CD71vwT
q8rx+02jAgMBAAGjUDBOMAwGA1UdEwQFMAMBAf8wHQYDVR0OBBYEFAIL+gMOwJKW
4KIclNFtODBPnaL3MB8GA1UdIwQYMBaAFAIL+gMOwJKW4KIclNFtODBPnaL3MA0G
CSqGSIb3DQEBCwUAA4IBAQB2XQoLKfx86AaqurynjmmJXKxz9d9H1z22+0jE4Pv/
3DemlayIyXl52KL95H3vS/c1FaD47tCCgXcTB03rfbIGp49otWd2iqO+PnPfp2qP
jC2Ps+EM4yfodGrMN1IcSWZ0q7BvCJVw1hDr0ZDBSQMHyBSuir8LeiL7lIB38amh
iDyKwPx7lEM8JbC/B+tVkNfLRzXvSHfjMTkZAEOYmMsRcDiRJTIUuvcQucOMMwR5
UipV+Nx1zHDdpBDu67smqQWJzY+577uxyrggr5hX2idmUfsDWg6FRGLrOajE2/0h
zVKbZZiv0xSUIxqNvfOp/Xbwhr4TBlF7rCa0OueYkWAA
-----END CERTIFICATE-----
-----BEGIN CERTIFICATE-----
MIIDfzCCAmegAwIBAgIJAMxjbJveHYG8MA0GCSqGSIb3DQEBCwUAMFYxCzAJBgNV
BAYTAlVTMQ4wDAYDVQQIDAVVbnNldDEOMAwGA1UEBwwFVW5zZXQxDjAMBgNVBAoM
BVVuc2V0MRcwFQYDVQQDDA4yMDI1OjIwMzo6MjoyOTAeFw0xOTA4MjYwNzE5MzZa
Fw0yOTA4MjMwNzE5MzZaMFYxCzAJBgNVBAYTAlVTMQ4wDAYDVQQIDAVVbnNldDEO
MAwGA1UEBwwFVW5zZXQxDjAMBgNVBAoMBVVuc2V0MRcwFQYDVQQDDA4yMDI1OjIw
Mzo6MjoyOTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBALVe2EJY+YiX
cxXd6b8Oze7Utobzi0bQsuJ8k/A/BqcYCtBx6Q2NE1k7cfdjs+tm+vhj/v7NTRpg
pTT5cKo/IDESk+15258gEO655cS3bsu9wjvLjOL+TPUMfaA9TTt1JUfFREd19MUy
sJfdxK3DFi1Hen42P8ARZlvfi1sZcahNQNq6jhN/UjClIRksf1VqRe4FK0z+Q3L5
YmZVgh3/hCU3tBZaDdOkE1QR04km9HoLU/ImG1Q1JezlJzsWOiMe+Jbe+DrJFc+O
oskQGWcUbixouBCD4VUrUc7JS6V3UQlkVNypduzP2uBapAdTPXhQ2M7WnR55EuGe
4Oa2RG7JVr8CAwEAAaNQME4wDAYDVR0TBAUwAwEB/zAdBgNVHQ4EFgQU3oUZPlFS
m/z43PxIdGBLrdUH97YwHwYDVR0jBBgwFoAU3oUZPlFSm/z43PxIdGBLrdUH97Yw
DQYJKoZIhvcNAQELBQADggEBAJ2G3scvdiIPknSN/EiwjKtWjcvFPK0iO9Z4S0GD
qYWLbzZ7Wg72WbRxmVrE54tJ9lC2FudZWzewEh4RFl0IXqApit91ry9fPAtAd91q
EVQwNf23D+T8UoW7tMNh+KbfOV3LXqoqWmEal5/4URioE1sO1GhXykAFbuUnn0Po
ugXroKlj8zn9tBRLkJI48hWWtC2Z1DaTUt6+98nINFcgGv6It0IpTJFPUoxgDVNS
d0QFbBSpZ4JJ09sHzm2wseCGD05G4YsqcNtPuMYPalz1C7JFI9cXzIX02xDUAqoc
9TlU6Rusi3mZUlNiD4VnzGtaR9DOwifvzLmrs2ez3DjOjgU=
-----END CERTIFICATE-----[root@host-192-201-1-151 server] 
查看两个云环境是否对接成功
在TECS Director系统首页，选择基础设施→数据中心
，打开数据中心页面。
在数据中心页面，移动鼠标到数据中心区域，单击云环境。
在云环境页面，单击云环境页签，查看两个云环境状态都是Normal，说明对接成功。
在TECS Director系统首页，选择系统管理→系统设置→证书管理
，查看加载了两个云环境两个根证书。
相关任务 : 
对接云环境状态Abnormal的排查： 
确认网络是否互通，进vrm容器里面ping对接云环境的TECS OpenStack认证url的地址可以ping通，不通则排查网络规划和设置。 
在TECS Director的vrm容器里和云环境控制节点上分别用curl命令获取token，查看是否通。证书路径改为实际环境上所在的路径，云环境上一般为/etc/https/ssl_external/client下。
`curl -X POST  -g --cacert '/etc/https/ssl_external/client/ca.pem' 
--cert '/etc/https/ssl_external/client/client.pem' 
--key '/etc/https/ssl_external/client/clientkey.pem' 
-H 'Accept: application/json' 
-H 'Content-Type: application/json' 
-d '{"auth":{"scope":{"project":{"domain":{"name":"Default"},"name":"admin"}},
"identity":{"password":{"user":{"domain":{"name":"Default"},"password":"Keystone123",
"name":"admin"}},"methods":["password"]}}}' 
-k -i 'https://192.203.1.153:5000/v3/auth/tokens'` 
TECS Director下vrm容器里证书路径为：
Ca证书：/usr/share/ssl/director-ca 
服务端证书和key：/usr/share/ssl/director-south-server 
Vrm容器内token命令如下： 
`curl -X POST  -g --cacert '/usr/share/ssl/director-ca/ca-south' 
--cert '/usr/share/ssl/director-south-server/director-south-server-certificate' 
--key '/usr/share/ssl/director-south-server/director-south-server-certificate.key' 
-H 'Accept: application/json' -H 'Content-Type: application/json' 
-d '{"auth":{"scope":{"project":{"domain":{"name":"Default"},"name":"admin"}},
"identity":{"password":{"user":{"domain":{"name":"Default"},"password":"Director123",
"name":"directoruser"}},"methods":["password"]}}}' 
-k -i 'https://[2025:3403::2]:443/v3/auth/tokens'` 
token获取成功后，还有一个逻辑会取nova对应的os-services接口，判断nova是否正常，如果正常，则认为云环境normal，curl命令如下。 
`curl -X GET -g --cacert '/usr/share/ssl/director-ca/ca-south' 
--cert '/usr/share/ssl/director-south-server/director-south-server-certificate' 
--key '/usr/share/ssl/director-south-server/director-south-server-certificate.key' 
-H 'Accept: application/json' -H 'Content-Type: application/json'
-H 'X-Auth-Token:gAAAAABeTkcQ5AVPtpH1Qes8c0Vg5DI0ydRwWqC8ay8Xw-NXEvs7tUgKlC79W0
KeAscdi0fP63uH1pZkbP-dMZEU2GtKmYTmkU1Bz68Aa6k-Bgv15x9M6Os_ZlqYgZ1IzaKVElHvKQstY
DRWnAD_JMsnBvVHT0rWtrLHmI7TKt3TWFjRxtORxAs' -k -i 'https://[2025:3403::2]:8774/
v2.1/a30d1adf8a5a4aaebd34fa3c0f69788b/os-services'` 
