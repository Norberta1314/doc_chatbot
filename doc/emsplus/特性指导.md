# 特性指导 
## Logging和IPDR功能 
特性描述 :术语 :术语|含义
---|---
EMSPlus|电信云及核心网增值网管。
MDS|消息分发服务，网元将消息发送到MDS，MDS对网元的消息进行分发到各个MU上。
MU|数据采集单元，与具体网元对接，实现事实数据的接收与处理（清洗、聚集）。
DPU|负责数据的存储和查询，采用GBase数据库。
MAN|为整个EMSPlus提供配置数据管理和进行数据推送。
FTU|文件转换单元，将文件接口的日志转换为消息接口的消息发送给MDS。
ASC|消息合并单元，将SMF消息与UPF消息关联合并。
描述 :
描述 :
定义 :IPDR通过xGW网元获取用户的上网记录信息，主要包含用户面的信息，同时通过NAT设备获取NAT信息，IPDR实时将两种信息进行关联存储，提供用户上网日志溯源。
Logging在满足IPDR功能外，还存储FireWall会话日志、安全日志及系统日志，CGNAT路由器的会话日志等，提供给用户查询，并提供一些基本的报表及指标统计。
背景知识 :随着全球用户的流量激增，网络安全问题越发严重，黑客攻击，用户浏览非法网站，非法份子大量发布非法信息，国家及运营商都急需一套设备记录这些访问日志。例如，根据用户的登录记录，如用户的公网IP来溯源用户信息；通过非法网站IP地址，查询哪些用户访问了这些网站；或者直接通过非法用户的手机号，查询该用户曾经访问过哪些网站，这些统称为上网日志溯源（IPDR）的需求。
除了上述的上网日志溯源需求外，运营商还需要一些设备存储特定的设备日志，用于回溯（Logging），例如存储FireWall会话日志、安全日志及系统日志，CGNAT的会话日志等，方便后续回溯这些日志定位问题。
应用场景 :IPDR功能提供用户上网记录溯源查询，Logging功能提供设备日志留存和查询。
客户收益 :

收益者|收益描述
---|---
运营商|可快速找出终端用户的上网记录、攻击溯源等。可以通过多种查询条件溯源，满足运营商日益增长的网络环境安全需求。
终端用户|此特性对终端用户不可见。


实现原理 :
实现原理 :
系统架构 :图1  EMSPlus系统架构

无线侧终端用户通过eNodeB和xGW网元接入互联网，在接入互联网之前还需要经过CGNAT和FireWall两套设备。xGW、CGNAT、FireWall设备向EMSPlus（IPDR/Logging）网元上报日志。
涉及的网元 :CN（CS/PS）：核心网CS/PS网元，向EMSPlus实时输出CHR话单。
CGNAT：路由器，向EMSPlus实时输出会话和NAT日志。
Firewall：防火墙，向EMSPlus实时输出会话、安全、系统、NAT日志等。
本网元实现 :SMF/UPF合并日志、CGNAT日志、FireWall日志、xGW话单的融合及保存。
业务流程 :图2  EMSPlus模块实现图

IPDR和Logging两种类型的表都是从外部网元获取日志消息，当网元提供文件日志时，需要FTU节点预先转换为消息日志，再发给MDS。经过MDS向MU分发，当消息类型为SMF/UPF合并日志时，需要先发给ASC节点进行日志关联，再发往MU。当数据在MU完成相关处理后，保存进DPU（GBase数据库中）。
EMSPlus的IPDR/Logging功能，由FTU、MDS、ASC、 MU、DPU五个模块组成，日志消息依次经过如下模块：
FTU（可选）：将网元的文件消息转换为日志消息，并转发给MDS。 
MDS：接收日志消息，并转发给MU。 
ASC（可选）：将SMF/UPF合并场景的两种消息合并，并转发MU。 
MU：对日志消息进行处理，按照GBase数据库约定格式进行存储。 
DPU：GBase数据库，保存IPDR/Logging功能对应的日志消息。 
IPDR日志在业务流程上对应如下： 
xGW的用户流量（CHR）日志和CGNAT的日志融合生成的fact_ipdr_log表。 
Logging日志在业务流程上对应如下： 
CGNAT的创建日志生成的fact_vcgnat_session_create_log表。 
CGNAT的删除日志生成的fact_vcgnat_session_delete_log表。 
FireWall的创建会话日志生成的fact_vfirewall_session_create_log表。 
FireWall的删除会话日志生成的fact_vfirewall_session_delete_log表。 
FireWall的创建安全日志生成的fact_vfirewall_security_create_log表。 
FireWall的系统日志生成的fact_vfirewall_syslog表。 
系统影响 :

该特性不涉及对系统的影响。 


应用限制 :该特性不涉及应用限制。 
特性交互 :

该特性不涉及与其他特性的交互。 


遵循标准 :

本特性采用中兴通讯内部的接口和协议，不涉及标准协议。 


特性能力 :该特性不涉及规格指标。 
可获得性 :
可获得性 :


版本要求及变更记录 :



特性版本|发布版本|发布说明
---|---|---
01|V5.17.10|首次发布。




License要求 :需要打开如下License配置项开关： 
IPDR LOG 
cgnat session create logging 
cgnat session Delete logging 
Firewall session Delete logging 
Firewall security Delete logging 
Firewall syslog logging 
对其他网元的要求 :该特性不涉及对其他网元的要求。 
O&M相关 :
O&M相关 :
命令 :本特性不涉及命令的变化。 
性能统计 :该特性不涉及计数器的变化。 
告警和通知 :该特性不涉及告警通知的变化。 
业务观察/失败观察 :该特性不涉及业务观察/失败观察的变化。 


话单与计费 :



该特性不涉及话单与计费的变化。 




特性配置 :配置说明 :IPDR/Logging功能是EMSPlus的基本功能，基本配置即可使用。
配置前提 :使用IPDR/Logging功能，需要把EMSPlus网元和CN网元、CGNAT网元、FireWall网元分别对接，EMSPlus能够收到网元上报的话单，并将话单进行处理后存储到数据库中，才可使用报表功能进行数据的查询，否则查询不到数据，因此需要配置MDS进行消息的分发，配置MU进行消息的处理和推送入库。
编号|前提说明|操作方法
---|---|---
1|确认规划|和用户一起讨论现场网络部署规划，确认EMSPlus和对端网元使用的网元号、网元对接的IP地址、端口号和使用的业务类型号。
2|查询MAN的地址|使用如下命令，确认MAN的地址。SHOW COMMCFG;
3|查询MU的地址|通过以下命令查询MU的地址信息。SHOW COMMCFG;
配置过程 :
配置过程 :
##### 配置MDS 
MDS主要配置：
在EMSPlus客户端，单击System，选择Terminal进入终端配置。
单击Add MDS External NE Configuration或使用命令[ADD MDS EXTERNALNE]，添加和MDS对接的外部网元，这里主要是配置对端网元的IP地址、端口号和网元类型。
单击Add MDS External NE Data Dispatch Configuration或使用命令[ADD MDSEXTNEDATADSP]，配置外部网元类型、组号和对应的MU，主要是配置对于收到配置的外部网元和对应的局号的消息发到MU上进行消息的处理。
单击Add MDS Dispatch IP Address Configuration或是使用命令[ADD MDSDSPIP]，配置MDS将消息转发到MU的IP地址和组号。
单击SYNC MDS DATA或是使用命令[SYNC MDS]，进行MDS配置数据的同步。
##### 配置MU参数 
MU主要配置：
在EMSPlus客户端，单击Add DCU_MU Special Parameter Configuration或使用命令[ADD DCUMUCFG]，配置MU专有的参数。
当不同逻辑子网的CGNAT和CHR的私网IPV4地址存在冲突时，可选参数Private IP Conflict Mode配置为ON，其余情况下均不需要配置，默认为OFF。
若其中的必选参数已在EMSPlus实例化时配置，可单击Set DCU_MU Special ParameterConfiguration或使用命令[SET DCUMUCFG]配置可选参数。
（可选）根据业务需求，单击Add APN Address Configuration或使用命令[ADD APNADDRCFG]，配置APN和VRFID匹配，两者的对应关系由业务侧提供。
单击Add MU Save Configuration或使用命令[ADD MUSAVECFG]，配置MU数据存储参数。
（可选）根据业务需求，单击Set Packet Filter Configuration或使用命令[SET PKTFILTERCFG]，配置包过滤。
（可选）根据业务需求，单击Add IPDR IP Filter或使用命令[ADD IPDRIPFILTER]，配置IPDR IP过滤器。
单击SYNC MU DATA或使用命令[SYNC MU]，同步MU配置数据。
配置实例 :场景说明 :假设EMSPlus本网元号为3，MU的组号为1。
xGW网元对接的IP地址10.1.1.59，端口号为11001，使用的业务类型号为3011。
CGNAT网元对接的IP地址10.2.1.59，端口号为11002。
FireWall网元对接的IP地址10.3.1.59，端口号为11003。
数据规划 :根据假设的场景，EMSPlus内部IP规划参见[表1]。
名称|地址|模块号
---|---|---
MDS|接收媒体面Eth2: 10.1.1.59接收媒体面Eth3: 10.2.1.59接收媒体面Eth4: 10.3.1.59转发媒体面Eth1: 182.168.1.7控制面Eth0: 172.168.1.7|4
MAN|控制面：172.168.1.4|1
MU|接收媒体面：182.168.1.6控制面：172.168.1.6|3
配置步骤 :手工部署时，根据规划进行配置，参见[表2]。实例化部署时，所有的配置都可以在Inputs参数中配置。
步骤|说明|操作
---|---|---
1|进入MDS客户端配置模式|创建MDS的外部网元：ADD MDSEXTERNALNE:IP=10.1.1.59, PORT=11001, NETYPE=XGWADD MDSEXTERNALNE:IP=10.2.1.59, PORT=11002,NETYPE=CGNATADD MDSEXTERNALNE:IP=10.3.1.59, PORT=11003, NETYPE=FIREWALL_LOG配置MDS外部网元数据分发：ADD MDSEXTNEDATADSP:NETYPE=XGW, GROUPID=1, DESTINATION=SEND_TO_MUADD MDSEXTNEDATADSP:NETYPE=FIREWALL_LOG,GROUPID=1, DESTINATION=SEND_TO_MUADD MDSEXTNEDATADSP:NETYPE=CGNAT,GROUPID=1,DESTINATION=SEND_TO_MU配置MDS分发IP地址：ADD MDSDSPIP:GROUPID=1, MODULETYPE=DCU_MU, IPADDR=182.168.1.6同步MDS配置信息：SYNC MDS
2|进入MU客户端配置模式|配置APN和VRFID匹配表（两者的对应关系由业务提供）：ADD APNADDRCFG:APN=CMNET, VRFID=2同步MU配置信息：SYNC MU同步MDS配置信息，也可等到MDS配置完毕后一起执行：SYNC MDS
特性操作 :#### Logging日志查询分析 
当MS通过UMTS接入外部PDN网络（如Internet）时，必须采用一个公网IP地址来传送数据包。MS获取到一个私网IP地址，通过NAT服务将私网IP被映射为公网IP地址，并接入Internet。
通过查询CGNAT、防火墙等相关日志信息，提供数据业务运营分析，为移动数据业务精细化运营提供了全面支撑。 
##### Logging窗口介绍 
在EMSPlus客户端上方单击Logging主菜单，打开Logging窗口，如[图1]所示。
图1  Logging窗口

窗口左侧是功能操作区，包括Query和Task，Query分成Recent、Favorite、All。
Recent：显示最近的查询操作。 
Favorite：将常用的查询操作添加至收藏夹，并管理收藏夹。 
All：提供共享模板以及预定义模板查询。通过打开导航树上的查询模板，设置查询条件，执行数据查询操作。查询结果最终以图形、数据表格的形式呈现。 
Task：定时执行查询任务，并输出查询结果文件，支持任务的新增、修改和删除。 
窗口右上侧是查询参数设置区。 
窗口右下侧是查询结果区，提供查询结果图和表，并支持对查询结果进行相应操作，参见[表1]。
任务名称|操作
---|---
|导出查询结果|将查询结果以CSV或EXCEL方式导出，并下载到本地。Non-Full Scale（非全量导出）：仅导出当前查询结果。Full Scale（全量导出）：导出全部可供查询的数据，最多导出50万条数据。
|密文导出查询结果|该按钮在通过license控制开启GDPR后才显示。将查询结果以CSV或EXCEL方式导出，并下载到本地。导出的数据中个人隐私数据会加密，如IMSI等。Non-Full Scale（非全量导出）：仅导出当前查询结果。Full Scale（全量导出）：导出全部可供查询的数据，最多导出50万条数据。
|定制列|根据需要定制查询结果列。
|自定义查询结果图|根据需要以自定义柱形图（bar）、饼图（pie）或折线图（line）的方式查看查询结果。
|设置查询结果排序方式|查询出的数据按Field Name字段升序或降序排序显示。
##### 按预定义模板查询数据 
##### 按预定义模板查询数据 
统计查询的预定义模板包括以下几种。 
Log QueryGeneral Query 
CGNATCreate Session Log (CGNAT)Delete Session Log (CGNAT)Statistics Data 
FIREWALLCreate Session Log (Firewall)Delete Session Log (Firewall)Security LogSystem LogSession Statistics DataSecurity Statistics Data 
本文以Statistics Data和Delete Session
Log为例，介绍数据统计和日志查询操作，其他操作类似。
###### General Query 
摘要 :介绍如何使用预定义模板查询5GC的控制面日志。 
步骤 :在左侧菜单选择All→Predefined Query→Logging→Log Query→General Query
，打开General Query查询页面，如[图1]所示。
 说明： 
系统最多可以同时打开3个General Query报表，并在页签右上角以数字显示。 
图1  General Query

参数名称|参数说明
---|---
Time|设置日志查询的时间段
Records|查询结果显示的记录数。取值范围为1~4000。
IMSI_SUPI|按照指定的IMSI_SUPI号码或MSISDN_GPSI号码进行查询。“=” : 精准匹配“!=” : 反选
MSISDN_GPSI|按照指定的IMSI_SUPI号码或MSISDN_GPSI号码进行查询。“=” : 精准匹配“!=” : 反选
NFTypeNFID|按照指定的NF类型（NF Type）或NFID进行查询。in表示查询选择所选条件的数据。not in表示查询除这些条件之外的数据。
Cause|按照指定的原因码进行查询。
配置General Query的参数。 
（可选）单击按钮，选择查询结果展示表格的表头字段，单击Confirm按钮，如[图2]所示。
如果配置则至少选择一个，如果都不选择则查询所有字段的流量。 
图2  选择维度和KPI字段

单击按钮，查询结果显示在页面下方，如[图3]所示。
图3  General Query结果

查询结果区的左侧显示查询的所有的日志信息。 
查询结果的的右侧显示单条日志的详细内容。 
###### 统计日志数据 
摘要 :统计日志数据，包括上行流量和下行流量，以及上行包和下行包。 
步骤 :在EMSPlus客户端的Logging窗口，单击功能操作区的Query。
选择左侧菜单All→Predefined
Query→Logging→CGNAT→Statistics Data
，打开日志数据统计页面，如[图4]所示。
图4  统计日志数据

参数名称|参数说明
---|---
Time Granularity|当Time Granularity设置为15Min或Hour，则查询Time可选择1~24小时内。当Time Granularity设置为Day，则查询Time可选择1~3天内。当Time Granularity设置为Month，则查询Time可选择1~2个月内。
Time|当Time Granularity设置为15Min或Hour，则查询Time可选择1~24小时内。当Time Granularity设置为Day，则查询Time可选择1~3天内。当Time Granularity设置为Month，则查询Time可选择1~2个月内。
Records|统计结果显示的记录数。取值范围为1~4000，默认值为20。
配置日志数据统计的参数。 
单击按钮，统计结果显示在页面下方，如[图5]所示。
图5  查询结果

###### 查询删除会话的日志 
摘要 :维护人员可以查询选定时间范围的IP地址的删除会话日志信息。
步骤 :在EMSPlus客户端的Logging窗口，单击功能操作区的Query。
选择左侧菜单All→Predefined
Query→Logging→CGNAT→Delete Session Log(CGNAT)
，打开日志查询页面，如[图6]所示。
图6  查询删除会话日志

参数名称|参数说明
---|---
Time|查询3天时间范围内的日志数据。
Records|查询结果显示的记录数。
Public Source IP|分配给MS的公网IP地址和端口号。
Public Source Port|分配给MS的公网IP地址和端口号。
Private Source IP|分配给MS的私网IP地址和端口号。
Private Port|分配给MS的私网IP地址和端口号。
Dest IP|MS被访问的目的IP地址和端口号。
Dest Port|MS被访问的目的IP地址和端口号。
Dest Nat IP|MS经过NAT映射后的目的IP地址和端口号。
Dest Nat Port|MS经过NAT映射后的目的IP地址和端口号。
Protocol|MS使用的协议类型。
配置日志查询的参数。 
单击按钮，查询结果显示在页面下方。
#### IPDR日志查询分析 
用户通过终端上网，数据经过核心网网元后，过NAT转换最后到达Internet。查询用户上网日志信息，追溯用户的上网行为。
##### IPDR窗口介绍 
在EMSPlus客户端上方单击IPDR主菜单，打开IPDR窗口，如[图1]所示。
图1  IPDR窗口

窗口左侧是功能操作区，包括Query和Task，Query分成Recent、Favorite、All。Recent：显示最近的查询操作。Favorite：将常用的查询操作添加至收藏夹，并管理收藏夹。All：提供共享模板以及预定义模板查询。通过打开导航树上的查询模板，设置查询条件，执行数据查询操作。查询结果最终以图形、数据表格的形式呈现。Task：定时执行查询任务，并输出查询结果文件，支持任务的新增、修改和删除。 
窗口右上侧是查询参数设置区。 
窗口右下侧是查询结果区，提供查询结果图和表。 
##### 查询用户上网日志 
摘要 :通过IPDR功能，维护人员可以查询选定时间范围的IP地址的使用情况，如使用该IP的用户号码和IMSI号码。
步骤 :在EMSPlus客户端的IPDR窗口，单击功能操作区的Query。
选择左侧菜单All→Predefined Query→IPDR
→IPDR
，打开上网日志查询页面，如[图1]所示。
图1  IPDR页签

单击More Conditions，展开更多条件设置区域，如[图2]所示。
图2  IPDR窗口

参数名称|参数说明
---|---
|选择查询的时间段。
Records|查询结果显示的记录数。
MSISDN|根据用户的MSISDN或IMSI号码，查询该用户的上网日志信息。
IMSI|根据用户的MSISDN或IMSI号码，查询该用户的上网日志信息。
Public Source IP|根据公网IP地址和端口号，查询指定时间段内使用该IP地址和端口号的用户信息。
Public Source Port|根据公网IP地址和端口号，查询指定时间段内使用该IP地址和端口号的用户信息。
Private Source IP|根据私网IP地址和端口号，查询指定时间段内使用该IP地址和端口号的用户信息。
Private Source Port|根据私网IP地址和端口号，查询指定时间段内使用该IP地址和端口号的用户信息。
Dest IP|根据目的IP地址和端口号，查询指定时间段内访问该IP地址和端口号的用户信息。
Dest Port|根据目的IP地址和端口号，查询指定时间段内访问该IP地址和端口号的用户信息。
Dest Nat IP|根据经过NAT转换后的目的端口号，查询指定时间段内访问该IP地址和端口号的用户信息。
Dest Nat Port|根据经过NAT转换后的目的端口号，查询指定时间段内访问该IP地址和端口号的用户信息。
配置上网日志查询的参数。 
单击按钮，查询结果显示在页面下方，如[图3]所示。
图3  查询结果

输出字段名|输出字段说明
---|---
Start Time|用户上网业务的上线时间
End Time|用户上网业务的下线时间
Active Time|用户上网业务的在线时间
Private IP|用户上网时被分配的私网IP地址
Public IP|用户上网时使用的公网IP地址
Dest IP|用户访问的目的IP地址
IMSI|用户的IMSI号码
MSISDN|用户手机号码。为了保护用户隐私，在查询结果和导出的文件中，用户手机号码的部分位数以“*”代替。
Private Port|用户上网时使用的私网端口号
Public Port|用户上网时使用的公网端口号
Dest Port|用户访问的目的端口号
Protocol|用户上网时使用的协议类型
#### 创建定时任务 
摘要 :EMSPlus系统按照任务中指定的条件周期性地查询日志数据，并生成查询结果报表。生成的查询结果报表也能被自动发送到指定的FTP/SFTP服务器。
步骤 :在EMSPlus客户端的Logging或者IPDR窗口，单击功能操作区的Task，功能操作区显示已有的定时任务，如[图1]所示。
图1  定时任务列表

单击功能操作区的+Add Task按钮，在弹出的对话框中设置任务的名称，如[图2]所示。
图2  任务基本属性

参数名称|参数说明
---|---
Task Name|定时任务的名称，任务名称最长为40个字符。
切换到Schedule Frequency页面，设置任务时间表，如[图3]所示。设置任务开始时间、结束任务、任务类型、执行频率参数。
图3  任务自定义时间

参数名称|参数说明
---|---
开始时间设置|Immediately|配置完成后立即执行该任务。
Start Timestamp|开始时间设置|在设定的Time执行该任务。选择此项需在其后的输入框中设置开始时间。
结束时间设置|Indefinitely|无限期执行任务。
End Timestamp|结束时间设置|在设定的Time停止该任务。选择此项需在其后的输入框中设置结束时间。
任务类型设置|Simple Repeatedly|需要设定该任务的Execute Frequency。
Custom Repeatedly|任务类型设置|按天或周、月中的某几天来重复执行该任务，需要设置任务执行Trigger Timestamp以及执行的日期。
执行频率设置|如果任务类型选择Simple Repeatedly，需要设置Execute Frequency。如果任务类型选择Custom Repeatedly，则打开以下配置参数。Trigger Timestamp：任务触发的时间，格式为HH：MM。Date Type：选择任务执行的周期是Per Day、Per Week或者Per Month。Date Selection：选择每周或每月执行任务的日期。Effective Month：选择执行任务的月份。|如果任务类型选择Simple Repeatedly，需要设置Execute Frequency。如果任务类型选择Custom Repeatedly，则打开以下配置参数。Trigger Timestamp：任务触发的时间，格式为HH：MM。Date Type：选择任务执行的周期是Per Day、Per Week或者Per Month。Date Selection：选择每周或每月执行任务的日期。Effective Month：选择执行任务的月份。
切换到Output Setting页面，设置任务执行结果导出为文件时的相关属性，如[图4]所示。
图4  任务输出设置

参数名称|参数说明
---|---
File Type|查询结果输出文件的文件类型。
File Prefix|查询结果输出文件的的命名规则。
File Transfer Mode|是否将输出文件自动上传至指定的FTP/SFTP服务器。选中File Transfer Mode，需要配置FTP/SFTP服务器参数，如服务器IP地址、端口号、保存路径、用户名和密码。
单击Confirm按钮。
单击General View，查看所有的任务。可以停止或者删除任务，查看任务主要信息，如[图5]所示。
图5  所有任务

单击Task Operation列的按钮，查看任务详细信息，如[图6]所示。
单击最右边的按钮可以导出数据。
图6  任务详细信息

测试用例 :#### IPDR测试用例 
测试项|IPDR基本功能测试
---|---
预置条件|EMSPlus已经与网元对接成功。网元已经将业务数据上报给EMSPlus系统，并且正确入数据库。|EMSPlus已经与网元对接成功。网元已经将业务数据上报给EMSPlus系统，并且正确入数据库。|EMSPlus已经与网元对接成功。网元已经将业务数据上报给EMSPlus系统，并且正确入数据库。
操作过程|登录EMSPlus的web客户端。单击IPDR按钮。单击ALL，在下拉选项中选择IPDR，选择日期。单击按钮，IPDR界面显示在数据库中查询到对应的IPDR表，如图1所示。|登录EMSPlus的web客户端。单击IPDR按钮。单击ALL，在下拉选项中选择IPDR，选择日期。单击按钮，IPDR界面显示在数据库中查询到对应的IPDR表，如图1所示。|登录EMSPlus的web客户端。单击IPDR按钮。单击ALL，在下拉选项中选择IPDR，选择日期。单击按钮，IPDR界面显示在数据库中查询到对应的IPDR表，如图1所示。
预期结果|查询的结果和网元上报的业务数据相同。|查询的结果和网元上报的业务数据相同。|查询的结果和网元上报的业务数据相同。
实际结果|同预期结果。|同预期结果。|同预期结果。
注意事项|fact_ipdr_log生成|fact_ipdr_log生成|fact_ipdr_log生成
签名||测试日期|
图1  IPDR查询结果

#### Logging测试用例 
测试项|Logging基本功能测试
---|---
预置条件|EMSPlus已经与网元对接成功。网元已经将业务数据上报给EMSPlus系统，并且正确入数据库。|EMSPlus已经与网元对接成功。网元已经将业务数据上报给EMSPlus系统，并且正确入数据库。|EMSPlus已经与网元对接成功。网元已经将业务数据上报给EMSPlus系统，并且正确入数据库。
操作过程|登录EMSPlus的web客户端。单击Logging按钮。单击ALL，在下拉选项中选择一个报表模型，例如CreateSession Log，选择日期。单击按钮，Logging界面显示在数据库中查询到对应的Logging表，如图1所示。|登录EMSPlus的web客户端。单击Logging按钮。单击ALL，在下拉选项中选择一个报表模型，例如CreateSession Log，选择日期。单击按钮，Logging界面显示在数据库中查询到对应的Logging表，如图1所示。|登录EMSPlus的web客户端。单击Logging按钮。单击ALL，在下拉选项中选择一个报表模型，例如CreateSession Log，选择日期。单击按钮，Logging界面显示在数据库中查询到对应的Logging表，如图1所示。
预期结果|查询的结果和网元上报的业务数据相同。|查询的结果和网元上报的业务数据相同。|查询的结果和网元上报的业务数据相同。
实际结果|同预期结果。|同预期结果。|同预期结果。
注意事项|fact_vcgnat_session_create_log生成fact_vcgnat_session_delete_log生成fact_vfirewall_session_delete_log生成fact_vfirewall_security_delete_log生成fact_vfirewall_syslog生成操作界面类似|fact_vcgnat_session_create_log生成fact_vcgnat_session_delete_log生成fact_vfirewall_session_delete_log生成fact_vfirewall_security_delete_log生成fact_vfirewall_syslog生成操作界面类似|fact_vcgnat_session_create_log生成fact_vcgnat_session_delete_log生成fact_vfirewall_session_delete_log生成fact_vfirewall_security_delete_log生成fact_vfirewall_syslog生成操作界面类似
签名||测试日期|
图1  Logging查询结果

## 缩略语 
## 缩略语 
### CGNAT 
Carrier Grade Network Address Translation运营商级网络地址转换
CHR :Call History Record呼叫历史记录
### CN 
Core Network核心网
### CS 
Circuit Switched电路交换
DPU :Data Processing Unit数据处理单元
eNodeB :Evolved NodeB演进的NodeB
FTP :File Transfer Protocol文件传输协议
IMSI :International Mobile Subscriber Identity国际移动用户标识
IP :Internet Protocol因特网协议
### IPDR 
Internet Protocol Detail Record互联网协议详细记录
### KPI 
Key Performance Index关键性能指标
MAN :Manager Node管理节点
MDS :Message Dispatch Service消息分发服务
### MS 
Mobile Station移动台
MSISDN :Mobile Station International Subscriber Directory Number移动台国际用户目录号
MU :Merging Unit合并单元
### NAT 
Network Address Translation网络地址转换
PDN :Packet Data Network分组数据网
### PS 
Packet Switched分组交换
SFTP :Secure File Transfer Protocol安全文件传输协议
### UMTS 
Universal Mobile Telecommunication System通用移动通讯系统
### xGW 
Extendable Gateway综合接入网关
## License功能 
特性描述 :术语 :术语|含义
---|---
EMSPlus|数据业务报表系统，为运营商提供运维支撑和决策支持。
WEB客户端|EMSPlus网元的本地管理终端。
描述 :
描述 :


定义 :



License是经过授权的许可证，在本产品中用来限制系统所支持的一些特性。通过License中的License开关项，系统可以对提供给用户报表功能和报表任务功能进行控制，尽可能的减少功能对系统资源的消耗。 


EMSPlus网元支持通过Web方式进行License管理操作。 


用户可通过Web管理EMSPlus的License文件，包括加载（[LOAD]）、查看（[SHOW]）等操作。




背景知识 :License包括基本信息和License控制项两部分。 
基本信息包括用户信息、序列号、有效期。 
本产品支持的License控制项参见表1。表1  License控制项名称描述管理模块Reporting、IPDR、Logging报表。控制是否支持Reporting、IPDR、Logging功能，按钮页面是否显示。DPI_Reporting基本报表控制是否支持各类流量统计功能，生成各类流量报表。IPDR基本报表控制是否支持IPDR功能，生成事实表文件。对应数据：fact_ipdr_log。Logging基本报表控制是否支持Logging功能，生成对应相关事实表cgnat（session_create、session_delete）和firewall（session_create、session_delete、security_create、syslog）文件和聚集表文件。DPI_Reporting可选报表默认总体不提供给用户使用的功能。 
应用场景 :

本特性用于控制本产品所具有的产品特性和产品性能，一般在开局或者扩容时加载License。 


客户收益 :

收益者|收益描述
---|---
运营商|通过申请License获得更高级系统功能和更高的处理性能支持。
终端用户|此特性对终端用户不可见。


实现原理 :
实现原理 :
系统架构 :图1  License管理系统架构图

对于客户端：报表客户端、MML客户端都需要获取License，这些客户端组件获得License的通道都是通过MML接口，MML命令通过Clis转发到LicService组件，该组件为系统内所有模块提供License信息。 
对于服务端：RAS组件需要获得License信息，这些组件都是通过发消息给LicService来获取License。由于COMM级联通讯的限制，需要通过UMMP上的RAS来中转。另外Datamanager不直接获取License信息，而是通过读取Database中的历史数据保存的策略数据表来删除数据。 


涉及的网元 :



该特性由本网元单独实现，无需其他网元的配合。 




本网元实现 :EMSPlus仅需要提供*.LCS文件。全新安装版本会提供默认License文件。
License在EMSPlus的部署目录为/ubas/ZXUN-EMSPLUS/server/fileupload。
业务流程 :无 
系统影响 :

该特性不涉及对系统的影响。 


应用限制 :

License在实际应用中可以管理Reporting、IPDR、Logging报表，如果DCU上License未同步成功，则无法聚集数据。


License加载成功后，每次需要最长10分钟报表才能刷新报表并显示报表页面。 


特性交互 :

该特性不涉及与其他特性的交互。 


遵循标准 :

本特性采用中兴通讯内部的接口和协议，不涉及标准协议。 


特性能力 :

根据“[背景知识]”
对系统的功能和性能进行约束、控制。


可获得性 :
可获得性 :


版本要求及变更记录 :



特性版本|发布版本|发布说明
---|---|---
01|V5.17.10|首次发布。






License要求 :



该特性为EMSPlus网元的基本特性，无需License支持。






对其他网元的要求 :



该特性不涉及对其他网元的要求。 






工程规划要求 :



集中License管理特性和License控制项的性能统计特性需要安装EMSPlus V5.17.10.B10及以上版本。




O&M相关 :
O&M相关 :
命令 :编号|命令名称|描述
---|---|---
1|LOAD LICENSE|加载License
编号|命令名称|描述
---|---|---
1|SHOW LICENSE|查询License
编号|命令名称|描述
---|---|---
1|SYNC LICENSE|同步License
告警和通知 :编号|告警名称
---|---
1|2365981441 License文件非法
2|2365981442 系统中加载的License即将到期
3|2365981443 License文件不存在
4|2365981444 存在多个License文件
5|2365981445 系统中加载的License已经过期
6|2415919136 同步License失败
特性配置 :#### 加载License文件 
配置说明 :

License文件是一个后缀为.lic或者.LCS的文件，通过工具或管理软件加载到系统中。


配置前提 :

已根据开局商务合同信息申请了License文件，License申请模板参见EMSPlus版本文件中的ZXUN EMSPLUS+V*.*.*_License_template_English.xlsx文件（V*.*.*为版本号）。


配置过程 :在EMSPlus客户端加载License文件。
在命令终端执行[SHOW LICENSE]命令，查询License文件加载结果。
License加载成功后，新的License控制项对客户端配置功能的影响立即生效。 
配置实例 :场景说明 :根据运营商功能需求，加载License文件。 
配置步骤 :登录EMSPlus客户端，选择...→系统信息
，弹出系统信息窗口，如[图1]所示。
图1  系统信息页面

在产品信息区域，单击导入License，弹出导入License文件对话框，如[图2]所示。
图2  导入License文件对话框

单击选择文件，选择根据现场需要做好的*.lic或者*.LCS文件，单击确定。
选择菜单系统→命令终端
，进入命令终端页面，如[图3]所示。
图3  命令终端页面

执行[SHOW LICENSE]命令，查询License信息，如[图4]所示。
图4  查询License信息

 说明： 
EMSPlus的License部署目录：/ubas/ZXUN-EMSPLUS/server/fileupload。
测试用例 :测试项|加载License功能验证
---|---
预置条件|已制作了License文件。|已制作了License文件。|已制作了License文件。
操作过程|在EMSPlus客户端加载License文件。在命令终端执行SHOW LICENSE命令，查看License参数。|在EMSPlus客户端加载License文件。在命令终端执行SHOW LICENSE命令，查看License参数。|在EMSPlus客户端加载License文件。在命令终端执行SHOW LICENSE命令，查看License参数。
预期结果|License参数与License文件内容一致。|License参数与License文件内容一致。|License参数与License文件内容一致。
实际结果|同预期结果。|同预期结果。|同预期结果。
注意事项|||
签名||测试日期|
- 
#### 校验License文件一致性 
配置说明 :通过校验License一致性，确定各业务节点的License文件与MAN节点的License是否一致。 
配置前提 :已加载License文件。 
配置过程 :在命令终端窗口执行[CHECK CONSISTENCY]命令。
配置实例 :场景说明 :导入License文件后，当需要确认各节点License是否一致时，执行[CHECK CONSISTENCY]命令。
配置步骤 :在EMSPlus客户端，选择菜单系统→命令终端
，进入命令终端页面，如[图1]所示。
图1  命令终端页面

执行[CHECK CONSISTENCY]命令，校验一致性类型选择License，如[图2]所示。
图2  执行检查一致性命令

当所有模块的状态均显示为一致时，表明各节点License一致。命令执行结果如[图3]所示。
图3  命令执行结果

测试用例 :测试项|CHECK CONSISTENCY:TYPE="License"功能验证。
---|---
预置条件|已加载License。|已加载License。|已加载License。
操作过程|执行CHECK CONSISTENCY命令。|执行CHECK CONSISTENCY命令。|执行CHECK CONSISTENCY命令。
预期结果|输出目的节点License与MAN节点License是否一致的信息。|输出目的节点License与MAN节点License是否一致的信息。|输出目的节点License与MAN节点License是否一致的信息。
实际结果|同预期结果。|同预期结果。|同预期结果。
注意事项|||
签名||测试日期|
#### 同步License文件 
配置说明 :同步License文件用于使目的节点与MAN节点的License文件一致，命令为SYNC LICENSE。 
配置前提 :当发现有业务节点与MAN节点的License文件不一致时，执行同步License文件命令。 
配置过程 :选择目标节点模块号，执行[SYNC LICENSE]命令。命令参数说明参见[表1]。
参数名称|参数说明
---|---
MODULE|目标节点模块号。当该参数为空时，默认选择全部的业务节点。
配置实例 :场景说明 :在MAN节点License正常的情况下，执行[CHECK CONSISTENCY]命令后，存在业务节点与MAN节点的License文件不一致，此时需要执行[SYNC LICENSE]命令。
配置步骤 :在EMSPlus客户端，选择菜单系统→命令终端
，进入命令终端页面，如[图1]所示。
图1  命令终端页面

执行[SYNC LICENSE]命令，选择需要同步License文件的模块号，如[图2]所示。命令执行结果如[图3]所示。
图2  执行SYNC LICENSE命令

图3  命令执行结果

测试用例 :测试项|SYNC LICENSE功能验证
---|---
预置条件|已加载License。|已加载License。|已加载License。
操作过程|执行SYNC LICENSE命令。|执行SYNC LICENSE命令。|执行SYNC LICENSE命令。
预期结果|目的节点的License文件与MAN节点License文件一致。|目的节点的License文件与MAN节点License文件一致。|目的节点的License文件与MAN节点License文件一致。
实际结果|同预期结果。|同预期结果。|同预期结果。
注意事项|||
签名||测试日期|
## 缩略语 
## 缩略语 
DCU :Data Collection Unit数据采集单元
### MML 
Man Machine Language人机语言
### UMMP 
Unified Master Main Processor统一主控板
## NTP功能 
特性描述 :术语 :术语|含义
---|---
NTP|网络时间协议，用来同步网络中各个计算机的时间的协议。
描述 :
描述 :
定义 :时钟同步功能可以确保EMSPlus与网络中其他网元之间，以及MAN为主节点，DCU、MDS、DPU、MU、ASC、FTU为次节点之间时间同步。


背景知识 :



系统硬件时钟的运行精度存在差异，所以对于核心网系统来说，各个网元间肯定会存在时间差，而核心网业务中时间是一个重要的属性，需要有措施保证系统里的各个网元时间同步。 


EMSPlus分布式各节点之间时间也会随着运行时间的推进产生时间差，因此也需要在内部各节点之间进行时间同步。 


目前业界普遍采用的时钟同步协议是NTP，已经可以满足EMSPlus的需要，EMSPlus则采用该协议实现与其他网元和内部节点间的时间同步。 


有关该协议的详细信息参考RFC1305。




应用场景 :

##### MAN作为NTP客户端 
在一些情况下，MAN作为NTP客户端，外部网元或数据源会为其提供时钟基准，如[图1]所示。
图1  MAN作为NTP客户端






##### MAN作为NTP服务端 
MAN作为NTP服务端，向其他如MDS、MU、DCU等模块提供时钟基准，如[图2]所示。
图2  MAN作为NTP服务端






客户收益 :

收益者|收益描述
---|---
运营商|避免时钟不统一造成的性能统计等数据结果不准确。
终端用户|此特性对终端用户不可见。


实现原理 :
实现原理 :


系统架构 :



图1  系统架构图






流程说明： 




MAN主节点向上级时钟源同步时间。 


内部DCU、MU、MDS等次节点向MAN主节点同步时间。 




通过上述方式，保障内部所有节点时间与外部时钟源保持一致。 






涉及的网元 :



MDS收到消息分别向DCU、MU转发消息，MAN作为NTP服务器，这些模块相当于客户端，实现主次节点间的时间同步。 






本网元实现 :



MAN同时作为客户端和服务端，作为客户端时向上级网元同步时间，作为服务端时向EMSPlus网元进行时间同步，确保时间准确数据正常。 






业务流程 :



NTP客户端时钟同步流程： 




NTP客户端定时向时钟源服务器端发送时钟同步消息。 


时钟源服务器接收到时钟同步请求后，携带时间信息返回响应消息。 


NTP客户端根据返回的时间信息，调整自身操作系统的时间，维护本地时钟源的信息。 






系统影响 :

该特性不涉及对系统的影响。 


应用限制 :

该特性不涉及应用限制。 


特性交互 :

该特性不涉及与其他特性的交互。 


遵循标准 :

RFC 1305—NTP（Network Time Protocol） 


特性能力 :

该特性不涉及规格指标。 


可获得性 :
可获得性 :


License要求 :



该特性为EMSPlus网元的基本特性，无需License支持。 






对其他网元的要求 :



MAN作为NTP客户端时，需要上级时钟源网元开放NTP服务。 


MAN作为NTP服务端时，需要被同步网元启用NTP客户端功能。 




O&M相关 :
O&M相关 :


命令 :



编号|命令名称|描述
---|---|---
1|SET SNTPCLNT|MAN作为NTP客户端时的相关信息配置。
2|SET SNTPSRV|MAN作为NTP服务端时的相关信息配置。
3|SET NTPSTAT|设置NTP客户端和服务器的状态。
4|SYNC NTPTIME|同步NTP时间。






性能统计 :



该特性不涉及计数器的变化。 






告警和通知 :



编号|告警名称
---|---
1|2365981953 NTP服务器链路中断
2|2365981954 NTP时间未同步
3|2365981955 NTP时间偏移超最大阈值
4|2365981956 本地NTP服务器启动失败
5|2365981957 NTP鉴权失败






业务观察/失败观察 :



该特性不涉及业务观察/失败观察的变化。 






话单与计费 :



该特性不涉及话单与计费的变化。 




特性配置 :#### MAN服务端特性配置 
配置说明 :配置MAN节点作为NTP服务器，使EMSPlus其他次节点与时钟源MAN同步。 
配置前提 :

NTP服务器的控制面IP与其他次节点的网关是通的。 


配置过程 :配置NTP服务端参数。该过程将MAN主节点配置为时钟源，用于为次节点提供NTP时间同步服务。 
使用命令[SET SNTPSRV]，配置NTP服务端参数。
序号|命令名称|命令含义|命令参数
---|---|---|---
1|SET SNTPSRV|设置NTP服务器参数。|IP1：NTP服务器1的IP。PORT1：NTP服务器1的端口号。IP2：NTP服务器2的IP。PORT2：NTP服务器2的端口号。
启动NTP客户端和服务端。 
使用命令[SET NTPSTAT]，配置NTP服务端参数。
序号|命令名称|命令含义|命令参数
---|---|---|---
1|SET NTPSTAT|设置NTP状态(包含客户端和服务器)。|SRV：设置NTP服务器的工作状态。CLNT：设置NTP客户端的工作状态。
配置实例 :场景说明 :配置MAN为NTP服务端，EMSPlus其他模块作为NTP客户端与其时间同步。 
数据规划 :假设MAN的浮动IP为172.168.1.63。
配置步骤 :通过Web登录EMSPlus，选择菜单System→MML Terminal
进入命令行页面，如[图1]所示。
图1  命令行页面

配置NTP服务器，将MAN作为EMSPlus服务器时钟源。 
[SET SNTPSRV] :IP1="172.168.1.63", PORT1=123;
[SET NTPSTAT]:SRV="RUN", CLNT="RUN";
#### MAN客户端特性配置 
配置说明 :配置MAN节点作为NTP客户端，使EMSPlus的MAN节点与上级时钟源同步。
配置前提 :配置前提如下： 
MAN节点与上级NTP服务器地址是通的。 
使用EMSPlus的NTP服务时关闭操作系统自带的NTP服务。 
用户初次配置完毕，必须使用SYNC NTPTIME命令强制同步时间。 
NTP客户端开启鉴权模式时，要求目标NTP服务端也开启鉴权模式。当NTP客户端启用了鉴权模式，但是目标NTP服务端未开启鉴权模式，此时NTP请求消息中将有鉴权信息，但是NTP服务端返回的应答消息中，不携带鉴权信息，此应答消息将无法通过本NTP客户端鉴权，从而导致时间同步失败。 
配置过程 :使用命令[SET SNTPCLNT]，配置NTP客户端参数。该过程将上级NTP服务器配置为时钟源，用于为MAN节点提供NTP时间同步服务。
使用命令[SYNC NTPTIME]，MAN节点作为客户端同步NTP服务器的时间。
配置实例 :场景说明 :配置MAN为NTP客户端，EMSPlus的MAN节点与上级NTP服务端同步。 
数据规划 :假设上级NTP服务器的IP为177.1.64.100。 
配置步骤 :通过Web登录EMSPlus，选择菜单System→MML Terminal
进入命令行页面，如[图1]所示。
图1  命令行页面

配置NTP客户端，将上级NTP服务器作为时钟源。 
[SETSNTPCLNT]:SRVIP1=177.1.64.100,SRVPORT1=123,SRVPORT2=123;
同步MAN节点与NTP服务器的时间。 
[SYNC NTPTIME];
测试用例 :

测试项|验证NTP同步是否成功
---|---
预置条件|已规划MAN的浮动IP地址和端口。|已规划MAN的浮动IP地址和端口。|已规划MAN的浮动IP地址和端口。
操作过程|设置主节点服务器地址和端口。SET SNTPSRV:IP1="172.168.1.63", PORT1=123;打开NTP服务器和客户端开关。SET NTPSTAT:SRV="RUN", CLNT="RUN";执行命令QUERY NTP SYNCSTAT，查看NTP同步信息。|设置主节点服务器地址和端口。SET SNTPSRV:IP1="172.168.1.63", PORT1=123;打开NTP服务器和客户端开关。SET NTPSTAT:SRV="RUN", CLNT="RUN";执行命令QUERY NTP SYNCSTAT，查看NTP同步信息。|设置主节点服务器地址和端口。SET SNTPSRV:IP1="172.168.1.63", PORT1=123;打开NTP服务器和客户端开关。SET NTPSTAT:SRV="RUN", CLNT="RUN";执行命令QUERY NTP SYNCSTAT，查看NTP同步信息。
预期结果|当status为Master时，说明己同步成功。|当status为Master时，说明己同步成功。|当status为Master时，说明己同步成功。
实际结果|同预期结果。|同预期结果。|同预期结果。
注意事项|||
签名||测试日期|


常见问题处理 :##### NTP客户端同步时间失败 


建议分析问题前，在命令终端中，执行[SHOW SYSLOG] :FUNCNAME="NTP"。在系统日志中粗略问题的症结，再根据相关工具排查。出现同步时间失败的原因可能有以下几种：




NTP客户端未启动。在命令终端中执行[SHOW NTPSTAT]，查看客户端状态。如果是停止状态，则确认NTP客户端参数配置正确，再执行[SET NTPSTAT]:CLNT="RUN";命令，启动NTP客户端。


NTP客户端绑定的主机地址没有找到，或者指定的端口被占用。在命令终端中执行[SET SNTPCLNT]，重新配置本端IP和本端端口号。


上级NTP服务器的IP地址不通。使用[ping]命令检测指定IP的网络是否通畅。


上级NTP服务没有启动。在上级NTP服务器上执行终端命令[netstat -nap | grep 123]，查看123端口是否打开。


自动同步时调整本地时间偏差，如果出现超最大阈值时，系统也会同步时间失败。 


可以查看到“NTP时间偏移超最大阈值(2365981955)”告警。用户可执行强制同步时间命令[SYNC
NTPTIME]修正该问题。


因上级NTP服务没有同步时间，上级NTP服务错误，无法使用。 




##### 无法与上级NTP服务同步时间，但是其它的机器却可以与该上级NTP服务同步时间 




上级NTP服务对IP地址和网段有限制，导致请求被禁止。 


协议版本不一致。在命令终端中执行SET SNTPCLNT命令，重新配置版本号。 




这两个问题都需要与用户确认，并让用户支持。 


##### 如何查询NTP客户端的执行日志 




在命令终端中，执行[SHOW SYSLOG]:FUNCNAME="NTP";，查看NTP执行的系统日志，该日志中包含有每次同步时间时结果描述（包含成功或者异常）。


配置BEGINDATE和ENDDATE参数，修改查询范围。




##### 启动NTP服务器失败 




执行[SET NTPSTAT]命令，返回错误信息“When
the client is stopped, the server can not start. 
”
，说明NTP服务端、客户端未启动。


配置NTP客户端，并启动NTP客户端。 




##### 如何重启NTP服务 


NTP服务运行在chost进程中，如需要重启NTP服务只需要执行[pkill
chost]后，在15秒内看门狗会自动重启chost进程。


## 缩略语 
## 缩略语 
DCU :Data Collection Unit数据采集单元
DPU :Data Processing Unit数据处理单元
MDS :Message Dispatch Service消息分发服务
MU :Merging Unit合并单元
### NTP 
Network Time Protocol网络时间协议
## 安全管理功能 
特性描述 :术语 :术语|含义
---|---
EMSPlus（Element Management System Plus for Cloud Core Network）|网络时间协议，用来同步网络中各个计算机的时间的协议。
SM|安全管理。
Web|ZXUN EMSPlus的本地维护终端，可以提供告警管理、性能管理和命令终端功能。
描述 :
描述 :


定义 :



安全管理功能可以防止未经授权的用户访问、篡改或者删除系统数据，保障系统的正常运行。 


用户进入系统会话之前，系统会对用户身份进行鉴别。鉴别时至少提供口令鉴别机制，并在每次登录系统时进行。口令应是不可见的，并在存储和传输时加密保护。此外，登录用户在查看系统配置时用户口令也以密文形式回显。用户完成鉴别前，系统不允许执行除登录以外的其他任何操作。 


系统保存每个用户的以下安全属性： 



 
用户标识 

 
用户角色 

 
用户有效期 

 
密码有效期 

 
密码 

 


系统为所有安全属性提供有效的初始值。不允许未授权用户修改安全属性，以确保安全属性只接受安全范围内的修改。系统的安全属性包括但不限于： 



 
用户信息 

 
角色信息 

 
权限信息 

 
有效期 

 
密码策略 

 
登录策略 

 
锁定策略 

 


在日常的操作维护活动中，系统管理员或者具备安全管理权限的授权人员，需要根据实际情况分配权限和增加一些安全措施。 






背景知识 :



命令：人机命令框架下，授权用户能执行的最小权限单位，又称为人机命令。人机命令是已经内部设定好，固定提供给用户使用的。 


命令集：一组命令的集合，代表一定的命令执行权限。 


命令和命令集之间是多对多的关系。系统根据命令的分类设定了一些命令集提供给用户使用，没有特殊的要求，这些命令集足够使用了。超级用户和具有安全配置权限的用户可以根据现场要求将某些命令归到一个命令集下面，可以通过“增加命令集”和“增加命令集成员”这两条命令实现。 


角色：一组命令集的集合，用户被授权的单位，具备某角色的用户可以执行此角色所能操作的任何命令。 


命令集和角色之间是多对多的关系。 


系统默认设定了四种默认角色，此四种默认角色是不允许被删除和修改的。超级用户和具有安全配置权限的用户可以根据现场要求增加新的角色，可以通过“增加角色”和“增加角色命令集”这两条命令实现。 


本系统四种默认角色信息参见[表1]。


角色标识|角色名称|角色描述
---|---|---
1|管理员角色|最高具有管理员权限
2|操作员角色|最高具有数据配置权限
3|维护员角色|最高具有系统维护权限
4|监控员角色|最高具有数据查看权限




应用场景 :

##### 用户权限控制场景 
创建新用户和分配其只有某项操作权限，并且设定其账户密码，使该用户必须通过密码登录网管系统，而且只能操作指定的一些操作命令。 
限定该用户只有在某个指定的时间段内才能登录网管系统，使该用户在其它时间段内无法登录系统。 
限定某个用户的用户有效期和密码有效期，超过有效期该用户自动无效或者密码失效，不能登录网管系统。 


##### 用户登录IP地址控制场景 
限定只有某个IP范围内的客户端才能登录网管系统，使该用户只有使用此IP范围内的客户端才能登录网管系统，其它不在此IP范围的客户端不能登录。


##### 密码安全策略场景 
限定密码安全功能，当用户的密码不符合安全系数要求的时候，会有相应的提示信息，提醒用户及时的修改成安全系数比较高的密码。 


客户收益 :

收益者|收益描述
---|---
运营商|增加用户安全，防止不必要的破坏。
终端用户|此特性对终端用户不可见。


实现原理 :
实现原理 :


系统架构 :



图1  EMSPlus系统架构示意图






安全管理功能在实时监控模块实现。 






涉及的网元 :



该特性由本网元单独实现，无需其他网元的配合。 






本网元实现 :



安全管理特性涉及到的功能点： 



 
鉴权功能，检测登录用户是否能执行某个命令。 

 
命令行配置，主要负责用户登录、注销、命令集管理、角色管理、用户管理、高级管理等功能的命令行配置。 

 




业务流程 :图2  安全管理业务流程图

用户用户是最终登录网管系统并进行操作的操作员集合。系统管理员在创建用户时，通过定义用户中包含的角色约定该用户的权限。用户管理是系统安全管理最重要的组成部分，提供用户的创建、查询、修改、删除。不同用户可以被赋予不同的权限。创建用户时，可以指定用户名称、密码、可操作的时间段以及用户联系方式等信息。对于用户密码提供密码策略，对于用户提供账号策略，达到安全保护的目的。系统默认提供admin管理员用户。根据用户创建时的用户名和密码登录到EMSPlus系统，可在其权限范围内实现网络管理操作。 
角色角色是对应用户的操作权限，是一组操作集的集合，其本质是通过定义操作集来实现一组用户的操作权限。角色管理提供角色对应的操作权限控制，便于系统安全管理。通过将角色分配给用户，实现用户对于操作的权限分配。 
操作集操作集是一系列操作权限的集合，用来定义角色的操作权限。一个角色被赋予一个操作集后，赋予此角色的用户即拥有相应操作集内的所有操作权限。 
操作授权用户能执行的最小权限单位，比如增加用户、删除用户。 
系统影响 :该特性不涉及对系统的影响。 
应用限制 :该特性不涉及应用限制。 
特性交互 :该特性不涉及与其他特性的交互。 
遵循标准 :

本特性采用ZTE内部的接口和协议，不涉及标准协议。


特性能力 :该特性不涉及规格指标。 
可获得性 :
可获得性 :


版本要求及变更记录 :



特性版本|发布版本|发布说明
---|---|---
01|V5.17.10|首次发布。






License要求 :



该特性为EMSPlus网元的基本特性，无需License支持。




对其他网元的要求 :该特性不涉及对其他网元的要求。 
O&M相关 :
O&M相关 :


命令 :



本特性不涉及命令的变化。 




性能统计 :该特性不涉及计数器的变化。 
告警和通知 :该特性不涉及告警消息的变化。 
业务观察/失败观察 :该特性不涉及业务观察/失败观察的变化。 


话单与计费 :



该特性不涉及话单与计费的变化。 




特性操作 :#### 创建用户账号 
在系统初始配置和日常操作阶段，需要先规划角色和操作集，再创建用户账号。角色和操作集可以通过新建的方式配置，也可以使用系统默认配置的角色和操作集。 
初始配置用户的工作流程如[图1]所示，操作说明参见[表1]。
图1  新建用户流程

步骤|操作|说明
---|---|---
1|新建命令集|将不同的操作权限组成一个集合，以集合的方式将操作权限分配给角色可以降低权限管理的复杂性。
2|新建角色|分配给该角色对应网管系统中各项资源的操作权限。
3|设置安全策略|设置系统安全策略，如定制用户账户规则。
4|新建用户|为新用户设置用户名和密码，分配用户具有的角色，定义用户所属的用户组。
##### 新建命令集 
摘要 :命令集是一系列操作命令权限的集合，用来定义角色的操作权限。一个角色与一个命令集进行绑定后，包含该角色的用户即拥有相应命令集内的所有操作权限。 
前提 :以安全管理员账户登录EMSPlus。
步骤 :增加命令集
在EMSPlus客户端，选择菜单System→MML Terminal
，打开Terminal窗口，如[图1]所示。
图1  Terminal 窗口

在Terminal窗口中，执行[ADD CMDSET]命令，增加命令集，如[图2]所示。
图2  增加命令集

自定义命令集名称，并单击Execute。
增加命令集成员
在Terminal窗口中，执行[ADD CMDSET MEMBER]命令，将命令加入到命令集中，完成特定命令集的创建，如[图3]所示。
图3  增加命令集成员

参数名称|参数说明
---|---
Command Set ID|命令集的唯一标识。
Command Set Name|命令集名称，不区分大小写。
Command ID List|内部命令标识码列表。可以给自定义命令集同时添加多个操作命令；如果操作命令已经被赋予了，则不重复操作。
参考[表1]填写相关参数，并单击Execute。
相关任务 :任务目的|任务操作
---|---
查询命令集|在Terminal窗口中，输入SHOW CMDSET命令，并单击Execute，查询命令集。
复制命令集|在Terminal窗口中，输入COPY CMDSET命令，并单击Execute，复制命令集。
删除命令集|在Terminal窗口中，输入DEL CMDSET命令，并单击Execute，删除命令集。
查询命令集成员|在Terminal窗口中，输入SHOW CMDSET MEMBER命令，并单击Execute，查询命令集成员。
删除命令集成员|在Terminal窗口中，输入DEL CMDSET MEMBER命令，并单击Execute，删除命令集成员。
查询命令集对应的角色|在Terminal窗口中，输入SHOW CMDSET ROLE命令，并单击Execute，查询命令集对应的角色。
查询操作命令|在Terminal窗口中，输入SHOW CMD命令，并单击Execute，查询操作命令。
##### 新建角色 
摘要 :当EMSPlus系统预定义的角色不能满足需要时，维护人员可以自定义角色。为该角色增加相应的操作集或操作，即可赋予该角色一定的操作权限。
创建用户时，为用户选择相应的角色，即可通过角色对用户的操作进行限制，起到用户权限设置的作用。 
相关信息 :本节涉及到的概念：操作集、父节点、子节点，相应的说明以[图1]为例。
图1  安全管理

操作集：是一些操作的集合，如Security Management、Command Set Management、Role Management、User Management、Advanced Management。 
父节点：是子节点的上一层节点，比如Security Management是Command Set Management、Role Management、User Management、Advanced Management的上一层节点，也称为父节点。 
子节点：是父节点下一层节点，比如Command Set Management、Role Management、User Management、Advanced Management是Security Management的下一层节点，也称为子节点。 
步骤 :新建角色
在EMSPlus客户端，选择菜单System→MML Terminal
，打开Terminal窗口，如[图2]所示。
图2  Terminal 窗口

在Terminal窗口中，输入[ADD ROLE]命令，并参考[表1]填写相关参数，如[图3]所示。
图3  新增角色

参数名称|参数说明
---|---
Role Name|自定义角色名称，不区分大小写，全局唯一。
Role Description|角色的描述信息，用于辅助说明角色功能、应用等其他信息。
Valid Role(Yes or No)|角色是否生效。No (SM_NOTVALID)：角色无效。Yes (SM_ISVALID)：角色有效。
单击Execute，新增角色。
增加角色命令集
在Terminal窗口中，输入[ADD ROLE CMDSET]命令，并参考[表2]填写相关参数，如[图4]所示。
图4  增加角色命令集

参数名称|参数说明
---|---
Role ID|Role ID：角色的内部标识。Role Name：自定义角色名称。二者必须输入且只能输入一个。
Role Name|Role ID：角色的内部标识。Role Name：自定义角色名称。二者必须输入且只能输入一个。
Command Set ID List|内容为命令集标识。可以给自定义角色同时添加多个命令集；如果命令集已经被赋予了，则不重复操作。
单击Execute，给角色授权命令集。
相关任务 :任务目的|任务操作
---|---
查询角色|在Terminal窗口中，输入SHOW ROLE命令，并单击Execute，查询角色。
修改角色|在Terminal窗口中，输入SET ROLE命令，并单击Execute，修改角色。
删除角色|在Terminal窗口中，输入DEL ROLE命令，并单击Execute，删除角色。
查询角色命令集|在Terminal窗口中，输入SHOW ROLE CMDSET命令，并单击Execute，查询角色命令集。
删除角色命令集|在Terminal窗口中，输入DEL ROLE CMDSET命令，并单击Execute，删除角色命令集。
查询角色对应的用户|在Terminal窗口中，输入SHOW ROLE USER命令，并单击Execute，查询角色对应的用户。
##### 设置安全策略 
##### 设置安全策略 
安全策略包括密码的安全策略和账号的安全策略。 
密码安全策略：用于设置用户密码的复杂度及有效期等安全选项。 
账号安全策略：用于设置账号的状态及有效期等安全选项。 
###### 设置密码安全策略 
摘要 :定制用户的密码策略保证用户账号安全。 
步骤 :在EMSPlus客户端，选择菜单System→MML Terminal
，打开Terminal窗口，如[图1]所示。
图1  Terminal 窗口

在Terminal窗口中，执行[SET PASSWORDTACTIC]命令，设置密码策略，如[图2]所示。
图2  设置密码策略

参考[表1]设置密码策略参数，并单击Execute。
参数名称|参数说明
---|---
Minimum Length of Password|密码的最小长度，默认为：0，即不限制密码长度。
Enable Password Complexity RequirementNo|密码复杂度要求是指密码由小写字母、大写字母、数字和一些特殊字符组成。且密码不能与用户名相同或与用户名相反。No (SM_NOTVALID)：关闭密码复杂性策略。Yes(SM_ISVALID)：启用密码复杂性策略。当选择启用密码复杂性策略时，您还可以在系统配置文件中配置复杂性策略，要求密码必须包含以上四种字符中的2个、3个或所有。
Reminding Days Before Password Expired|在相应密码过期前N天登录时向用户发送通知。此参数指定N值。
Count of Latest Passwords Cannot Be Reused|当用户修改密码时，最近的N个密码无法使用。此参数指定N值。默认值：0。
Day of Latest Passwords Cannot Be Reused|当用户修改密码时，不能使用最近N天内使用的旧密码。如果最近密码计数设置为零，则忽略此参数。
Must Modify Password When User Login First|表示用户首次登录时是否需要修改密码。No (SM_NOTVALID)：表示用户首次登录时不需要修改密码。Yes(SM_ISVALID)：表示用户首次登录时必须修改密码。
Must Modify Password When Alarmed User Login|表示用户连续输入错误密码三次但未达到锁定次数的限制，登录成功后是否需要修改密码。No (SM_NOTVALID)：表示用户登录成功后不需要修改密码。Yes(SM_ISVALID)：表示用户登录成功后必须修改密码。
Maximum Number of Password Successive Character|不允许密码中相同字符的连续出现次数，默认为：0。
After Reset Password Must Modify Password When User Login|指示其他用户修改密码后，用户登录时是否必须修改密码。No (SM_NOTVALID)：表示上述密码策略无效。Yes(SM_ISVALID)：表示上述密码策略有效。
Max Count Of Modify Password Perday|最大密码修改次数。如果最近密码或最近密码不能重复使用次数设置为零，则此参数将被忽略。
相关任务 :任务目的|任务操作
---|---
查询密码策略|在Terminal窗口中，执行SHOW PASSWORDTACTIC命令，查询密码策略。
###### 设置账号安全策略 
摘要 :定制用户的账号策略保证用户账号安全。 
步骤 :在EMSPlus客户端，选择菜单System→MML Terminal
，打开Terminal窗口，如[图3]所示。
图3  Terminal 窗口

在Terminal窗口中，执行[SET USERTACTIC]命令，设置账号策略，如[图4]所示。
图4  设置账号策略

参考[表2]设置账号策略参数，并单击Execute。
参数名称|参数说明
---|---
Lock Status|用户锁定策略Never Lock (SM_STATUS_NLOCK)：表示无论用户输入多少次错误密码，系统都不锁定用户。Policy Lock (SM_STATUS_PLOCK)：表示用户连续输错密码一定次数后，系统将锁定用户，并在一定时间后自动解锁。Lock Forever (SM_STATUS_FLOCK)：表示用户连续输错密码一定次数后，系统将锁定该用户，且只能通过手动解锁命令进行解锁。
Maximum Times of Incorrect Password Input|用户可以输入错误密码的次数。如果将Lock Status设置为Policy Lock (SM_STATUS_PLOCK)或Lock Forever (SM_STATUS_FLOCK)，则需要此参数。
Auto Unlock Time(min)|如果将Lock Status设置为Policy Lock (SM_STATUS_PLOCK)，则此参数有效。当用户被锁定时，经过该参数设定的时间后，系统自动解锁该用户。
Lock Check Period(d)|锁定检测周期，检测用户是否需要解锁。
Lock User by IP|指定是否根据IP地址锁定用户。No (SM_NOTVALID)：用户连续输错密码一定次数后，系统不允许该用户通过任意IP地址尝试登录网管。Yes (SM_ISVALID)：用户连续输错密码一定次数后，系统不允许该用户以相同的IP地址尝试登录网管。
Reminding Days Before Account Expired|由过期天数指示的帐户过期通知日期。
Invalid Period of Not Login(d)|如果用户在N天内未登录，则该用户被视为无效用户。此参数指定N值。如果N=0，如果用户长时间未登录，则用户不会失效。
相关任务 :任务目的|任务操作
---|---
查询账号策略|在Terminal窗口中，执行SHOW USERTACTIC命令，查询账号策略。
##### 新建用户 
摘要 :创建一个新的用户，并为该用户分配角色，设置该用户的基本权限。 
在为新用户设置用户名和密码的同时，维护人员还可以设置密码的有效天数，定义同一用户最多的登录数以及其他限制条件。 
 说明： 
如果不给用户分配角色，该用户登录后将无任何操作权限。 
前提 :用户的安全策略已配置，具体操作参见“[设置安全策略]”
。
步骤 :新建用户
在EMSPlus客户端，选择菜单System→MML Terminal
，打开Terminal窗口，如[图1]所示。
图1  Terminal 窗口

在Terminal窗口中，输入[ADD USER]命令，并参考[图2]填写相关参数，如[表1]所示。
图2  新增用户

参数类型|参数名称|参数说明
---|---|---
必选参数|User Name|用户的名称，不区分大小写。用户名中允许下列字符：中文字符、数字、大写字母或小写字母以及一些特殊字符（~，@%&_（）-+）。
User Password|必选参数|用户的密码。密码区分大小写。如果使用密码策略，则密码必须符合密码策略。
Confirm Password|必选参数|确认密码，必须与新密码相同。
可选参数|Description|用户的描述信息。
Valid User(Yes or No)|可选参数|表示用户状态。No (SM_NOTVALID): 表示用户无效。无效用户无法登录OMM系统。Yes (SM_ISVALID): 表示用户有效。默认情况下，新增的用户为有效用户。
Mobile|可选参数|用户的手机号码，例如：13913XXXXXX。
Email|可选参数|用户邮箱，如123@zte.com.cn。
Maximum Login Count|可选参数|表示允许使用新用户帐户登录系统的最大用户数，此用户数受为系统配置的最大连接数限制。
Restrict Password Validity|可选参数|指定是否设置密码的有效期。No (SM_NOTVALID): 表示密码永久有效。Password Validity(d)参数可以留空。Yes (SM_ISVALID): 密码具有有效期限。如果密码过期，用户必须在登录时修改密码。必须设置Password Validity(d)参数。
Password Validity(d)|可选参数|密码的有效期限。当限制密码有效期设置为Yes (SM_ISVALID)时，必须设置此参数。
Authentication Type|可选参数|用户登录身份验证类型。LOCAL：表示用户在网管上进行认证。LDAP：表示对用户在LDAP服务器上进行认证，配置命令为：SET LDAPSVR；如果无法连接LDAP服务器，则使用LOCAL身份验证。TACACS+：表示用户在TACACS+服务器上进行认证，相关配置命令为：SET TACACSINFO；如果无法连接TACACS+服务器，则使用LOCAL身份验证。User login authentication type.
Restrict Login Terminal Type or not|可选参数|指定是否限制登录终端。No (SM_NOTVALID)：表示用户不限于指定的登录终端。Yes (SM_ISVALID)：表示限制用户使用指定的登录终端。
Restrict Login Terminal Type|可选参数|登录终端类型，选项：TERM_WEB_GUI：表示用户只能通过IE客户端和日常维护客户端登录网管。TERM_TELNET_SERVER：表示用户只能通过telnet client登录网管。TERM_NDF：表示用户只能通过NDF客户端登录网管。TERM_SSH_SERVER：表示用户只能通过SSH客户端登录网管。TERM_NETCONF：表示该用户只能通过NETCONF客户端登录网管。
Double Authentication|可选参数|指定用户是否为双重身份验证用户。No (SM_NOTVALID)：表示用户不是双身份验证用户。Yes (SM_ISVALID)：表示用户是双重身份验证用户。
Restrict Operable Date|可选参数|指定是否将用户操作限制在特定时间段内。No (SM_NOTVALID)：不为用户指定时间段，并且Operable Start Date和Operable End Date参数可以留空。Yes (SM_ISVALID)：用户只能在指定的时间段内操作。必须设置Operable Start Date和Operable End Date参数。
Operable Start Date|可选参数|指定期间的开始日期。
Operable End Date|可选参数|指定期间的结束日期。
Restrict Operable Time|可选参数|指定是否将用户操作限制为每天的特定时间段。No (SM_NOTVALID)：不为用户指定时间段，并且Operable Start Time和Operable End Time参数可以留空。Yes (SM_ISVALID)：用户只能在指定的时间段内操作。必须设置Operable Start Time和Operable End Time参数。
Operable Start Time|可选参数|指定时间段的开始时间。
Operable End Time|可选参数|指定时间段的结束时间。
Restrict Operable Day of Week|可选参数|指定是否将用户操作限制为每周的特定天数。No (SM_NOTVALID)：用户操作不限于每周的指定天数。Operable Day of Week参数可以留空。Yes (SM_ISVALID)：用户只能在每周的指定天数内操作。必须设置Operable Day of Week参数。
Operable Day of Week|可选参数|允许用户操作的每周天数。Sun(Sunday)：用户可以在星期天操作。Mon (Monday)：用户可以在星期一操作。Tue (Tuesday)：用户可以在星期二操作。Wed (Wednesday)：用户可以在星期三操作。Thu (Thursday)：用户可以在星期四操作。Fri (Friday)：用户可以在星期五操作。Sat (Saturday)：用户可以在星期六操作。
单击Execute，新增用户。
为新用户分配角色
在Terminal窗口中，输入[ADD USER ROLE]命令，并参考[表2]填写相关参数，如[图3]所示。
图3  增加用户角色

参数名称|参数说明
---|---
User ID|User ID：用于指定需要增加角色的用户的内部标识。User Name：用于指定需要增加角色的用户的用户名称。二者必须输入且只能输入一个。
User Name|User ID：用于指定需要增加角色的用户的内部标识。User Name：用于指定需要增加角色的用户的用户名称。二者必须输入且只能输入一个。
Role ID List|被增加的用户的内部角色标识。可以给自定义用户同时添加多个角色；如果角色已经被赋予了，则不重复操作。
单击Execute，给角色授权命令集。
相关任务 :任务目的|任务操作
---|---
修改用户信息|在Terminal窗口中，输入SET USER命令，并单击Execute，修改用户信息。
删除用户|在Terminal窗口中，输入DEL USER命令，并单击Execute，删除用户。
复制用户|在Terminal窗口中，输入COPY USER命令，并单击Execute，复制用户信息。
查询用户|在Terminal窗口中，输入SHOW USER命令，并单击Execute，复制用户信息。
删除用户角色|在Terminal窗口中，输入DEL USER ROLE命令，并单击Execute，删除用户角色。
查询用户角色|在Terminal窗口中，输入SHOW USER ROLE命令，并单击Execute，查询用户角色。
修改本用户密码|在Terminal窗口中，输入SET PASSWORD命令，并单击Execute，修改本用户密码。
修改本用户登录提示信息|在Terminal窗口中，输入SET LOGINTIP命令，并单击Execute，修改本用户登录提示信息。
增加用户登录IP范围|在Terminal窗口中，输入ADD USER IPSEC命令，并单击Execute，增加用户登录IP范围。
删除用户登录IP范围|在Terminal窗口中，输入DEL USER IPSEC命令，并单击Execute，删除用户登录IP范围。
查询用户登录IP范围|在Terminal窗口中，输入SHOW USER IPSEC命令，并单击Execute，查询用户登录IP范围。
删除用户所有登录IP范围|在Terminal窗口中，输入DEL USER ALLIPSEC命令，并单击Execute，删除用户所有登录IP范围。
查询所有用户|在Terminal窗口中，输入SHOW ALL USER命令，并单击Execute，查询所有用户。
#### 管理日志 
摘要 :本节以操作日志为例，介绍如何查询日志信息。查询安全日志、系统日志的操作与之类似。 
相关信息 :日志主要用于记录用户对EMSPlus的操作事件，是系统安全管理的重要组成部分。
EMSPlus系统的日志分为如下三类：
操作日志记录用户对EMSPlus操作的详细信息，如：查询某个操作员的某个时间段内的操作。 
安全日志记录用户执行的安全事件。 
系统日志记录服务器定时任务的完成情况，便于用户了解系统任务运行状况。 
步骤 :在EMSPlus客户端，选择菜单System→MML Terminal
，进入MML Terminal页面，如[图1]所示。
图1  The MML Terminal Window

在MML Terminal窗口，输入[SHOW CMDLOG]命令，如[图2]所示。
图2  查看操作日志

（可选）设置查询日志的参数。 
如果所有参数均不设置，则查询出所有的操作日志。 
参数名称|参数说明
---|---
User Name|需要查询日志的用户。
Level|需要查询的操作的级别，由命令级别决定。VERYIMPTIMPTNOTICENORMAL
Module|需要查询的模块类型。
IP Address|操作终端的IP地址。
Result|操作结果SUCCESS：表示查询成功的操作。FAILURE：表示查询的操作失败。
Mode|登录方法。
Detail|操作详情，例如完整的MML命令，包括助记符和输入参数。
Start Time|查询日志时间段的开始时间，精确到秒。
End Time|查询日志时间段的结束时间，精确到秒。
MML Code|用户运行的命令代码。命令代码是命令的内部代码。要了解命令的代码，请查看命令属性。
单击Execute按钮，满足条件的日志显示在日志列表中。
相关任务 :任务名称|任务操作
---|---
Query Security Logs|在MML Terminal窗口，输入SHOW SCRTLOG命令并单击Execute。
Query System Logs|在MML Terminal窗口，输入SHOW SYSLOG命令并单击Execute。
Set FTP/SFTP Server for Log|在MML Terminal窗口，输入SET LOGEXPORT PARAM命令并单击Execute。
Delete FTP/SFTP Server for Log|在MML Terminal窗口，输入DEL LOGEXPORT PARAM命令并单击Execute。
Query FTP/SFTP Server for Log|在MML Terminal窗口，输入SHOW LOGEXPORT PARAM命令并单击Execute。
Set Log Export Global Parameters|在MML Terminal窗口，输入SET LOGEXPORT SWITCH命令并单击Execute。
Export Specific Log|在MML Terminal窗口，输入SET EXPORTALLLOGTIME PARAM命令并单击Execute。
Set SYSLOG Export Log Type|在MML Terminal窗口, enter the SET SYSLOG PARAM命令并单击Execute。
Query SYSLOG Export Log Type|在MML Terminal窗口，输入SHOW SYSLOG PARAM命令并单击Execute。
Add User CMDLOG Storage Limitation Strategy|在MML Terminal窗口，输入ADD CMDLOGLIMIT STRATEGY命令并单击Execute。
Set User CMDLOG Storage Limitation Strategy|在MML Terminal窗口，输入SET CMDLOGLIMIT STRATEGY命令并单击Execute。
Delete User CMDLOG Storage Limitation Strategy|在MML Terminal窗口，输入DEL CMDLOGLIMIT STRATEGY命令并单击Execute。
Show User CMDLOG Storage Limitation Strategy|在MML Terminal窗口，输入SHOW CMDLOGLIMIT STRATEGY命令并单击Execute。
## 缩略语 
## 缩略语 
FTP :File Transfer Protocol文件传输协议
IP :Internet Protocol因特网协议
SFTP :Secure File Transfer Protocol安全文件传输协议
ZTE :Zhongxing Telecommunications Equipment中兴通讯
## 告警管理功能 
特性描述 :术语 :术语|含义
---|---
EMSPlus|ZXUN EMSPlus的本地维护终端，可以提供告警管理、性能管理和命令终端功能。
EMSPlus（Element Management System Plus for Cloud Core Network）|电信云及核心网增值网管。
Web|ZXUN EMSPlus网元的本地管理终端。
告警信息|系统运行过程中出现的各种故障或异常的提示信息。
通知信息|系统运行过程中曾经发生的操作或异常信息，代表一个事件的发生，不会有潜在的危险，通知信息不用后续恢复。
描述 :
描述 :


定义 :



####### 告警管理 
告警管理功能是实时展现系统运行中的异常或者关键事件，以便操作人员及时采取措施解决故障，或者了解系统过往运行过程中的关键信息，从而保证系统长期正常稳定运行。 
告警可以上报给上级网管（EMS网元管理系统），并支持告警同步。


####### 告警 
当系统检测到可能影响系统功能或性能的事件发生时，将告警事件、可能原因、处理建议、附加信息内容以告警的形式在网管系统呈现，并上报给上级网管（如EMS）。 
维护人员可借助告警信息定位并排除故障，以保障系统的稳定运行。告警对应的问题或故障解决后，系统将自动返回告警恢复消息。 


####### 系统类型 
系统类型描述了告警信息产生的位置，分为以下三种： 

 
网元告警：网元设备上产生的告警信息。 

 
网管系统告警：网管系统上产生的告警信息。 

 
外围节点告警：系统其它节点上产生的告警信息。 

 


####### 告警级别 
根据对系统的影响程度分为四种级别： 

 
严重：系统出现了严重的故障，无法正常运行，需要立即修复。 

 
主要：系统出现了比较严重的故障，虽然可以继续运行，但某些重要功能不能正常实现，影响正常业务，需要立即修复。 

 
次要：系统出现了一般故障，虽然可以正常运行，但局部功能受到一定影响。应采取纠正措施，以免发生更严重的故障。 

 
警告：系统出现了轻微故障，不影响正常运行，对系统的局部功能影响也不大，如果长时间不解决，可能会发展为更高级别的故障。应采取措施诊断纠正，以免其转变成更加严重的、影响正常业务的故障。 

 


告警类型 :按照告警的类型来划分，支持如下几类告警： 

 
设备告警：与设备故障相关的告警类型。 

 
通讯告警：与信息传输过程相关的告警类型。 

 
环境告警：与设备所处的环境相关的告警类型。 

 
服务质量告警：与服务质量降级相关的告警类型。 

 
处理错误告警：与软件或进程故障相关的告警类型。 

 


####### 告警状态 
告警根据状态分为当前告警和历史告警： 

 
当前告警：系统中当前存在，仍未恢复的告警。 

 
历史告警：系统中已经恢复的告警，保存于数据库中。 

 


####### 告警/通知码 
告警/通知码为唯一标识告警/通知信息的序列号，与告警/通知信息一一对应，维护人员可以在系统中通过告警/通知码查询该告警/通知的信息。 
例如：“CPU使用率超标”的告警码为2365981185，“用户登录通知”的通知码为2365980933。


####### 告警实时监控 
EMSPlus提供系统当前告警的实时监控，帮助用户及时了解系统发生的故障或变化，并解决问题。故障恢复时，当前告警将被清除，并转到历史告警数据库中。 


告警恢复 :系统产生告警后，通过相应处理已经消除告警，系统将在告警信息中显示持续时间、恢复时间和恢复类型，同时该告警进入历史告警库中，用户通过查询历史告警操作，可以查询到已恢复的告警。 


####### 告警确认 
告警确认是将一条告警由未确认状态转换到已确认状态，维护人员对一条消息进行确认，表示开始处理该条告警。
告警被确认后，系统会在告警数据库中记录此次确认发生的时间、确认者、确认信息等相关信息。 


####### 告警反确认 
告警反确认是将一条处于已确认状态的告警数据转换到未确认状态。
操作员对一条告警进行确认后开始处理当前告警，如果无法解决故障，可对该条告警进行反确认，将告警状态转换到未确认状态。


####### 告警源 
检测软、硬件运行状态中某种指标的模块，负责上报实时告警、通知以及恢复其已上报的告警。 


####### 过滤规则 
如果暂时不想让某个或某些异常事件显示，可创建过滤规则，将其暂时过滤。 






背景知识 :



系统支持用户根据自己的需要，设置一定的条件，对告警进行一定规则的过滤。 


支持接入告警箱，以声音、警示灯、邮件、短信的方式通知维护人员。 


告警管理系统可以检测如下异常情况，并自动触发告警： 



 
磁盘空间不足或磁盘故障 

 
CPU或内存过载 

 
文件读写失败或文件传输失败 

 
安全事件，如用户多次登录失败 

 
时钟同步错误 

 
性能统计数据超过设置的指标门限值 

 




应用场景 :本特性用于检测本系统运行故障，以便操作人员及时采取措施排查解决故障，从而保证系统长期正常稳定运行。 
客户收益 :

收益者|收益描述
---|---
运营商|通过告警管理了解系统当前运行状态是否正常，提高了产品可靠性和易用性。
终端用户|此特性对终端用户不可见。


实现原理 :
实现原理 :


系统架构 :



网管和业务在运行过程中产生告警，上报给COMM平台的告警服务器，告警服务器将告警保存入告警池，同时上报给Web/EMSPlus，如[图1]所示。


图1  EMSPlus告警功能示意图










涉及的网元 :



涉及的网元及其功能参见[表1]。


功能单元|描述
---|---
CN(CS/PS)|核心网CS/PS网元，向EMSPlus实时输出CHR话单和DPI消息。
CGNAT|路由器，向EMSPlus实时输出会话和NAT日志。
Firewall|防火墙，向EMSPlus实时输出会话、安全、系统、NAT日志等。
EMSPlus|将网元上报的话单和日志进行数据的清洗和存储，并向客户报表展示。




本网元实现 :EMSPlus告警管理功能包括： 
告警数据采集EMSPlus系统支持对告警信息的实时采集，采集的告警信息包括：设备告警、性能越限告警等。 
告警实时监控EMSPlus提供系统当前告警的实时监控，帮助用户及时了解系统发生的故障或变化，并解决问题。故障恢复时，当前告警将被清除，并转到历史告警数据库中。EMSPlus提供的告警实时监控功能包括：对当前告警按照告警级别计数。导出当前告警，导出文件支持.csv文件格式。按告警级别定制告警是否发音。确认/反确认告警，并存储处理意见。查看告警详细信息。告警查询。EMSPlus可以根据告警的发生时间、级别、类型、告警码、发生位置等组合条件，对当前和历史告警信息进行查询。告警的查询结果可以导出到文件，文件格式支持.csv。 


业务流程 :



告警由告警源上报到告警代理，告警代理进行判别是否是重复告警，如果是重复告警，则直接丢弃，否则上报到告警服务器。告警服务器判别是否设置了告警过滤，如果符合告警过滤条件，则丢弃该告警，此后根据是否设置了告警箱进行相应上报。 




系统影响 :该特性不涉及对系统的影响。 
应用限制 :该特性不涉及应用限制。 
特性交互 :该特性不涉及与其他特性的交互。 
遵循标准 :

本特性采用ZTE内部的接口和协议，不涉及标准协议。


特性能力 :该特性不涉及规格指标。 
可获得性 :
可获得性 :


版本要求及变更记录 :



特性版本|发布版本|发布说明
---|---|---
01|V5.17.10|首次发布。




License要求 :该特性为EMSPlus网元的基本特性，无需License支持。 
对其他网元的要求 :该特性不涉及对其他网元的要求。 
O&M相关 :
O&M相关 :
命令 :本特性不涉及命令的变化。 
性能统计 :该特性不涉及计数器的变化。 
告警和通知 :该特性不涉及告警消息的变化。 
业务观察/失败观察 :该特性不涉及业务观察/失败观察的变化。 


话单与计费 :



该特性不涉及话单与计费的变化。 




特性操作 :#### 查询告警和通知 
#### 查询告警和通知 
可以查询的种类如下： 
当前告警：指当前发生的告警。 
历史告警：曾经发生过，但目前已经恢复的告警。 
通知：一些操作或异常提示信息。 
##### 查询当前告警 
摘要 :当前告警查询功能支持直接查询所有当前告警信息，同时也支持用户按照设置查询条件，只查看符合条件的告警。 
步骤 :在EMSPlus客户端，单击告警管理，打开告警管理页面，如[图1]示。
图1  告警管理页面

选择左侧菜单告警查询→当前告警查询→所有当前告警
，打开查询所有当前告警页面，如[图2]所示。
图2  查询所有当前告警页面

（可选）根据特定条件筛选告警。 
单击，打开筛选页面，设置告警查询条件，如[图3]所示。
图3  筛选告警条件

单击确定按钮，将列出符合条件的告警。
相关任务 :维护人员可以查看告警的详细信息，具体操作参见“[告警处理]”
。
##### 查询历史告警 
摘要 :历史告警查询功能支持直接查询所有历史告警信息，同时也支持用户按照设置查询条件，只查看符合条件的告警。 
步骤 :在EMSPlus客户端，单击告警管理，打开告警管理页面，如[图4]所示。
图4  告警管理页面

选择左侧菜单告警查询→历史告警查询→一天内历史告警
，打开查询一天内历史告警页面，如[图5]所示。
图5  查询所有当前告警页面

（可选）根据特定条件筛选告警。 
单击，打开筛选页面，设置告警查询条件，如[图6]所示。
图6  筛选告警条件

参数名称|参数说明
---|---
Occurrence Time|设置告警的发生时间段，由系统自动检索符合条件的告警。若不设置发生时间，则查询所有时间段的告警。格式：YYYY-MM-DDhh:mm:ss
Restore Time|告警恢复的时间段。若不设置恢复时间，则查询所有时间段的告警。格式：YYYY-MM-DD hh:mm:ss
Severity|设置查询的告警的级别。若不选择，则查询所有级别的告警。
System Type|设置告警的系统类型。可以选择：All AlarmNE AlarmOMM System AlarmPeripheral Node Alarm
Selected Alarm Codes|选择查询的告警码。
Alarm Code|设置需要查询的告警码，通过单击告警名称前的复选框进行选择。可供选择的告警码由SystemType决定，若不选，则匹配所有告警码。
单击确定按钮，将列出符合条件的告警。
相关任务 :维护人员可以查看告警的详细信息；单击页面下方的按钮，执行对应的操作，具体操作参见“[导出告警信息]”
。
##### 查询通知 
摘要 :通知查询功能支持直接查询所有通知信息，同时也支持用户按照设置查询条件，只查看符合条件的通知。 
步骤 :在EMSPlus客户端窗口单击Fault，选择左侧菜单FM Query→ Show Notification
，打开通知查询页面，如[图7]所示。
图7  通知查询

参数名称|参数说明
---|---
Occurrence Time|设置通知的发生时间段，由系统自动检索符合条件的通知。若不设置发生时间，则查询所有时间段的通知。格式：YYYY-MM-DDhh:mm:ss
Position Information|模糊匹配通知发生的位置，例如vnfid=xx、vmname=xx。若不选择，则匹配所有位置的通知。
System Type|设置通知的系统类型。可以选择：All AlarmNE AlarmOMM System AlarmPeripheral Node Alarm
Selected Alarm Codes|已选择查询的告警码。
Alarm Code|设置需要查询的告警码，通过单击告警名称前的复选框进行选择。可供选择的告警码由SystemType决定，若不选，则匹配所有告警码。
设置通知查询条件，例如告警产生时间、位置，并可进一步设置系统类型、告警码。 
单击Query按钮，将列出符合条件的通知。
相关任务 :维护人员可以查看通知的详细信息；单击页面下方的按钮，执行对应的操作，具体操作参见“[导出告警信息]”
。
#### 告警处理 
#### 告警处理 
##### 查看告警详情和处理建议 
摘要 :维护人员可以通过该操作查看告警或通知的详细信息，并参考处理意见，对告警或通知进行定位，及时处理故障。 
本节以查看当前告警的详细信息为例进行介绍，查看历史告警和通知的详细信息与此类似。 
步骤 :在所有当前告警页面，勾选需要查看详细信息的告警并选择更多→详情
，如[图1]所示。
图1  查看告警详细信息路径

在当前告警详细信息页面，查看告警的详细信息及处理意见，如[图2]所示。
图2  当前告警详细信息页面

Click close.
##### 确认/反确认告警 
摘要 :确认告警是将一条当前告警由未确认状态转换到已确认状态，表示维护人员已经获知该告警信息，并开始进行相应的处理。当前告警确认后，EMSPlus系统会在告警数据库中记录此次确认发生的时间、确认者、确认信息等相关信息。
告警反确认是告警确认的逆向操作。维护人员执行告警确认操作后，如果发现确认操作有误，可以使用该功能进行反确认，将告警状态恢复为未确认。
 说明： 
告警管理系统不提供历史告警的告警反确认操作、通知的告警确认和反确认操作。 
步骤 :在当前告警查询页面，根据不同情况，执行对应操作。 
如果...|那么...
---|---
需要确认告警|选中一条或多条Acknowledgement Status为Unacknowledged的告警信息，单击Acknowledge按钮，如图3所示。
需要反确认告警|选中一条或多条Acknowledgement Status为Acknowledged的告警信息，单击Unacknowledge按钮。
图3  确认告警

在弹出的确认对话框中，输入确认/反确认信息，并单击Submit按钮，如[图4]所示。
图4  确认对话框

##### 导出告警信息 
摘要 :摘要 :导出功能可以将查询到的当前告警、历史告警或通知信息导出为.csv格式的文件，导出的告警或通知信息是系统维护及故障分析的一种依据。在请求中兴通讯协助处理故障时，可能需要用户提供相关告警或通知信息。
本节以导出当前告警信息为例进行说明，历史告警、通知信息的导出操作与此类似。 
步骤 :在当前告警查询页面，选中需要导出的告警条目，单击Export按钮，如[图5]所示。
 说明： 
如果都不选中，则导出所有告警信息。由于通知查询页面没有选择框，所以只提供导出所有通知信息的操作。 
If no alarms are selected, all the alarms are exported. You cannot select the notifications to be exported, and thus all notifications are exported. 
图5  导出当前告警

文件将自动下载至本地。 
#### 设置告警过滤规则 
摘要 :告警过滤规则用于将符合条件的告警过滤掉，不在当前告警中显示。用户可以选择是否将被过滤的告警作为历史告警保存到告警数据库中。 
本节以设置告警过滤规则为例进行说明，设置通知过滤规则与此类似。 
步骤 :在EMSPlus客户端，单击告警管理，打开告警管理页面，如[图1]所示。
图1  告警管理页面

选择左侧菜单告警设置→告警规则设置
，打开查询告警规则设置页面，如[图2]所示。
图2  告警规则设置页面

（可选）单击告警过滤规则名称，可以查看到该规则的信息。 
单击新建按钮，打开设置过滤规则的参数信息页面，如[图3]所示。
图3  新增告警过滤规则

页面名称|参数名称|参数说明
---|---|---
Basic Information|Rule Name|过滤规则的名称。
Rule Description|Basic Information|过滤规则的描述信息。
Rule Status|Basic Information|过滤规则设置完成后的状态：Enable：表示规则设置完成后，该规则生效。Disable：表示规则设置完成后，该规则不生效。
Rule Type|Basic Information|过滤规则的类型：Alarm：表示创建告警过滤规则。Notify：表示创建通知过滤规则。
Severity|Basic Information|设置需要过滤的告警的级别。可以选择：Critical、Major、Minor、Warning；若不选，则匹配所有级别的告警。
Alarm Type|Basic Information|设置需要过滤的告警的类型。可以选择：Communication Alarm、Processing Alarm、QoS Alarm、Equipment Alarm和Environment Alarm；若不选，则匹配所有类型的告警。
Occurrence Time|Basic Information|设置需要过滤的告警的发生时间，由系统自动检索符合条件的告警；若不设置发生时间，则匹配所有时间段。
Whether to Save Filtered Alarm|Basic Information|设置是否将过滤的告警作为历史告警保存到告警数据库中。
Additional Information|Basic Information|可以根据输入的字符串模糊匹配告警的附加信息。
Information Related to System Type|System Type|设置需要过滤的告警的系统类型。可以选择：NE AlarmOMM System AlarmPeripheral Node AlarmNone
Alarm Code|Information Related to System Type|设置需要过滤的告警码，需要事先选择且只能选择一种系统类型，否则该页面无效。可供选择的告警码由System Type决定，若不选，则匹配所有告警码。
Selected Alarm Codes|Information Related to System Type|显示已选择的过滤告警码。
Filter Alarm Code|Information Related to System Type|已设置的过滤告警码。
设置过滤规则的条件信息，单击确定按钮，新增的规则将显示在告警过滤规则列表中。
#### 设置告警箱（可选） 
摘要 :告警箱用于统计并显示EMSPlus服务器上报的告警，并以声音、灯光、液晶显示、短消息发送等多种形式提示维护人员。
当需要连接一个新的告警箱时，需要在EMSPlus服务器上设置该告警箱的参数，EMSPlus根据设置的参数与告警箱建立连接，并将相应的告警信息转发给告警箱。
步骤 :在EMSPlus客户端，单击告警管理，打开告警管理页面，如[图1]所示。
图1  告警管理页面

选择左侧菜单告警设置→告警箱设置
，打开查询告警箱设置页面，如[图2]所示。
图2  查询所有当前告警页面

单击新建按钮，打开新增告警箱参数设置页面，如[图3]所示。
图3  新建告警箱页面

参数名称|参数说明
---|---
Alarm Box IP|配置告警箱的IP地址，该IP地址需要与EMSPlus服务器IP地址在同一网段。
Status|Disabled：表示告警箱设置完成后，禁止告警箱连接，该告警箱暂不开始工作。Enabled：表示告警箱设置完成后，允许告警箱连接，该告警箱即开始工作。
Minimum Acoustic-optic Display Level|配置需要告警箱发声发光的最低告警级别，如果EMSPlus当前告警中有等于或高于此级别的告警，告警箱会在液晶屏上显示并通过内置喇叭发声。告警级别可以选择：Critical、Major、Minor、Warning。
Send Short Message|No：表示告警发生时，不发送短信。Yes：表示告警发生时，发送短信给指定人员，选中后需设置Phone Number参数。
Minimum SMS Level|配置需要告警箱发送短信的最低告警级别，当新告警第一次产生时，如果级别大于或等于此级别，则发送短信。可以选择：Critical、Major、Minor、Warning。此功能只在新告警第一次产生时作用，即短信只在告警第一次产生时发送，后续不再发送。
Server Port|配置EMSPlus服务端用来与告警箱连接的端口号，取值范围：6000~65535之间的整数。
Phone Number|配置接收短信的手机号码。
设置增加告警箱的参数，单击确定按钮，新增的告警箱将显示在告警箱列表中。
## 缩略语 
## 缩略语 
CHR :Call History Record呼叫历史记录
### CN 
Core Network核心网
### CPU 
Central Processing Unit中央处理器
### CS 
Circuit Switched电路交换
### DPI 
Deep Packet Inspection深度包检测
EMS :Element Management System网元管理系统
### NAT 
Network Address Translation网络地址转换
### PS 
Packet Switched分组交换
ZTE :Zhongxing Telecommunications Equipment中兴通讯
## 版本管理功能 
特性描述 :术语 :术语|含义
---|---
EMSPlus|电信云及核心网增值网管。
MDS|消息分发服务，网元将消息发送到MDS，MDS将网元的消息分发到各个DCU上。
DCU|数据采集单元，DCU与具体网元对接，实现事实数据的接收与处理（清洗、聚集）。
DPU|负责数据的存储和查询，DPU采用GBase数据库。
MU|数据融合单元，负责数据的合并处理。
MAN|为整个EMSPlus提供配置数据管理和数据推送。
描述 :定义 :版本管理是为满足不同需求，对同一产品或系统进行局部的改进和改型所产生的产品或系统系列的变更情况进行记录、跟踪、维护和控制的过程。 
背景知识 :除了基本业务参数的配置，还需要版本管理将后台运行进程加载到虚机上，才能实现完整的EMSPlus网元功能。本文指导外场人员安装、升级、回滚、卸载EMSPlus网元相关模块的版本操作。 
应用场景 :本特性用于EMSPlus网元版本的安装、升级、卸载。 
客户收益 :

对运营商和用户的受益说明参见[表1]。


收益方|收益说明
---|---
运营商|完善EMSPlus网元功能，提高了产品的可靠性和易用性。
终端用户|此特性对终端用户不可见。


实现原理 :

系统架构 :EMSPlus系统由MAN、DPU、MDS、DCU、MU等模块组成，如[图1]所示。
图1  EMSPlus系统架构






涉及网元 :该特性由本网元单独实现，无需其他网元的配合。 


本网元实现 :xGW、CGNAT、FireWall日志话单的融合、清洗和入数据库。


业务流程 :本特性不涉及业务流程。 


系统影响 :

本特性不涉及对系统的影响。 


应用限制 :

本特性不涉及应用限制。 


特性间交互 :

本特性不涉及特性交互。 


遵循标准 :

本特性采用中兴公司内部的接口和协议，不涉及标准协议。 


特性能力 :

本特性不涉及规格指标。 


可获得性 :

版本要求及变更记录 :特性版本|发布版本|发布说明
---|---|---
01|V5.17.11|首次发布。


License要求 :该特性为EMSPLus网元的基本特性，无需License支持。 


对其他网元的要求 :本特性不涉及对其他网元的要求。 


O&M相关 :

命令 :本特性不涉及命令的变化。 


性能统计 :本特性不涉及计数器的变化。 


告警与通知 :本特性不涉及告警消息的变化。 


失败观察 :本特性不涉及失败观察的变化。 


##### 计费 
本特性不涉及话单与计费的变化。 


特性操作 :当需要对EMSPlus系统更新版本时，需要先更新MAN模块版本，再通过客户端更新其它模块的版本。 
#### MAN模块版本管理 
MAN模块的版本管理需要通过10287端口来完成。 
##### 安装新网元 
参见EMSPlus的“软件安装（AIC部署）
”安装新网元。
##### 更新网元 
摘要 :当网元版本升级时，更新网元的平台版本包文件。 
步骤 :在客户端PC的浏览器地址栏中输入https://<MAN节点EMS网络平面的双机浮动IP地址>:10287
，通过10287端口登录MAN节点，打开版本文件更新/删除页面，如[图1]所示。
omc用户的缺省密码为Emsplusomc_123。
图1  更新/删除版本文件

单击Update按钮，打开安装文件导入页面，如[图2]所示。
图2  导入安装文件

单击Click here to import，在弹出的对话框中选择更新的平台版本包，单击OK按钮，页面显示版本包导入进度，如[图3]所示。
图3  版本包导入进度

版本包导入完成，单击Return按钮，显示已上载的安装文件，如[图4]所示。
图4  选择安装文件

选择已上传的安装文件，单击按钮，显示基本设置页面，如[图5]所示。
图5  基本设置

配置版本升级的路径，其它选项缺省，不能修改。 
单击按钮，显示网元类型页面，如[图6]所示。
图6  网元类型

单击按钮，完成版本文件更新。
单击按钮退出。
##### 删除网元 
摘要 :删除不需要网元的平台版本包。 
步骤 :在客户端PC的浏览器地址栏中输入https://<MAN节点EMS网络平面的双机浮动IP地址>:10287
，通过10287端口登录MAN节点，打开版本文件更新/删除页面，如[图1]所示。
root用户的缺省密码为root123。
图1  更新/删除版本文件

单击Delete按钮，在弹出的对话框中单击OK按钮，执行删除操作，如[图2]所示。
图2  删除网元

#### 其它模块版本管理 
MDS、DCU、MU模块的版本管理需要通过2329端口登录WEB客户端后进行操作，该配置过程分为版本包管理和版本操作两部分。
##### 管理版本包 
摘要 :对平台版本包和网元版本包文件进行管理： 
上传、取消或删除版本包文件。 
重新加载或者删除已上传的版本包文件。 
###### 前提条件 
已通过[ADD COMMCFG]命令完成MDS、DCU、MU模块的环境参数配置。
步骤 :在客户端PC的浏览器地址栏中输入https://<MAN节点EMS网络平面的双机浮动IP地址>:2329
，登录到EMSPlus客户端窗口。
admin用户的缺省密码为Z_tywg_2019。
选择菜单System→Version Management→Package Management
，打开版本包管理页面，如[图1]所示。
图1  版本包管理

单击Select Files，弹出Open对话框。
在弹出的对话框中选择版本包文件，单击Open按钮，如[图2]所示。
版本包文件扩展名为pkg，分为平台版本包和网元版本包两种类型。
平台版本包：例如EMSPlus_PLAT_V5.18.12.B13.pkg，针对MDS和MU模块。 
网元版本包：例如EMSPlus_NE_V5.18.12.B13.pkg，针对DCU模块。图2  上传版本包 
单击版本包右侧的Upload按钮，或者按Upload
all按钮上传所有的版本包。
也可以单击Cancel或者Remove按钮，执行取消或删除版本包操作。
对已上传的版本包，如[图3]所示，单击Reload或Delete Packet按钮，执行重载或者删除操作。
图3  已上传版本包

##### 版本操作 
摘要 :安装、更新、回滚、卸载版本包。 
###### 前提条件 
已通过[ADD COMMCFG]命令完成MDS、DCU、MU模块的环境参数配置。
步骤 :在客户端PC的浏览器地址栏中输入https://<MAN节点EMS网络平面的双机浮动IP地址>:2329
，登录到EMSPlus客户端窗口。
admin用户的缺省密码为Z_tywg_2019。
选择菜单System→Version Management→Version Operation
，打开版本操作页面，如[图1]所示。
图1  版本操作

根据不同情况，执行对应操作。 
如果...|那么...
---|---
安装版本包|选择需要安装版本包的模块，单击Install按钮，模块自动匹配需要安装的版本包，按页面提示安装各个模块的版本包。
更新版本包|选择需要更新版本包的模块，单击Update按钮。
回滚版本包|选择需要回滚版本包的模块，单击Rollback按钮。
卸载版本包|选择需要卸载版本包的模块，单击Uninstall按钮。
## 缩略语 
## 缩略语 
DCU :Data Collection Unit数据采集单元
DPU :Data Processing Unit数据处理单元
MDS :Message Dispatch Service消息分发服务
MU :Merging Unit合并单元
### PC 
Personal Computer个人电脑
### xGW 
Extendable Gateway综合接入网关
## 虚拟化功能 
特性描述 :术语 :术语|含义
---|---
TECS|对计算、存储及网络虚拟资源进行管理与调度的云计算管理软件，包括NFVI和VIM。
VIM|虚拟化基础设施管理系统，主要负责基础设施层硬件资源、虚拟资源的管理，监控和故障上报，面向上层应用提供虚拟化资源池。
NFVO|网络功能虚拟化编排器，负责全网的网络服务、虚拟资源以及物理资源的编排和管理功能。
VNFM|虚拟化的网络功能管理器，负责对网元提供生命周期管理，以及弹性伸缩相关的虚机操作管理功能。
VNF|虚拟化的网络功能，即虚拟网元。在通信网络中，代表提供某个特定网络功能或服务的载体。
VM|一种虚拟化的计算环境中，与实体电脑/服务器功能行为非常相似。
描述 :定义 :虚拟化功能是指计算机元件在虚拟的基础上而不是真实的基础上运行，是一个为了简化管理，优化资源的解决方案。用户只需简单输入参数，就能完成整套EMSPlus开通，并完成基础配置工作。
背景知识 :EMSPlus开通时，设计虚机数量多，手动启动虚机费时费力，引入虚拟化生命周期管理功能，实现一键开通整套EMSPlus，大大减少了开局时间。
应用场景 :

底层平台部署完毕，CloudStudio部署完毕。通过在NFVO上传镜像包和版本包，实现一键开通。


客户收益 :对运营商和用户的受益说明参见[表1]。
收益方|收益说明
---|---
运营商|节约开局成本。
终端用户|此特性对终端用户不可见。
实现原理 :

系统架构 :图1  系统架构




EMSPlus属于VNF的一种，每种VNF包含很多模块类型，包括MAN、DCU、MDS、DPU等。


涉及网元 :涉及的网元及其功能参见[表1]。
网元|描述
---|---
TECS底层云平台|负责提供硬件虚拟化资源。
CloudStudio编排平台|负责EMSPlus网元业务编排、虚机创建等。


本网元实现 :通过在NFVO上注册版本，填写输入参数后，一键完成整套网元开通工作。简化开通流程，节约开局时间，减少不必要的错误。


业务流程 :图2  业务流程






系统影响 :

该特性不涉及对系统的影响。 


应用限制 :

该特性不涉及应用限制。 


特性间交互 :

该特性不涉及与其他特性的交互。 


遵循标准 :

版本包制作符合TOSCA规范。


特性能力 :

该特性不涉及规格指标。 


可获得性 :

版本要求及变更记录 :特性版本|发布版本|发布说明
---|---|---
01|V5.17.11|首次发布。


License要求 :开局MAN节点为HA集群时，需要HA license支持。


对其他网元的要求 :CloudStudio、TECS需要最新发布版本。 


O&M相关 :

命令 :该特性不涉及命令变化。 


性能统计 :该特性不涉及计数器的变化。 


告警与通知 :该特性不涉及告警消息的变化。 


失败观察 :该特性不涉及业务观察/失败观察的变化。 


##### 计费 
该特性不涉及话单与计费的变化。 


特性配置 :

本特性的相关操作参见“软件安装
”。


## 缩略语 
## 缩略语 
DCU :Data Collection Unit数据采集单元
DPU :Data Processing Unit数据处理单元
### HA 
High Availability高可用性
MDS :Message Dispatch Service消息分发服务
### NFVI 
Network Functions Virtualization Infrastructure网络功能虚拟化基础设施
NFVO :Network Functions Virtualization Orchestrator网络功能虚拟化编排器
### TECS 
Tulip Elastic Cloud System郁金香弹性云系统
### TOSCA 
Topology and Orchestration Specification for Cloud
Applications云应用的拓扑和编排规范
VIM :Virtualized Infrastructure Manager虚拟化基础设施管理系统
VM :Virtual Machine虚拟机
VNF :Virtualized Network Function虚拟化网络功能
VNFM :Virtualized Network Function Manager虚拟化网络功能管理器
## 维度导入导出功能 
特性描述 :术语 :术语|含义
---|---
事实表|网元系统中原始的数据记录。
聚集表|按照一定的时间粒度和维度聚集事实表中的数据，从而形成聚集表。
维度表|维度表描述维度信息，例如小区维度表。
描述 :
描述 :


定义 :



维度导入导出功能可以快速导入或导出数据。EMSPlus提供了维度表文件导入前的合法性校验功能，防止无效数据或错误数据被导入到数据库中。






背景知识 :



维度表文件导入功能中，可以选择覆盖或追加模式导入，同时还提供了合法性校验功能。用户可以在维度表文件导入前只验证文件的正确性而不导入数据，并提示系统校验结果，以便让用户将数据文件修改正确。 


导出功能支持导出模板和维度表。 




应用场景 :

本特性用于导入导出维度表数据，一般在现场导入，由运营商提供或者ZTE提供维度表文件。


客户收益 :

收益者|收益描述
---|---
运营商|验证数据的准确性，为现场提供快速的维度数据导入导出。
终端用户|此特性对终端用户不可见


实现原理 :
实现原理 :


系统架构 :



EMSPlus系统的报表功能，主要是根据报表模型将事实表和聚集表中的数据以图表的方式展示给用户，如[图1]所示。


图1  系统报表图








涉及的网元 :该特性由本网元单独实现，无需其他网元的配合。 


本网元实现 :



维度导入导出涉及到的功能点： 



 
导出功能：支持对维度表所有数据的导出，支持对维度表模板的导出。 

 
导入功能：根据维度表模板文件制作好的数据导入到EMSPlus系统，后台对应将数据格式化后，通过数据库命令方式导入到数据库。 

 
配置功能：通过人机命令方式对维度表的记录进行增加、删除、修改和查询操作。 

 






业务流程 :



此功能由COMM平台实现，EMSPlus无业务流程。




系统影响 :该特性不涉及对系统的影响。 
应用限制 :该特性不涉及应用限制。 
特性交互 :该特性不涉及与其他特性的交互。 
遵循标准 :本特性采用中兴通讯内部的接口和协议，不涉及标准协议。 
特性能力 :该特性不涉及规格指标。 
可获得性 :可获得性 :

版本要求及变更记录 :



特性版本|发布版本|发布说明
---|---|---
01|V5.17.10|首次发布






License要求 :



该特性为EMSPlus网元的基本特性，无需License支持。




对其他网元的要求 :该特性不涉及对其他网元的要求。 
O&M相关 :O&M相关 :

命令 :



编号|命令名称|命令描述
---|---|---
1|EXP DIMTABLEDATA|导出维度表数据
2|IMP DIMTABLEDATA|导入维度表数据




性能统计 :该特性不涉及计数器的变化。 
告警和通知 :该特性不涉及告警消息的变化。 
业务观察/失败观察 :该特性不涉及业务观察/失败观察的变化。 
话单与计费 :该特性不涉及话单与计费的变化。 
特性配置 :配置特性 :配置说明 :下载维度表模板，添加相关数据并导入到数据库。 
维度表名称|用途|备注
---|---|---
CI|配置CI相关维度信息|也可使用ADD   CI命令进行配置
CI Group|配置CI组相关维度信息|也可使用ADD   CIGROUP命令进行配置
User Group|配置用户组相关维度信息|也可使用ADD   USERGRP命令进行配置
User Group   Detail|配置用户组中用户的相关维度信息|也可使用ADD   USERGRPDETAIL命令进行配置
NE Group|配置网元组相关维度信息|也可使用ADD   NEGRP命令进行配置
NE Group Detail|配置网元组中网元的相关维度信息|也可使用ADD   NEGRPDETAIL命令进行配置
Terminal|配置用户终端相关维度信息|也可使用ADD   NEGRPDETAIL、ADD   TERMINAL OS、ADD TERMINAL MODEL、ADD TERMINAL命令进行配置
Application|配置应用相关维度信息|Application维度为版本文件预置，无法通过命令行新增应用相关维度信息
VIP|配置VIP用户相关维度信息|也可使用ADD   VIPUSER命令进行配置
RoamPLMN|配置漫游PLMN相关维度信息|也可使用ADD ROAMPLMN命令进行配置
配置前提 :模板文件可下载，相关列正确。 
配置过程 :



通过Web界面登录到EMSPlus客户端窗口。 


在维度导入导出页面下载维度表模板。 


通过模板制作维度表文件。 


选择覆盖或追加模式导入维度表文件。 


导出维度表数据。 




配置实例 :场景说明 :根据现场需求，制作并导入维度表文件。 
配置步骤 :在EMSPlus客户端，选择菜单System→Import/Export
，进入维度导入导出页面，如[图1]所示。
图1  Export Dimension 页面

在Export Dimension区域，单击维度表Operation栏中的Download Template按钮，下载维度表模板。
根据现场需求，通过模板制作维度表文件。 
在Import Dimension区域，单击Select
File按钮，在弹出的对话框中选择维度表文件，如[图2]所示。
图2  导入维度表文件

参数名称|参数解释
---|---
Import Pattern|维度表文件导入模式，用户可以选择覆盖或追加模式导入。
Check Pattern|用户可以选择仅验证文件正确性而不导入数据，或者验证文件正确性并导入数据。
单击Submit All按钮，导入维度表文件，Import
Result区域框显示导入结果。
单击Export Dimension区域框中维度表的Export Data按钮，可以导出维度表数据。
测试用例 :

测试项|验证主键为空是否导入成功
---|---
预置条件|dim_cigroup_oper表的RAT字段值为空。|dim_cigroup_oper表的RAT字段值为空。|dim_cigroup_oper表的RAT字段值为空。
操作过程|选择需要导入的数据文件，单击Submit。|选择需要导入的数据文件，单击Submit。|选择需要导入的数据文件，单击Submit。
预期结果|提示RAT列行值为空。|提示RAT列行值为空。|提示RAT列行值为空。
实际结果|同预期结果|同预期结果|同预期结果
注意事项|||
签名||测试日期|


常见问题处理 :##### 维度数据文件导入失败 


在导入文件之前，确认制作的文件符合要求，如文件的版本号、列类型、列大小或长度、非空值、主关键字唯一性。 


##### 如何查看报错信息 


服务端根据校验规则进行数据文件的校验。当发生错误时，系统将具体信息给用户提示，便于用户进行改正。 


Import Result区域框中可以查看错误信息。


##### 错误记录不完整 


对于页面提示的错误信息，错误信息包含行和列信息。当错误不止一处时，最多可以提示20条记录，如果超过20条错误，校验结束。 


## 缩略语 
## 缩略语 
### PC 
Personal Computer个人电脑
ZTE :Zhongxing Telecommunications Equipment中兴通讯
## 虚拟化缩扩容功能 
特性描述 :术语 :术语|含义
---|---
MDS|消息分发服务，网元将消息发送到MDS，MDS将网元的消息分发到各个DCU上。
DCU|数据采集单元，与具体网元对接，实现事实数据的接收与处理（清洗、聚集）。
DPU|负责数据的存储和查询，采用GBase数据库。
ASC|数据融合单元，将从C面（控制面）和U面（媒体面）来的数据按照一定的规则合并。
MAN|为整个EMSPlus提供配置数据管理和进行数据推送。
FTU|文件转换单元，将文件接口的日志转换为消息接口的消息发送给MDS。
描述 :

定义 :缩扩容是指通过重新扩大或者减少虚机规格，包括虚机数量和虚机虚拟资源规格，满足现场对于虚拟资源需求的变化。 


背景知识 :外场用户数量和业务量日益增大，在外场环境调整虚机数量和虚机虚拟资源规格，原则上只能在不影响正常业务的条件下进行。不能采用重新实例化业务网元的方式，只能采用缩扩容方式进行操作。 


应用场景 :在缩扩容场景下，当前实例化的VNF最大能力已经不能满足现场需求，需要重新扩大虚机规格，包括虚机数量和虚机虚拟资源规格。比如VNF实例化按照200 W用户容量开局，而当前局点用户已经超过200
W，必须扩容加大VNF部署规格，重新生成新容量下的所有虚机信息。
客户收益 :

受益方|收益说明
---|---
运营商|减少设备投资，提高设备运行安全性和可靠性。
终端用户|此特性对终端用户不可见。


实现原理 :系统架构 :EMSPlus的系统架构如[图1]所示。
图1  系统架构

EMSPlus各节点的虚机规格模型是通过NFVO下发到VIM，从而由VIM分配虚机资源，创建虚机，然后在虚机上运行EMSPlus节点的多个内部组件，节点的生命周期由VNFM管理。
涉及网元 :该特性由本网元单独实现，无需其他网元的配合。 
本网元实现 :通过与VNFM交互，实现EMSPlus的MDS、DCU、DPU、FTU、ASC节点的扩缩容，满足当前业务需求。
业务流程 :CloudStudio在线缩扩容机制，整体流程如[图2]所示（图中虚框内是需要EMSPlus产品实现的部分）。
图2  VNF缩扩容流程图

系统影响 :

本特性对系统容量有影响，可在线增大虚机的数量。 


应用限制 :目前只支持扩容，缩容暂不考虑。 
目前只支持FTU、MDS、MU、DCU、DPU、ASC的扩容，不支持MAN扩容。 
DPU是数据库模块，不支持和其它业务模块同时扩容，需要单独扩容。 
扩容基于正在运行系统。 
扩容仅支持虚机数量扩容，不支持虚拟资源扩容。 
特性间交互 :

该特性不涉及与其他特性的交互。 


遵循标准 :本特性采用中兴通讯内部的接口和协议，不涉及标准协议。 
特性能力 :

该特性不涉及规格指标。 


可获得性 :版本要求及变更记录 :特性版本|发布版本|发布说明
---|---|---
01|V5.18.10|首次发布。
License要求 :该特性为EMSPlus网元的基本特性，无需License支持。
对其他网元的要求 :该特性对其它网元无要求。 
O&M相关 :

命令 :本特性不涉及命令的变化。 


性能统计 :该特性不涉及计数器的变化。 


告警与通知 :该特性不涉及告警消息的变化。 


失败观察 :该特性不涉及业务观察/失败观察的变化。 


话单与计费 :该特性不涉及话单与计费的变化。 


特性操作 :FTU、MDS、DCU、DPU、ASC节点扩容时，如果虚机扩容失败，则根据不同情况，进行不同的操作。
虚机扩容失败有两种情况： 
虚机创建失败，MANO返回失败，会有自动回滚操作，用户不需要进行回滚操作。 
虚机创建部分成功，部分失败，MANO返回成功，EMSPlus会给MANO返回扩容失败，但MANO只要创建了虚机，就认为扩容的流程是成功的，如图1所示。因此MANO是不会自动回滚，用户需要手动进行回滚操作，参见“MANO为V5.20.12.B6之前版本回退操作”。 
图1  任务查看

#### 扩容磁阵 
摘要 :当虚机对应的云硬盘类型所在的磁阵空间不足时，扩容磁阵。 
前提 :磁阵的RAID类型已配置为RAID 5。
相关信息 :优先扩容EMSPlus系统。 
如无法优先扩容EMSPlus系统，建议其它网元指定云硬盘类型。 
如果在扩容时DPU的数据库盘创建失败，须要检查对应的云硬盘类型所在的磁阵空间是否被其它VNF占用，如果被其它VNF占用，须要相应VNF释放磁阵空间。 
步骤 :新增磁阵柜添加到TECS存储池，具体操作参考TECS开通文档，不同磁阵参考对应的指导手册，例如KS3200磁阵参考《vCN磁阵配置指导手册（ZTE
KS3200)）》。
在TECS建立磁阵和云硬盘类型的对应关系，参考TECS开通手册。 
#### 上传csar包 
摘要 :扩容操作前，需要上传和当前系统正在使用的相同版本的csar包。
步骤 :在客户端PC的浏览器地址栏中输入https://<MAN节点EMS网络平面的双机浮动IP地址:2329
，登录到EMSPlus客户端窗口。
选择菜单System→Version Management→Version Operation
，查看当前系统正在使用的版本号，如[图1]所示。
图1  查看版本号

切换到菜单Package Management
，进入版本包管理页面，如[图2]所示。
图2  版本包管理

单击Select Files按钮，在弹出的对话框中选择和当前系统使用的相同版本的.csar包，并单击Upload按钮，如[图3]所示。
图3  上传csar软件包

#### 扩容FTU/MDS/DCU/ASC 
#### 扩容FTU/MDS/DCU/ASC 
本节介绍FTU、MDS、DCU、ASC的扩容，目前EMSPlus仅支持扩容操作，不支持缩容操作。
##### 创建虚机 
摘要 :在NFVO客户端创建用于扩容的虚机。
步骤 :在客户端打开Google Chrome浏览器，在地址栏输入https://NFVO服务端IP:28808/nfvo-mano-portal
，登录CloudStudio系统的NFVO客户端窗口。
选择菜单编排→应用→VNF
，进入VNF列表页面，如[图1]所示。
图1  VNF列表

单击需要扩容虚机的更多按钮，选择下拉菜单容量调整，进入容量调整配置页面，页面显示原有虚机的各项配置，如[图2]所示。
图2  缩扩容配置

在虚机配置/虚机个数区域中，修改需要扩容的FTU、DCU、MDS、ASC虚机的个数，其他参数不需要修改，如[图3]所示。
如果同时扩容FTU、DCU、MDS和ASC类型虚机，则同时修改FTU、DCU、MDS、ASC的虚机数。例如将DCU虚机数由4修改为6，将MDS虚机数由2修改为4，将ASC虚机数由3修改为5，将FTU虚机数由2修改为4。 
如果只扩容DCU、MDS、FTU或ASC某一类型虚机，则只需要修改该类型虚机数。例如只扩容DCU，可以将DCU虚机数由4修改为6，不修改FTU、MDS和ASC的虚机数。 
 说明： 
目前仅支持虚机数量的扩容，不支持虚机虚拟资源规格的扩容。 
图3  修改虚机数

如果扩容MDS，在网络配置/BOSS网络平面配置区域中，是否启用为YES时，则需要配置MDS虚机的BOSS IP地址。在BOSS IP列表的已有地址后新增IP地址，IP之间使用英文逗号分隔，该区域其他参数不需要修改，如[图4]所示。
扩容几个MDS虚机数，需要新增几个BOSS IP地址，IP地址参见MDS节点的地址规划。 
图4  修改BOSS网络平面的IP地址

如果扩容MDS，在网络配置/GI网络平面配置区域中，是否启用为YES时，则需要配置MDS虚机的GI IP地址。在MDS GI IP列表的已有地址后新增IP地址，IP之间使用英文逗号分隔，该区域其他参数不需要修改，如[图5]所示。
扩容几个MDS虚机数，需要新增几个GI IP地址，IP地址参见MDS节点的地址规划。 
图5  修改GI网络平面的IP地址

如果扩容MDS，在网络配置/Firewall网络平面配置区域中，是否启用为YES时，则需要配置MDS虚机的Firewall IP地址。在Firewall IP列表的已有地址后新增IP地址，IP之间使用英文逗号分隔，该区域其他参数不需要修改，如[图6]所示。
扩容几个MDS虚机数，需要新增几个Firewall IP地址，IP地址参见MDS节点的地址规划。 
图6  修改Firewall网络平面的IP地址

如果扩容DCU，在网络配置/北向网络平面配置区域中，是否启用为YES时，则需要配置DCU虚机的北向网络平面IP地址。在北向输出IP列表的已有地址后新增IP地址，IP之间使用英文逗号分隔，该区域其他参数不需要修改，如[图7]所示。
扩容几个DCU虚机数，需要新增几个北向输出IP地址，IP地址参见DCU节点的地址规划。 
图7  修改北向网络平面的IP地址

如果扩容FTU，在网络配置/FTU网络平面配置区域中，是否启用为YES时，则需要配置FTU虚机的IP地址。在FTU浮动IP列表、FTU主机IP列表、FTU备机IP列表的已有地址后新增IP地址，IP之间使用英文逗号分隔，该区域其他参数不需要修改，如[图8]所示。
当FTU使用ZTE_EMSPLUS_BOSS_NET平面时，则扩容几个FTU虚机数，需要新增几个FTU的浮动、主机、备机的BOSS平面IP地址，IP地址参见FTU节点的地址规划。
图8  修改FTU网络平面的IP地址

如果扩容FTU，在网络配置/GI网络平面配置区域中，是否启用为YES时，则需要配置FTU虚机的GI IP地址。在FTU浮动GI IP列表、FTU主机GI IP列表、FTU备机GI IP列表的已有地址后新增IP地址，IP之间使用英文逗号分隔，该区域其他参数不需要修改，如[图9]所示。
扩容几个FTU虚机数，就需要新增几个FTU的浮动、主机、备机IP地址，IP地址参见FTU节点的地址规划。 
图9  修改GI网络平面的IP地址

在公共配置/数据盘区域中，如果原有硬盘类型为volume，且扩容的新虚机数据盘使用不同的云硬盘类型时，修改云硬盘类型参数。清空原有云硬盘类型，依次输入新扩容DCU虚机、MDS虚机、ASC虚机、FTU虚机数据盘挂载的云硬盘类型（每个虚机数据盘都挂载一个云硬盘类型），云硬盘类型之间使用英文逗号分隔，该区域其他参数不需要修改，如[图10]所示。
例如： 
只扩容两个DCU虚机。如果DCU虚机数据盘分别挂载云硬盘类型emsplus_vol_02和emsplus_vol_03，则云硬盘类型参数修改为emsplus_vol_02,emsplus_vol_03。 
扩容两个DCU虚机和一个MDS虚机。如果两个DCU虚机数据盘都挂载云硬盘类型emsplus_vol_02，MDS虚机数据盘挂载云硬盘类型emsplus_vol_03，则云硬盘类型参数修改为emsplus_vol_02,emsplus_vol_02,emsplus_vol_03。如果两个DCU虚机数据盘分别挂载云硬盘类型emsplus_vol_02和emsplus_vol_03，MDS虚机数据盘挂载云硬盘类型emsplus_vol_04，则云硬盘类型参数修改为emsplus_vol_02,emsplus_vol_03,emsplus_vol_04。 
图10  修改云硬盘类型

升级后再扩容的场景，镜像有变更，需要在inputs界面填写升级后版本对应的镜像名称。 
在公共配置区域中，镜像名称填为升级后版本对应的镜像名称
图11  扩容时填写镜像名称

单击提交按钮，虚机创建成功，进度条显示100%，表示扩容虚机成功，如[图12]所示。
图12  缩扩容结果

##### 扩容节点 
摘要 :在EMSPlus客户端扩容DCU、MDS、ASC、FTU节点，安装EMSPlus各模块的业务。
步骤 :在客户端PC的浏览器地址栏中输入https://<MAN节点EMS网络平面的双机浮动IP地址>:2329，登录到EMSPlus客户端窗口。
选择菜单System→Expansion Management
，检查扩容前后的虚机数量是否有误，如[图13]所示。
图13  扩容管理

虚机数量无误后，单击Expansion，弹出密码输入对话框，如[图14]所示。
图14  密码输入对话框

输入客户端的登录密码，单击OK。
等待EMSPlus各模块业务安装，完成DCU、MDS、ASC、FTU节点扩容。
图15  节点扩容结果

##### 验证扩容结果 
摘要 :查询EMSPlus系统中的模块，验证扩容是否成功。
步骤 :在客户端PC的浏览器地址栏中输入https://<MAN节点EMS网络平面的双机浮动IP地址>:2329，登录到EMSPlus客户端窗口。
选择菜单System→MML Terminal
，执行[SHOW MOUDLE]命令，检查扩容后节点数是否正确，如[图16]所示。
图16  验证扩容结果

##### 更新业务配置 
节点扩容完成后，需要根据现场实际情况，将原有配置更新到扩容节点上，详细参见网元对接配置
。
##### DCU扩容后更新北向配置 
摘要 :如果EMSPlus已经开启分布式北向功能，需要在DCU扩容后，更新北向配置，将北向模板同步到新扩容出来的DCU上。
步骤 :在客户端PC的浏览器地址栏中输入https://<MAN节点EMS网络平面的双机浮动IP地址:>2329，登录到EMSPlus客户端窗口。
选择菜单System→MML Terminal
，执行[SHOW DISTRIBUTENORTH]命令，查询北向任务是否存在，如[图17]所示。
 说明： 
如果查询记录数为空，说明该局点EMSPlus未开启北向功能，不再执行以下的操作。 
如果现场需要EMSPlus开启北向功能，可以导入北向任务配置文件，参见相关任务。 
图17  查询北向任务查询北向任务SHOW DISTRIBUTENORTH

选择菜单System→Import/Export
，切换到NorthBound页签，如[图18]所示。
图18  NorthBound

单击Reload All按钮，将北向模板分发到扩容出来的DCU上。
相关任务 :如果EMSPlus实例化时没有开启北向网络平面选项，现场需要EMSPlus开启北向功能，可以在扩容的DCU虚机上依次增加北向IP。
选择菜单System→Import/Export
，切换到NorthBound页签，如[图19]所示。
图19  NorthBound

单击Select File按钮，在弹出的对话框中选择北向任务配置文件（例如DCU_MU.zip），配置文件显示在Import Template区域框，如[图20]所示。
图20  选择北向任务配置文件

单击Submit按钮，导入北向任务配置文件，如[图21]所示。
图21  导入北向任务配置文件

#### 扩容DPU 
#### 扩容DPU 
本节介绍DPU的扩容，目前EMSPlus仅支持扩容操作，不支持缩容操作。
 小心！ 
二次扩容DPU之前，需要手工完成DPU Rebalance，否则不许扩容。详细操作参见“[配置DPU Rebalance（可选）]”
。
##### 创建虚机 
摘要 :在NFVO客户端创建用于扩容的虚机。
步骤 :在客户端打开Google Chrome浏览器，在地址栏输入https://NFVO服务端IP:28808/nfvo-mano-portal
，登录CloudStudio系统的NFVO客户端窗口。
选择菜单编排→应用→VNF
，进入VNF列表页面，如[图1]所示。
图1  VNF列表

单击需要扩容虚机的更多按钮，选择下拉菜单容量调整，进入容量调整配置页面，页面显示原有虚机的各项配置，如[图2]所示。
图2  缩扩容配置

在虚机配置/虚机个数区域中，修改DPU的虚机数量，DPU虚机数至少增加2个虚机。例如虚拟机个数由4修改为6，其他参数不需要修改，如[图3]所示。
 说明： 
目前仅支持虚机数量的扩容，不支持虚机虚拟资源规格的扩容。 
图3  修改DPU虚机数

在公共配置/数据盘区域中，如果原有硬盘类型为volume，且扩容的新虚机数据盘使用不同的云硬盘类型时，修改云硬盘类型参数。清空原有云硬盘类型，依次输入新扩容DPU虚机数据盘挂载的云硬盘类型（每个虚机数据盘都挂载一个云硬盘类型），云硬盘类型之间使用英文逗号分隔，该区域其他参数不需要修改，如[图4]所示。
例如扩容两个DPU虚机： 
如果两个DPU虚机数据盘都挂载云硬盘类型emsplus_vol_02，则云硬盘类型参数修改为emsplus_vol_02,emsplus_vol_02。 
如果两个DPU虚机数据盘分别挂载云硬盘类型emsplus_vol_02和emsplus_vol_03，则云硬盘类型参数修改为emsplus_vol_02,emsplus_vol_03。 
图4  修改数据盘

如果扩容的新虚机数据库盘使用不同的云硬盘类型，在公共配置/数据库盘区域中，修改云硬盘类型参数。清空原有云硬盘类型，依次输入新扩容DPU虚机数据库盘挂载的云硬盘类型，输入的云硬盘类型的数量为“扩容DPU虚机数”×每虚机数据库盘数量，云硬盘类型之间使用英文逗号分隔，该区域其他参数不需要修改，如[图5]所示。
每个虚机的每个数据库盘都挂载一个云硬盘类型，同一个DPU下多个数据库盘挂载的云硬盘类型相同。 
例如： 
扩容两个DPU虚机，每虚机数据库盘数量参数为1。如果两个DPU虚机数据库盘都挂载云硬盘类型emsplus_vol_02，则云硬盘类型参数修改为emsplus_vol_02,emsplus_vol_02。如果两个DPU虚机数据库盘分别挂载云硬盘类型emsplus_vol_02和emsplus_vol_03，则云硬盘类型参数修改为emsplus_vol_02,emsplus_vol_03。 
扩容两个DPU虚机，每虚机数据库盘数量参数为2。如果第一个DPU虚机两个数据库盘都挂载云硬盘类型emsplus_vol_02，第二个DPU虚机两个数据库盘都挂载云硬盘类型emsplus_vol_03，则云硬盘类型参数修改为emsplus_vol_02,emsplus_vol_02,emsplus_vol_03,emsplus_vol_03。 
图5  修改数据库盘

升级后再扩容的场景，镜像有变更，需要在inputs界面填写升级后版本对应的镜像名称。 
在公共配置区域中，镜像名称填为升级后版本对应的镜像名称
图6  扩容时填写镜像名称

单击提交按钮，虚机创建成功，进度条显示100%，表示扩容虚机成功，如[图7]所示。
图7  缩扩容结果

##### 扩容节点 
摘要 :在EMSPlus客户端扩容DPU节点，安装EMSPlus各模块的业务。
步骤 :在客户端PC的浏览器地址栏中输入https://<MAN节点EMS网络平面的双机浮动IP地址>:2329，登录到EMSPlus客户端窗口。
单击导航栏System，选择菜单Version Management→Expansion Management
，检查扩容前后的虚机数量是否有误，如[图8]所示。
图8  扩容管理

虚机数量无误后，单击Expansion，弹出密码输入对话框，如[图9]所示。
图9  密码输入对话框

输入客户端的登录密码，单击OK。
等待EMSPlus各模块业务安装，完成DPU节点扩容。
图10  节点扩容结果

##### 验证扩容结果 
摘要 :查询EMSPlus系统中的模块，验证扩容是否成功。
步骤 :在客户端PC的浏览器地址栏中输入https://<MAN节点EMS网络平面的双机浮动IP地址>:2329，登录到EMSPlus客户端窗口。
选择菜单System→MML Terminal
，执行[SHOW MOUDLE]命令，检查扩容后节点数是否正确，如[图11]所示。
图11  验证扩容结果

##### 配置DPU Rebalance（可选） 
摘要 :DPU集群扩容功能是基于distribution和rebalance功能实现。一个DPU集群同时可以创建两个distribution。安装完集群后需要创建一个distribution，并且生成hashmap后集群才可以正常使用。
当对集群进行扩容时，需要创建第二个distribution和hashmap，再执行[rebalance]命令将集群中的表扩容到第二个distribution上。
 说明： 
联系ZTE技术支持人员确认，是否需要执行DPU rebalance操作。
步骤 :SSH方式登录到任意DPU控制节点后，执行以下命令。
`[omc@man2 logs]$ ssh 172.168.20.11
[omc@dpuc1 ~]$ su gbase
[gbase@dpuc1 omc]$ gccli -uroot
gbase> set global gcluster_rebalancing_concurrent_count = 0;
gbase> rebalance instance;
gbase> set global gcluster_rebalancing_concurrent_count = 1;` 
[gcluster_rebalancing_concurrent_count]默认为1，具体联系ZTE确认。
此时DPU集群将开始进行数据表重新分布操作，通过查询表gclusterdb.rebalancing_status跟踪进度。
`gbase> select * from gclusterdb.rebalancing_status;` 
gclusterdb.rebalancing_status的表结构参见[表1]。
字段名|字段类型|字段含义
---|---|---
index_name|varchar(129)|数据库名.表名
db_name|varchar(64)|数据库名
table_name|varchar(64)|表名
tmptable|varchar(129)|rebalance任务执行时使用的中间表名称如果不使用中间表，那么该字段值为NULL
start_time|datetime|在STARTING状态时，表示任务加入的时间在RUNNING状态时，start_time表示任务更改为RUNNING的时间
end_time|datetime|表示rebalance任务结束的时间
status|varchar(32)|表示rebalance任务的当前状态
percentage|int(11)|表示rebalance任务的执行进度
priority|int(11)|表示rebalance任务的优先级，值最小的优先执行
host|varchar(32)|表示rebalance任务被哪个coordinator节点执行
distribution_id|bigint(8)|表示rebalance任务要把表rebalance到哪个distribution ID
当所有表的status为COMPLETED时，表示迁移成功，如[图12]所示。
图12  迁移成功

删除hashmap和distribution。 
执行[gcadmin showdistribution]命令，查询old distribution节点号，如下所示，样例old节点为1。
`[gbase@dpuc1 omc]$ gcadmin showdistribution
 
              Distribution ID: 2 | State: new | Total segment num: 3
 
    Primary Segment Node IP         Segment ID         Duplicate Segment node IP
=============================================================
|       172.168.186.8          |       1          |        172.168.186.9           |
-------------------------------------------------------------------------------------------------------
|       172.168.186.9          |       2          |        172.168.186.7           |
-------------------------------------------------------------------------------------------------------
|       172.168.186.7          |       3          |        172.168.186.8           |
=============================================================
 
              Distribution ID: 1 | State: old | Total segment num: 1
 
    Primary Segment Node IP         Segment ID         Duplicate Segment node IP
=============================================================
|       172.168.186.7          |       1          |                                |
=============================================================` 
删除上述old hashmap节点。 
`[gbase@dpuc1 omc]$ gccli -uroot
gbase> refreshnodedatamap drop 1;
Query OK, 0 rows affected (Elapsed: 00:00:17.95)
gbase> quit
` 
[refreshnodedatamap drop 1]，把ID为1的hashmap删除。
如果有用户表正在使用hashmap 1，那么[refreshnodedatamap drop 1]将报错。必须等所有的用户表都已经rebalance到新的distribution时才可以删除老的hashmap和distribution。只有hashmap 1删除成功，才可以删除ID为1的distribution。
删除distribution的命令如下所示。 
`[gbase@dpuc1 omc]$ gcadmin rmdistribution 1
cluster distribution ID [1]
it will be removed now
please ensure this is ok, input y or n: y   [输入y确认]
gcadmin remove distribution [1] success` 
#### 回滚操作 
##### MANO为V5.20.12.B6之前版本回退操作 
摘要 :EMSPlus的虚机扩容操作失败，但是MANO已经成功创建了虚机，用户需要手动进行扩容回退操作。
本文的TECS界面仅供参考。
步骤 :登录到VNFM客户端的/home/mano/ngomm/vnfm_1/ftpvnf/vnfd/73dce03b-6a65-4e9c-a870-27b37f5a79ae路径。EMSPlus虚机扩容操作会在该路径下生成一个vnfd_model_bak.json文件，如[图1]所示。
图1  vnfd_model_bak.json文件

将vnfd_model_bak.json文件名修改为vnfd_model.json，并覆盖到/home/mano/ngomm/vnfm_1/ftpvnf/vnfd/73dce03b-6a65-4e9c-a870-27b37f5a79ae/base文件夹下的同名文件。
登录到TECS客户端，选择菜单虚拟资源→云主机
，在云主机列表中查找MANO扩容时创建的虚机，如[图2]所示。
图2  TECS客户端

单击该虚机的选择操作下拉列表框，选择删除云主机，如[图3]所示。
图3  删除虚机

##### MANO为V5.20.12.B6及之后版本回退操作 
摘要 :EMSPlus在进行扩容时，扩容失败情况需要在MANO上进行整体回退操作,对于创建出部分虚机成功的情况，需要在MANO上删除虚机，同时需要在虚拟化平台上删除未创建成功的虚机资源(主要包括网络端口和云硬盘)，本文以TECS虚拟化平台举例。本文的MANO和TESC界面仅供参考。 
步骤 :执行前准备失败回退
在扩容失败界面点击“整体回退”按钮。如截图： 
图1  扩容前准备失败

输入验证码，如截图： 
图2  扩容前准备失败整体回退输入验证码

回退成功。如截图： 
图3  前置失败回退成功

执行失败
在扩容时，部分虚机创建成功，会在执行步骤中失败，在界面点击“整体回退”按钮。如截图： 
图4  创建虚机部分成功执行失败

输入验证码，如截图： 
图5  扩容执行后检查 失败整体回退输入验证码

回退成功。如截图： 
图6  执行失败，回退成功

在执行后检查失败时，已经有新的虚机创建，需要在MANO上，虚机管理页面将新扩容的虚机删除。登录MANO点击EMSPlus局点，如需要操作emsp39局，点击emsp39，如截图： 
图7  操作扩容的emsp39局

进入虚机管理后，在需要删除的虚机名称后的操作中，点击需要删除的虚机。如截图： 
图8  虚机管理界面

点击删除按钮后会弹出对话框，选择强制删除选项，在将需要删除的虚机名称输入对话框，点击删除按钮。如截图： 
图9  删除虚机时弹出的对话框

删除虚机成功后，如截图 
图10  删除虚机成功

8.删除新建的虚机名称可以在本次扩容回退成功的日志中查找，见
图/Figure6 后置处理失败回退成功。 
9.在TECS上删除未创建的虚机的资源包括端口和云硬盘，需要删除的资源名称可以在扩容的日志“VNF资源操作”中查看，如截图： 
图11  查看扩容的资源

如删除网络端口，登录TECS进行对应的删除，具体如图： 
图12  删除网络端口

将所有新创建的虚机和资源如上述步骤删除后，回退成功。 
## 缩略语 
## 缩略语 
DCU :Data Collection Unit数据采集单元
DPU :Data Processing Unit数据处理单元
MAN :Manager Node管理节点
MANO :Management and Orchestration管理和编排
MDS :Message Dispatch Service消息分发服务
MU :Merging Unit合并单元
NFVO :Network Functions Virtualization Orchestrator网络功能虚拟化编排器
### PC 
Personal Computer个人电脑
### RAID 
Redundant Array of Independent Disks独立冗余磁盘阵列
### SSH 
Secure Shell安全外壳
### TECS 
Tulip Elastic Cloud System郁金香弹性云系统
VIM :Virtualized Infrastructure Manager虚拟化基础设施管理系统
VNF :Virtualized Network Function虚拟化网络功能
VNFM :Virtualized Network Function Manager虚拟化网络功能管理器
ZTE :Zhongxing Telecommunications Equipment中兴通讯
## 北向功能 
特性描述 :术语 :术语|含义
---|---
Northbound|EMSPlus北向功能，为厂家或运营商第三方系统提供接入和管理的网络接口。
MAN|管理节点，为整个EMSPlus提供配置数据管理和数据推送。
DCU|数据采集单元，对接具体的网元，实现事实数据的接收与处理（清洗、聚集）。
DPU|数据处理单元，负责数据的存储和查询，采用GBase数据库。
MDS|消息分发服务，网元将消息发送到MDS，MDS对网元的消息分发到各个DCU上。
MU|数据融合单元，负责数据的合并处理。
描述 :

定义 :北向功能特性是EMSPlus向第三方系统提供接入和管理的网络接口，通过该特性将存储层数据和采集层数据输出给第三方系统。存储层数据主要是DPU的事实表和聚集表数据，采集层数据主要是DCU节点的ET（Extract
Transform，抽取转换）/MU清洗数据、RAS的在线聚集数据。
根据不同的实现原理，将存储层数据北向功能特性称为集中式北向，将采集层数据北向功能特性称为分布式北向，如[图1]所示。
图1  EMSPlus北向输出示意图






背景知识 :第三方系统需要EMSPlus的清洗数据、聚集数据进行数据分析，不同的第三方系统要求的数据格式也有差异。因此EMSPlus提供北向功能特性，向第三方系统输出清洗数据、聚集数据，并支持自定义数据格式，满足第三方系统需求。


应用场景 :

EMSPlus为第三方系统提供接入和管理的网络接口，通过北向功能特性向第三方系统输出清洗数据、聚集数据。


客户收益 :

受益方|收益说明
---|---
运营商|第三方系统通过北向功能特性可以使用EMSPlus输出的有价值数据。
终端用户|此特性对终端用户不可见。


实现原理 :系统架构 :EMSPlus系统架构如[图1]所示。
图1  EMSPlus北向自定义输出逻辑图

北向功能分为以下方式： 
集中式北向由MAN节点的NorthOutput和DPM模块实现。NorthOutput模块从存储层GBase数据库获取数据生成文件，DPM通过FTP/SFTP接口将文件输出给第三方系统。 
分布式北向分为EMSPlus（Logging）局分布式北向和EMSPlus（Reporting）局分布式北向。EMSPlus（Logging）局分布式北向由MU节点的MU、DPM模块实现，MU模块生成文件，DPM通过FTP/SFTP接口将文件输出给第三方系统；EMSPlus（Reporting）局分布式北向由DCU节点的RCM、RAS、DPM模块实现，RCM、RAS模块生成文件，DPM通过FTP/SFTP接口将文件输出给第三方系统。 
涉及网元 :涉及的网元及其功能参见[表1]。
功能单元|描述
---|---
第三方系统|对接EMSPlus的第三方厂家或运营商网元，支持FTP/SFTP。
EMSPlus|将网元上报的话单和日志进行数据的清洗和存储，并向客户报表展示。
本网元实现 :EMSPlus将存储层和采集层的数据生成文件，由DPM输出给第三方系统。
业务流程 :该特性不涉及到业务流程。 
系统影响 :

该特性不涉及对系统的影响。 


应用限制 :

该特性不涉及应用限制。 


特性间交互 :

该特性不涉及与其他特性的交互。 


遵循标准 :

本特性采用中兴通讯内部的接口和协议，不涉及标准协议。 


特性能力 :

该特性不涉及规格指标。 


可获得性 :

版本要求及变更记录 :特性版本|发布版本|发布说明
---|---|---
01|V5.18.10|首次发布。


License要求 :该特性为EMSPlus的License受控项，要申请了License许可后，运营商才能获得该特性的服务。
该特性对应License文件中的项目为Support OF Northbound，此项目显示为ON，表示EMSPlus支持北向功能特性。


对其他网元的要求 :该特性对其它网元无要求。 


O&M相关 :

命令 :本特性不涉及命令的变化。 


性能统计 :该特性不涉及计数器的变化。 


告警与通知 :该特性不涉及告警消息的变化。 


失败观察 :该特性不涉及业务观察/失败观察的变化。 


话单与计费 :该特性不涉及话单与计费的变化。 


特性操作 :#### 配置EMSPlus（Logging）局分布式北向 
#### 配置EMSPlus（Logging）局分布式北向 


EMSPlus（Logging）局分布式的北向任务由MU节点的MU模块实现，北向推送由MU节点的DPM模块实现。


##### 导入License 
摘要 :将支持北向功能的License文件导入EMSPlus。
前提 :已获取支持北向功能的License文件。 
步骤 :登录EMSPlus客户端，选择右上角...→系统信息
，弹出系统信息窗口，如[图1]所示。
图1  系统信息页面

在产品信息区域，单击导入License，弹出导入License文件对话框，如[图2]所示。
图2  导入License文件对话框

单击选择文件，选择根据现场需要做好的*.lic或者*.LCS文件，单击确定。
选择菜单系统→命令终端
，进入命令终端页面，如[图3]所示。
图3  命令终端页面

执行[SHOW LICENSE]命令，查询License信息，如[图4]所示。
图4  查询License信息

 小心！ 
EMSPlus的License部署目录：/ubas/ZXUN-EMSPLUS/server/fileupload
##### 配置北向任务 
摘要 :导入北向任务配置文件，每个任务对应一个配置文件。配置文件描述了数据类型、数据文件存储格式等，由中兴通讯提供。 
步骤 :在EMSPlus客户端，选择菜单System→Import/Export
，默认打开Dimension页面。
切换到NorthBound页签，如[图1]所示。
图1  NorthBound

单击Select Files按钮，在弹出的对话框中选择北向任务配置文件（例如DCU_MU.zip），配置文件显示在Import Template区域框，如[图2]所示。
图2  Selecting a Northbound Task Configuration File

北向模板导入模式参数Pattern有两种选择：
Overwrite：覆盖模式，该模式下新的模板会覆盖旧的模板。 
Append：追加模式，该模式下新的模板会与旧的模板合并，形成一个组合模板。 
根据实际需要选择导入模式，单击Submit按钮，导入北向任务配置文件，如[图3]所示。
图3  Importing the Northbound Task Configuration File

选择菜单System→MML Terminal
，打开命令终端页面。
执行[SHOW DISTRIBUTENORTH]命令，查询北向任务，确认导入北向任务配置文件操作成功，如[图4]所示。
图4  查询北向任务

##### 配置北向推送 
摘要将采集层数据通过北向接口推送到第三方FTP服务器。 
步骤 :在EMSPlus客户端，选择菜单System→MML Terminal
，打开命令终端页面。
执行[ADD FTPCFG]命令，配置第三方FTP服务器，如[图1]所示。
图1  配置第三方FTP服务器

参数名称|参数说明
---|---
FTP ID|FTP服务器ID，唯一标识FTP服务器。
Name|FTP服务器的名称。
IP Address|FTP服务器的IP地址。
Port|FTP服务器的端口号。
User Name|FTP服务器的用户名。
Password|用户名对应的密码。
FTP Path|推送文件的保存路径。
Description|FTP服务器的描述信息。
FTP Protocol|支持的协议：FTP和SFTP。
执行[ADD DPMCFG]命令，配置DPM推送，如[图2]所示。可以配置多条。
图2  配置DPM推送

参数名称|参数说明
---|---
Module Type|执行推送服务的节点类型，选择DCU_MU MODULE。
File Name|推送的文件名称，可以使用“*”号作为通配符，例如：*.*,*.tar.gz。
Master FTP ID|主FTP服务器ID。
Slave FTP ID|备FTP服务器ID。
Run State|运行状态，取值为MASTER、SLAVE，表示优先向该状态值对应服务器推送。
Description|DPM推送任务描述信息。
执行[SET NBPUSHPARAM]命令，配置北向推送参数，如[图3]所示。
图3  配置北向推送参数

参数名称|参数说明
---|---
Module Type|执行推送服务的节点类型，选择DCU_MU MODULE。
Scan Interval(second)|推送数据文件时，扫描文件的间隔，单位秒。
History Files Saving Time(hour)|推送数据文件时，历史文件保存时长，单位小时。
##### 验证特性 
摘要 
摘要 :验证北向功能特性的配置是否正确。 
步骤 :验证北向功能生效。 
检测MU节点的/dev/shm/northcompleted目录有对应表的压缩文件生成。
验推送数据成功。 
登录第三方FTP服务器，确认收到EMSPlus推送的数据。
#### 配置EMSPlus（Reporting）局分布式北向 
#### 配置EMSPlus（Reporting）局分布式北向 


EMSPlus（Reporting）局分布式的北向任务由DCU节点的RCM、RAS模块实现，北向推送由DCU节点的DPM模块实现。


##### 导入License 
摘要 :将支持北向功能的License文件导入EMSPlus。
前提 :已获取支持北向功能的License文件。 
步骤 :登录EMSPlus客户端，选择右上角...→系统信息
，弹出系统信息窗口，如[图1]所示。
图1  系统信息页面

在产品信息区域，单击导入License，弹出导入License文件对话框，如[图2]所示。
图2  导入License文件对话框

单击选择文件，选择根据现场需要做好的*.lic或者*.LCS文件，单击确定。
选择菜单系统→命令终端
，进入命令终端页面，如[图3]所示。
图3  命令终端页面

执行[SHOW LICENSE]命令，查询License信息，如[图4]所示。
图4  查询License信息

 小心！ 
EMSPlus的License部署目录：/ubas/ZXUN-EMSPLUS/server/fileupload
##### 配置北向任务 
摘要 :导入北向任务配置文件，每个任务对应一个配置文件。配置文件描述了数据类型、数据文件存储格式等，由中兴通讯提供。 
步骤 :在EMSPlus客户端，选择菜单System→Import/Export
，默认打开Dimension页面。
切换到NorthBound页签，如[图1]所示。
图1  NorthBound Tab

单击Select Files按钮，在弹出的对话框中选择北向任务配置文件（例如DCU_RP.zip），配置文件显示在Import Template区域框，如[图2]所示。
图2  Selecting a Northbound Task Configuration File

北向模板导入模式参数Pattern有两种选择：
Overwrite：覆盖模式，该模式下新的模板会覆盖旧的模板。 
Append：追加模式，该模式下新的模板会与旧的模板合并，形成一个组合模板。 
根据实际需要选择导入模式。单击Submit按钮，导入北向任务配置文件，如[图3]所示。
图3  Importing the Northbound Task Configuration File

选择菜单System→Terminal
，打开命令终端页面。
执行[SHOW DISTRIBUTENORTH]命令，查询北向任务，确认导入北向任务配置文件操作成功，如[图4]所示。
图4  查询北向任务

##### 配置北向推送 
摘要 :将采集层数据通过北向接口推送到第三方FTP服务器。
步骤 :在EMSPlus客户端，选择菜单System→Terminal
，打开命令终端页面。
执行[ADD FTPCFG]命令，配置第三方FTP服务器，如[图1]所示。
图1  配置第三方FTP服务器

参数名称|参数说明
---|---
FTP ID|FTP服务器ID，唯一标识FTP服务器。
Name|FTP服务器的名称。
IP Address|FTP服务器的IP地址。
Port|FTP服务器的端口号。
User Name|FTP服务器的用户名。
Password|用户名对应的密码。
FTP Path|推送文件的保存路径。
Description|FTP服务器的描述信息。
FTP Protocol|支持的协议：FTP和SFTP。
执行[ADD DPMCFG]命令，配置DPM推送，如[图2]所示。可以配置多条。
图2  配置DPM推送

参数名称|参数说明
---|---
Module Type|执行推送服务的节点类型，选择DCU_RP MODULE。
File Name|推送的文件名称，可以使用“*”号作为通配符，例如：*.*,*.tar.gz。
Master FTP ID|主FTP服务器ID。
Slave FTP ID|备FTP服务器ID。
Run State|运行状态，取值为MASTER、SLAVE，表示优先向该状态值对应服务器推送。
Description|DPM推送任务描述信息。
执行[SET NBPUSHPARAM]命令，配置北向推送参数，如[图3]所示。
图3  配置北向推送参数

参数名称|参数说明
---|---
Module Type|执行推送服务的节点类型，选择DCU_RP MODULE。
Scan Interval(second)|推送数据文件时，扫描文件的间隔，单位秒。
History Files Saving Time(hour)|推送数据文件时，历史文件保存时长，单位小时。
##### 验证特性 


摘要 :验证北向功能特性的配置是否正确。 


步骤 :

验证北向功能生效。 
检测DCU节点下面目录有对应表的压缩文件生成。
/ubas/ZXUN-EMSPLUS/server/emsent/ftp/dcu/north_output/ras_pushdata
/ubas/ZXUN-EMSPLUS/server/emsent/ftp/dcu/north_output/rcm_pushdata


验推送数据成功。 
登录第三方FTP服务器，确认收到EMSPlus推送的数据。




测试用例 :测试用例 :#### EMSPlus（Logging）分布式北向功能测试 


测试项|EMSPlus（Logging）分布式北向功能测试
---|---
预置条件|已获取支持北向功能特性的License文件。已获取北向任务配置文件。|已获取支持北向功能特性的License文件。已获取北向任务配置文件。|已获取支持北向功能特性的License文件。已获取北向任务配置文件。
操作过程|导入License，参见“导入License”。配置北向任务，参见“配置北向任务”。配置北向推送，参见“配置北向推送”。|导入License，参见“导入License”。配置北向任务，参见“配置北向任务”。配置北向推送，参见“配置北向推送”。|导入License，参见“导入License”。配置北向任务，参见“配置北向任务”。配置北向推送，参见“配置北向推送”。
预期结果|参见“验证特性”。|参见“验证特性”。|参见“验证特性”。
实际结果|同预期结果。|同预期结果。|同预期结果。
注意事项|||
签名||测试日期|


#### EMSPlus（Reporting）分布式北向功能测试 


测试项|EMSPlus（Reporting）分布式北向功能测试
---|---
预置条件|已获取支持北向功能特性的License文件。已获取北向任务配置文件。|已获取支持北向功能特性的License文件。已获取北向任务配置文件。|已获取支持北向功能特性的License文件。已获取北向任务配置文件。
操作过程|导入License，参见“导入License”。配置北向任务，参见“配置北向任务”。配置北向推送，参见“配置北向推送”。|导入License，参见“导入License”。配置北向任务，参见“配置北向任务”。配置北向推送，参见“配置北向推送”。|导入License，参见“导入License”。配置北向任务，参见“配置北向任务”。配置北向推送，参见“配置北向推送”。
预期结果|参见“验证特性”。|参见“验证特性”。|参见“验证特性”。
实际结果|同预期结果。|同预期结果。|同预期结果。
注意事项|||
签名||测试日期|


## 缩略语 
## 缩略语 
DCU :Data Collection Unit数据采集单元
### DPM 
Data Push Manager数据推送管理器
DPU :Data Processing Unit数据处理单元
FTP :File Transfer Protocol文件传输协议
IP :Internet Protocol因特网协议
MAN :Manager Node管理节点
MDS :Message Dispatch Service消息分发服务
MU :Merging Unit合并单元
### RAS 
Real-time Analysis System实时分析系统
### RCM 
Real-time CHR Manager实时CHR管理器
SFTP :Secure File Transfer Protocol安全文件传输协议
### SQL 
Structured Query Language结构化查询语言
## 接入EMS功能 
特性描述 :术语 :术语|含义
---|---
EMSPlus|电信云及核心网增值网管，为运营商提供运维支持和决策支持。
EMS|中兴通讯的核心网统一网元管理系统，可以管理中兴通讯的所有核心网网络设备。
描述 :定义 :接入EMS功能特性是指EMSPlus接入中兴通讯的核心网统一网元管理系统，纳入EMS管理范围。
ZTE的核心网统一网元管理系统包含NetNumen U31和ElasticNet UME产品。
背景知识 :EMSPlus通过遵循一系列EMS-OMM接口规范，使用V4 COMM底层支撑，使用EMB接入方式接入EMS。EMSPlus和EMS间通过命令行接口和文件传输接口进行交互。
应用场景 :通过EMS客户端下发命令行到EMSPlus。 
通过EMS下发EMSPlus性能统计任务，查询性能统计数据。 
客户收益 :对运营商和用户的受益说明参见[表1]。
收益方|收益说明
---|---
运营商|EMS系统上实现单点接入，对所有被管理网元（包括EMSPlus）的配置、性能进行集中监控和管理。
终端用户|此特性对终端用户不可见。
实现原理 :系统架构 :EMSPlus通过COMM平台接入EMS，实现EMS任务下发到EMSPlus，EMSPlus上报告警、性能等数据给EMS。
接入EMS系统架构如[图1]所示。
图1  EMSPlus接入EMS系统架构

涉及网元 :本特性需要EMS配合完成。EMSPlus接入EMS后，可以在EMS上对EMSPlus下发命令，查询性能统计数据，显示告警信息。
本网元实现 :通过本特性，EMSPlus可以将拓扑管理、性能管理、命令终端接入到EMS，实现核心网网元的统一管理。
业务流程 :接入EMS大致需要经过如下几个流程：链路检测、网元信息查询、命令行模型加载、配置同步等过程。这些过程按照EMS-OMM接口规范，本文不再赘述。 
系统影响 :该特性不涉及对系统的影响。 
应用限制 :EMSPlus与EMS的语言环境需要保持一致。
特性间交互 :大部分操作维护功能都是EMS实现的，EMSPlus只是提供数据上传和同步接口功能，比如告警、性能。
EMS的命令行终端提供EMSPlus系统的管理、巡检、配置等操作维护功能。
EMS特性描述参考相应的特性指导文档。 
遵循标准 :本特性采用ZTE内部的接口和协议，不涉及标准协议。
特性能力 :该特性不涉及规格指标。 
可获得性 :版本要求及变更记录 :特性版本|发布版本|发布说明
---|---|---
01|V5.18.12.B13|首次发布。
License要求 :该特性为EMSPlus网元的基本功能，无需License支持。
对其他网元的要求 :支持接入EMSPlus的EMS产品型号及版本如下：
EMS产品型号|支持的版本
---|---
NetNumen U31 R50|V12.19.10.P2及以后版本
NetNumen U31 R06|V12.19.10.B2及以后版本
ElasticNet UME R50|V16.19.12.B6及以后版本
ElasticNet UME R50e|V16.19.12.B3及以后版本
O&M相关 :命令 :本特性不涉及命令的变化。 
性能统计 :该特性不涉及计数器的变化。 
告警与通知 :当EMS和网元间链路断时，EMS上会触发告警。
新增的告警/通知参见[表1]。
告警和通知
---
1015 网元代理链路断（The link between the server and the NE agent is broken）
失败观察 :该特性不涉及失败观察的变化。 
##### 计费 
该特性不涉及话单与计费的变化。 
特性配置 :#### 特性配置（NetNumen U31） 
在NetNumen U31上配置接入EMSPlus。
配置说明 :在NetNumen U31上创建一个EMSPlus网元代理，实现对EMSPlus的集中操作维护管理。
配置前提 :EMS客户端和服务端运行正常，EMS和EMSPlus之间的链路连接正常。
配置过程 :在部署EMSPlus虚机时设置接入EMS的参数（关注MAN节点的浮动IP地址）。
在EMS客户端打开网元代理管理。 
创建EMSPlus的网元代理。
启动EMSPlus的网元代理。
配置实例 :场景说明 :本节介绍如何在NetNumen U31上接入EMSPlus，EMSPlus需要接入EMS系统进行集中维护管理。
数据规划 :根据实际情况进行配置，假设场景的数据规划参见[表1]。
参数名称|参数值|备注
---|---|---
网元代理名称|emsplus|EMSPlus在EMS上显示的名称。
EMSPlus的IP地址|10.43.37.224|MAN节点的EMS网络平面的浮动IP地址
EMS服务器的IP地址|10.43.37.252|-
配置步骤 :设置接入EMS的参数
部署EMSPlus虚机时，EMS网络平面的浮动IP地址为EMSPlus接入EMS的IP地址，如[图1]所示。
图1  配置浮动IP地址

打开网元代理管理
登录NetNumen U31客户端。 
单击客户端窗口工具栏中的图标，切换到Topology Management窗口，如[图2]所示。
图2  拓扑管理

右击拓扑树中的根节点EMS Server，选择快捷菜单CN NE Agent Management，如[图3]所示。
图3  网元树

弹出CN NE Agent Management对话框，如[图4]所示。
图4  核心网网元代理管理

创建网元代理
单击对话框右侧的Add按钮，弹出Create NE Agent对话框，如[图5]所示。
图5  创建网元代理

选择V4 OMS。在Basic Attributes页面输入网元代理的名称、EMSPlus的MAN节点的浮动IP地址、EMS服务器的IP地址，如[图6]所示。
图6  配置网元代理基本属性

切换到Extended Attributes页面，参数保持默认值，如[图7]所示。
图7  网元代理扩展属性

单击OK按钮，在弹出的提示框中单击OK按钮，如[图8]所示，完成网元代理的创建。
图8  网元代理创建成功

启动网元代理
在CN NE Agent Management对话框中，选中新建的EMSPlus网元代理emsplus，单击右侧的Start按钮，如[图9]所示。
图9  启动网元代理

在弹出的Start NE  Agent对话框中等待网元代理接入完成提示The NE Agent starts successfully 
。单击Close按钮，关闭对话框，如[图10]所示。
图10  网元代理启动成功

网元树中显示刚启动的EMSPlus网元代理和网元。V4 OMS网元代理的节点呈两层结构，第一层为网元代理，第二层为V4网元，如[图11]所示。
图11  接入EMSPlus

#### 特性配置（ElasticNet UME） 
在ElasticNet UME上配置接入EMSPlus。
配置说明 :

在ElasticNet UME上创建一个EMSPlus网元代理，实现对EMSPlus的集中操作维护管理。


配置前提 :

EMS客户端和服务端运行正常，EMS和EMSPlus之间的链路连接正常。


配置过程 :



在部署EMSPlus虚机时设置接入EMS的参数（关注MAN节点的浮动IP地址）。


创建EMSPlus的网元代理。


启动EMSPlus的网元代理。




配置实例 :场景说明 :本节介绍如何在ElasticNet UME上接入EMSPlus，EMSPlus需要接入EMS系统进行集中维护管理。
数据规划 :根据实际情况进行配置，假设场景的数据规划参见[表1]。
参数名称|参数值|备注
---|---|---
网元代理名称|EMSPlus|EMSPlus在EMS上显示的名称。
EMSPlus的IP地址|10.43.37.224|MAN节点的EMS网络平面的浮动IP地址
EMS服务器的IP地址|10.43.37.252|-
配置步骤 :设置接入EMS的参数
部署EMSPlus虚机时，EMS网络平面的浮动IP地址为EMSPlus接入EMS的IP地址，如[图1]所示。
图1  配置浮动IP地址

创建网元代理
登录ElasticNet UME客户端。 
选择菜单拓扑→分层接入
，进入分层接入页面，如[图2]所示。
图2  分层接入页面

单击工具栏上新建按钮，系统显示新建代理页面，如[图3]所示。
图3  新建代理

参数|说明
---|---
代理类型|选择V4OMS。
代理名称|根据实际需要配置代理名称。
描述|该网元的简单描述信息。
启动|选择在创建网元代理后，是否立即启动该代理。是：表示创建网元代理后，自动启动该代理并连接下级网元。否：表示创建网元代理后，不启动该代理。维护人员可手工启动该代理。
网络地址|EMSPlus的浮动IP地址，即在EMSPlus实例化时，EMS平面上的浮动IP地址。
端口|代理的端口号，保持默认值21125。
厂商|代理网元的供应商，例如：ZTE。
位置|网元的位置。
网元类型|选择保持默认值N/A。
EMS网络地址|当EMSPlus需要通过NAT穿越方式接入网元代理时，需要填写EMSPlus经过代理防火墙映射后的地址。一般情况下无需填写。
支持集中安全|选择是否启用集中安全管理：是：启用集中安全。否：不启用集中安全。说明：EMSPlus上的配置需要与EMS网管侧配置保持一致。
启用SSH|选择EMSPlus与网元之间是否需要采用SSH方式通讯。是：启用SSH通讯。否：不启用SSH通讯。说明：该配置需要与网元侧保持一致。
根据规划，输入EMSPlus的接入参数。
单击新建，EMSPlus网元出现在列表中，且管理状态为已启动，如[图4]所示。
图4  接入结果

特性操作 :#### 特性操作（NetNumen U31） 
##### 执行EMSPlus命令 
摘要 :在EMSPlus接入NetNumen U31后，可以在NetNumen U31上执行EMSPlus的配置命令，检查EMS下发命令至EMSPlus功能是否正常。
前提 :EMSPlus已接入NetNumen U31。
步骤 :在NetNumen U31客户端窗口，单击工具栏中的图标，切换到MML Terminal窗口，如[图1]所示。
图1  命令终端

在左上方的MML Tree中选中需要执行的EMSPlus网元，左下方的命令树中显示可以执行的命令，如[图2]所示。
图2  选择网元

单击需要执行的命令，右下方显示该命令的命令码，如[图3]所示。
图3  选择命令

配置命令参数，单击按钮，Command Result页面显示该命令执行的结果，如[图4]所示。
图4  命令执行结果

性能统计 :本节以NetNumen U31为例，介绍如何在EMS上对EMSPlus进行性能统计操作。
###### 新建测量任务 
摘要测量任务会根据设定的条件，采集网元的性能数据。 
前提 :已规划需要进行测量的网元、性能对象、性能数据采集粒度和时间段。 
步骤 :在NetNumen U31客户端窗口，选择菜单Performance→Measurement Task Management
，打开Measurement Task Management窗口，如[图1]所示。
图1  测量任务管理

在网元树中选定需要查看的EMSPlus网元，右侧展示该网元的测量任务。EMSPlus网元默认预定义了3个测量任务，如[图2]所示。
图2  测量任务

右击当前EMSPlus网元（例如emsplus_224），选择快捷菜单Add Measurement Task，弹出Add Measurement Task对话框，如[图3]所示。
图3  创建测量任务

测量任务页面的参数说明参见[表1]。
参数名称|参数说明
---|---
NE type|测量任务归属的网元类型。NE type和MO type会相互过滤，如果已经选择了MO type，则下拉列表框仅显示该类型下支持的网元类型。
MO type|网元类型支持的管理对象类型。NE type和MO type会相互过滤，如果已经选择了NE type，则下拉列表框仅显示该类型下支持的测量对象类型。
Task type|测量任务的类型，包括Normal和All-PO。两种任务类型的区别在于：All-PO是指包含该测量对象类型下所有性能对象的测量任务，维护人员不需要为全性能对象任务选择性能对象。
PO|测量任务的性能对象。性能对象是测量的基本单元，可以实现对测量对象的不同指标的测量。当Task type设置为All-PO时，该选项无效。
MO type参数选择MODULESYSTEM（该测量对象类型是各个节点的系统参数统计，包括CPU使用率、内存使用率等）。任务类型、网元类型和性能对象保持默认，如[图4]所示。
图4  配置测量任务

切换到Location页面。选择任务采集位置，包括网元位置和测量对象位置，默认当前网元的所有测量对象，一般情况下保持默认，如[图5]所示。
图5  配置位置1

位置选择页面的参数说明参见[表2]。
参数名称|参数说明
---|---
Wildcard level|通配层次的选项与选择的网元测量对象有关：All(Include no right NE)：表示匹配全网所有此网元类型的网元，不需要选择测量对象。此时NE location(s)和MO location(s)选择框将灰化。NE：表示匹配一个或多个网元。此时MO location(s)选择框将灰化。Wildcard level为Neasurement Task页面设置的MO type：此时需要配置NE location(s)和MO location(s)。
NE location(s)|测量任务对应的网元树。
MO location(s)|测量任务对应的测量对象树。如果NE location(s)选择框变成灰色，则表示此时的测量对象就是网元本身。
也可以自定义MODULESYSTEM测量对象类型的采集节点位置。Wildcard level参数选择MODULESYSTEM，在右下方区域框配置需要的测量对象位置，如[图6]所示。
图6  配置位置2

切换到General页面。输入任务名称，选择开始时间、结束时间、任务状态、采集粒度，输入采集时段信息，如[图7]所示。
图7  配置通用信息

基本信息页面的参数说明参见[表3]。
参数名称|参数说明
---|---
Task Name|测量任务的名称，不能与已经存在的任务重名。默认显示格式为“MeasurementTask_”+”Measurement Task页面选择的MO type”。
Creator|默认显示为当前登录用户，且不可修改。
Start time|测量任务开始执行的时间。开始时间不能早于EMSPlus客户端的系统时间，Start time必须设置为Granularity的整数倍。
End time|测量任务结束的时间。结束时间不能早于开始时间，End time必须设置为Granularity的整数倍。
Task status|测量任务的状态：Activated或Suspended。选择Suspended时：此测量任务无效。选择Activated时：此测量任务在设置的开始时间采集性能数据。
Granularity|EMSPlus进行数据采集的周期。选择的MO type不同，测量任务支持的采集Granularity也不同。选项包括：5分钟、15分钟、1小时。
Effective data|以周或月为周期，设置测量任务执行的日期。日期上有颜色的表示已选择，单击该日期，可以取消选择该日期。
Effective time|以分钟为单位，设置测量任务执行的时段。输入开始时间和结束时间，并通过Add和Delete按钮来编辑时段。设置多个时段时，时间段不能重合。
单击OK按钮，在弹出的提示框中单击OK，测量任务管理窗口显示新建的任务，如[图8]所示。
图8  新建的测量任务

###### 激活/挂起测量任务 
摘要对于当前运行状态为Suspended的测量任务，如需要按照该任务的规则采集性能数据，则激活该测量任务。任务激活后，任务信息会同步到对应的网元设备，网元设备进行性能数据的采集，将采集的性能数据存放到数据库中。对于当前运行状态为Activated的测量任务，如不需要按照该任务的规则采集性能数据，则挂起该测量任务。 
前提 :已确认测量任务的Consistency Status显示为Normal。
步骤 :激活测量任务
在NetNumen U31客户端窗口，选择菜单Performance→Measurement Task Management
，打开Measurement Task Management窗口。
选中一条或多条任务状态为Suspended的测量任务，单击工具栏中的按钮，如[图1]所示。
激活后的测量任务的Task Status为Activated。
图1  激活测量任务

 说明： 
一次操作最多可选择20条测量任务。 
挂起测量任务
在NetNumen U31客户端窗口，选择菜单Performance→Measurement Task Management
，打开Measurement Task Management窗口。
选中一条或多条任务状态为Activated的测量任务，单击工具栏中的按钮，如[图2]所示。
挂起后的测量任务的Task Status为Suspended。
图2  挂起测量任务

###### 修改测量任务 
摘要只有用户创建的测量任务（即测量任务的Task Origin为Client）可以修改，EMSPlus默认的3个测量任务不能修改。 
前提 :已确认需要修改的测量任务的Consistency Status为Normal，Task Status为Suspended。
步骤 :在NetNumen U31客户端窗口，选择菜单Performance→Measurement Task Management
，打开Measurement Task Management窗口，如[图1]所示。
图1  测量任务列表

选中一条需要修改的测量任务，单击工具栏中的按钮，弹出Modify Measurement Task对话框，如[图2]所示。
图2  修改测量任务

根据需要修改测量任务的参数，灰化的NE type、MO type、Task type和Task status参数不能修改。
单击OK按钮。
###### 按任务查询性能数据 
摘要根据定制的测量任务向网元采集性能数据，并将采集的性能数据存储到服务器的数据库中。维护人员可以根据测量任务设置的条件从数据库检索出已经入库的性能统计数据。 
前提 :与网元相关的测量任务已创建并运行了一段时间。 
步骤 :在NetNumen U31客户端窗口，选择菜单Performance→Measurement Task Management
，打开Measurement Task Management窗口，如[图1]所示。
图1  测量任务列表

右击一条测量任务，选择快捷菜单Query PM Data by Task，打开History Performance Query对话框，如[图2]所示。
图2  历史性能数据查询

在Index/Counter Selection页面，选择网元需要查询的计数器和指标，选中的计数器和指标将会显示在Selected indices/counter区域框中。
Index/Counter Selection页面的参数说明参见[表1]。
参数名称|参数说明
---|---
NEtype|性能查询的网元类型。NE type和MO type会相互过滤，如果已经选择了MO type，则下拉列表框仅显示该类型下支持的网元类型。
MO type|网元类型支持的管理对象类型。NE type和MO type会相互过滤，如果已经选择了NE type，则下拉列表框仅显示该类型下支持的测量对象类型。
切换到Object Selection页面，选择作为查询对象的网元，如[图3]所示。
图3  查询对象页面

Object Selection页面的参数说明参见[表2]。
参数名称|参数说明
---|---
Location group|表示查询性能的汇总规则。Query raw data：查询数据库中的所有性能数据。Group by all NEs：对所有网元的所有测量对象的数据进行汇总，且查询的数据按计数器合并规则汇总。Group by NE：对各个网元的所有测量对象的数据进行汇总，且查询的数据按计数器合并规则汇总。
Wildcard level|表示性能查询对象的匹配层次，该选项与Index/Counter Selection页面选择的有关。All(include no righr NE)：匹配全网所有此网元类型的网元，不需要选择测量对象，NE location(s)和MO location(s)选择框将灰化。NE：需要选择某一或几个网元；不需要选择测量对象，MO location(s)选择框将灰化。通配层次为Index/Counter Selection页面选择的MO type时，需要设置NE location(s)和MO location(s)。
NE location(s)|在网元树中选中查询任务对应的网元。
MO location(s)|在测量对象树中选中查询任务对应的测量对象。
切换到Time Selection页面，设置Query Granularity、Time Setting、Effective data和Effective time参数，如[图4]所示。
图4  查询时间页面

Time Selection页面的参数说明参见[表3]。
参数名称|参数说明
---|---
Query Granularity|查询网元性能的周期。选择的测量对象类型不同，支持的查询粒度也不同。
Time Setting|查询网元性能的时间段。选中各选项前的单选按钮，单击下拉按钮，在文本框中设置时间。
Effective data|以周或月为周期，设置查询任务执行的日期。日期上有颜色的表示已选择，如果单击该日期，可以取消选择该日期。
Effective time|以分钟为单位，设置查询任务执行的时段。输入开始时间和结束时间，并通过Add和Delete按钮来设置多个时段。
单击OK按钮，历史性能查询结果示例如[图5]所示。
图5  性能数据查询结果

###### 删除测量任务 
摘要只有用户创建的测量任务（即测量任务的Task Origin为Client）可以删除，EMSPlus默认的3个测量任务不能删除。 
前提 :已确认需要删除的测量任务的Consistency Status为Normal，Task Status为Suspended。
步骤 :在NetNumen U31客户端窗口，选择菜单Performance→Measurement Task Management
，打开Measurement Task Management窗口，如[图1]所示。
图1  测量任务列表

选中一条需要删除的测量任务，单击工具栏中的按钮，在弹出提示框中单击Yes按钮，如[图2]所示。
图2  删除确认提示框

##### 查看告警信息 
摘要 :检查NetNumen U31接收EMSPlus告警的功能是否正常。
前提 :EMSPlus已接入NetNumen U31。
步骤 :在NetNumen U31客户端窗口，单击网元树中的EMSPlus网元，切换到NE Alarms Table页签，查看当前告警列表，如[图1]所示。
图1  查看当前告警

双击一条告警条目，查看告警详情，如[图2]所示。
图2  查看告警详情

单击Alarm Monitoring按钮，选择快捷菜单History Alarms→History Alarms Within One Day
，查看最近1天的历史告警，如[图3]所示。选择快捷菜单History Alarms→History Alarms Within Three Day
，查看最近3天的历史告警。
图3  查看历史告警

#### 特性操作（ElasticNet UME） 
##### 执行EMSPlus命令 
摘要 :在EMSPlus接入ElasticNet UME后，可以在ElasticNet UME上执行EMSPlus的配置命令，检查EMS下发命令至EMSPlus功能是否正常。
前提 :EMSPlus已接入ElasticNet UME。
步骤 :在ElasticNet UME客户端窗口，选择菜单配置→命令终端→命令处理
，进入命令处理页面，如[图1]所示。
图1  命令处理页面

在左上方的网元树中选中需要操作的EMSPlus网元，左下方的命令树中显示可以执行的命令，如[图2]所示。
图2  选择网元

单击需要执行的命令，例如：查询模块，右下方显示该命令的命令码[SHOW MODULE]，如[图3]所示。
图3  选择命令

单击执行按钮，该命令的执行结果显示在文本结果区域，如[图4]所示。
图4  命令执行结果

性能统计 :###### 创建测量任务 
摘要 :网元根据测量任务设定的条件，采集相关数据，上报到EMSPlus服务器。
步骤 :在ElasticNet UME客户端，选择菜单性能→性能任务→测量任务
，打开测量任务页签，如[图1]所示。
图1  测量任务管理

单击新建，打开新建测量任务页面。输入名称，选择网元类型、测量对象类型和测量族，如[图2]所示。
图2  选择测量族

测量任务页面的参数说明参见[表1]。
参数|说明
---|---
名称|测量任务的名称，例如EMSPlus_test。
网元类型|选择测量任务归属的网元类型，选择EMSPLUS。
测量对象类型|选择网元类型支持的测量对象类型，选择EMSPLUS。
测量族|测量对象类型支持的测量类型，如果已经选择了测量对象类型，则下拉列表框仅显示该类型下支持的测量族。
单击下一步，切换到选择对象页面，如[图3]所示。
图3  选择对象页面

选择对象页面的参数说明参见[表2]。
参数名称|参数说明
---|---
选择类型|按对象范围：配置对象范围参数，并选择资源。按测量对象模板：配置对象过滤和测量对象模板参数。
对象范围|选择类型选择按对象范围，该参数可见。
选择按对象范围，并单击选择，在弹出的对话框中选择EMSPlus网元，如[图4]所示。
图4  选择网元

单击下一步切换到选择时间页签，设置测量任务的基本信息，如[图5]所示。
图5  选择时间

时间页面的参数说明参见[表3]。
参数|说明
---|---
状态|测量任务创建后默认的状态。
粒度|在粒度下拉菜单后选择查询粒度，包括5分钟、15分钟、30分钟、1小时、1天。例如：选择15分钟，表示以15分钟为单位显示查询结果。
时间范围|自定义选择任务有效时间。
有效时段和日期|有效时段有效时间为：00:00-24:00。每段时间以小时为单位分为24个时间粒度，可以单击选择时间段中的小时时间粒度。有效日期查询的有效日期，包括：按月和按周。勾选中按月：下面列出一个月的所有待选天，可全选，可选择某些天。勾选中按周：下面列出一周的所有天，从周一 ~ 周日，可全选，可单击选择某些天。
单击新建按钮，完成测量任务的新建。新建的测量任务出现在测量任务页签中。
###### 激活测量任务 
摘要 :对于当前运行状态为未激活的测量任务，如要按照该任务的规则采集性能数据，则需要激活该测量任务。
任务激活后，任务信息会同步到对应的网元设备，网元设备进行性能数据的采集，并将采集的性能数据上传存储到EMSPlus服务器的数据库中。
步骤 :在ElasticNet UME客户端，选择菜单性能→性能任务→测量任务
，打开测量任务页签，如[图1]所示。
图1  测量任务

选中状态为未激活的测量任务，在操作列选择更多→激活
。
 说明： 
一次可操作多条测量任务。 
###### 按任务查询性能数据 
摘要 :根据定制的测量任务向网元采集性能数据，并将采集的性能数据存储到服务器的数据库中。维护人员可以根据测量任务设置的条件从数据库检索出已经入库的性能统计数据。 
步骤 :在ElasticNet UME客户端，选择菜单性能→性能任务→测量任务
，已创建的测量任务显示在测量任务列表中，如[图1]所示。
图1  测量任务

选择需要查询的测量任务，单击历史查询按钮，测量任务详情显示在历史查询页面，如[图2]所示。
图2  历史历史查询

单击展开条件，设置历史性能数据查询条件，单击查询，如[图3]所示。
图3  设置查询条件

###### 同步测量任务 
摘要 :本节介绍如何将网管服务器上的测量任务同步到网元。 
当ElasticNet UME服务器和被管理网元设备上的测量任务信息不一致时，同步测量任务可将EMSPlus服务器上的测量任务信息同步到相应的网元设备上。
步骤 :在EMSPlus客户端，选择菜单性能→性能任务→测量任务
，打开测量任务页面，如[图1]所示。
图1  测量任务

选中需要同步的测量任务，在操作列选择更多→同步
。
切换到网元任务页签，查看具体网元的测量任务状态，如[图2]所示。
图2  网元任务

选择需要同步到网元的测量任务，单击同步按钮，提示“同步消息发送成功 
”。
##### 查看告警信息 
摘要 :检查ElasticNet UME接收EMSPlus告警的功能是否正常。
前提 :EMSPlus已接入ElasticNet UME。
步骤 :查看当前告警
在ElasticNet UME客户端窗口，选择菜单告警→当前告警→告警监控
，打开默认条件模板的当前告警监控页面，如[图1]所示。
图1  告警监控

单击告警列表中网元侧的，在弹出的对话框中输入emsplus，如[图2]所示。
图2  搜索框

单击，当前告警监控页面仅显示EMSPlus的告警。
查看历史告警
选择菜单告警→历史告警→告警查询
，打开历史告警查询页面，如[图3]所示。
图3  历史告警

单击告警列表中网元侧的，在弹出的对话框中输入emsplus，如[图4]所示。
图4  搜索框

单击，历史告警页面仅显示EMSPlus的告警。
测试用例 :#### 命令行功能测试 
测试项|命令行功能测试
---|---
预置条件|EMSPlus已经接入EMS。|EMSPlus已经接入EMS。|EMSPlus已经接入EMS。
操作过程|进入命令终端窗口。执行EMSPlus命令。|进入命令终端窗口。执行EMSPlus命令。|进入命令终端窗口。执行EMSPlus命令。
预期结果|参见执行EMSPlus命令。|参见执行EMSPlus命令。|参见执行EMSPlus命令。
实际结果|同预期结果。|同预期结果。|同预期结果。
注意事项|||
签名||测试日期|
#### 新建测量任务功能测试 
测试项|新建测量任务功能测试
---|---
预置条件|EMSPlus已经接入EMS。|EMSPlus已经接入EMS。|EMSPlus已经接入EMS。
操作过程|进入测量任务管理窗口。打开创建测量任务的对话框。设置新建测量任务的参数。单击OK按钮。|进入测量任务管理窗口。打开创建测量任务的对话框。设置新建测量任务的参数。单击OK按钮。|进入测量任务管理窗口。打开创建测量任务的对话框。设置新建测量任务的参数。单击OK按钮。
预期结果|参见新建测量任务。|参见新建测量任务。|参见新建测量任务。
实际结果|同预期结果。|同预期结果。|同预期结果。
注意事项|||
签名||测试日期|
#### 查询性能统计功能测试 
测试项|查询性能统计功能测试
---|---
预置条件|EMSPlus已经接入EMS。|EMSPlus已经接入EMS。|EMSPlus已经接入EMS。
操作过程|进入测量任务管理窗口。打开历史性能数据查询的对话框。设置历史性能数据查询的参数。单击OK按钮。|进入测量任务管理窗口。打开历史性能数据查询的对话框。设置历史性能数据查询的参数。单击OK按钮。|进入测量任务管理窗口。打开历史性能数据查询的对话框。设置历史性能数据查询的参数。单击OK按钮。
预期结果|参见按任务查询性能数据。|参见按任务查询性能数据。|参见按任务查询性能数据。
实际结果|同预期结果。|同预期结果。|同预期结果。
注意事项|||
签名||测试日期|
## 缩略语 
## 缩略语 
### CPU 
Central Processing Unit中央处理器
### EMB 
Enterprise Message Bus企业消息总线
EMS :Element Management System网元管理系统
IP :Internet Protocol因特网协议
MAN :Manager Node管理节点
### NAT 
Network Address Translation网络地址转换
### OMM 
Operation and Maintenance Management操作维护管理
### OMS 
Operation and Maintenance Subsystem操作维护子系统
### SSH 
Secure Shell安全外壳
### UME 
Unified Management Expert System统一管理专家系统
ZTE :Zhongxing Telecommunications Equipment中兴通讯
## 5GC日志查询功能 
特性描述 :术语 :术语|含义
---|---
EMSPlus|数据业务报表系统，为运营商提供运维支撑和决策支持。
Web|EMSPlus网元的本地管理终端。
MDS|消息分发服务，网元将消息发送到MDS，MDS对网元的消息进行分发到各个DCU上。
DCU|数据采集单元，与具体网元对接，实现事实数据的接收与处理（清洗、聚集）。
描述 :定义 :5GC日志查询是指EMSPlus具有NF日志服务功能，支持基本的XDR日志采集、按报表性能统计（对齐性能统计支持的维度）、日志和报表查询。EMSPlus提供用于运营商性能分析的原始数据，提供网元故障定位手段。
背景知识 :用户使用EMSPlus的日志查询功能查出网元日志数据，但不同的用户关注的数据不一样，有的用户关注全部数据，有的只关注失败数据。 
使用EMSPlus的日志查询功能查出网元日志数据后，在网元性能分析或故障定位时，需要对相应的日志记录数据进行分析。但字段含义专业性较强，且部分字段数值构成复杂，不易理解，需要另行查询协议后再分析。 
应用场景 :查询NF日志和报表，以表格方式展示查询结果。
统计NF性能数据，以表格和图形方式展示统计结果。 
客户收益 :对运营商和用户的受益说明参见[表1]
收益方|收益说明
---|---
运营商|提升运营商的网元统计能力和故障定位手段。
终端用户|此特性对终端用户不可见。
实现原理 :系统架构 :图1  系统架构

EMSPlus以一个VNF（网元）的方式部署，而非以模块的方式部署到其它网元内部。在轻量化架构中，两个MDS N+1互备，正常情况下，以负荷分担模式运行。MDS具有收转发功能，转发到DCU或MU上。
日志数据&报表数据采用文件存储，不支持日志关联和二次统计。EMSPlus查询模块分发查询语句到GBase数据库，不支持分组统计，按详单格式综合输出。 
涉及网元 :5GC涉及的网元如AMF、PCF、SGSN、MME、UPF、SMF、UDM、UDR等。
本网元实现 :EMSPlus系统和网元对接成功。
能够对网元发过来的话单和日志进行清洗和入数据库。 
用户能够使用Chrome浏览器登录系统，查询数据库中的数据，并通过表格形式展示。 
业务流程 :本特性不涉及业务流程。 
系统影响 :该特性不涉及对系统的影响。 
应用限制 :该特性不涉及应用限制。 
特性间交互 :该特性不涉及与其他特性的交互。 
遵循标准 :本特性采用ZTE内部的接口和协议，不涉及标准协议。
特性能力 :该特性不涉及规格指标。 
可获得性 :版本要求及变更记录 :特性版本|发布版本|发布说明
---|---|---
01|V5.19.10.P1B5|首次发布。
License要求 :需要打开如下License配置项开关： 
5GC General Query
对其他网元的要求 :该特性不涉及对其他网元的要求。 
O&M相关 :命令 :本特性不涉及命令的变化。 
性能统计 :本特性不涉及计数器的变化。 
告警与通知 :本特性不涉及告警消息的变化。 
失败观察 :本特性不涉及失败观察的变化。 
##### 计费 
本特性不涉及话单与计费的变化。 
特性操作 :#### 概要分析 
EMSPlus提供了多种预定义的概要分析报表，对5GC网元的业务失败日志进行分析。
##### 查询概要分析报表 
摘要 :EMSPlus为入门级用户提供了多种预定义的概要分析报表，对网元的失败业务日志进行分析。
在概要分析查询结果中，EMSPlus还提供了数据钻取功能，对查询结果进行深度钻取分析，最终可以钻取到网元业务数据详单（XDR）。
 说明： 
本节以“SMF概览分析报表”为例，介绍如何通过EMSPlus查询SMF网元的概要分析报表。其它网元（例如AMF、PCF、AUSF、UDM、UDR、NRF、NSSF）的概要分析报表的查询操作与之类似，本文不再赘述。
相关信息 :在EMSPlus客户端的CHR页面，选择左侧导航树的数据分析→概要分析→全网
，可以查看最近1小时内全网各网元的业务失败数据统计，如[图1]所示。
图1  概要分析（全网）

单击饼状图中的某个网元，也可以跳转到该网元的概要分析报表。例如单击饼状图中的SMF网元，跳转到SMF的概要分析，如[图2]所示。
步骤 :在EMSPlus客户端的CHR页面，选择左侧导航树的数据分析→概要分析→SMF
，页面右侧会自动展示SMF网元在最近1小时内的业务失败数据统计，查看5个维度的统计分析图，如[图2]所示。
用户可以查看每个指标的占比和Top N排名情况。 
图2  概要分析（SMF）

按钮|使用说明
---|---
|跳转到趋势分析，参见“查询通用趋势分析”。当前的查询条件（包括起止时间）会自动带入趋势分析的高级查询框作为过滤条件。
|直接跳转到XDR，查看失败业务详单，参见“查询通用日志”。当前的查询条件（包括起止时间）会自动带入通用日志查询的高级查询框作为过滤条件。
|将当前的概要分析报表查询保存到收藏夹中（收藏的报表的查询条件不包括起止时间），详细操作参见相关任务。
|将当前的统计图最大化。
|退出最大化模式。
|如果无需关注某个统计项，可以单击下方的颜色，将该颜色对应的统计项隐藏掉。
在可输入高级过滤条件输入框输入指定的查询条件，对该条件下的失败记录进行高效的概要分析。
查询条件支持多字段结合逻辑表达式，例如EventID='7107' and InnerCause='70322' and IMSI_SUPI='460************'，如[图3]所示。
图3  高级过滤条件

单击起止时间，选择查询的时间段，如[图4]所示。单击，系统会统计指定时间段内的业务失败数据。
图4  选择查询时间段

单击维度右侧Top N下拉列表框，选择查询的Top范围，如[图5]所示。
图5  选择查询Top范围

在统计图中，单击某一个统计项，可以对这个统计项进行钻取分析，最终可以钻取到XDR，如[图6]所示。
 说明： 
SMF概览分析报表中各维度的钻取关系说明参见“[SMF概要分析简介]”。
概要分析中附带的条件会自动填入XDR界面的Input Advanced Query Condition输入框中，XDR上的操作参见“[查询通用日志]”。
图6  网元业务数据详单

相关任务 :将概要分析报表查询保存到收藏夹： 
在报表统计分析图（如[图2]所示），单击右上角的按钮，打开修改书签对话框，如[图7]所示。
图7  修改书签对话框

参数名称|参数说明
---|---
名称|书签的名称。
文件夹|书签保存的目录，包括：书签栏：默认存放各个网元预定义的报表。其他书签：存放临时或者与用户相关的报表。
（可选）单击更多，在弹出的对话框中新建文件夹，如[图8]所示。
图8  新建文件夹

设置书签的名称，以及书签保存的目录，单击完成，该书签保存到收藏夹的书签栏/其他书签栏或其子目录中，如[图9]所示。
图9  收藏夹

##### SMF概要分析简介 
EMSPlus系统提供了预定义的SMF概要分析报表，可以基于几种常见的维度对SMF网元相关的失败业务进行分析，如[图1]所示。
图1  SMF概要分析示例

SMF的概要分析包含了如下几种统计分析图，每张统计分析图都支持多级钻取，最终钻取到网元业务数据详单（XDR）：
EventID：失败事件Top N统计，其查询结果钻取路径如图2所示。图2  EventID钻取路径 
IMSI_SUPI：失败次数最多的Top N用户（IMSI/SUPI）统计，其查询结果钻取路径如图3所示。图3  IMSI/SUPI钻取路径 
NFID：失败次数最多的Top N SMF网元统计，其查询结果钻取路径如图4所示。图4  NFID钻取路径 
RAT：失败次数最多的Top N无线接入方式（RAT）统计，其查询结果钻取路径如图5所示。图5  RAT钻取路径 
ReqAPNDNN：失败次数最多的Top N APN/DNN统计，其查询结果钻取路径如图6所示。图6  APN/DNN钻取路径 
##### AMF概要分析简介 
EMSPlus系统提供了预定义的AMF概要分析报表，可以基于几种常见的维度对AMF网元相关的失败业务进行分析，如[图1]所示。
图1  AMF概要分析示例

AMF的概要分析包含了如下几种统计分析图，每张统计分析图都支持多级钻取，最终钻取到网元业务数据详单（XDR）：
EventID：失败事件Top N统计，其查询结果钻取路径如图2所示。图2  EventID钻取路径 
IMSI_SUPI：失败次数最多的Top N用户（IMSI/SUPI）统计，其查询结果钻取路径如图3所示。图3  IMSI/SUPI钻取路径 
TacRac：失败次数最多的Top N位置信息（TAC/RAC）统计，其查询结果钻取路径如图4所示。图4  TAC/RAC钻取路径 
NFID：失败次数最多的Top N AMF网元统计，其查询结果钻取路径如图5所示。图5  NFID钻取路径 
#### 查询专题分析报表 
摘要 :EMSPlus提供了一些常用的专题KPI分析报表，列出最近7天的关键KPI指标分析。针对某一天数据，还可以支持钻取分析，查看当天24小时分时数据统计，并支持进一步钻取到网元业务数据详单（XDR）。
 说明： 
本节以“EPS回落失败总览报表”为例，介绍如何通过EMSPlus查询网元的专题分析报表。其它专题分析报表的查询方法与之类似。
步骤 :在EMSPlus客户端的CHR页面，选择左侧导航树的数据分析→专题分析→SMF→EPS Fallback失败总览
，页面右侧自动展示最近7天的EPS回落失败数据统计，以及最典型的4种回落失败的原因统计，如[图1]所示。
图1  EPS回落失败统计

单击任意一天的数据，系统可以进一步查看当天24小时分时数据统计，如[图2]所示。
图2  24小时分时数据统计

在4种典型的回落失败的原因统计图上，单击统计项，还可以进一步钻取，最终查询到XDR，如[图3]所示。
专题分析中附带的条件会自动填入XDR界面的Input Advanced Query Condition输入框中，XDR上的操作参见“[查询通用日志]”。
图3  失败详单

#### 专家模式 
除了预定义的概要分析和专题分析报表之外，EMSPlus还提供了专家模式，为专家级用户提供各种自定义的条件查找和失败事件分析。
EMSPlus系统支持多条件逻辑表达式的组合查询、随心钻取分析等功能，为分析业务失败原因、处理用户投诉、快速定位故障提供方便，帮助运营商提升KPI，降低运维复杂度，提升运维效率。
##### 查询通用日志 
摘要 :本节介绍如何按照自定义条件查询网元的失败日志。 
步骤 :在EMSPlus客户端的CHR页面，选择左侧导航树的数据分析→专家模式→通用日志查询
，打开专家模式(通用日志查询)页面，如[图1]所示。
 说明： 
系统最多可以同时打开3个通用日志查询页面，并在页签右上角以数字显示。 
图1  通用日志查询

单击More Conditions，展开更多条件区域，如[图2]所示。
图2  通用日志查询条件

参数名称|参数说明
---|---
|默认查询4小时内的日志，最多可查询3天范围内日志数据。
Records|查询结果显示的记录数。
IMSI_SUPI|根据用户的IMSI号码，查询该用户的上网日志信息。
MSISDN_GPSI|根据用户的手机号码，查询该用户的上网日志信息。
NFType|如果需要查询指定的网元类型，单击Please select区域，选择需查询的网元类型。其中：in：查询选择的网元类型的日志数据。not in：查询除这些网元之外的网元类型的日志数据。
NFID|如果需要查询指定的网元ID，单击，并选择具体的网元。其中：in：查询选择的网元的日志数据。not in：查询除这些网元之外的网元的日志数据。
Cause|如果需要按照指定失败原因进行查询，单击，并选择失败原因。其中：in：查询选择的失败原因的日志数据。not in：查询除这些原因之外的失败原因的日志数据。
Sequential|选择查询结果是否按照时间排序。
Failure Logs|选择是否只搜索业务失败日志。
Valid Fields|选择在Detail Content区域，是否只显示有数据的字段。
Input Advanced Query Condition|多字段结合逻辑表达式的高级查询条件区域，可以按照自定义的条件进行查询。
按钮|使用说明
---|---
|跳转至NFType的概要分析，参见“查询概要分析报表”。单击统计项进行钻取分析，最终可以钻取到网元业务数据详单（XDR）。对应的查询条件会带入概要分析中。
|跳转至通用趋势分析，参见“查询通用趋势分析”。对应的查询条件会带入通用趋势分析中。
|将当前的通用日志查询保存到收藏夹中（收藏的查询条件不包括起止时间）。
根据实际需要，输入日志的查询参数，便于用户分析定位问题。 
（可选）如果需要定制查询结果的字段，单击按钮，选择需要显示的字段，并单击Confirm按钮，如[图3]所示。
图3  选择结果中的字段

（可选）如果需要选择一种或多种网元类型，单击NFType中的输入框，从下拉列表框中选择网元类型，如[图4]所示。
图4  选择网元类型

（可选）如果需要选择指定的网元，单击NFID后面的。在弹出的对话框中选择网元，并单击按钮，将其添加到右侧列表中，单击OK按钮，如[图5]所示。
图5  选择网元号

单击按钮，查询结果显示在页面下方，如[图6]所示。
查询结果左侧的列表区域显示网元的业务记录信息。 
图6  报表查询结果

按钮|使用说明
---|---
|导出报表查询结果，导出的文件支持Excel和CSV格式，如图7所示。默认不选中Full Scale：仅导出表格中的数据。选中Full Scale：由于表格最多只展示4000条数据，选中Full Scale，可以导出全部的数据（全量）。最大可以导出5万条数据。CHR报表导出任务结果显示在窗口右上侧的中。
|报表查询结果中的列排序。单击该按钮，在打开的对话框中选中某一项，按住鼠标上下拖拽。如果列顺序发生改变，则OK按钮立即激活，如图8所示。单击OK按钮，表格按最新的列顺序显示。
图7  数据导出

图8  列排序

单击列表区域某一条业务记录，查询结果右侧的Detail Content区域显示该条记录的详细信息。
 说明： 
关闭查询结果页面后，再次打开查询页面，系统默认会记住上次查询使用的条件。 
相关任务 :右击Detail Content区域的字段，选择快捷菜单，如[图9]所示，可执行相关的操作。
图9  快捷菜单

快捷菜单功能如下： 
Apply as Filter：添加高级查询条件 
Column Statistics：按字段统计日志数据 
Trend Analysis：跳转到趋势分析，参见“查询通用趋势分析” 
Add Column：设置查询结果列 
###### 添加高级查询条件 
摘要 :EMSPlus系统支持多字段结合逻辑表达式的高级查询条件。维护人员可以从查询结果的Detail Content中选择需要查询的字段，将其添加到高级查询条件区域，并再次进行查询。
例如，如果需要查询在某个时间段内的所有EventID为10008，且失败原因码为2的日志，可按照如下步骤进行操作。
步骤 :在EMSPlus客户端的CHR页面，选择左侧导航树的数据分析→专家模式→通用日志查询
，打开专家模式(通用日志查询)页面，如[图1]所示。
图1  通用日志查询

单击按钮，查询结果显示在页面下方，如[图2]所示。
图2  报表查询结果

右击Detail Content区域某一字段，例如EventID=10008，在弹出的快捷菜单中选择[Apply as Filter→Selected]，如[图3]所示，系统自动在自定义输入框中生成该查询条件，如[图4]所示。
图3  Detail Content区域添加字段到高级查询条件区

参数名称|参数说明
---|---
Selected|从所有查询结果中筛选拥有此字段对应信息的结果。单次查询不可重复选择，且与Not Selected不可以同时选择。
Not Selected|从所有查询结果中筛选不拥有此字段对应信息的结果。单次查询不可重复选择，且与Selected不可以同时选择。
... and Selected|从所有查询结果中筛选同时满足and Selected前后条件的对应信息结果，可重复选择。
... or Selected|从所有查询结果中筛选满足or Selected前后任意一条或者两条条件的对应信息结果，可重复选择。
... and not Selected|从所有查询结果中筛选同时满足and not Selected前后条件的对应信息结果，可重复选择。
... or not Selected|从所有查询结果中筛选满足or not Selected前后任意一条或者两条条件的对应信息结果，可重复选择。
图4  成功添加至高级查询条件区1

右击Detail Content区域某一字段，例如Cause=2，在弹出的快捷菜单中选择[Apply as Filter→... and Selected]，系统自动在自定义输入框中生成该查询条件，如[图5]所示。
图5  成功添加至高级查询条件区2

 说明： 
在高级查询条件区域，也可手动输入查询语句。 
在高级查询条件区域手动输入查询条件时，系统会自动检查输入的表达式是否合法。 
单击，可以查询到所有符合此条件的失败日志。
###### 按字段统计日志数据 
摘要 :在日志查询结果中，EMSPlus系统支持按照任意字段进行统计，统计出各种查询结果值的数量和占比。在统计出的饼图中，系统还支持随心钻功能，对任意一个结果值进行钻取，进一步查询符合条件的网元业务数据详单（XDR）。
步骤 :在EMSPlus客户端的CHR页面，选择左侧导航树的数据分析→专家模式→通用日志查询
，打开专家模式(通用日志查询)页面，如[图1]所示。
图1  5GC报表查询页面

单击按钮，查询结果显示在页面下方，如[图2]所示。
图2  5GC报表查询结果

右击Detail Content区域某一字段，例如StartTime，继续统计这个用户的所有失败事件，如[图3]所示。
图3  Detail Content区域统计日志数据

选择快捷菜单Column
Statistics，EMSPlus系统根据StartTime字段进行统计，展示出这个用户各种失败事件的次数和百分比，如[图4]所示。
图4  统计页面显示

（可选）单击，可以跳转到趋势分析，参见“[查询通用趋势分析]”。
####### 相关操作 
在图4页面，单击Statistics for StartTime区域圆饼图上方的Topic/Item，使其颜色变灰，则此Topic/Item的统计信息不显示在圆饼图中，如图5所示。图5  统计页面显示 
在圆饼图中，单击Topic/Item项目所在色块，可以直接对该项目进行钻取，系统自动将当前的查询条件带入自定义查询框中，并查询出符合条件的所有XDR，如图6所示。图6  自定义查询框 
###### 设置查询结果列 
摘要 :在日志查询结果中，系统会默认显示一些常用的字段作为表格列。而在右侧的Detail Content区域中，系统会显示日志中包含的所有字段。如果维护人员对某一个字段比较关注，但默认并未显示在查询结果列中，可以将其手工添加至查询结果表格列。
步骤 :在EMSPlus客户端的CHR页面，选择左侧导航树的数据分析→专家模式→通用日志查询
，打开专家模式(通用日志查询)页面，如[图1]所示。
图1  通用日志查询

单击按钮，查询结果显示在页面下方，如[图2]所示。
图2  报表查询结果

右击Detail Content区域需要添加的列的字段，例如StartTimeMill，如[图3]所示。
图3  Detail Content区域添加列

选择快捷菜单Add Column，将字段添加到查询结果中的最后一列，如[图4]所示。
图4  成功添加列至查询结果

####### 相关操作 
单击查询结果中字段名后面的按钮，即可将此字段从查询结果中删除。 
单击查询结果下方的按钮，拖动字段名，单击OK，可调整字段在查询结果中显示的顺序。单击Reset，可恢复到操作前设置。图5  调整字段顺序 
##### 查询通用趋势分析 
摘要 :查看失败频次排名靠前的这些指标值的变化趋势。 
针对某个维度，例如EventID，系统对起止时间进行切割，切成12个时间段，显示指标在12个时间段的总量（失败次数的总计）和TopN指标值的变化趋势。
步骤 :在EMSPlus客户端的CHR页面，选择左侧导航树的数据分析→专家模式→通用趋势分析
，打开专家模式(通用趋势分析)页面。默认显示所有维度的指标值总量的变化趋势，如[图1]所示。
图1  通用趋势分析

参数名称|参数说明
---|---
|默认查询1小时内的日志，最多可查询3天范围内日志数据。
维度|可按维度查询指标值的变化趋势。
TopN|默认显示Top3，最多Top5。
可输入高级过滤条件|多字段结合逻辑表达式的高级查询条件区域，可以按照自定义的条件进行查询。
根据实际需要，输入日志的查询参数。 
单击按钮，查询结果显示在页面下方，显示所选维度的失败次数最多的TopN指标值的变化趋势，如[图2]所示。
图2  通用趋势分析查询结果

单击趋势图上方的Total或者指标的色块，使其颜色变灰，则不显示选中指标值的趋势图，如[图3]所示。
图3  过滤趋势图

单击某个时间段的趋势图数据点或柱状图，跳转到XDR（网元业务数据详单），如[图4]所示。
趋势分析中附带的条件会自动填入XDR界面的Input Advanced Query Condition输入框中，XDR上的操作参见“[查询通用日志]”。
图4  XDR

## 缩略语 
## 缩略语 
5GC :5G Core Network5G核心网
AMF :Access and Mobility Management Function接入和移动管理功能
APN :Access Point Name接入点名称
AUSF :Authentication Server Function鉴权服务器功能
DCU :Data Collection Unit数据采集单元
DNN :Data Network Name数据网名称
IMSI :International Mobile Subscriber Identity国际移动用户标识
### KPI 
Key Performance Index关键性能指标
MDS :Message Dispatch Service消息分发服务
MME :Mobility Management Entity移动管理实体
MU :Merging Unit合并单元
NF :Network Function网络功能
NRF :NF Repository Function网络功能仓储
NSSF :Network Slice Selection Function网络切片选择功能
PCF :Policy Control Function策略控制功能
### RAC 
Routing Area Code路由区域码
RAT :Radio Access Technology无线接入技术
SGSN :Serving GPRS Support Node服务GPRS支持节点
SMF :Session Management Function会话管理功能
SUPI :Subscriber Permanent Identifier用户永久标识
### TAC 
Tracking Area Code跟踪区域码
UDM :Unified Data Management统一数据管理
UDR :Unified Data Repository统一数据存储
UPF :User Plane Function用户平面功能
VNF :Virtualized Network Function虚拟化网络功能
### XDR 
x(Application) Data Record应用数据记录
ZTE :Zhongxing Telecommunications Equipment中兴通讯
## Hadoop业务 
特性描述 :术语 :术语|含义
---|---
DAP ZDH|基于Hadoop架构的分布式大数据存储/计算平台，提供海量数据的采集、存储和计算能力。
DAP Manager|为ZDH提供安装、配置、运维、安全等体系化的管理能力。
HadoopLoader|用于将本地文件加载到HDFS。
DCU|数据采集单元，与具体网元对接，实现数据的接收与处理（清洗、聚集）。
描述 :定义 :EMSPlus的Hadoop业务支持将IPDR记录，按照运营商定制的Parquet格式，推送运营商的Hadoop集群中。
应用场景 :当运营商需要将EMSPlus的IPDR记录推送到第三方Hadoop集群时，可使用该功能。
客户收益 :收益方|收益说明
---|---
运营商|提升运营商的网元统计能力和故障定位手段。
终端用户|此特性对终端用户不可见。
实现原理 :实现原理 :系统架构 :EMSPlus的Hadoop业务，整体流程如[图1]所示。
图1  Hadoop业务流程

EMSPlus的Hadoop集群接收EMSPlus的LOG局DCU模块北向推送的csv.gz压缩文件，并通过HadoopLoader解压成csv文件上传到HDFS文件系统。转换功能会读取csv文件将文件转成parquet格式存储。同时，推送功能将转换后的parquet文件推送至客户的Hadoop集群。 
涉及网元 :本特性由网元单独实现，无需其他网元的配合。 
系统影响 :本特性不涉及对系统的影响。 
应用限制 :目前只支持特定运营商的parque文件转换功能。 
特性交互 :本特性与EMSPlus的北向特性有功能交互。 
遵循标准 :本特性采用ZTE内部的接口和协议，不涉及标准协议。
特性能力 :该特性不涉及规格指标。 
可获得性 :可获得性 :版本要求及变更记录 :特性版本|发布版本|发布说明
---|---|---
01|V5.20.10|首次发布。
License要求 :本特性为EMSPlus为定制开发特性，EMSPlus无需License支持。Hadoop平台DAP Manager的licence需要由DAP产品提供。 
对其他网元的要求 :本特性对其它网元无要求。 
O&M相关 :O&M相关 :命令 :本特性不涉及命令的变化。 
性能统计 :该特性不涉及计数器的变化。 
告警与通知 :该特性会新增告警信息，具体告警信息参考告警文档。 
失败观察 :该特性不涉及业务观察/失败观察的变化。 
话单与计费 :该特性不涉及话单与计费的变化。 
特性操作 :#### DAP Manager的使用与维护 
概述 :DAP Manager为基于Hadoop架构的分布式大数据存储/计算平台，提供安装、配置、运维、安全等体系化的管理能力。 
步骤 :查看集群主机状态信息客户端PC的浏览器地址栏中输入https://<manager节点EMS网络平面的双机 浮动IP地址:21180>，登录到DAP Manager客户端窗口。默认初始用户名为admin， 默认密码为Emsplus__123。选择Host→Host Management查看各主机的状态信息，如图1所示。图1  查看集群主机状态信息 
查看集群服务状态信息选择Cluster→Service Management查看各主机的状态信息，如图2所示。图2  查看集群服务状态信息 
查看集群告警信息选择Maintenance→Alarm Information，默认显示Active alarm页签,，查看集群当前告警，如图3所示。图3  查看当前告警切换到History alarm页签，查看集群历史告警，如图4所示。图4  查看历史告警 
#### Parquet文件格式转换功能的使用与维护 
概述 :文件格式转换功能负责将csv格式文件转换成客户要求的parquet格式。 
步骤 :检查格式转换功能配置参数登录到namenode-1节点，格式转换功能的配置文件transparquet.properties在/ubas/ZXUN-EMSPLUS/server/application/conf目录下，查看格式转换功能参数。#implementing timing task, normally configured as 30~60 min
emsplus.transparquet.transparquet.cron=0 0/30 * * * ?
#Aging period of files pushed successfully. Default: Seven days, unit: Hours
emsplus.transparquet.succeedfile.timeout=168 
#Aging period of files that failed to be pushed. Default: Seven days, unit: Hours
emsplus.transparquet.failedfile.timeout=168 
#Restriction on the size of a single parquet file, unit: M
emsplus.transparquet.parquetfile.size=150
#hdfs root directory threshold, which should be configured according to the actual storage 
size of the cluster. The total storage should be 70%, unit: GB.
emsplus.transparquet.disk.max.size=1000
#man node control-plane floating ip of emsplus, used for reporting alarm
emsplus.alarm.ip=10.42.190.149 
启动和关闭parquet格式转换功能默认情况下格式转换功能已经部署启动好的。如果要启动格式转换功能，请登录到namenode-1节点， 进入到/ubas/ZXUN-EMSPLUS/server/application/conf目录执行如下命令启动转换功能。[omc@namenode-1 ~]$ cd /ubas/ZXUN-EMSPLUS/server/application
[omc@namenode-1 ~]$ ./CancelMonitorWD.sh
[omc@namenode-1 ~]$ ./MonitorWD.sh如果要停止格式转换功能，请登录到namenode-1节点，执行如下命令。[omc@namenode-1 ~]$ cd /ubas/ZXUN-EMSPLUS/server/application
[omc@namenode-1 ~]$ ./CancelMonitorWD.sh 
查看格式转换功能是否正常工作如果要查看格式转换功能是否正常工作，可以通过日志来判断。请登录到namenode-1节点，进入/ubas/ZXUN-EMSPLUS/server/application/logs目录，vim命令查看 MonitorWD.log日志。到文件最底部查看最新日志，正常工作时的日志如图1所示。如果工作异常，日志中会有报错信息，一般根据报错信息可以定位和解决问题。[omc@namenode-1 ~]$ cd /ubas/ZXUN-EMSPLUS/server/application/logs
[omc@namenode-1 ~]$ vim MonitorWD.log图1  格式转换功能正常工作时的日志信息 
#### 文件推送功能的使用与维护 
概述 :文件推送功能将EMSPlus的Hadoop集群中转换完成的parquet文件推送到客户的Hadoop集群。 
步骤 :检查文件推送功能主要配置参数登录到namenode-1节点，文件推送功能的配置文件hadoop_push.conf在/ubas/push/conf目录下。# Destination address
dstDir=/user/zte/EMSPlus
# Source Directory Loop Scan Interval (s)
scanInterval=900
# Times of reattempt for push failure
failedPushTime=3 
# Retry interval for push failure (s)
failedPushInterval=1200
# Alarm service interface. Modify the floating of the control plane of 
the man node whose ip is ems+ ip
alarm_url=https://ip:8988/uniportal/zdh/entryServlet 
开启和关闭文件推送功能默认情况下文件推送功能已经部署启动完成。如果要启动文件推送功能，请登录到namenode-1节点， 进入到/ubas/push/script目录执行如下命令启动转换功能。[omc@namenode-1 ~]$ cd /ubas/push/script
[omc@namenode-1 ~]$ ./cancel_monitor.sh
[omc@namenode-1 ~]$ ./monitor_push.sh如果要停止文件推送功能，请登录到namenode-1节点，执行如下命令。[omc@namenode-1 ~]$ cd /ubas/push/script
[omc@namenode-1 ~]$ ./cancel_monitor.sh 
查看文件推送功能是否正常工作如果要查看文件推送功能是否正常工作，可以通过日志来判断。请登录到namenode-1节点，进入 /ubas/push/log目录，vim命令查看hadoop_push.log日志。移动到文件最底部查看最新日志，正常工作时的日志如图1所示。如果工作异常，日志中会有报错信息，一般根据报错信息可以定位和解决问题。图1  文件推送功能正常工作时的日志信息 
## 缩略语 
## 缩略语 
### CDR 
Call Detail Record呼叫详细记录，即话单
DCU :Data Collection Unit数据采集单元
### NE 
Network Element网络单元（网元）
ZTE :Zhongxing Telecommunications Equipment中兴通讯
## 支持业务网元PING功能 
特性描述 :术语 :术语|含义
---|---
业务网元|与EMSPlus对接的业务网元，如：SMF、UPF等。
MDS|EMSPlus系统中与业务网元对接的模块，实现业务数据的采集和分发功能。
描述 :定义 :业务网元Ping功能是指在EMSPlus接口地址所在的网口添加静态路由信息，帮助操作人员在网元侧使用Ping功能判断业务网元与EMSPlus之间的通断情况。
背景知识 :操作人员常使用PING的结果来作为网络通断的标志。而EMSPlus的对外接口地址所在网口在业务进程启动后会被托管，导致从业务网元侧无法ping通，因此操作人员无法直接使用PING来检查业务网元和EMSPlus之间的网络通断情况。
应用场景 :当EMSPlus与业务网元断链时，该功能可以帮助维护人员进行故障定位。
客户收益 :对运营商和用户的受益说明参见[表1]。
收益方|收益说明
---|---
运营商|用于检查EMSPlus与业务网元的连接情况，方便维护人员对系统进行维护操作。
终端用户|该功能对终端用户不可见。
实现原理 :系统架构 :PING功能实现原理如[图1]所示。
图1  实现原理

涉及网元 :涉及的网元及其功能参见[表1]。
网元|描述
---|---
EMSPlus|电信云及核心网增值网管，通过MDS节点接入交换机。
业务网元|核心网CS/PS网元，通过EMSPlus实时输出CHR。
本网元实现 :通过在EMSPlus的MDS节点正确配置静态路由信息，响应业务网元发送的构建ICMP请求数据包，从而实现业务网元和EMSPlus之间的网络连通检查。
业务流程 :该特性不涉及到业务流程。 
系统影响 :该特性不涉及对系统的影响。 
应用限制 :该特性不涉及应用限制。 
特性间交互 :该特性不涉及与其他特性的交互。 
遵循标准 :本特性所遵循的标准为： 
ICMP协议（Internet Control Message Protocol）
特性能力 :该特性不涉及规格指标。 
可获得性 :版本要求及变更记录 :特性版本|发布版本|发布说明
---|---|---
01|V5.20.10|首次发布。
License要求 :该特性为EMSPlus的基本特性，无需License支持。
对其他网元的要求 :该特性不涉及对其它网元的要求。 
O&M相关 :命令 :该特性不涉及配置命令的变化。 
性能统计 :该特性不涉及计数器的变化。 
告警与通知 :该特性不涉及告警消息的变化。 
失败观察 :该特性不涉及业务观察/失败观察的变化。 
##### 计费 
该特性不涉及话单与计费的变化。 
特性配置 :配置说明 :为了保证EMSPlus中每个MDS虚机与每个对接的业务网元间网络的正常，需要在每个MDS虚机上进行静态路由配置，每个MDS虚机都需要配置与每个对接的业务网元的路由。
例如：EMSPlus接入了SMF和UPF两个业务网元，则需要分别在每个MDS虚机上配置到这两个业务网元的静态路由到指定文件。
 说明： 
以下操作以配置与SMF网元的路由为例。EMSPlus与其它业务网元的静态路由配置方法与之类似。
配置前提 :在进行本操作配置前以下相关配置需要提前配置好： 
防火墙：已经设置允许PING消息通过。 
路由：从业务网元到EMSPlus的路由已经打通。 
#### 数据准备 
在进行配置前，需要获取如下信息： 
EMSPlus侧与SMF对接的网卡信息网卡名称通过SSH方式登录到MDS虚机操作系统的命令行终端，执行ifconfig -a，通过IP地址与LLD配置进行对比，找到与SMF网元对接的网卡名称，如eth1_0。[omc@mds1 ~]$ ifconfig -a
......
eth1_0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
        inet 10.228.62.148  netmask 255.255.255.0  broadcast 10.228.62.255
        inet6 fe80::f816:3eff:fe59:d72e  prefixlen 64  scopeid 0x20<link>
        ether fa:16:3e:59:d7:2e  txqueuelen 1000  (Ethernet)
        RX packets 3537909  bytes 243987618 (232.6 MiB)
        RX errors 0  dropped 0  overruns 0  frame 0
        TX packets 68  bytes 4218 (4.1 KiB)
        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0网关地址从LLD配置或者VIM上查询获取EMSPlus与SMF网元对接平面的网关地址。 
获取SMF侧对接EMSPlus的网络信息从LLD配置或者VIM上查询获取SMF网元对接EMSPlus的网络平面的CIDR信息。 
#### 配置静态路由文件 
摘要 :以下介绍如何增加网络路由。 
增加网络路由时，需要根据现场环境实际情况在/etc/sysconfig/static-routes中增加静态路由配置。若系统中没有该文件，则可以使用[touch]命令手工创建该文件，再编辑该文件以增加路由参数。参数数据为[数据准备]中获取的数据。
步骤 :在static-routes文件中添加如下内容增加网络路由。
 说明： 
仅支持如下两种格式的参数配置，仅使用其中一种即可，请勿使用其它格式。 
`方式一：
any net 10.228.63.0/24 gw 10.228.62.1 dev eth1_0
方式二：
any net 10.228.63.0 netmask 255.255.255.0 gw 182.168.36.1 dev eth1_0` 
其中： 
10.228.63.0/24是SMF网元侧与EMSPlus对接所用网络平面的CIDR信息。 
10.228.62.1是EMSPlus侧与SMF网元对接所用网络平面的网关地址。 
eth1_0是MDS虚机上与SMF网元对接所用的网卡。 
#### 运行静态路由配置脚本 
摘要 :本节介绍如何将静态路由配置文件添加到系统定时任务中，以保证配置的静态路由持续有效。 
步骤 :通过SSH方式登录到MDS虚机操作系统的命令终端。
切换到$ZXHOME目录下，执行[sh] addmdsroute.sh命令，将配置的静态路由增加到系统中。
`[omc@mds1 ~]$cd $ZXHOME
[omc@mds1 server]$sh addmdsroute.sh` 
若有报错，可参考[如何验证静态路由参数]检查静态路由文件中的配置及格式是否正确。
#### 确认脚本执行结果 
摘要 :本节介绍如何确认静态路由是否有效，且已添加到系统定时任务中。 
步骤 :执行[route]命令，查看其输出确认所配置的路由已经加到系统中。
`[omc@mds1 server]$ route
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
10.228.62.0     0.0.0.0         255.255.255.0   U     0      0        0 eth1_0
10.228.63.0     10.228.62.1     255.255.255.0   UG    0      0        0 eth1_0` 
以上示例中，蓝色部分即表示已存在新增的路由信息。 
通过如下命令，确认/etc/crontab中已经增加了addmdsroute.sh的5分钟定时任务。
`[omc@mds1 server]$ grep "^*/5" /etc/crontab | grep "addmdsroute.sh"
*/5 * * * * omc  /ubas/ZXUN-EMSPLUS/server/addmdsroute.sh` 
#### 在网元侧使用PING检查网络状态 
在SMF网元侧使用PING工具ping EMSPlus的接口地址，检查PING的结果。
若无法ping通EMSPlus的接口地址，则需要检查SMF网元与EMSPlus间的网络配置。
常见问题处理 :#### 如何验证静态路由参数 
一种验证静态路由文件配置格式正确的方法是在命令行中手工执行[route add]指令，参数为配置文件中的一行，不含any字样。例如：
`route add -net 10.228.63.0/24 gw 10.228.62.1 dev eth1_0` 
若命令执行失败则说明该配置是存在问题，需要根据命令提示进行调整。 
## 缩略语 
## 缩略语 
CHR :Call History Record呼叫历史记录
### CIDR 
Classless Inter-Domain Routing无类别域间路由
### CS 
Circuit Switched电路交换
### ICMP 
Internet Control Message ProtocolInternet控制报文协议
IP :Internet Protocol因特网协议
### LLD 
Low Level Design详细设计
MDS :Message Dispatch Service消息分发服务
### PS 
Packet Switched分组交换
SMF :Session Management Function会话管理功能
### SSH 
Secure Shell安全外壳
UPF :User Plane Function用户平面功能
VIM :Virtualized Infrastructure Manager虚拟化基础设施管理系统
## FTU功能 
特性描述 :术语 :术语|含义
---|---
FTU|文件转换单元，将文件接口的日志转换为消息接口的消息发送给MDS。
描述 :定义 :FTU功能用于将版本为V5.X的业务网元的文件接口适配转换为MDS的消息接口。EMSPlus提供了FTU的任务模板导入以及命令行的分发配置。
背景知识 :为了与目前已经商用的一些V5.X的业务网元（如PCRF、SPR等）对接，EMSPlus定制了FTU模块，将接收到的文件转换为日志消息发给MDS进行后续处理。
应用场景 :本特性用于EMSPlus对接文件接口的网元，需要使用到FTU节点的情况，一般由中兴通讯提供FTU任务模板文件，在现场导入。
客户收益 :

 对运营商和用户的受益说明参见[表1]。


收益方|收益说明
---|---
运营商|可以对接更多的V5.X网元，为客户输出有价值的数据。
终端用户|此特性对终端用户不可见。


实现原理 :系统架构 :FTU节点采用主流的数据收集工具的架构，主要包含Reader、Parser和Sender，用于FTU节点的数据采集、内容解析和消息传递，如[图1]所示。
图1  FTU节点实现原理

涉及网元 :该特性由本网元单独实现，无需其他网元的配合。 
本网元实现 :EMSPlus将版本为V5.X的业务网元的文件接口通过FTU模块，转换为MDS的消息接口。
EMSPlus通过导入模板以及命令行的分发配置，实现文件读取、转换和转发工作。
业务流程 :图2  业务流程图

业务流程描述如下： 
网元（NE）发送文件接口的日志到EMSPlus。
EMSPlus的FTU节点读取 文件接口，转换为消息接口的日志，并转发给MDS节点；
MDS正常接收消息接口的日志并处理分发。 
系统影响 :该特性不涉及对系统的影响。 
应用限制 :该特性不涉及应用限制。 
特性间交互 :该特性不涉及与其他特性的交互。 
遵循标准 :本特性采用中兴通讯内部的接口和协议，不涉及标准协议。 
特性能力 :该特性不涉及规格指标。 
可获得性 :版本要求及变更记录 :特性版本|发布版本|发布说明
---|---|---
01|V5.21.10|首次发布。
License要求 :该特性为EMSPlus网元的基本特性，无需License支持。
对其他网元的要求 :该特性不涉及对其他网元的要求。 
O&M相关 :命令 :新增配置项参见[表1]。
命令|描述
---|---
ADD FTUDSPCFG|Add FTU Dispatch Configuration
DEL FTUDSPCFG|Delete FTU Dispatch Configuration
SHOW FTUDSPCFG|Show FTU Dispatch Configuration
SHOW FTUTASK|Show FTU Task Name
ADD FTUTASKCFG|Add FTU Task Configuration
SET FTUTASKCFG|Set FTU Task Configuration
DEL FTUTASKCFG|Delete FTU Task Configuration
SHOW FTUTASKCFG|Show FTU Task Configuration
SYNC FTUCFG|SYNC FTU Configuration
性能统计 :该特性不涉及计数器的变化。 
告警与通知 :该特性不涉及告警消息的变化。 
失败观察 :该特性不涉及业务观察/失败观察的变化。 
##### 计费 
该特性不涉及话单与计费的变化。 
特性配置 :配置特性 :配置说明 :本节介绍如何配置FTU的分发任务。 
配置前提 :执行该配置需要的前提条件，包括需要准备的工具、文件、基础配置和预先规划的数据。例如： 
EMSPlus系统已配置FTU模块。 
已从ZTE获取FTU任务的模板文件。 
配置过程 :[导入FTU任务模板]
[创建FTU分发配置]
[创建FTU分发任务]
[同步FTU配置]
##### 导入FTU任务模板 
摘要 :导入FTU任务模板，模板中的内容用于支持FTU的任务配置，使FTU正常工作。FTU任务模板由中兴通讯提供。 
前提 :已从ZTE获取FTU任务模板文件。 
已登录EMSPlus客户端。 
步骤 :在EMSPlus客户端，选择菜单System→Export/Import
，并切换到FTU页面，如[图1]所示。
图1  FTU页面

单击Select Files按钮，选择模板文件后，单击Submit，如[图2]所示。
图2  导入FTU分发模板

##### 创建FTU分发配置 
摘要 :FTU分发配置用于创建FTU分发组（Group ID）与MDS节点IP的对应关系。 
FTU节点按照配置的不同分发策略，将日志数据分发到指定MDS节点。 
前提 :已登录EMSPlus客户端。
步骤 :在EMSPlus客户端的Terminal窗口，执行[ADD FTUDSPCFG]命令，增加FTU分发配置，如[图1]所示。
图1  创建FTU分发配置

参数名称|参数说明
---|---
GROUPID|FTU分发组号。FTU对同一组中的多个IP地址按照策略进行业务日志的分发。
IP|MDS接口地址。该IP地址是MDS节点接收业务日志的IP地址。
##### 创建FTU分发任务 
摘要 :FTU模块根据任务名配置不同分发策略，将接收到的日志分发到目标。 
前提 :已创建FTU分发配置。 
已登录EMSPlus客户端。 
步骤 :在EMSPlus客户端的Terminal窗口，执行[SHOW FTUTASK]命令，先查询系统中的FTU任务名称，如[图1]所示。
图1  查看FTU任务配置

在EMSPlus客户端的Terminal窗口，执行[ADD FTUTASKCFG]命令，增加FTU任务配置，如[图2]所示。
图2  增加FTU任务配置

参数名称|参数说明
---|---
Module No.|FTU的模块号。
Task Name|FTU任务名称，即FTU日志分发任务名称。该名称的任务由MODULE参数指定的FTU模块处理。
Thread Num|日志分发线程个数。在TASKNAME指定的任务下，FTU进行日志分发时使用的线程个数，最多可以配置8个线程进行日志分发。
Send IP|日志发送者IP。通常为FTU在GI面的IP地址，FTU模块使用该IP作为发送日志时的源IP。
Group ID|FTU分发组号。FTU向该分发组中的MDS发送日志。
##### 同步FTU配置 
摘要 :FTU配置参数在配置完成后，需要同步到FTU模块才能生效。 
前提 :已登录EMSPlus客户端。
步骤 :在EMSPlus客户端的Terminal窗口，执行[SYNC FTUCFG]命令，将FTU的配置数据同步到FTU模块，如[图1]所示。
图1  同步FTU配置

测试用例 :测试项|验证FTU任务模板是否导入成功
---|---
预置条件|已获取FTU任务模板。|已获取FTU任务模板。|已获取FTU任务模板。
测试步骤|导入FTU任务模板。参见导入FTU任务模板。|导入FTU任务模板。参见导入FTU任务模板。|导入FTU任务模板。参见导入FTU任务模板。
预期结果|FTU文件模板导入成功。|FTU文件模板导入成功。|FTU文件模板导入成功。
实际结果|||
签名||测试日期|
## 缩略语 
## 缩略语 
MDS :Message Dispatch Service消息分发服务
PCRF :Policy and Charging Rules Function策略和计费规则功能
SPR :Subscription Profile Repository用户签约数据库
## 支持VNFM异地容灾功能 
特性描述 :术语 :术语|含义
---|---
VNFM主用地址|VNFM异地容灾场景下，主用局的VNFM地址。
VNFM主用地址掩码|主用局VNFM的IP地址掩码。
VNFM备用地址|VNFM异地容灾场景下，备用局的VNFM地址
VNFM备用地址掩码|备用局VNFM的IP地址掩码。
描述 :定义 :由于主备VNFM的IP地址不同，支持VNFM异地容灾功能，是在VNFM主备局之间发生倒换时，EMSPlus能够在主备VNFM的管理下正常执行生命周期管理操作。
背景知识 :当主用VNFM出现故障时，VNFM会将业务倒换到备用的VNFM上，此时需要EMSPlus生命周期功能正常。
应用场景 :正常情况下，该功能无需手动配置。只有如下两种情况需要手工配置： 
当VNFM支持异地容灾功能，运营商要求EMSPlus已有局支持VNFM异地容灾功能，需要先将EMSPlus升级到V5.21.11版本及以后版本。 
开局时，未规划VNFM的备机地址，后续规划VNFM备机IP和掩码。 
客户收益 :对运营商和用户的受益说明参见[表1]。
收益方|收益说明
---|---
运营商|确保了系统的可靠性，当主用的VNFM不可用时，可以使用备用的VNFM对EMSPlus进行生命周期操作。
终端用户|此特性对终端用户不可见。
实现原理 :系统架构 :ElasticNet UME R50s包含VNFM组件，EMSPlus作为VNF(V7)网元支持ElasticNet UME R50s下的异地容灾。
图1  VNFM和VNF V7（EMSPlus）组网图

涉及网元 :涉及的网元及其功能参见[表1]。
网元|描述
---|---
VNFM|VNFM可以对EMSPlus网元进行扩容等生命周期操作。
本网元实现 :当VNFM进行主备局之间倒换后，会给EMSPlus网元发送一个重连消息（connect_vnf），EMSPlus在收到该消息后会向VNFM的备机进行重新注册流程，重新注册后，可以在备机的VNFM上对EMSPlus进行生命周期的操作。 
业务流程 :图2  VNFM与EMSPlus之间重注册业务

当VNFM进行主备局之间倒换后，会给EMSPlus网元发送一个重连消息（connect_vnf）。 
EMSPlus会向VNFM返回响应信息。 
EMSPlus向备用VNFM发起重新注册流程。重新注册成功后，可以在备用VNFM上对EMSPlus进行生命周期的操作。 
系统影响 :该特性不涉及对系统的影响。 
应用限制 :需要VNFM支持异地容灾功能。 
特性间交互 :该特性不涉及与其它特性的交互。 
遵循标准 :本特性采用我司内部的接口和协议，不涉及标准协议。 
特性能力 :该特性不涉及规格指标。 
可获得性 :版本要求及变更记录 :特性版本|发布版本|发布说明
---|---|---
01|V5.21.11|首次发布。
License要求 :该特性为EMSPlus网元的基本特性，无需License支持。
##### 对其它网元的要求 
该特性需要支持VNFM异地容灾功能。 
O&M相关 :命令 :本特性不涉及命令的变化。 
性能统计 :该特性不涉及计数器的变化。 
告警与通知 :该特性不涉及告警消息的变化。
失败观察 :该特性不涉及业务观察/失败观察的变化。 
##### 计费 
该特性不涉及话单与计费的变化。 
特性配置 :配置说明 :需要手动修改MAN节点上的配置info-lcm.properties文件，重启业务进程后VNFM异地容灾功能生效。
如果EMSPlus与VNFM之间启用了证书方式的加密通信（通过配置文件/ubas/ZXUN-EMSPLUS/server/emsplus_***/server/conf/info-lcm.properties中sslConfig=1是否为1确定是否开启证书功能，如果为1则开启证书功能），需要在EMSPlus命令行中导入新的VNFM证书。
配置前提 :VNFM支持异地容灾功能。 
已经规划VNFM的备机IP地址和备机IP地址掩码。 
获取到了VNFM主备的新的证书，由VNFM提供。 
配置过程 :通过SSH方式登录到MAN节点。
切换到/ubas/ZXUN-EMSPLUS/server/emsplus_***/server/conf目录下。
修改配置文件info-lcm.properties。
在文件中增加VNFM的备机IP（vnfm_ip_slave）配置项和VNFM的备机IP掩码（vnfm_netmask_slave）配置项。
重启MAN节点的业务： 
切换到目录/ubas/ZXUN-EMSPLUS/server下执行./killall.sh，双机会倒换到备机上，进程会自动启动。如果是单机组网，则需要执行./run.sh启动进程。
业务重启后，执行[iptables] -L，可以看到VNFM的主机IP和备机IP的防火墙策略已经加入。
在EMSPlus系统的命令行终端上执行[IMPORT MHS CERT]命令，导入新的VNFM证书。
#### 配置示例 
场景说明
本示例的具体场景，包括组网、接口使用等，组网使用图示。 
假设修改emsplus39局的VNFM备机IP地址为10.228.157.70，VNFM的备机子网掩码为255.255.255.0。 
数据规划
根据假设的场景，备机IP数据规划参见下表。 
VNFM的备机IP|VNFM的备机掩码
---|---
10.228.157.70|255.255.255.0
配置步骤
根据规划，进行如下配置。 
序号|步骤说明|步骤
---|---|---
1|修改配置文件info-lcm.properties。|通过SSH方式登录MAN节点。打开info-lcm.properties文件。cd /ubas/ZXUN-EMSPLUS/server/emsplus_*/server/confvi info-lcm.properties在文件中增加如下配置，详细配置如图1所示。vnfm_ip_slave=10.228.157.70vnfm_netmask_slave=255.255.255.0
2|重启业务进程，使其配置生效。|如果是双机cd /ubas/ZXUN-EMSPLUS/server./killall.sh如果为单机cd /ubas/ZXUN-EMSPLUS/server./killall.sh./run.sh
3|如果开启证书功能，需要到EMSPlus系统的命令行终端，执行命令行，导入新的VNFM证书。|输入https://IP:2329/#/cnComm/mmlclit，登录EMSPlus系统的客户端。执行命令IMPORT MHS CERT导入证书。例如：IMPORT MHS CERT:CACRTURL=sftp://user:password@127.0.0.1:22/rootca,CLTCRTURL=sftp://user:password@127.0.0.1:22/clica,CLTKEYURL=sftp://user:password@127.0.0.1:22/clipw。具体命令使用，详见命令行帮助。
图1  修改配置文件

## 缩略语 
## 缩略语 
MAN :Manager Node管理节点
### SSH 
Secure Shell安全外壳
VNFM :Virtualized Network Function Manager虚拟化网络功能管理器
## 个人信息保护功能 
特性描述 :术语 :术语|含义
---|---
EMSPlus|电信云及核心网增值网管（Element Management System Plus for Cloud Core Network），为运营商提供运维支持和决策支持。
GDPR|通用数据保护条例（General Data Protection Regulation）。
Web|EMSPlus网元的本地管理终端。
描述 :定义 :欧盟GDPR功能，是遵从GDPR合规性要求，使用License许可和操作权限鉴权，对EMSPlus系统中涉及到的用户个人数据采取的保护措施。
背景知识 :2016年4月27日，欧洲议会通过了《通用数据保护条例》（简称“GDPR”）法律条例，并将在2018年5月25日生效。 
GDPR中的个人信息是指通过已识别或可识别的自然人相关的任何数据，例如姓名、身份证号、定位数据、网络标识符以及特定的身体、心理、基因、精神状态、经济、文化、社会身份等识别符，能够直接或间接识别到身份的自然人。 
GDPR保护的个人数据包括但不限于：姓名、照片、电话、邮件地址、身份证号、住宅地址、信用评分、指纹、基因、员工ID、出生日期、婚姻状况、个人账号、信息记录、工作经历、教育背景、薪资、IP地址、IMSI、IMEI、位置信息、设备ID。单独使用或结合其他信息使用时，能够确定个人身份信息的数据也属于个人数据。
ZTE产品进入欧盟境内提供服务，受到GDPR管辖，需主动完成GDPR合规性要求。EMSPlus是GDPR个人数据处理者，依据GDPR的法规要求，个人数据的处理应遵循以下原则：
正当、合法、透明：数据主体的个人数据应当以正当、合法、透明的方式被处理。 
目的限制：个人数据应当基于具体、明确、合法的目的收集，不应以与此目的不相容的方式进一步处理。 
数据最小化：处理的个人数据应与处理数据的目的是适当、相关且必要的。 
准确性：个人数据应当是准确的，并在必要的情况下及时更新，根据数据处理的目的，采取合理的措施确保及时删除或修正不准确的个人数据。 
存储期限：存储个人数据不超过处理目的所必要的期限。 
完整性与保密性：采取必要的技术或组织措施确保个人数据的适度安全，包括防止未授权或非法处理个人数据、数据丢失或毁损。 
可归责：数据控制者须负责且能展示遵从上述原则。 
应用场景 :本特性用于在欧盟境内，执行GDPR法律要求时，使用EMSPlus产品的场景。
在启用GDPR情况下选择明文导出、密文导出和明文显示功能。 
明文导出开启GDPR的情况下，选择明文导出，则个人数据以明文形式导出。 
密文导出开启GDPR的情况下，选择密文导出，则个人数据通过加密以密文形式导出。 
明文显示开启GDPR的情况下，选择明文显示，则界面显示和报表展示以明文显示给用户。 
客户收益 :收益者|收益描述
---|---
运营商|能够保护个人隐私数据泄漏，避免违反GDRP风险
用户|个人隐私数据得到保护
实现原理 :

系统架构 :针对GDPR的影响，EMSPlus系统结构如[图1]所示。
图1  GDPR安全系统架构图




EMSPlus系统采用层次结构，包括NE层、数据采集层、数据处理和客户端。

 
NE层NE层以TCP方式向DCU提供原始数据，实现了关键的CHR数据采集、缓冲和分发。 

 
数据采集层DCU与NE直接相连， 接收NE发送的实时CHR/UDR信息，提取和转换关键数据，并将结果输出到文件中，DPU通过FTP/SFTP方式获取。DCU产生的CHR文件不需要进行加密。 

 
数据处理层DPU负责DCU与客户端之间的数据传输，实现全网监控和分析。 DPU实现CHR/UDR数据存储、挖掘和分析，处理用户登录、权限控制、日志管理、数据导出等。
GBase数据库采用列式加密。
CHR数据以SFTP方式加载到数据库中。
数据库访问启用SSL通道。
通过数据库软件SQLite加密用户信息。
 

 
展现层客户端采用Web模式，面向客户服务、OAM、OSS、市场等部门，为不同角色提供权限控制功能。
Web采用HTTPS方式，支持TLS 2.0。
报表查询支持屏蔽相关用户信息。
对导出权限进行控制。
使用匿名化工具加密个人信息。
 

 


涉及网元 :该特性由本网元单独实现，无需其他网元的配合。 


本网元实现 :EMSPlus通过License对用户进行鉴权。在License个人数据保护功能开关打开时，客户端呈现的个人数据，区分用户明文显示和匿名化显示权限，显示的结果不同；用户在导出数据时，区分用户明文导出和匿名化导出权限，导出的结果不同。
EMSPlus功能实现如下：

 
提供个人数据保护License，如果GDPR开关没有打开，则原有功能不变。 

 
个人数据保护License开启：对于密钥管理，EMSPlus接入EMS场景，EMSPlus从EMS上获取密钥；不接入EMS场景，EMSPlus提供本地密钥中心。对于服务端数据，EMSPlus系统运行记录的日志中，个人数据匿名化处理。对于客户端数据，用户配置数据、报表查询数据、报表导出数据、操作日志查询区分用户明文显示、匿名显示；操作日志导出区分明文导出、匿名导出权限。 

 


业务流程 :

数据库加密 
对GBase数据库进行加密，确保数据库相关文件无法被非法读取、破解。 


在线脱敏 
目前EMSPlus有部分功能需要使用离线工具脱敏，具体如下：

 
维度表导出的文件 

 
MML执行结果导出或保存的文件 

 
日志管理导出的文件 

 


导出权限控制 
导出权限增加：“个人数据明文导出”和“个人数据匿名导出”。 


显示权限控制 
显示权限增加：“个人数据明文显示”和“个人数据匿名显示”。 


EMSPlus与网元间的采集接口使用透明消息交互

 
逻辑实体接口之间的数据交换，其所在网络处于安全域内。虽然消息本身不属3GPP协议，但其所在的网络存在与3GPP业务相关的消息，这种消息交互是透明的。 

 
该接口消息量巨大，采用DPDK接管协议栈。 

 
如果这该接口使用加密通道，会导致效率大幅下降，将波及到现有的体系架构。 

 




系统影响 :该特性不涉及对系统的影响。 
应用限制 :欧盟地区需要开启GDPR 权限。 
特性间交互 :该特性不涉及与其他特性的交互。 
遵循标准 :本特性采用ZTE内部的接口和协议，不涉及标准协议。
特性能力 :该特性不涉及规格指标。 
可获得性 :版本要求及变更记录 :特性版本|发布版本|发布说明
01|V5.19.10|首次发布。
License要求 :该特性为EMSPlus网元的基本特性，无需License支持。
对其他网元的要求 :该特性不涉及对其他网元的要求。 
O&M相关 :命令 :本特性不涉及命令的变化。 
性能统计 :该特性不涉及计数器的变化。 
告警与通知 :该特性不涉及告警消息的变化。 
失败观察 :该特性不涉及业务观察/失败观察的变化。 
##### 计费 
该特性不涉及话单与计费的变化。 
特性配置 :配置特性 :配置说明 :欧盟GDPR功能默认是关闭的，用户要使用此特性时，需要开启GDPR权限，并配置用户的个人数据查看和导出权限才可使用。
如果已开启GDPR功能，但没有配置角色中的个人数据保护操作权限，具有该角色的用户登录系统后，界面上个人数据信息显示是密文的，明文导出和匿名导出按钮灰化，也就是不能导出数据。 
配置前提 :EMSPlus客户端和服务端运行正常。
配置过程 :开启GDPR功能。 
创建角色。 
创建用户。 
##### 配置示例 
新增“个人数据明文显示”、“个人数据明文导出”和“个人数据匿名导出”三个权限，用于控制登录用户的个人数据查看、个人数据导出行为。
开启GDPR功能。 
EMSPlus安装完毕，在Licence中开启GDPR功能，具体操作参考“License功能
”。
创建角色。 
在EMSPlus客户端，选择菜单System→MML Terminal
，进入MML Terminal窗口，如[图1]所示。
图1  MML Terminal窗口

在MML Terminal窗口中输入命令[ADD ROLE]，如[图2]所示。
图2  MML Terminal窗口

设置角色的基本信息参数并单击Execute，完成增加角色的操作，如[图3]所示。
图3  角色新建成功结果框

在MML Terminal窗口中输入命令[ADD ROLE CMDSET]，如[图4]所示。
图4  角色操作权限

参数名称|参数说明
---|---
Role ID|指示角色的ID。该参数可以通过SHOW ROLE命令查询。
Role Name|用户定义的角色名称，不区分大小写，全局唯一。
Command Set ID List|填写预定义的GDRP命令集ID182011（在MML Terminal窗口中输入命令SHOW CMDSET查询）。GDPR命令集中包含：个人数据明文导出权限个人数据明文显示权限个人数据匿名导出权限
单击Execute按钮，完成增加角色权限的操作，如[图5]所示。
图5  增加角色权限成功

创建用户。 
在EMSPlus客户端，选择菜单System→MML Terminal
，进入MML Terminal窗口，如[图6]所示。
图6  MML Terminal窗口

在MML Terminal窗口中输入命令[ADD USER]，如[图7]所示。
图7  增加用户基本信息

参数名称|参数说明
---|---
User Name|用户的名称，不区分大小写。用户名中允许下列字符：中文字符、数字、大写字母或小写字母以及一些特殊字符（~，@%&_（）-+）。
User Password|用户的密码。密码区分大小写。如果使用密码策略，则密码必须符合密码策略。
Confirm Password|确认密码，必须与新密码相同。
Description|用户的描述信息。
设置用户的参数并单击Execute，完成增加用户的操作，如[图8]所示。
图8  新建用户成功

在MML Terminal窗口中输入命令[ADD USER ROLE]，选择用户的角色信息，如[图9]所示。
图9  选择用户的角色信息

单击Execute按钮，完成增加用户角色的操作，如[图10]所示。
图10  增加用户角色成功

用户登录EMSPlus系统，会弹出隐私保护警告提示，如[图11]所示。
用户需要确认后才可以登录，否则禁止登录。 
图11  登录隐私告警

测试用例 :测试项|GDPR用户测试IPDR页面
---|---
预置条件|实例化EMSPlus成功。GDPR权限开启。|实例化EMSPlus成功。GDPR权限开启。|实例化EMSPlus成功。GDPR权限开启。
测试步骤|登录EMSPlus环境。打开菜单栏IPDR页面，单击左侧报表树，打开IPDR报表。单击Query按钮，查询报表。|登录EMSPlus环境。打开菜单栏IPDR页面，单击左侧报表树，打开IPDR报表。单击Query按钮，查询报表。|登录EMSPlus环境。打开菜单栏IPDR页面，单击左侧报表树，打开IPDR报表。单击Query按钮，查询报表。
预期结果|密文按钮显示正常，明文按钮显示不可导出，导出数据相关字段加密。|密文按钮显示正常，明文按钮显示不可导出，导出数据相关字段加密。|密文按钮显示正常，明文按钮显示不可导出，导出数据相关字段加密。
消息流程|消息流程|消息流程|消息流程
实际结果|同预期结果。|同预期结果。|同预期结果。
注意事项|||
签名||测试日期|
测试项|GDPR用户测试命令行执行
---|---
预置条件|实例化EMSPlus成功。GDPR权限开启。|实例化EMSPlus成功。GDPR权限开启。|实例化EMSPlus成功。GDPR权限开启。
测试步骤|登录EMSPlus环境。打开命令行界面，输入命令ADD VIPUSER:IMSI=460119990020925,DESCRIPTION=1。单击Execute按钮。|登录EMSPlus环境。打开命令行界面，输入命令ADD VIPUSER:IMSI=460119990020925,DESCRIPTION=1。单击Execute按钮。|登录EMSPlus环境。打开命令行界面，输入命令ADD VIPUSER:IMSI=460119990020925,DESCRIPTION=1。单击Execute按钮。
预期结果|执行成功，IMSI_SUPI值脱敏，密文导出命令按钮显示，明文按钮显示不可导出，导出数据IMSI_SUPI值加密。|执行成功，IMSI_SUPI值脱敏，密文导出命令按钮显示，明文按钮显示不可导出，导出数据IMSI_SUPI值加密。|执行成功，IMSI_SUPI值脱敏，密文导出命令按钮显示，明文按钮显示不可导出，导出数据IMSI_SUPI值加密。
消息流程|消息流程|消息流程|消息流程
实际结果|同预期结果。|同预期结果。|同预期结果。
注意事项|||
签名||测试日期|
## 缩略语 
## 缩略语 
3GPP :3rd Generation Partnership Project第三代合作伙伴计划
CHR :Call History Record呼叫历史记录
DCU :Data Collection Unit数据采集单元
### DPDK 
Data Plane Development Kit数据平面开发套件
DPU :Data Processing Unit数据处理单元
EMS :Element Management System网元管理系统
FTP :File Transfer Protocol文件传输协议
### GDPR 
General Data Protection Regulation通用数据保护条例
### HTTPS 
Hypertext Transfer Protocol Secure超文本传输安全协议
IMEI :International Mobile Equipment Identity国际移动设备标识
IMSI :International Mobile Subscriber Identity国际移动用户标识
IP :Internet Protocol因特网协议
### IPDR 
Internet Protocol Detail Record互联网协议详细记录
### MML 
Man Machine Language人机语言
### NE 
Network Element网络单元（网元）
OAM :Operation, Administration and Maintenance操作管理与维护
### OSS 
Operation Support System运营支撑系统
SFTP :Secure File Transfer Protocol安全文件传输协议
### SSL 
Secure Sockets Layer安全套接字层
TCP :Transmission Control Protocol传输控制协议
### TLS 
Transport Layer Security传输层安全
UDR :User Data Record用户数据记录
ZTE :Zhongxing Telecommunications Equipment中兴通讯
## 资源名称更新 
特性描述 :描述 :定义 :资源名称更新功能包括VNF资源名称更新和VIM资源名称更新两部分，它能够在不重新实例化网元条件下，对运营商资源名称进行修改。
VNF资源名称更新包括：修改主机名称修改端口名称修改云盘名称修改亲和互斥组名称 
VIM资源名称更新包括：批量修改VIM租户名称批量修改AZ名称批量修改虚拟网络名称批量修改虚拟子网名称批量修改镜像名称批量修改Volume Type&存储后端名称批量修改QoS名称 
背景知识 :为了满足客户在不重新实例化的前提下，进行资源名称的修改，EMSPlus需要支持资源名称更新相关接口，完成资源名称的修改。
应用场景 :本特性用于对已实例化的EMSPlus网元的各类资源名称进行修改的场景。
客户收益 :受益方|收益描述
---|---
运营商|当运营商的命名规范发生变化，生产线预装后现场调整参数，避免重新实例化。
终端用户|此特性对终端用户不可见。
实现原理 :资源实例&资源属性调整：VNF独占资源通过VNF资源名称更新进行调整，VNF外资源及VNF间共享资源通过VIM资源池名称更新进行调整。 
资源名称调整：VNF名称和通过VNF资源命名规则维护的资源名称通过VNF更新进行调整，其他资源名称通过资源池更新进行调整。 
图1  VNF资源名称更新原理

系统影响 :该特性影响VNF的实例化和扩容等生命周期操作。 
应用限制 :该特性需要CloudStudio、TECS支持资源更新功能。
特性交互 :该特性不涉及和其它特性的交互。 
遵循标准 :本特性采用中兴通讯内部的接口和协议，不涉及标准协议。 
特性能力 :该特性不涉及规格指标。 
可获得性 :版本要求及变更记录 :特性版本|发布版本|发布说明
---|---|---
01|V5.22.10.B16|首次发布。
License要求 :该特性对License无要求。 
对其他网元的要求 :该特性云平台只支持TECS，且需要TECS和CloudStudio网元支持资源更新功能。其中： 
对于VNF资源名称更新相关功能，CloudStudio需要V5.20.13.B6及以上版本。 
对于VIM资源名称更新相关功能，CloudStudio需要V5.21.13.P1.B1及以上版本。 
O&M相关 :命令 :本特性不涉及命令的变化。 
性能统计 :该特性不涉及计数器的变化。 
告警与通知 :该特性不涉及告警消息的变化。 
失败观察 :该特性不涉及业务观察/失败观察的变化。 
话单与计费 :该特性不涉及话单与计费的变化。 
特性操作 :#### VNF资源名称更新 
VNF资源名称更新支持对EMSPlus自身的相关资源名称进行修改。
 说明： 
VNF资源名称更新的相关操作，需要CloudStudio为V5.20.13.B6及以上版本。 
以下操作以CloudStudio（GSO）V5.22.20.B3为例进行说明。其它版本的操作界面与之类似。 
##### 修改主机名称 
摘要 :当客户需要自定义虚机名称时，通过修改主机命名规则功能完成虚机名称自定义修改。 
相关信息 :主机命名规则用于对主机名称自定义，它由非关键字和关键字组合而成。 
非关键字部分：定义主机命名规则固定字符，仅能由大写英文字母、小写英文字母、中划线、下划线、数字 5种字符组成。 
关键字部分：定义主机命名规则可变字符，必须仅包含1组虚机类型和虚机实例号的关键字。如果进行主机命名规则修改，主机前缀名会被清空，并且扩容时主机前缀名不可用。关键字定义如下：%VM.T1：虚机类型字符大写，包括DPU、FTU、ASC、MDS、MAN和DCU。%VM.t1：虚机类型字符小写，包括dpu、ftu、asc、mds、man和dcu。%VM.S1：虚机实例号，同类型虚机的实例号（1,2,3,...9,10,11,...99,100,...），最低字符长度1。%VM.S2：虚机实例号，同类型虚机的实例号（01,02,03,...99,100,...），最低字符长度2，缺位用0补齐。S3，S4依次类推，最多支持到S9。 
示例1：
如果希望FTU备机名称为：NFV-R-HDNJIH-01A-ZX-01-FTU02，则需要填写主机命名规则为：NFV-R-HDNJIH-01A-ZX-01-%VM.T1%VM.S2
。
示例2：
如果希望FTU备机名称为：nfv-r-hdnjih-01a-zx-01_ftu-2，则需要填写主机命名规则为：nfv-r-hdnjih-01a-zx-01_%VM.t1-%VM.S1
。
步骤 :在GSO客户端，选择菜单编排→应用→VNF
，进入VNF列表页面。
在EMSPlus实例的操作栏，选择更多→更新
，如[图1]所示。
图1  更新

在VNF更新页面，单击下一步。
图2  VNF更新页面

在选择场景页面，选择修改资源命名规则，单击下一步。
图3  修改资源命名规则

在VNF包页面，单击下一步。
图4  VNF包信息

在填写信息页面，在参数名称列中找到VM行，双击右侧参数值列，根据规划，填写虚机命名规则，并单击下一步。
图5  填写命名规则

系统弹出检查参数对话框，单击下一步。
图6  检查参数对话框

在任务步骤页面，单击提交。
图7  提交更新

在任务列表页面，找到VNF的更新任务，单击操作栏的执行按钮。系统开始执行更新操作。
图8  执行

VNF更新任务执行完成后，系统显示任务状态为成功，如[图9]所示。
图9  执行成功

 说明： 
对于CloudStudio GSO V5.22.20之前的版本，主机命名规则修改后，可能需要联系GSO的维护人员，修复vnfm_token_password参数type错误的问题。 
对于CloudStudio GSO V5.22.20及以后版本，则无需此操作。 
分别登录GSO和TECS的客户端，查看EMSPlus对应的虚机名称，验证是否修改成功。
相关任务 :如果VNF更新任务执行失败，可以参考如下步骤进行整体回退。执行失败后先回退，联系ZTE售后人员。 
在任务详情页面，单击整体回退。
图10  整体回退

在回退确认对话框中，输入验证码，并单击回退。
图11  回退确认

回退成功后，任务状态显示为回退成功。
图12  回退成功

##### 修改云盘名称 
摘要 :当客户需要自定义云盘名称时，通过云盘命名规则修改功能完成云盘名称自定义修改。 
相关信息 :云盘命名规则支持对云盘名称进行自定义，它由非关键字和关键字组合而成。 
非关键字部分：定义云盘命名规则固定字符，仅能由大写英文字母、小写英文字母、中划线、下划线、数字5种字符组成。 
关键字部分：定义云盘命名规则可变字符，必须仅包含一组云盘类型和云盘实例号的组合，至多包含一组虚机类型和虚机实例号的组合。关键字定义如下：%VOL.T1：云盘类型字符大写，包括系统盘SYS、数据盘DATA、数据库盘DBSTORAGE和文件盘FILE。%VOL.t1：云盘类型字符小写，包括系统盘sys、数据盘data、数据库盘dbstorage和文件盘file。%VOL.S1：云盘实例号，按照同类型云盘的维度进行排序的实例号（1,2,3,...9,10,11,...99,100,...），最低字符长度1。%VOL.S2：云盘实例号，按照同类型云盘的维度进行排序的实例号（01,02,03,...99,100,...），最低字符长度2，缺位用0补齐。S3,S4依次类推，最多支持到S9。%VM.T1：虚机类型字符大写，包括DPU、FTU、ASC、MDS、MAN和DCU。%VM.t1：虚机类型字符小写，包括dpu、ftu、asc、mds、man和dcu。%VM.S1：虚机实例号，同类型虚机的实例号（1,2,3,...9,10,11,...,99,100,...），最低字符长度1。%VM.S2：虚机实例号，同类型虚机的实例号（01,02,03,...,99,100,...），最低字符长度2，缺位用0补齐。S3,S4依次类推，最多支持到S9。 
云盘命名规则支持和虚机命名规则混合使用。当混合使用时，同类型云盘的云盘实例号按照同虚机名的维度进行排序。 
示例1：
如果希望第100块数据库盘名称为：EMSplus_LOG_29_DBSTORAGE_100，则需要填写云盘命名规则为：EMSplus_LOG_29_%VOL.T1_%VOL.S1
。
示例2：
如果希望DPU2的第4块数据库盘名称为：nfv-r-hdnjih-01a-zx-01-vol-dpu02dbstorage04，则需要填写云盘命名规则为：nfv-r-hdnjih-01a-zx-01-vol-%VM.t1%VM.S2%VOL.t1%VOL.S2
。
步骤 :在GSO客户端，选择菜单编排→应用→VNF
，进入VNF列表页面。
在EMSPlus实例的操作栏，选择更多→更新
，如[图1]所示。
图1  更新

在VNF更新页面，单击下一步。
图2  VNF更新页面

在选择场景页面，选择修改资源命名规则，单击下一步。
图3  修改资源命名规则

在VNF包页面，单击下一步。
图4  VNF包信息

在填写信息页面，在参数名称列中找到VOL行，双击右侧参数值列，根据规划，填写云盘命名规则，并单击下一步。
图5  填写命名规则

系统弹出检查参数对话框，单击下一步。
图6  检查参数对话框

在任务步骤页面，单击提交。
图7  提交更新

在任务列表页面，找到VNF的更新任务，单击操作栏的执行按钮。系统开始执行更新操作。
图8  执行

VNF更新任务执行完成后，系统显示任务状态为成功，如[图9]所示。
图9  执行成功

登录TECS客户端，查看EMSPlus对应的云盘名称，验证是否修改成功。
相关任务 :如果VNF更新任务执行失败，可以参考如下步骤进行整体回退。执行失败后先回退，联系ZTE售后人员。 
在任务详情页面，单击整体回退。
图10  整体回退

在回退确认对话框中，输入验证码，并单击回退。
图11  回退确认

回退成功后，任务状态显示为回退成功。
图12  回退成功

##### 修改端口名称 
摘要 :当客户需要自定义端口名称时，通过端口命名规则修改功能完成端口名称自定义修改。 
相关信息 :端口命名规则支持对端口名称自定义，它由非关键字和关键字组合而成： 
非关键字部分：定义端口命名规则固定字符，仅能由大写英文字母、小写英文字母、中划线、下划线、数字 5种字符组成。 
关键字部分：定义端口命名规则可变字符，只能是以下2种组合其中之一。第一种：一组虚机类型+虚机实例号+一个端口类型。第二种：一组端口类型+端口实例号。关键字定义如下：%VPRT.T1：端口类型字符大写，包括EMS、CTRL、MEDIA、NORTHOUTPUT、GI、FWNET、SIG、MANRES、HEART1、HEART2和FTU。%VPRT.t1：端口类型字符小写，包括ems、ctrl、media、northoutput、gi、fwnet、sig、manres、heart1、heart2和ftu。%VPRT.S1：端口实例号，按照同类型端口的维度进行排序的实例号（1,2,3,...9,10,11,...99,100,...），
最低字符长度1。%VPRT.S2：端口实例号，按照同类型端口的维度进行排序的实例号（01,02,03,...99,100,...），最低字符长度2，缺位用0补齐。S3，S4依次类推，最多支持到S9。 
端口命名规则可以和虚机命名规则混合使用。当混合使用时不需要填写端口实例号。 
示例1：
如果希望端口名为：NFV-R-HDNJIH-01A-ZX-01-VPRT-MDS01-FWNET，则需要填写端口命名规则为：NFV-R-HDNJIH-01A-ZX-01-VPRT-%VM.T1%VM.S2-%VPRT.T1
。
示例2：
如果希望端口名为：cp_emsplus_28_3_fwnet，则需要填写端口命名规则为：cp_emsplus_28_%VPRT.S1_%VPRT.t1
。
步骤 :在GSO客户端，选择菜单编排→应用→VNF
，进入VNF列表页面。
在EMSPlus实例的操作栏，选择更多→更新
，如[图1]所示。
图1  更新

在VNF更新页面，单击下一步。
图2  VNF更新页面

在选择场景页面，选择修改资源命名规则，单击下一步。
图3  修改资源命名规则

在VNF包页面，单击下一步。
图4  VNF包信息

在填写信息页面，在参数名称列中找到VPRT行，双击右侧参数值列，根据规划，填写端口命名规则，并单击下一步。
图5  填写命名规则

系统弹出检查参数对话框，单击下一步。
图6  检查参数对话框

在任务步骤页面，单击提交。
图7  提交更新

在任务列表页面，找到VNF的更新任务，单击操作栏的执行按钮。系统开始执行更新操作。
图8  执行

VNF更新任务执行完成后，系统显示任务状态为成功，如[图9]所示。
图9  执行成功

登录TECS的客户端，查看EMSPlus对应的端口名称，验证是否修改成功。
相关任务 :如果VNF更新任务执行失败，可以参考如下步骤进行整体回退。执行失败后先回退，联系ZTE售后人员。 
在任务详情页面，单击整体回退。
图10  整体回退

在回退确认对话框中，输入验证码，并单击回退。
图11  回退确认

回退成功后，任务状态显示为回退成功。
图12  回退成功

##### 修改亲和互斥组名称 
摘要 :当客户需要自定义亲和互斥组名称时，通过亲和互斥组命名规则修改功能完成亲和互斥组名称自定义修改。 
相关信息 :亲和互斥组命名规则支持对亲和互斥组名称自定义，它由非关键字和关键字组合而成： 
非关键字部分：定义亲和互斥组命名规则固定字符，仅能由大写英文字母、小写英文字母、中划线、下划线、数字 5种字符组成。 
关键字部分：定义亲和互斥组命名规则可变字符，必须仅包含1组亲和互斥组类型的关键字。关键字定义如下：%VMG.T1：亲和互斥组类型字符大写，包括：DPU、FTU、MAN、ASC、MDS和DCU。%VMG.t1：亲和互斥组类型字符小写，包括：dpu、ftu、man、asc、mds和dcu。 
示例：
如果希望FTU亲和互斥组名称为：NFV-R-HDNJIH-01A-ZX-01-VMG-FTU，则需要填写亲和互斥组命名规则为：NFV-R-HDNJIH-01A-ZX-01-VMG-%VMG.T1
。
步骤 :在GSO客户端，选择菜单编排→应用→VNF
，进入VNF列表页面。
在EMSPlus实例的操作栏，选择更多→更新
，如[图1]所示。
图1  更新

在VNF更新页面，单击下一步。
图2  VNF更新页面

在选择场景页面，选择修改资源命名规则，单击下一步。
图3  修改资源命名规则

在VNF包页面，单击下一步。
图4  VNF包信息

在填写信息页面，在参数名称列中找到VMG行，双击右侧参数值列，根据规划，填写亲和互斥组命名规则，并单击下一步。
图5  填写命名规则

系统弹出检查参数对话框，单击下一步。
图6  检查参数对话框

在任务步骤页面，单击提交。
图7  提交更新

在任务列表页面，找到VNF的更新任务，单击操作栏的执行按钮。系统开始执行更新操作。
图8  执行

VNF更新任务执行完成后，系统显示任务状态为成功，如[图9]所示。
图9  执行成功

登录TECS的客户端，查看EMSPlus对应的虚机亲和互斥组名称，验证是否修改成功。
相关任务 :如果VNF更新任务执行失败，可以参考如下步骤进行整体回退。执行失败后先回退，联系ZTE售后人员。 
在任务详情页面，单击整体回退。
图10  整体回退

在回退确认对话框中，输入验证码，并单击回退。
图11  回退确认

回退成功后，任务状态显示为回退成功。
图12  回退成功

#### VIM资源名称更新 
VIM资源名称更新支持对EMSPlus所在的VIM相关资源名称进行批量修改。
 小心！ 
对VIM资源名称进行修改时，会影响使用该资源的所有VNF。操作前，需要确认所有VNF都支持VIM资源名称修改，且需要跟客户确认。 
 说明： 
VIM资源名称更新的相关操作，需要CloudStudio为V5.21.13.P1.B1及以上版本。 
以下操作以CloudStudio（GSO）V5.22.20.B3为例进行说明。其它版本的操作界面与之类似。 
##### 批量修改VIM租户名称 
摘要 :当客户需要自定义租户名称时，通过批量修改VIM租户名称功能完成租户名称自定义修改。 
步骤 :在GSO客户端，选择菜单系统→NFVO→配置管理→VIM
。找到EMSPlus所在的VIM，选择更多→资源改名
，如[图1]所示。
图1  资源改名

在选择场景页面，选择批量修改VIM租户名称，并单击下一步。
图2  选择更新条目

切换至资源改名页，找到需要改名的租户名，双击右侧的参数值，根据规划，输入新的租户名称，并单击提交。
图3  资源改名

系统弹出检查参数对话框，待检查完成时，单击确定。
图4  检查参数

待任务状态为成功后，查看系统显示结果。
图5  执行改名任务

登录TECS客户端，验证租户名称是否修改成功。 
相关任务 :如果任务执行失败，需要执行整体回退操作。执行失败后先回退，联系ZTE售后人员。 
##### 批量修改AZ名称 
摘要 :当客户需要自定义虚机可用域名称时，通过批量修改AZ名称功能完虚机可用域名称自定义修改。 
相关信息 :该功能需要实例化时指定虚机可用域，否则无法正常修改。 
步骤 :在GSO客户端，选择菜单系统→NFVO→配置管理→VIM
。找到EMSPlus所在的VIM，选择更多→资源改名
，如[图1]所示。
图1  资源改名

在选择场景页面，选择批量修改AZ名称，并单击下一步。
图2  批量修改AZ

切换至资源改名页，找到需要改名的资源名称，双击右侧的参数值，根据规划，输入新的AZ域名称，并单击提交。
图3  资源改名

系统弹出检查参数对话框，待检查完成时，单击确定。
图4  检查参数

待任务状态为成功后，查看系统显示结果。
图5  执行改名任务

登录TECS客户端，验证虚机可用域名称是否修改成功。 
相关任务 :如果任务执行失败，需要执行整体回退操作。执行失败后先回退，联系ZTE售后人员。 
##### 批量修改虚拟网络名称 
摘要 :当客户需要自定义虚拟网络名称时，通过批量修改虚拟网络名称功能完成虚拟网络名称自定义修改。 
步骤 :在GSO客户端，选择菜单系统→NFVO→配置管理→VIM
。找到EMSPlus所在的VIM，选择更多→资源改名
，如[图1]所示。
图1  资源改名

在选择场景页面，选择批量修改虚拟网络名称，并选择EMSPlus所在的租户名称，单击下一步。
图2  批量修改虚拟网络

切换至资源改名页，找到需要改名的网络名称，双击右侧的参数值，根据规划，输入新的虚拟网络名称，并单击提交。
图3  资源改名

系统弹出检查参数对话框，待检查完成时，单击确定。
图4  检查参数

待任务状态为成功后，查看系统显示结果。
图5  执行改名任务

登录TECS客户端，验证虚拟网络名称是否修改成功。 
相关任务 :如果任务执行失败，需要执行整体回退操作。执行失败后先回退，联系ZTE售后人员。 
##### 批量修改虚拟子网名称 
摘要 :当客户需要自定义虚拟子网名称时，通过批量修改虚拟子网名称功能完成虚拟子网名称自定义修改。 
步骤 :在GSO客户端，选择菜单系统→NFVO→配置管理→VIM
。找到EMSPlus所在的VIM，选择更多→资源改名
，如[图1]所示。
图1  资源改名

在选择场景页面，选择批量修改虚拟子网名称，并选择EMSPlus所在的租户名称，单击下一步。
图2  批量修改虚拟子网

切换至资源改名页，找到需要改名的子网名称，双击右侧的参数值，根据规划，输入新的子网名称，并单击提交。
图3  资源改名

系统弹出检查参数对话框，待检查完成时，单击确定。
图4  检查参数

待任务状态为成功后，查看系统显示结果。
图5  查看修改结果

登录TECS客户端，验证虚拟子网名称是否修改成功。 
相关任务 :如果任务执行失败，需要执行整体回退操作。执行失败后先回退，联系ZTE售后人员。 
##### 批量修改镜像名称 
摘要 :当客户需要自定义镜像名称时，通过批量修改镜像名称功能完成镜像名称自定义修改。 
步骤 :在GSO客户端，选择菜单系统→NFVO→配置管理→VIM
。找到EMSPlus所在的VIM，选择更多→资源改名
，如[图1]所示。
图1  资源改名

在选择场景页面，选择批量修改镜像名称，并选择EMSPlus所在的租户，单击下一步。
图2  批量修改镜像名称

切换至资源改名页，找到需要改名的镜像名称，双击右侧的参数值，根据规划，输入新的镜像文件名称，并单击提交。
图3  修改镜像名称

系统弹出检查参数对话框，待检查完成后，单击确定。
图4  检查参数

待任务状态为成功后，查看系统显示结果。
图5  查看修改结果

登录TECS客户端，验证镜像名称是否修改成功。 
相关任务 :如果任务执行失败，需要执行整体回退操作。执行失败后先回退，联系ZTE售后人员。 
##### 批量修改Volume Type&存储后端名称 
摘要 :当客户需要自定义云盘类型名称和存储后端名称时，通过批量修改Volume Type&存储后端名称功能完成云盘类型名称和存储后端名称自定义修改。 
步骤 :在GSO客户端，选择菜单系统→NFVO→配置管理→VIM
。找到EMSPlus所在的VIM，选择更多→资源改名
，如[图1]所示。
图1  资源改名

在选择场景页面，选择批量修改VolumeType&存储后端名称，单击下一步。
图2  批量修改Volume Type&存储后端名称

切换至资源改名页，找到需要改名的云盘类型或存储后端的名称，双击右侧的参数值，根据规划，输入新的云盘类型或存储后端名称，并单击提交。
图3  资源改名

系统弹出检查参数对话框，待检查完成后，单击确定。
图4  检查参数

待任务状态为成功后，查看系统显示结果。
图5  执行

登录TECS客户端，验证云盘类型或存储后端名称是否修改成功。 
相关任务 :如果任务执行失败，需要执行整体回退操作。执行失败后先回退，联系ZTE售后人员。 
## 缩略语 
## 缩略语 
### AZ 
Availability Zone可用性区域
QoS :Quality of Service服务质量
### TECS 
Tulip Elastic Cloud System郁金香弹性云系统
VIM :Virtualized Infrastructure Manager虚拟化基础设施管理系统
VNF :Virtualized Network Function虚拟化网络功能
## 备份与恢复 
特性描述 :术语 :术语|含义
---|---
备份恢复|对EMSPlus系统正常运行所依赖的配置数据、应用数据的备份操作，以及系统出现问题后的恢复操作。
配置数据|EMSPlus系统的配置数据包括：与网元对接的配置、节点之间的配置、数据库配置等信息。
应用数据|EMSPlus系统的应用数据包括：节点上的日志记录、业务进程、运行脚本等信息。
描述 :定义 :备份是按照EMSPlus系统维护人员的需求把配置和数据打包存储到指定路径下的过程。已备份的数据可用于EMSPlus系统中数据损坏或丢失情况下恢复数据。备份文件保存为.zip压缩包的形式。
恢复是将备份的业务配置和基础数据恢复到EMSPlus系统中。
背景知识 :备份恢复功能为EMSPlus系统的基础业务功能，用于对EMSPlus系统正常运行所依赖的业务配置、基础数据的备份，以及系统出现问题后的恢复。
应用场景 :本特性用于备份恢复功能，一般在进行业务操作前需要进行备份操作，当系统出现问题后进行恢复操作。 
客户收益 :对运营商和用户的受益说明参见[表1]。
收益方|收益说明
---|---
运营商|保证EMSPlus各项业务操作的可恢复性。
终端用户|此特性对终端用户不可见。
实现原理 :系统架构 :EMSPlus系统的备份原理如[图1]所示。
图1  系统备份原理图

EMSPlus系统的恢复原理如[图2]所示。
图2  系统恢复原理图

涉及网元 :该特性由本网元单独实现，无需其他网元的配合。 
本网元实现 :备份恢复功能包括： 
配置备份：对EMSPlus系统中各节点的配置参数备份，用于扩容、升级等业务操作后恢复节点配置文件和数据库的配置表。 
应用备份：对EMSPlus系统中各节点的应用数据备份，用于节点运行故障后，恢复整节点的业务。 
备份文件恢复：当EMSPlus系统异常时进行恢复的操作。 
业务流程 :备份流程：客户端选择Backup&Restore→Backup→Backup Configuration或Backup&Restore→Backup→Backup Application。触发EMSPlus上的备份恢复进程。系统在后台生成备份的压缩文件。下载压缩包到本地机器。 
恢复流程：客户端选择Backup&Restore→Restore。触发EMSPlus上的备份恢复进程。系统读取上传的备份的压缩文件。系统向客户端发送重启节点的请求。收到客户端确认消息后重启节点。 
系统影响 :该特性不涉及对系统的影响。 
应用限制 :该特性不涉及应用限制。 
特性间交互 :该特性不涉及与其他特性的交互。 
遵循标准 :本特性采用中兴通讯内部的接口和协议，不涉及标准协议。 
特性能力 :该特性不涉及规格指标。 
可获得性 :版本要求及变更记录 :特性版本|发布版本|发布说明
---|---|---
01|V5.17.10|首次发布。
License要求 :该特性为EMSPlus网元的基本特性，无需License支持。
对其他网元的要求 :该特性不涉及对其他网元的要求。 
O&M相关 :命令 :该特性不涉及命令的变化。 
性能统计 :该特性不涉及计数器的变化。 
告警与通知 :该特性不涉及告警消息的变化。 
失败观察 :该特性不涉及业务观察/失败观察的变化。 
##### 计费 
该特性不涉及话单与计费的变化。 
特性操作 :#### 备份配置数据 
摘要 :对EMSPlus系统中各节点的配置参数备份，用于扩容、升级等业务操作后恢复节点的配置文件和数据库的配置表。
前提 :已登录EMSPlus客户端。
步骤 :在EMSPlus客户端，选择菜单System→Export/Import
，默认打开Dimension页面。
切换到Backup&Restore页签，如[图1]所示。
图1  Backup&Restore页面

单击Backup按钮。系统弹出Execute Backup对话框，如[图2]所示。
图2  Execute Backup对话框。

参数名|参数说明
---|---
Name|输入需要生成的备份文件名，例如：EMSPlus_RPT_CFG_20210114。
Type|对于配置数据备份，选择Backup Configuration。
参考[表1]，设置配置数据的备份参数。
单击Start。系统开始备份操作，并显示备份的进度，如[图3]所示。
图3  备份结果

（可选）单击Download按钮，可以将备份文件下载到客户端本地，如[图4]所示。
图4  下载备份文件

#### 备份应用数据 
摘要 :对EMSPlus系统中各节点的应用数据备份，用于节点运行故障后，恢复整节点的业务。
前提 :已登录EMSPlus客户端。
步骤 :在EMSPlus客户端，选择菜单System→Export/Import
，默认打开Dimension页面。
切换到Backup&Restore页签，如[图1]所示。
图1  Backup&Restore页面

单击Backup按钮。系统弹出Execute Backup对话框，如[图2]所示。
图2  Execute Backup对话框。

参数名|参数说明
---|---
Name|输入需要生成的备份文件名，例如：EMSPlus_RPT_APP_20210114。
Type|对于应用数据备份，选择Backup Application。
参考[表1]，设置配置数据的备份参数。
单击Start。系统开始备份操作，并显示备份的进度，如[图3]所示。
图3  备份结果

（可选）单击Download按钮，可以将备份文件下载到客户端本地，如[图4]所示。
图4  下载备份文件

#### 恢复备份数据 
摘要 :当EMSPlus系统出现异常时，维护人员可以通过备份数据来恢复系统。
系统既通过服务器上的备份文件进行恢复，也可以通过客户端的备份文件进行恢复。 
 小心！ 
恢复操作会重启所有虚机，且客户端会自动登出，需要等待一段时间才能重新登录。 
前提 :EMSPlus系统已做过数据备份操作。 
如果需要通过客户端文件恢复，则客户端上已准备好备份文件。 
已登录EMSPlus客户端。 
步骤 :使用服务器上的备份文件进行恢复
在EMSPlus客户端，选择菜单System→Import/Export→Backup&Restore
，进入备份恢复页面，如[图1]所示。
图1  备份恢复页面

选择需要恢复的备份任务，单击Operation栏对应的Restore按钮。
系统弹出Execute local restore对话框，如[图2]所示。
图2  Execute local restore对话框

单击Start，确认开始进行恢复操作。
系统弹出危险操作确认对话框，如[图3]所示。
图3  危险操作确认对话框

单击OK，系统开始执行数据恢复操作。
恢复操作完成后，系统会自动重启所有虚机，且客户端会自动登出，需要等待一段时间才能重新登录。如[图4]所示
图4  确认登出客户端

单击OK。
通过客户端上的备份文件进行恢复
在EMSPlus客户端，选择菜单System→Import/Export→Backup&Restore
，进入备份恢复页面。
图5  备份恢复页面

单击工具栏Restore按钮。系统弹出Execute local restore对话框，如[图6]所示。
图6  选择备份文件对话框

单击Select File按钮，选择客户端本地的备份文件，并单击Upload，如[图7]所示。
图7  Click Start Button to Restore Security Data

单击Start，系统弹出危险操作确认对话框，如[图8]所示。
图8  危险操作提示框

单击OK，系统开始执行数据恢复操作，如[图9]所示。
图9  恢复备份文件

恢复操作完成后，系统会自动重启所有虚机，且客户端会自动登出，需要等待一段时间才能重新登录。如[图10]所示。
图10  确认重启客户端提示框

单击OK。
#### 删除备份数据 
摘要 :当数据恢复操作完成后，可以删除服务器上的历史备份文件，释放服务器空间。 
前提 :EMSPlus系统已做过数据备份操作。 
已登录EMSPlus客户端。 
步骤 :在EMSPlus客户端，选择菜单System→Import/Export→Backup&Restore
，进入备份恢复页面，如[图1]所示。
图1  备份恢复页面

单击Operation栏的Delete按钮。
系统弹出危险操作确认对话框，如[图2]所示。
图2  危险操作确认对话框

单击OK按钮，删除对应的备份文件。
测试用例 :测试项|系统备份和恢复功能
---|---
预置条件|EMSPlus系统运行正常。|EMSPlus系统运行正常。|EMSPlus系统运行正常。
测试步骤|执行配置数据备份。具体操作可参见备份配置数据。执行应用数据备份。具体操作可参见备份应用数据。执行数据恢复。具体操作可参见恢复备份数据。|执行配置数据备份。具体操作可参见备份配置数据。执行应用数据备份。具体操作可参见备份应用数据。执行数据恢复。具体操作可参见恢复备份数据。|执行配置数据备份。具体操作可参见备份配置数据。执行应用数据备份。具体操作可参见备份应用数据。执行数据恢复。具体操作可参见恢复备份数据。
预期结果|配置数据和应用数据能够正常备份。备份的数据能够正常恢复。|配置数据和应用数据能够正常备份。备份的数据能够正常恢复。|配置数据和应用数据能够正常备份。备份的数据能够正常恢复。
实际结果|||
签名||测试日期|
