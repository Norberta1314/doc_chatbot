# 数据服务通信配置 
# 数据服务通信配置 


[](None)背景知识 


数据服务通讯配置适用于UDR和UDSF。UDR存储结构化数据，UDSF存储非结构化数据，UDR和UDSF既可以以NFS形式部署在业务NF中，也可以以NF形式独立部署并被多个业务NF共享。 

UDR和UDSF支持容灾部署，数据可以在2个或更多UDR或UDSF之间复制。 

UDR支持第三方应用访问结构化数据，如第三方应用通过LDAP接口访问USPP数据。 

UDR和UDSF独立部署、容灾部署以及第三方应用访问UDR，都需要节点和其他NF的节点或第三方应用通讯。 




[](None)功能说明 


本功能用于管理NF间的通讯配置： 


 
业务NF和独立部署的UDR、UDSF之间 

 
容灾部署的UDR之间 

 
容灾部署的UDSF之间 

 
第三方应用和UDR之间 

 




[](None)子主题： 






## 网关通信配置 
## 网关通信配置 


[](None)背景知识 


业务NF和独立部署的UDSF之间、容灾部署的UDSF之间、第三方应用和UDR之间的通讯，都需要通过CGW： 


 
业务NF和独立部署的UDSF之间，需要通过部署在UDSF的CGW通讯 

 
容灾部署的UDSF之间，需要通过部署在两个UDSF的CGW通讯 

 
第三方应用和UDR之间，需要通过部署在UDR的CGW通讯 

 




[](None)功能说明 


本功能用于管理NF间的CGW通讯配置： 


 
业务NF和独立部署的UDSF之间 

 
容灾部署的UDR之间 

 
容灾部署的UDSF之间 

 
第三方应用和UDR之间 

 




[](None)子主题： 






### CGW互联配置 
### CGW互联配置 


[](None)背景知识 


容灾UDSF节点之间，通过各自所在的NF的CGW通讯，消息通过两个CGW从一个UDSF的节点发送到另外一个UDSF的节点。 

业务NF节点和UDSF节点之间，通过UDSF的CGW通讯，消息通过UDSF的CGW，在业务NF节点和UDSF节点之间交换。 




[](None)功能说明 


本功能用于配置CGW节点支持业务NF和UDSF之间以及容灾UDSF之间通讯的网络参数。 




[](None)子主题： 






#### 增加CGW互联配置(ADD CGWNODE) 
#### 增加CGW互联配置(ADD CGWNODE) 


[](None)功能说明 

该命令用于增加一个CGW互通配置。UDSF独立部署或容灾部署时，使用该命令。命令执行成功后，主备UDSF之间、UDSF和网元之间可以通过CGW相互通讯，实现数据访问和数据复制。


[](None)注意事项 

每个NF最多可增加4个配置，分别配置CGW和网元的数据访问网络双平面以及CGW之间的数据复制网络双平面。 

UDSF容灾部署时，需要分别配置本地CGW和远程CGW，并且主备UDSF配置应保持一致。 


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NFID|NF ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|CGW所在NF的唯一标识。NFID可通过SHOW NFCFG命令查询。
NETTYPE|网络用途|参数可选性: 必选参数类型: 枚举，参见枚举定义参数范围: 0-3|网络用途，指示用于和网元的数据访问通讯或用于和其他CGW的数据复制通讯，以及所在网络平面。包括：data_access_1：通过数据访问网络平面1，和使用UDSF的网元通讯。data_access_2：通过数据访问网络平面2，和使用UDSF的网元通讯。data_sync_1：通过数据复制网络平面1，和其他UDSF的CGW通讯。data_sync_2：通过数据复制网络平面2，和其他UDSF的CGW通讯。如果只有一个网络平面，则必须配置为网络平面1。
IP|IP地址|参数可选性: 任选参数类型: 字符串|本端的IP地址，支持IPV4和IPV6。使用不同的端口范围时，一个IP地址既可以用于和网元通讯，也可用于和其他CGW通讯。
SERVERPORTSTART|监听端口最小值|参数可选性: 必选参数类型: 数字参数范围: 30000-40000|接收对端网元或CGW的TCP链接的本端起始端口。端口最小值不能大于端口最大值。
SERVERPORTEND|监听端口最大值|参数可选性: 必选参数类型: 数字参数范围: 30000-40000|接收对端网元或CGW的TCP链接的本端终止端口。端口最小值不能大于端口最大值。
CONNECTPORTSTART|连接端口最小值|参数可选性: 必选参数类型: 数字参数范围: 50000-65535|主动连接对端CGW的本端起始端口。网络用途为数据访问时，不需要配置，可以全部设置为50000。端口最小值不能大于端口最大值。
CONNECTPORTEND|连接端口最大值|参数可选性: 必选参数类型: 数字参数范围: 50000-65535|主动连接对端CGW的本端终止端口。网络用途为数据访问时，不需要配置，可以全部设置为50000。端口最小值不能大于端口最大值。
NFLIST|NF列表|参数可选性: 必选参数类型: 字符串参数范围: 0-79|CGW可以为部署在同一TMSP的多个NF服务，该参数列出了使用该CGW的所有NF的标识，多个NF标识使用“&”连接。通常设置为和NFID参数一致。
VPNID|VPNID|参数可选性: 必选参数类型: 数字参数范围: 0-4095默认值: 0|VPN ID。在CommonS_TMSP节点下的Rosng配置中，使用“SHOW IP VRF DETAIL”命令，获取可用VPN ID（VRF ID）。如果没有Rosng配置，则VPN ID为0。该参数默认值为0
DSCP|DSCP标签|参数可选性: 必选参数类型: 数字参数范围: 0-63默认值: 0|差分服务代码点（Differentiated Services Code Point）标签。对于IPv4，在CommonS_IPS服务下使用“SHOW QOSMAPIPV4”命令获取可用的DSCP，或设置为0。对于IPv6，在CommonS_IPS服务下使用“SHOW QOSMAPIPV6”命令获取可用的TC，或设置为0。该参数默认值为0




[](None)命令举例 


`
增加一个CGW互通配置，NF标识为1，网络用途为“数据同步网络1”，本端IP地址为10.43.11.100，监听端口范围为30000~31000，连接端口范围为50000~51000，NF列表为1，VPN ID为0，DSCP为0。
ADD CGWNODE:NFID=1,NETTYPE="data_sync_1",IP="10.43.11.100",SERVERPORTSTART=30000,SERVERPORTEND=31000,CONNECTPORTSTART=50000,CONNECTPORTEND=51000,NFLIST="1",VPNID=0,DSCP=0
` 


#### 删除CGW互联配置(DEL CGWNODE) 
#### 删除CGW互联配置(DEL CGWNODE) 


[](None)功能说明 

该命令用于删除一个CGW互通配置。


[](None)注意事项 

UDSF容灾部署时，需要在主备UDSF分别删除CGW互通配置。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NFID|NF ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|CGW所在NF的唯一标识。NFID可通过SHOW NFCFG命令查询。
NETTYPE|网络用途|参数可选性: 必选参数类型: 枚举，参见枚举定义参数范围: 0-3|网络用途，指示用于和网元的数据访问通讯或用于和其他CGW的数据复制通讯，以及所在网络平面。包括：data_access_1：通过数据访问网络平面1，和使用UDSF的网元通讯。data_access_2：通过数据访问网络平面2，和使用UDSF的网元通讯。data_sync_1：通过数据复制网络平面1，和其他UDSF的CGW通讯。data_sync_2：通过数据复制网络平面2，和其他UDSF的CGW通讯。如果只有一个网络平面，则必须配置为网络平面1。




[](None)命令举例 


`
删除NF标识为1，网络用途为“数据同步网络1”的一个CGW互通配置。
DEL CGWNODE:NFID=1,NETTYPE="data_sync_1"
` 


#### 修改CGW互联配置(SET CGWNODE) 
#### 修改CGW互联配置(SET CGWNODE) 


[](None)功能说明 

该命令用于修改一个CGW互通配置。当CGW互通信息变更时，使用该命令。命令执行成功后，主备UDSF之间、UDSF和网元之间可以通过修改后的CGW相互通讯，实现数据访问和数据复制。


[](None)注意事项 

UDSF容灾部署时，修改数据复制网络，需要在主备UDSF分别修改。 

修改数据访问网络，需要在UDSF和网元分别修改。 


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NFID|NF ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|CGW所在NF的唯一标识。NFID可通过SHOW NFCFG命令查询。
NETTYPE|网络用途|参数可选性: 必选参数类型: 枚举，参见枚举定义参数范围: 0-3|网络用途，指示用于和网元的数据访问通讯或用于和其他CGW的数据复制通讯，以及所在网络平面。包括：data_access_1：通过数据访问网络平面1，和使用UDSF的网元通讯。data_access_2：通过数据访问网络平面2，和使用UDSF的网元通讯。data_sync_1：通过数据复制网络平面1，和其他UDSF的CGW通讯。data_sync_2：通过数据复制网络平面2，和其他UDSF的CGW通讯。如果只有一个网络平面，则必须配置为网络平面1。
IP|IP地址|参数可选性: 任选参数类型: 字符串|本端的IP地址，支持IPV4和IPV6。使用不同的端口范围时，一个IP地址既可以用于和网元通讯，也可用于和其他CGW通讯。
SERVERPORTSTART|监听端口最小值|参数可选性: 任选参数类型: 数字参数范围: 30000-40000|接收对端网元或CGW的TCP链接的本端起始端口。端口最小值不能大于端口最大值。
SERVERPORTEND|监听端口最大值|参数可选性: 任选参数类型: 数字参数范围: 30000-40000|接收对端网元或CGW的TCP链接的本端终止端口。端口最小值不能大于端口最大值。
CONNECTPORTSTART|连接端口最小值|参数可选性: 任选参数类型: 数字参数范围: 50000-65535|主动连接对端CGW的本端起始端口。网络用途为数据访问时，不需要配置，可以全部设置为50000。端口最小值不能大于端口最大值。
CONNECTPORTEND|连接端口最大值|参数可选性: 任选参数类型: 数字参数范围: 50000-65535|主动连接对端CGW的本端终止端口。网络用途为数据访问时，不需要配置，可以全部设置为50000。端口最小值不能大于端口最大值。
NFLIST|NF列表|参数可选性: 任选参数类型: 字符串参数范围: 0-79|CGW可以为部署在同一TMSP的多个NF服务，该参数列出了使用该CGW的所有NF的标识，多个NF标识使用“&”连接。通常设置为和NFID参数一致。
VPNID|VPNID|参数可选性: 任选参数类型: 数字参数范围: 0-4095默认值: 0|VPN ID。在CommonS_TMSP节点下的Rosng配置中，使用“SHOW IP VRF DETAIL”命令，获取可用VPN ID（VRF ID）。如果没有Rosng配置，则VPN ID为0。该参数默认值为0
DSCP|DSCP标签|参数可选性: 任选参数类型: 数字参数范围: 0-63默认值: 0|差分服务代码点（Differentiated Services Code Point）标签。对于IPv4，在CommonS_IPS服务下使用“SHOW QOSMAPIPV4”命令获取可用的DSCP，或设置为0。对于IPv6，在CommonS_IPS服务下使用“SHOW QOSMAPIPV6”命令获取可用的TC，或设置为0。该参数默认值为0




[](None)命令举例 


`
修改NF标识为1的一个CGW互通配置，将网络用途修改为“数据同步网络2”。
SET CGWNODE:NFID=1,NETTYPE="data_sync_2"
` 


#### 查询CGW互联配置(SHOW CGWNODE) 
#### 查询CGW互联配置(SHOW CGWNODE) 


[](None)功能说明 

该命令用于查看指定或全部CGW互通配置。


[](None)注意事项 

无。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NFID|NF ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|CGW所在NF的唯一标识。NFID可通过SHOW NFCFG命令查询。
NETTYPE|网络用途|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-3|网络用途，指示用于和网元的数据访问通讯或用于和其他CGW的数据复制通讯，以及所在网络平面。包括：data_access_1：通过数据访问网络平面1，和使用UDSF的网元通讯。data_access_2：通过数据访问网络平面2，和使用UDSF的网元通讯。data_sync_1：通过数据复制网络平面1，和其他UDSF的CGW通讯。data_sync_2：通过数据复制网络平面2，和其他UDSF的CGW通讯。如果只有一个网络平面，则必须配置为网络平面1。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NFID|NF ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|CGW所在NF的唯一标识。NFID可通过SHOW NFCFG命令查询。
NETTYPE|网络用途|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-3|网络用途，指示用于和网元的数据访问通讯或用于和其他CGW的数据复制通讯，以及所在网络平面。包括：data_access_1：通过数据访问网络平面1，和使用UDSF的网元通讯。data_access_2：通过数据访问网络平面2，和使用UDSF的网元通讯。data_sync_1：通过数据复制网络平面1，和其他UDSF的CGW通讯。data_sync_2：通过数据复制网络平面2，和其他UDSF的CGW通讯。如果只有一个网络平面，则必须配置为网络平面1。
IP|IP地址|参数可选性: 任选参数类型: 字符串|本端的IP地址，支持IPV4和IPV6。使用不同的端口范围时，一个IP地址既可以用于和网元通讯，也可用于和其他CGW通讯。
SERVERPORTSTART|监听端口最小值|参数可选性: 任选参数类型: 数字参数范围: 30000-40000|接收对端网元或CGW的TCP链接的本端起始端口。
SERVERPORTEND|监听端口最大值|参数可选性: 任选参数类型: 数字参数范围: 30000-40000|接收对端网元或CGW的TCP链接的本端终止端口。
CONNECTPORTSTART|连接端口最小值|参数可选性: 任选参数类型: 数字参数范围: 50000-65535|主动连接对端CGW的本端起始端口。网络用途为数据访问时，不需要配置，可以全部设置为50000。
CONNECTPORTEND|连接端口最大值|参数可选性: 任选参数类型: 数字参数范围: 50000-65535|主动连接对端CGW的本端终止端口。网络用途为数据访问时，不需要配置，可以全部设置为50000。
NFLIST|NF列表|参数可选性: 任选参数类型: 字符串参数范围: 0-79|CGW可以为部署在同一TMSP的多个NF服务，该参数列出了使用该CGW的所有NF的标识，多个NF标识使用“&”连接。通常设置为和NFID参数一致。
VPNID|VPNID|参数可选性: 任选参数类型: 数字参数范围: 0-4095默认值: 0|VPN ID。在CommonS_TMSP节点下的Rosng配置中，使用“SHOW IP VRF DETAIL”命令，获取可用VPN ID（VRF ID）。如果没有Rosng配置，则VPN ID为0。该参数默认值为0
DSCP|DSCP标签|参数可选性: 任选参数类型: 数字参数范围: 0-63默认值: 0|差分服务代码点（Differentiated Services Code Point）标签。对于IPv4，在CommonS_IPS服务下使用“SHOW QOSMAPIPV4”命令获取可用的DSCP，或设置为0。对于IPv6，在CommonS_IPS服务下使用“SHOW QOSMAPIPV6”命令获取可用的TC，或设置为0。该参数默认值为0




[](None)命令举例 


`
查询NF标识为1的所有CGW互通配置。

(No.1) : SHOW CGWNODE:NFID=1
------------------------------------------------------------------------------------------------------------------------------------
NF ID   网络用途          IP地址       监听端口最小值  监听端口最大值  连接端口最小值  连接端口最大值    NF列表  VPNID  DSCP标签
------------------------------------------------------------------------------------------------------------------------------------
1       数据同步网络1    10.43.11.100 30000           31000           50000           51000             1       0      0
------------------------------------------------------------------------------------------------------------------------------------

` 


## NF标识配置 
## NF标识配置 


[](None)背景知识 


业务NF、UDR和UDSF，都需要配置一个全局唯一的NF标识。 

第三方应用不需要配置NF标识。 




[](None)功能说明 


本功能用于配置业务NF、UDR和UDSF的NF标识。 




[](None)子主题： 






### 增加NF标识配置(ADD NFCFG) 
### 增加NF标识配置(ADD NFCFG) 


[](None)功能说明 

该命令用于增加一个NF配置。


[](None)注意事项 

无。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NFID|NF标识|参数可选性: 必选参数类型: 数字参数范围: 1-255|NF的唯一标识。
NFName|NF名称|参数可选性: 必选参数类型: 字符串参数范围: 1-40|NF的名称。
NFType|NF类型|参数可选性: 必选参数类型: 枚举，参见枚举定义参数范围: 0-2|NF的类型。包括：self_nf：本地NFsame_tmsp_nf：和本地NF部署在同一TMSP的其他NFdiff_tmsp_nf：和本地NF部署在不同TMSP的其他NF
COMMType|承载类型|参数可选性: 任选参数类型: 枚举，参见枚举定义默认值: NULL|数据通信承载类型，仅在NFTYPE取值“同一TMSP内的NF”或“不同TMSP内的NF”时有意义。包括：TCPSCTPNULL该参数默认值为“NULL”
NFState|链路状态|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: NORMAL|如果将本NF的链路状态修改为“断开”，则本NF与所有局断链。如果将非本NF的链路状态修改为“断开”，则本NF只与指定的NF断链。该参数默认值为“正常”




[](None)命令举例 


`
增加一个NF，NF标识为1，NF名称为UDSF_2，NF类型为部署在其他TMSP，承载类型为NULL的NF。
ADD NFCFG:NFID=1,NFNAME="UDSF_2",NFTYPE="diff_tmsp_nf",COMMTYPE="NULL",NFSTATE="NORMAL"
` 


### 删除NF标识配置(DEL NFCFG) 
### 删除NF标识配置(DEL NFCFG) 


[](None)功能说明 

该命令用于删除一个NF配置。


[](None)注意事项 

删除NF配置后，该NF无法访问其他NF以及无法被其他NF访问。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NFID|NF标识|参数可选性: 必选参数类型: 数字参数范围: 1-255|NF的唯一标识。




[](None)命令举例 


`
删除标识为1的NF。
DEL NFCFG:NFID=1
` 


### 修改NF标识配置(SET NFCFG) 
### 修改NF标识配置(SET NFCFG) 


[](None)功能说明 

该命令用于修改一个NF配置。


[](None)注意事项 

无。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NFID|NF标识|参数可选性: 必选参数类型: 数字参数范围: 1-255|NF的唯一标识。
NFName|NF名称|参数可选性: 任选参数类型: 字符串参数范围: 1-40|NF的名称。
NFType|NF类型|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-2|NF的类型。包括：self_nf：本地NFsame_tmsp_nf：和本地NF部署在同一TMSP的其他NFdiff_tmsp_nf：和本地NF部署在不同TMSP的其他NF
COMMType|承载类型|参数可选性: 任选参数类型: 枚举，参见枚举定义默认值: NULL|数据通信承载类型，仅在NFTYPE取值“同一TMSP内的NF”或“不同TMSP内的NF”时有意义。包括：TCPSCTPNULL该参数默认值为“NULL”
NFState|链路状态|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: NORMAL|如果将本NF的链路状态修改为“断开”，则本NF与所有局断链。如果将非本NF的链路状态修改为“断开”，则本NF只与指定的NF断链。该参数默认值为“正常”




[](None)命令举例 


`
将标识为1的NF的名称修改为UDSF_3。
SET NFCFG:NFID=1,NFNAME="UDSF_3"
` 


### 查询NF标识配置(SHOW NFCFG) 
### 查询NF标识配置(SHOW NFCFG) 


[](None)功能说明 

该命令用于查看指定或全部NF配置。


[](None)注意事项 

无。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NFID|NF标识|参数可选性: 任选参数类型: 数字参数范围: 1-255|NF的唯一标识。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NFID|NF标识|参数可选性: 任选参数类型: 数字参数范围: 1-255|NF的唯一标识。
NFName|NF名称|参数可选性: 任选参数类型: 字符串参数范围: 1-40|NF的名称。
NFType|NF类型|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-2|NF的类型。包括：self_nf：本地NFsame_tmsp_nf：和本地NF部署在同一TMSP的其他NFdiff_tmsp_nf：和本地NF部署在不同TMSP的其他NF
COMMType|承载类型|参数可选性: 任选参数类型: 枚举，参见枚举定义默认值: NULL|数据通信承载类型，仅在NFTYPE取值“同一TMSP内的NF”或“不同TMSP内的NF”时有意义。包括：TCPSCTPNULL该参数默认值为“NULL”
NFState|链路状态|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: NORMAL|如果将本NF的链路状态修改为“断开”，则本NF与所有局断链。如果将非本NF的链路状态修改为“断开”，则本NF只与指定的NF断链。该参数默认值为“正常”




[](None)命令举例 


`
显示所有NF。

(No.1) : SHOW NFCFG
------------------------------------------------------
NF ID   NF名称    NF类型          承载类型    链路状态
------------------------------------------------------
1       UDSF_1    本地NF          NULL        NORMAL
2       UDSF_2    同一TMSP内的NF  NULL        NORMAL
------------------------------------------------------
记录数：2

` 


## CGW过负荷告警阈值配置 
## CGW过负荷告警阈值配置 


[](None)背景知识 


CGW采用缓存机制来提高消息发送效率，当消息缓冲区使用率上升时，表示CGW的负荷增加。CGW提供了分级告警机制来警示用户CGW负荷过高。 




[](None)功能说明 


本功能用于配置CGW的过负荷告警阈值。ＣＧＷ负荷告警分为２级，默认值为90、80。 




[](None)子主题： 






### 增加CGW过负荷配置(ADD CGWBUFFLV) 
### 增加CGW过负荷配置(ADD CGWBUFFLV) 


[](None)功能说明 

该命令用于为CGW增加消息发送缓冲区阈值配置。当系统运行过程中消息发送缓冲区满时，需要提醒用户扩容，减少业务因消息发送缓冲区满失败。 


[](None)注意事项 

过负荷阈值配置是以NF为单位的。一般情况不需要配置。采用系统默认值即可。 
配置完成后，需要同步配置数据，可以实时生效。如果需要调整某个CGW的过负荷阈值等级时，BUFF阈值需要逐步增加，后一级阈值需要比前一级阈值数值大于等于5%。 


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
BUFF_LV1|过负荷1级告警阈值(%)|参数可选性: 必选参数类型: 数字参数范围: 1-100默认值: 90|消息发送缓冲区满告警阈值，默认值取值：90
BUFF_LV2|过负荷2级告警阈值(%)|参数可选性: 必选参数类型: 数字参数范围: 1-100默认值: 80|消息发送缓冲区满预警阈值，默认值取值：80




[](None)命令举例 


`
为CGW增加过负荷配置，示意如下：
ADD CGWBUFFLV:BUFF_LV1=90,BUFF_LV2=80
` 


### 删除CGW过负荷配置(DEL CGWBUFFLV) 
### 删除CGW过负荷配置(DEL CGWBUFFLV) 


[](None)功能说明 

该命令用于删除一条过负荷阈值配置。当某个CGW的消息发送缓冲区所有等级的阈值配置全部删除时将会采用默认值。


[](None)注意事项 

CGW的过负荷阈值配置被删除后，将会采用系统默认配置。


[](None)命令举例 


`
删除CGW的过负荷配置，示意如下：
DEL CGWBUFFLV
` 


### 修改CGW过负荷配置(SET CGWBUFFLV) 
### 修改CGW过负荷配置(SET CGWBUFFLV) 


[](None)功能说明 

该命令用于修改过负荷阈值配置。当用户需要调整过负荷阈值配置时，可以调用此命令对过负荷阈值配置进行修改。


[](None)注意事项 

修改时，注意所有阈值需要逐步增加，后一级BUFF阈值需要比前一级BUFF阈值数值大于等于5%。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
BUFF_LV1|过负荷1级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 90|消息发送缓冲区满告警阈值，默认值取值：90
BUFF_LV2|过负荷2级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 80|消息发送缓冲区满预警阈值，默认值取值：80




[](None)命令举例 


`
修改CGW的过负荷配置，示意如下：
SET CGWBUFFLV:BUFF_LV1=90,BUFF_LV2=80
` 


### 查询CGW过负荷配置(SHOW CGWBUFFLV) 
### 查询CGW过负荷配置(SHOW CGWBUFFLV) 


[](None)功能说明 

该命令用于查询CGW的过负荷阈值配置。


[](None)注意事项 

无。


[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
BUFF_LV1|过负荷1级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 90|消息发送缓冲区满告警阈值，默认值取值：90
BUFF_LV2|过负荷2级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 80|消息发送缓冲区满预警阈值，默认值取值：80




[](None)命令举例 


`
查询CGW的过负荷告警配置，示意如下：

(No.4) : SHOW CGWBUFFLV
---------------------------------------------------------
 过负荷1级告警阈值(%)     过负荷2级告警阈值(%)
---------------------------------------------------------
 90                       80
---------------------------------------------------------
记录数：1

执行成功耗时: 0.158 秒

` 


# UDSF服务配置 
# UDSF服务配置 


[](None)背景知识 


UDSF服务提供非结构化数据的访问与存储服务。租户（Tenant）就是使用系统的用户，不同的租户可以实现数据的隔离，从而保证数据的安全。 




[](None)功能说明 


UDSF服务正常运行需要进行如下配置： 

租户基本配置 

 
租户参数配置 

 
过负荷配置 




[](None)子主题： 






## 租户配置 
## 租户配置 


[](None)背景知识 


租户（Tenant）是指使用系统或计算资源的用户。UDSF支持多租户，不同租户的数据访问和数据存储都是隔离的，从而保证数据的安全。 




[](None)功能说明 


租户配置包含租户的访问策略、所属NF、SC类型等租户相关的基本配置信息。 




[](None)子主题： 






### 增加租户配置(ADD CDBTENANT) 
### 增加租户配置(ADD CDBTENANT) 


[](None)功能说明 

在UDSF部署时，通过该命令增加租户信息。执行成功后，可以通过[SHOW CDBTENANT](../mml/1190002.html)命令查看。


[](None)注意事项 

租户在部署时注入，一般后续不需要再增加。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，不可重复。
TENANTNAME|租户名称|参数可选性: 必选参数类型: 字符串参数范围: 1-128|该参数用于指示租户名称，不可重复。
NFID1|主用NF(局)标识|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于指示租户对应的主用NF标识。与部署时规划的值一致。
NFID2|备用NF(局)标识|参数可选性: 任选参数类型: 数字参数范围: 0-255默认值: 0|该参数用于指示租户对应的备用NF标识。无备用NF时，默认为0。
LEFTSCTYPE|左域SC TYPE|参数可选性: 必选参数类型: 数字参数范围: 0-62|该参数用于指示租户对应的左域SC类型。CDN节点初次启动时，若携带的SC类型与该值匹配，则将节点分配为左域，CDN节点的SC类型由部署时规划。如果配置为0，表示本NF只部署右域。
RIGHTSCTYPE|右域SC TYPE|参数可选性: 必选参数类型: 数字参数范围: 1-62|该参数用于指示租户对应的右域SC类型。CDN节点初次启动时，若携带的SC类型与该值匹配，则将节点分配为右域。
ACCESSPOLICY|访问策略|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-4默认值: default_access|该参数用于指示租户访问UDSF的访问策略。取值如下：缺省访问方式： messageLevel为1级请求时，优先访问主用局UDSF；messageLevel为2级请求时，优先访问本地UDSF本地访问优先： 优先访问本地节点主用访问优先：优先访问主用节点仅本地访问：仅访问本地节点备用访问优先： 优先访问备用节点默认：缺省访问方式
SHARDALGO|分片算法|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-127默认值: ALGO_GENERAL|该参数用于优化数据分布，禁止修改，仅供AMF网元定制算法使用。该参数默认值为ALGO_GENERAL（通用算法）
ONEWAYREPLICATION|单向复制开关|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: ONE_WAY_REPLICATION_OFF|该参数用于指示租户数据复制的策略,且仅在访问策略为仅访问本地时才会生效。开关打开后，CDN的数据仅支持从主用租户向备用租户同步。取值如下：0:关闭1:打开该参数默认值为ONE_WAY_REPLICATION_OFF（关闭）
CONSISTENCYCHECK|一致性检查开关|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: CONSISTENCYCHECK_ON|该参数用于指示系统是否进行各个副本间数据的一致性检查，开关打开后，CDN会定时检查数据的一致性，并自动删除不一致的数据：CONSISTENCYCHECK_OFF:关闭CONSISTENCYCHECK_ON:打开该参数默认值为CONSISTENCYCHECK_ON（打开）
DIAT|数据不一致告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 10|副本间数据偏差百分比阈值，超过该阈值CCC会产生告警。该参数默认值为10(%)。
GLOBALTENANTID|全局租户ID|参数可选性: 任选参数类型: 数字参数范围: 0-255默认值: 0|全局租户ID。客户端访问的所有租户的全局ID必须唯一，可以设置为0或非0值:非0:不能和其他租户的TENANTID以及GLOBALTENANTID相等0:全局租户ID等于租户ID该参数默认值为0




[](None)命令举例 


`
增加ID为1，名称为tenant1的租户，其中，主用NFID为1，左域SC类型为1，右域SC类型为2，访问策略为默认，分片算法为默认，单向开关为关，一致性检查开关为开，全局租户ID为0
ADD CDBTENANT:TENANTID=1,TENANTNAME="tenant1",NFID1=1,NFID2=0,LEFTSCTYPE=1,RIGHTSCTYPE=2,ACCESSPOLICY="default_access",SHARDALGO="ALGO_GENERAL",ONEWAYREPLICATION="ONE_WAY_REPLICATION_OFF",CONSISTENCYCHECK="CONSISTENCYCHECK_ON",GLOBALTENANTID=0
` 


### 删除租户配置(DEL CDBTENANT) 
### 删除租户配置(DEL CDBTENANT) 


[](None)功能说明 

该命令用于删除租户配置，一般不允许删除。


[](None)注意事项 

删除租户后会导致节点启动失败，业务无法访问。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，不可重复。




[](None)命令举例 


`
删除ID为1的租户。
DEL CDBTENANT:TENANTID=1
` 


### 修改租户配置(SET CDBTENANT) 
### 修改租户配置(SET CDBTENANT) 


[](None)功能说明 

该命令用于修改租户配置。执行成功后，可以通过[SHOW CDBTENANT](../mml/1190002.html)命令查看。


[](None)注意事项 

修改的租户名称不能与其他租户名称重复。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，不可重复。
TENANTNAME|租户名称|参数可选性: 任选参数类型: 字符串参数范围: 1-128|该参数用于指示租户名称，不可重复。
NFID1|主用NF(局)标识|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于指示租户对应的主用NF标识。与部署时规划的值一致。
NFID2|备用NF(局)标识|参数可选性: 任选参数类型: 数字参数范围: 0-255默认值: 0|该参数用于指示租户对应的备用NF标识。无备用NF时，默认为0。
LEFTSCTYPE|左域SC TYPE|参数可选性: 任选参数类型: 数字参数范围: 0-62|该参数用于指示租户对应的左域SC类型。CDN节点初次启动时，若携带的SC类型与该值匹配，则将节点分配为左域，CDN节点的SC类型由部署时规划。如果配置为0，表示本NF只部署右域。
RIGHTSCTYPE|右域SC TYPE|参数可选性: 任选参数类型: 数字参数范围: 1-62|该参数用于指示租户对应的右域SC类型。CDN节点初次启动时，若携带的SC类型与该值匹配，则将节点分配为右域。
ACCESSPOLICY|访问策略|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-4默认值: default_access|该参数用于指示租户访问UDSF的访问策略。取值如下：缺省访问方式： messageLevel为1级请求时，优先访问主用局UDSF；messageLevel为2级请求时，优先访问本地UDSF本地访问优先： 优先访问本地节点主用访问优先：优先访问主用节点仅本地访问：仅访问本地节点备用访问优先： 优先访问备用节点默认：缺省访问方式
SHARDALGO|分片算法|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-127默认值: ALGO_GENERAL|该参数用于优化数据分布，禁止修改，仅供AMF网元定制算法使用。该参数默认值为ALGO_GENERAL（通用算法）
ONEWAYREPLICATION|单向复制开关|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: ONE_WAY_REPLICATION_OFF|该参数用于指示租户数据复制的策略,且仅在访问策略为仅访问本地时才会生效。开关打开后，CDN的数据仅支持从主用租户向备用租户同步。取值如下：0:关闭1:打开该参数默认值为ONE_WAY_REPLICATION_OFF（关闭）
CONSISTENCYCHECK|一致性检查开关|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: CONSISTENCYCHECK_ON|该参数用于指示系统是否进行各个副本间数据的一致性检查，开关打开后，CDN会定时检查数据的一致性，并自动删除不一致的数据：CONSISTENCYCHECK_OFF:关闭CONSISTENCYCHECK_ON:打开该参数默认值为CONSISTENCYCHECK_ON（打开）
DIAT|数据不一致告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 10|副本间数据偏差百分比阈值，超过该阈值CCC会产生告警。该参数默认值为10(%)。
GLOBALTENANTID|全局租户ID|参数可选性: 任选参数类型: 数字参数范围: 0-255默认值: 0|全局租户ID。客户端访问的所有租户的全局ID必须唯一，可以设置为0或非0值:非0:不能和其他租户的TENANTID以及GLOBALTENANTID相等0:全局租户ID等于租户ID该参数默认值为0




[](None)命令举例 


`
修改租户1的名称为TENANT_1，访问策略为主用局优先。
SET CDBTENANT:TENANTID=1,TENANTNAME="TENANT_1",ACCESSPOLICY="master_access_pri"
` 


### 查询租户配置(SHOW CDBTENANT) 
### 查询租户配置(SHOW CDBTENANT) 


[](None)功能说明 

该命令用于查看租户配置，当用户需要查看租户信息时可以使用该命令。


[](None)注意事项 

无。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，不可重复。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，不可重复。
TENANTNAME|租户名称|参数可选性: 任选参数类型: 字符串参数范围: 1-128|该参数用于指示租户名称，不可重复。
NFID1|主用NF(局)标识|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于指示租户对应的主用NF标识。与部署时规划的值一致。
NFID2|备用NF(局)标识|参数可选性: 任选参数类型: 数字参数范围: 0-255默认值: 0|该参数用于指示租户对应的备用NF标识。无备用NF时，默认为0。
LEFTSCTYPE|左域SC TYPE|参数可选性: 任选参数类型: 数字参数范围: 0-62|该参数用于指示租户对应的左域SC类型。CDN节点初次启动时，若携带的SC类型与该值匹配，则将节点分配为左域，CDN节点的SC类型由部署时规划。如果配置为0，表示本NF只部署右域。
RIGHTSCTYPE|右域SC TYPE|参数可选性: 任选参数类型: 数字参数范围: 1-62|该参数用于指示租户对应的右域SC类型。CDN节点初次启动时，若携带的SC类型与该值匹配，则将节点分配为右域。
ACCESSPOLICY|访问策略|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-4默认值: default_access|该参数用于指示租户访问UDSF的访问策略。取值如下：缺省访问方式： messageLevel为1级请求时，优先访问主用局UDSF；messageLevel为2级请求时，优先访问本地UDSF本地访问优先： 优先访问本地节点主用访问优先：优先访问主用节点仅本地访问：仅访问本地节点备用访问优先： 优先访问备用节点默认：缺省访问方式
SHARDALGO|分片算法|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-127默认值: ALGO_GENERAL|该参数用于优化数据分布，禁止修改，仅供AMF网元定制算法使用。该参数默认值为ALGO_GENERAL（通用算法）
ONEWAYREPLICATION|单向复制开关|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: ONE_WAY_REPLICATION_OFF|该参数用于指示租户数据复制的策略,且仅在访问策略为仅访问本地时才会生效。开关打开后，CDN的数据仅支持从主用租户向备用租户同步。取值如下：0:关闭1:打开该参数默认值为ONE_WAY_REPLICATION_OFF（关闭）
CONSISTENCYCHECK|一致性检查开关|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: CONSISTENCYCHECK_ON|该参数用于指示系统是否进行各个副本间数据的一致性检查，开关打开后，CDN会定时检查数据的一致性，并自动删除不一致的数据：CONSISTENCYCHECK_OFF:关闭CONSISTENCYCHECK_ON:打开该参数默认值为CONSISTENCYCHECK_ON（打开）
DIAT|数据不一致告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 10|副本间数据偏差百分比阈值，超过该阈值CCC会产生告警。该参数默认值为10(%)。
GLOBALTENANTID|全局租户ID|参数可选性: 任选参数类型: 数字参数范围: 0-255默认值: 0|全局租户ID。客户端访问的所有租户的全局ID必须唯一，可以设置为0或非0值:非0:不能和其他租户的TENANTID以及GLOBALTENANTID相等0:全局租户ID等于租户ID该参数默认值为0




[](None)命令举例 


`
查看ID为1的租户配置。

(No.1) : SHOW CDBTENANT:
-----------------Ncudr_SystemManagement_0----------------
操作维护       租户ID 租户名称 主用NF(局)标识 备用NF(局)标识 左域SC TYPE 右域SC TYPE 访问策略 分片算法 单向复制开关 一致性检查开关  数据不一致告警阈值(%) 全局租户ID
----------------------------------------------------------------------------------------------------------------------------------------------------------
复制 修改 删除 1      tenant_1 1              2              1           2           缺省     通用算法 关闭         开启          10                    0
----------------------------------------------------------------------------------------------------------------------------------------------------------
记录数：1
执行成功开始时间:2022-08-23 17:29:14 耗时: 0.719 秒



` 


## 参数配置 
## 参数配置 


[](None)背景知识 


租户（Tenant）是指使用系统或计算资源的用户，一个租户下包含多个节点。 




[](None)功能说明 


租户的参数配置是配置租户内各个节点正常运行所需要的相关参数。UDSF的节点上电时需要读取这些参数，进行部署并创建内存数据库，启动UDSF服务。 




[](None)子主题： 






### 增加参数配置(ADD CDBPARAM) 
### 增加参数配置(ADD CDBPARAM) 


[](None)功能说明 

该命令用于增加租户参数配置，当UDSF节点上电时需要从租户配置中读取内存库大小（MDBSIZE）、日志缓冲区大小（LOGBUFSIZE）、TPS上限(TPS)、数据区个数(BUFFNUM)、行合并(ROWMERGE)参数。在UDSF上电前需要通过该命令增加租户参数，命令执行成功后，通过[SHOW CDBPARAM](../mml/1190007.html)命令可以查看。


[](None)注意事项 

租户参数必须在部署时注入，部署完成后一般不需要手工增加。 

 
若UDSF的节点上电时读取不到该租户参数，会导致上电失败。 


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
MDBSIZE|内存库大小(MB)|参数可选性: 必选参数类型: 数字参数范围: 500-32768|单个CDN节点内存库大小，单位为MB，指示用于存放数据的内存库大小。该参数需要重启CDN生效。
LOGBUFSIZE|日志库大小(MB)|参数可选性: 必选参数类型: 数字参数范围: 100-8192|单个CDN节点日志缓冲区大小，单位为MB，指示用于存放日志的缓冲区大小。该参数需要重启CDN生效。
TPS|TPS|参数可选性: 任选参数类型: 数字参数范围: 10000-120000默认值: 100000|单个CDN节点TPS上限，指示单节点TPS上限。该参数默认值为100,000
BUFFNUM|数据区个数|参数可选性: 任选参数类型: 数字参数范围: 10000-18000默认值: 15000|单个CDN节点事务数据区个数上限，指示单节点事务数据区个数上限。该参数需要重启CDN生效。该参数默认值为15,000
ROWMERGE|行合并功能|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: Disable|开启或关闭行合并功能。该参数的默认值为Disable（功能关闭）
SUBENABLE|启用订阅通知功能|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: NO|是否启用订阅通知功能。可取值：NO: 不启用订阅通知功能。YES：启用订阅通知功能。该参数的默认值为NO（功能不启用）




[](None)命令举例 


`
增加租户1的参数。
ADD CDBPARAM:TENANTID=1,MDBSIZE=6656,LOGBUFSIZE=1024,TPS=100000,BUFFNUM=15000,ROWMERGE="Disable"
` 


### 删除参数配置(DEL CDBPARAM) 
### 删除参数配置(DEL CDBPARAM) 


[](None)功能说明 

该命令用于删除租户参数配置。


[](None)注意事项 

删除配置可能会导致UDSF下的节点上电失败，需谨慎操作。 


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。




[](None)命令举例 


`
删除租户1的配置项。
DEL CDBPARAM:TENANTID=1
` 


### 修改参数配置(SET CDBPARAM) 
### 修改参数配置(SET CDBPARAM) 


[](None)功能说明 

该命令用于修改租户参数配置，当内存库大小（MDBSIZE）、日志缓冲区大小（LOGBUFSIZE）、TPS上限(TPSNUM)、数据区个数(BUFFNUM)、行合并开关(ROWMERGE)等参数不符合业务网元的使用需求时可以根据实际情况修改。执行成功后，可以通过[SHOW CDBPARAM](../mml/1190007.html) 命令查看。


[](None)注意事项 

将参数值改小后，可能导致数据丢失，节点异常，需谨慎操作。 

 
修改内存库大小（MDBSIZE）、日志缓冲区大小（LOGBUFSIZE）、数据区个数（BUFFNUM）后，需要重启UDSF下所有CDN节点才能生效。不重启不生效，对业务无影响。仅修改TPS、SUBENABLE和ROWMERGE不需要重启。 


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
MDBSIZE|内存库大小(MB)|参数可选性: 任选参数类型: 数字参数范围: 500-32768|单个CDN节点内存库大小，单位为MB，指示用于存放数据的内存库大小。该参数需要重启CDN生效。
LOGBUFSIZE|日志库大小(MB)|参数可选性: 任选参数类型: 数字参数范围: 100-8192|单个CDN节点日志缓冲区大小，单位为MB，指示用于存放日志的缓冲区大小。该参数需要重启CDN生效。
TPS|TPS|参数可选性: 任选参数类型: 数字参数范围: 10000-120000默认值: 100000|单个CDN节点TPS上限，指示单节点TPS上限。该参数默认值为100,000
BUFFNUM|数据区个数|参数可选性: 任选参数类型: 数字参数范围: 10000-18000默认值: 15000|单个CDN节点事务数据区个数上限，指示单节点事务数据区个数上限。该参数需要重启CDN生效。该参数默认值为15,000
ROWMERGE|行合并功能|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: Disable|开启或关闭行合并功能。该参数的默认值为Disable（功能关闭）
SUBENABLE|启用订阅通知功能|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: NO|是否启用订阅通知功能。可取值：NO: 不启用订阅通知功能。YES：启用订阅通知功能。该参数的默认值为NO（功能不启用）




[](None)命令举例 


`
修改租户1的MDBSIZE配置项值为1024。
SET CDBPARAM:TENANTID=1,MDBSIZE=1024
` 


### 查询参数配置(SHOW CDBPARAM) 
### 查询参数配置(SHOW CDBPARAM) 


[](None)功能说明 

该命令用于查询租户参数配置，包括内存库大小（MDBSIZE）、日志缓冲区大小（LOGBUFSIZE）、TPS上限(TPSNUM)、数据区个数(BUFFNUM)、行合并开关(ROWMERGE)。


[](None)注意事项 

无。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
MDBSIZE|内存库大小(MB)|参数可选性: 任选参数类型: 数字参数范围: 500-32768|单个CDN节点内存库大小，单位为MB，指示用于存放数据的内存库大小。该参数需要重启CDN生效。
LOGBUFSIZE|日志库大小(MB)|参数可选性: 任选参数类型: 数字参数范围: 100-8192|单个CDN节点日志缓冲区大小，单位为MB，指示用于存放日志的缓冲区大小。该参数需要重启CDN生效。
TPS|TPS|参数可选性: 任选参数类型: 数字参数范围: 10000-120000默认值: 100000|单个CDN节点TPS上限，指示单节点TPS上限。该参数默认值为100,000
BUFFNUM|数据区个数|参数可选性: 任选参数类型: 数字参数范围: 10000-18000默认值: 15000|单个CDN节点事务数据区个数上限，指示单节点事务数据区个数上限。该参数需要重启CDN生效。该参数默认值为15,000
ROWMERGE|行合并功能|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: Disable|开启或关闭行合并功能。该参数的默认值为Disable（功能关闭）
SUBENABLE|启用订阅通知功能|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: NO|是否启用订阅通知功能。可取值：NO: 不启用订阅通知功能。YES：启用订阅通知功能。该参数的默认值为NO（功能不启用）




[](None)命令举例 


`
查询租户1的参数配置。

(No.1) : SHOW CDBPARAM:TENANTID=1
-----------------NFS Common Configuration---------------------------------
租户ID 内存库大小 日志库大小  TPS    数据区个数 行合并功能 启用订阅通知功能
--------------------------------------------------------------------------
1      6656       1024        100000 15000      关闭       NO
--------------------------------------------------------------------------
记录数：1
执行成功耗时: 0.1 秒

` 


## 过负荷配置 
## 过负荷配置 


[](None)背景知识 


UDSF服务提供了过负荷控制功能，在系统超负荷运转时，可以保证系统的安全。UDSF目前提供了CPU过负荷的控制，在系统的CPU负载超过阈值时按比例以及消息的重要性丢弃部分消息，从而保证系统过负荷时能够正常运行。 




[](None)功能说明 


UDSF过负荷阈值可以根据用户的需求进行配置，也可以采用系统默认值。 




[](None)子主题： 






### 增加过负荷配置(ADD CDBLOADLV) 
### 增加过负荷配置(ADD CDBLOADLV) 


[](None)功能说明 

该命令用于为租户增加过负荷配置。当系统运行过程中出现过负荷时，为了防止减缓系统阻塞、业务大量失败的可能，需要按比例丢弃部分业务操作。过负荷配置就是以租户为单位配置过负荷时各个过负荷等级下的CPU阈值。目前系统默认的过负荷等级如下： 
level: 0, cpu: 75。系统正常运行。不丢消息、不发告警。 
level: 1, cpu: 80。系统轻度过负荷，发出轻度过负荷告警，丢弃部分低优先级消息。 
level: 2, cpu: 85。系统中度过负荷，丢弃低优先级消息，发出中度过负荷告警。 
level: 3, cpu: 90。系统重度过负荷，系统发出重度过负荷告警，开始丢弃部分高优先级消息。 
level: 4, cpu: 95。系统严重过负荷，系统发出严重过负荷告警，会丢弃所有消息。 


[](None)注意事项 

过负荷配置是以租户为单位的。一般情况不需要配置。采用系统默认值即可。只有在用户认为过负荷的CPU阈值需要调整时，才需要进行配置。 
配置完成后，需要同步配置数据，可以实时生效。如果需要调整某个租户的过负荷等级时，0~4级CPU阈值需要逐步增加，后一级CPU阈值需要比前一级CPU阈值数值大于等于5%。 


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
LEVEL|过负荷等级|参数可选性: 必选参数类型: 数字参数范围: 0-4|过负荷等级，取值如下：level: 0, cpu: 75。系统正常运行。不丢消息、不发告警。level: 1, cpu: 80。系统轻度过负荷，发出轻度过负荷告警，丢弃部分低优先级消息。level: 2, cpu: 85。系统中度过负荷，丢弃低优先级消息，发出中度过负荷告警。level: 3, cpu: 90。系统重度过负荷，系统发出重度过负荷告警，开始丢弃部分高优先级消息。level: 4, cpu: 95。系统严重过负荷，系统发出严重过负荷告警，会丢弃所有消息。
CPU|CPU负荷阈值(%)|参数可选性: 必选参数类型: 数字参数范围: 1-100|CPU负荷阈值，取值参见LEVEL说明。




[](None)命令举例 


`
为租户1增加一条过负荷等级为0的过负荷配置，示意如下：
ADD CDBLOADLV:TENANTID=1,LEVEL=0,CPU=75
` 


### 删除过负荷配置(DEL CDBLOADLV) 
### 删除过负荷配置(DEL CDBLOADLV) 


[](None)功能说明 

该命令用于删除一条过负荷配置。当某个租户的所有等级过负荷配置全部删除时将会采用默认值。


[](None)注意事项 

租户的过负荷配置被删除后，将会采用系统默认配置。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
LEVEL|过负荷等级|参数可选性: 必选参数类型: 数字参数范围: 0-4|过负荷等级，取值如下：level: 0, cpu: 75。系统正常运行。不丢消息、不发告警。level: 1, cpu: 80。系统轻度过负荷，发出轻度过负荷告警，丢弃部分低优先级消息。level: 2, cpu: 85。系统中度过负荷，丢弃低优先级消息，发出中度过负荷告警。level: 3, cpu: 90。系统重度过负荷，系统发出重度过负荷告警，开始丢弃部分高优先级消息。level: 4, cpu: 95。系统严重过负荷，系统发出严重过负荷告警，会丢弃所有消息。




[](None)命令举例 


`
删除租户1的过负荷配置，示意如下：
DEL CDBLOADLV:TENANTID=1,LEVEL=1
` 


### 修改过负荷配置(SET CDBLOADLV) 
### 修改过负荷配置(SET CDBLOADLV) 


[](None)功能说明 

该命令用于修改租户的过负荷配置。当用户需要调整租户的过负荷配置时，可以调用此命令对租户的过负荷配置进行修改。


[](None)注意事项 

修改时，注意0~4级CPU阈值需要逐步增加，后一级CPU阈值需要比前一级CPU阈值数值大于等于5%。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
LEVEL|过负荷等级|参数可选性: 必选参数类型: 数字参数范围: 0-4|过负荷等级，取值如下：level: 0, cpu: 75。系统正常运行。不丢消息、不发告警。level: 1, cpu: 80。系统轻度过负荷，发出轻度过负荷告警，丢弃部分低优先级消息。level: 2, cpu: 85。系统中度过负荷，丢弃低优先级消息，发出中度过负荷告警。level: 3, cpu: 90。系统重度过负荷，系统发出重度过负荷告警，开始丢弃部分高优先级消息。level: 4, cpu: 95。系统严重过负荷，系统发出严重过负荷告警，会丢弃所有消息。
CPU|CPU负荷阈值(%)|参数可选性: 必选参数类型: 数字参数范围: 1-100|CPU负荷阈值，取值参见LEVEL说明。




[](None)命令举例 


`
修改租户1的一条过负荷等级为0的CPU阈值为78，示意如下：
SET CDBLOADLV:TENANTID=1,LEVEL=0,CPU=78
` 


### 查询过负荷配置(SHOW CDBLOADLV) 
### 查询过负荷配置(SHOW CDBLOADLV) 


[](None)功能说明 

该命令用于查询租户的过负荷配置。


[](None)注意事项 

无。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
LEVEL|过负荷等级|参数可选性: 任选参数类型: 数字参数范围: 0-4|过负荷等级，取值如下：level: 0, cpu: 75。系统正常运行。不丢消息、不发告警。level: 1, cpu: 80。系统轻度过负荷，发出轻度过负荷告警，丢弃部分低优先级消息。level: 2, cpu: 85。系统中度过负荷，丢弃低优先级消息，发出中度过负荷告警。level: 3, cpu: 90。系统重度过负荷，系统发出重度过负荷告警，开始丢弃部分高优先级消息。level: 4, cpu: 95。系统严重过负荷，系统发出严重过负荷告警，会丢弃所有消息。
CPU|CPU负荷阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100|CPU负荷阈值，取值参见LEVEL说明。




[](None)命令举例 


`
查询租户1的过负荷配置，示意如下：

(No.4) : SHOW CDBLOADLV:TENANTID=1
-----------------Ncudr_SystemManagement_0----------------
租户ID        过负荷等级      CPU负荷阈值
---------------------------------------------------------
1             0               75
1             1               80
1             2               85
1             3               90
1             4               95
---------------------------------------------------------
记录数：5

执行成功耗时: 0.158 秒

` 


## 内存库告警阈值配置 
## 内存库告警阈值配置 


[](None)背景知识 


UDSF内存数据库需要预先分配内存池，当内存池用光时，后续的业务操作如增加和修改操作等需要申请内存的操作都会失败。因此UDSF提供了内存库库满分级告警机制，警告用户需要提前规划并实施扩容操作，避免库满时造成不必要的业务失败。 




[](None)功能说明 


UDSF内存数据库提供了三级库满告警，阈值可以通过本节点提供的配置命令进行配置。其中１级最高，３级最低，且每２级阈值之间差值要求不小于５。当一级告警上报后，如果用户仍然没有实施扩容操作，内存库使用率继续上升，会上报内存库满告警。 




[](None)子主题： 






### 增加内存库告警阈值配置(ADD CDBMEMALARMLV) 
### 增加内存库告警阈值配置(ADD CDBMEMALARMLV) 


[](None)功能说明 

该命令用于为租户增加内存库告警阈值配置。当系统运行过程中内存库库满时，需要提醒用户扩容，减少业务因库满失败。目前系统默认的内存库库满告警阈值等级如下： 
DB_RATIO_LV3: 70。内存库库满预警阈值，需要计划扩容。 
DB_RATIO_LV2: 80。内存库库满紧急预警，需要立即扩容。 
DB_RATIO_LV1: 90。内存库库将满告警，业务持续增加,库满时增加操作和修改操作会失败。 


[](None)注意事项 

内存库库满告警阈值配置是以租户为单位的。一般情况不需要配置。采用系统默认值即可。只有在用户认为过内存库库满告警阈值需要调整时，才需要进行配置。 
配置完成后，需要同步配置数据，可以实时生效。如果需要调整某个租户的内存库库满告警阈值等级时，1~3级CDBMEMALARMLV阈值需要逐步递减，后一级阈值需要比前一级阈值数值小于等于5。 


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
DB_RATIO_LV1|内存库一级告警阈值(%)|参数可选性: 必选参数类型: 数字参数范围: 1-95默认值: 90|内存库库满一级告警阈值该参数默认值为90
DB_RATIO_LV2|内存库二级告警阈值(%)|参数可选性: 必选参数类型: 数字参数范围: 1-95默认值: 80|内存库库满二级告警阈值该参数默认值为80
DB_RATIO_LV3|内存库三级告警阈值(%)|参数可选性: 必选参数类型: 数字参数范围: 1-95默认值: 70|内存库库满三级告警阈值该参数默认值为70




[](None)命令举例 


`
增加租户1的CDBMEMALARMLV配置，示意如下：
ADD CDBMEMALARMLV:TENANTID=1,DB_RATIO_LV1=90,DB_RATIO_LV2=80,DB_RATIO_LV3=70
` 


### 删除内存库告警阈值配置(DEL CDBMEMALARMLV) 
### 删除内存库告警阈值配置(DEL CDBMEMALARMLV) 


[](None)功能说明 

该命令用于删除内存库库满告警阈值配置。当某个租户的库满告警阈值配置删除时将会采用默认值。


[](None)注意事项 

租户的内存库库满告警阈值配置被删除后，将会采用系统默认配置。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。




[](None)命令举例 


`
删除租户1的CDBMEMALARMLV配置，示意如下：
DEL CDBMEMALARMLV:TENANTID=1
` 


### 修改内存库告警阈值配置(SET CDBMEMALARMLV) 
### 修改内存库告警阈值配置(SET CDBMEMALARMLV) 


[](None)功能说明 

该命令用于修改租户的库满告警阈值配置。当用户需要调整租户的库满告警阈值配置时，可以调用此命令对租户的库满告警阈值配置进行修改。


[](None)注意事项 

修改时，1~3级CDBMEMALARMLV阈值需要逐步递减，后一级阈值需要比前一级阈值数值小于等于5。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
DB_RATIO_LV1|内存库一级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-95默认值: 90|内存库库满一级告警阈值该参数默认值为90
DB_RATIO_LV2|内存库二级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-95默认值: 80|内存库库满二级告警阈值该参数默认值为80
DB_RATIO_LV3|内存库三级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-95默认值: 70|内存库库满三级告警阈值该参数默认值为70




[](None)命令举例 


`
修改租户1的CDBMEMALARMLV阈值为90，示意如下：
SET CDBMEMALARMLV:TENANTID=1,DB_RATIO_LV1=90
` 


### 查询内存库告警阈值配置(SHOW CDBMEMALARMLV) 
### 查询内存库告警阈值配置(SHOW CDBMEMALARMLV) 


[](None)功能说明 

该命令用于查询租户的库满告警阈值配置。


[](None)注意事项 

无。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
DB_RATIO_LV1|内存库一级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-95默认值: 90|内存库库满一级告警阈值该参数默认值为90
DB_RATIO_LV2|内存库二级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-95默认值: 80|内存库库满二级告警阈值该参数默认值为80
DB_RATIO_LV3|内存库三级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-95默认值: 70|内存库库满三级告警阈值该参数默认值为70




[](None)命令举例 


`
查询租户1的CDBMEMALARMLV配置，示意如下：

(No.4) : SHOW CDBMEMALARMLV:TENANTID=1
-----------------Ncudr_SystemManagement_0----------------
租户ID  内存库一级告警阈值(%)   内存库二级告警阈值(%)  内存库三级告警阈值(%)
---------------------------------------------------------------------------
1       90                      80                     70
---------------------------------------------------------------------------
记录数：1

执行成功耗时: 0.158 秒

` 


## 数据区告警阈值配置 
## 数据区告警阈值配置 


[](None)背景知识 


UDSF使用数据缓冲区来存放未完成的事务数据，事务结束后再释放事务缓冲区。当单位时间内事务缓冲区占用率过高时可能会导致事务缓冲区不够用，造成事务失败。事务缓冲区大小可以通过[ADD CDBPARAM](../mml/1190004.html)命令配置。当事务缓冲区使用率过高时, UDSF提供了分级告警，警告用户事务过频。目前会使用事务缓冲区的只有增加操作。




[](None)功能说明 


UDSF提供了四级告警，用于提示用户数据事务缓冲区的使用情况。本节点提供了阈值配置命令，其中１级最高，４级最低，且每２级之间差值要求不小于５。如果不配置，默认值为90、80、70、60。 




[](None)子主题： 






### 增加数据区告警阈值配置(ADD CDBBUFFLV) 
### 增加数据区告警阈值配置(ADD CDBBUFFLV) 


[](None)功能说明 

该命令用于为租户增加数据区告警阈值配置。当系统运行过程中数据区满时，需要提醒用户扩容，减少业务因数据区满失败。 


[](None)注意事项 

数据区告警阈值配置是以租户为单位的。一般情况不需要配置。采用系统默认值即可。 
配置完成后，需要同步配置数据，可以实时生效。如果需要调整某个租户的数据区告警阈值等级时，1~4级阈值需要逐步递减，后一级阈值需要比前一级阈值数值差值大于等于5。 


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
BUFF_LV1|数据区1级告警阈值(%)|参数可选性: 必选参数类型: 数字参数范围: 1-100默认值: 90|数据区满严重告警阈值，默认取值：90。
BUFF_LV2|数据区2级告警阈值(%)|参数可选性: 必选参数类型: 数字参数范围: 1-100默认值: 80|数据区满重要告警阈值，默认取值：80。
BUFF_LV3|数据区3级告警阈值(%)|参数可选性: 必选参数类型: 数字参数范围: 1-100默认值: 70|数据区满次要告警阈值，默认取值：70。
BUFF_LV4|数据区4级告警阈值(%)|参数可选性: 必选参数类型: 数字参数范围: 1-100默认值: 60|数据区满预警阈值，默认取值：60。




[](None)命令举例 


`
为租户1增加数据区告警阈值配置，示意如下：
ADD CDBBUFFLV:TENANTID=1,BUFF_LV1=90,BUFF_LV2=80,BUFF_LV3=70,BUFF_LV4=60
` 


### 删除数据区告警阈值配置(DEL CDBBUFFLV) 
### 删除数据区告警阈值配置(DEL CDBBUFFLV) 


[](None)功能说明 

该命令用于删除一条数据区告警阈值配置。当某个租户的数据区所有等级的阈值配置全部删除时将会采用默认值。


[](None)注意事项 

租户的数据区阈值配置被删除后，将会采用系统默认配置。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。




[](None)命令举例 


`
删除租户1的告警阈值配置，示意如下：
DEL CDBBUFFLV:TENANTID=1
` 


### 修改数据区告警阈值配置(SET CDBBUFFLV) 
### 修改数据区告警阈值配置(SET CDBBUFFLV) 


[](None)功能说明 

该命令用于修改数据区告警阈值配置。当用户需要调整数据区告警阈值配置时，可以调用此命令对数据区告警阈值配置进行修改。


[](None)注意事项 

修改时，注意1~4级阈值需要逐步递减，后一级阈值需要比前一级阈值数值差值大于等于5。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 必选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
BUFF_LV1|数据区1级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 90|数据区满严重告警阈值，默认取值：90。
BUFF_LV2|数据区2级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 80|数据区满重要告警阈值，默认取值：80。
BUFF_LV3|数据区3级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 70|数据区满次要告警阈值，默认取值：70。
BUFF_LV4|数据区4级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 60|数据区满预警阈值，默认取值：60。




[](None)命令举例 


`
修改租户1的告警阈值为90，示意如下：
SET CDBBUFFLV:TENANTID=1,BUFF_LV1=90
` 


### 查询数据区告警阈值配置(SHOW CDBBUFFLV) 
### 查询数据区告警阈值配置(SHOW CDBBUFFLV) 


[](None)功能说明 

该命令用于查询租户的数据区告警阈值配置。


[](None)注意事项 

无。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
BUFF_LV1|数据区1级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 90|数据区满严重告警阈值，默认取值：90。
BUFF_LV2|数据区2级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 80|数据区满重要告警阈值，默认取值：80。
BUFF_LV3|数据区3级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 70|数据区满次要告警阈值，默认取值：70。
BUFF_LV4|数据区4级告警阈值(%)|参数可选性: 任选参数类型: 数字参数范围: 1-100默认值: 60|数据区满预警阈值，默认取值：60。




[](None)命令举例 


`
查询租户1的告警阈值配置，示意如下：

(No.4) : SHOW CDBBUFFLV:TENANTID=1
-----------------Ncudr_SystemManagement_0----------------
租户ID  数据区1级告警阈值(%)  数据区2级告警阈值(%)  数据区3级告警阈值(%)  数据区4级告警阈值(%)
-----------------------------------------------------------------------------------------
1       90                    80                    70                    60 
-----------------------------------------------------------------------------------------
记录数：1

执行成功耗时: 0.158 秒

` 


专业维护 :专业维护 :

[](None)背景知识 


为了方便对节点状态和分布式数据进行管理，需要一些专业维护功能。 




[](None)功能说明 


使用本命令可以进行专业维护方面的操作，包括拓扑管理、数据维护、探针命令等功能。 




[](None)子主题： 






## UDSF管理 
## UDSF管理 


[](None)背景知识 


UDSF从系统管理和数据维护两个方面，给维护人员提供了系统维护功能。 
其中，UDSF拓扑管理可以查看系统中所有节点的拓扑信息以及数据分布信息。UDSF数据维护提供了一组数据维护的命令，方便用户查看和维护UDSF系统中的用户数据信息。UDSF探针也属于一种数据维护的方法，但因为探针可以直接查看内存库中的数据，因此单独归类。 




[](None)功能说明 


该功能用于UDSF系统管理和数据维护，方便用户查看系统状态，并对系统中的用户数据进行维护。 




[](None)子主题： 






### UDSF拓扑管理 
### UDSF拓扑管理 


[](None)背景知识 


UDSF拓扑包含UDSF节点分布、UDSF数据分布以及UDSF数据是否有效的历史变迁。 




[](None)功能说明 


该功能用于查看UDSF系统中各个节点的拓扑状态以及数据分布，提供了如下几个命令： 

查看UDSF节点状态：用于查看系统中CDN节点的当前状态。 

 
查看UDSF数据分布：用于查看UDSF数据分片在系统中分布情况以及各个副本的当前状态。 

 
查看UDSF数据状态：用于查看当前和历史数据状态，可以查看最近5次用户数据状态变迁历史信息。 




[](None)子主题： 






#### 查询节点状态(SHOW CDBNODE) 
#### 查询节点状态(SHOW CDBNODE) 


[](None)功能说明 

该命令用于查询节点的当前运行状态信息。当操作维护人员需要了解当前节点的运行状态时，可以执行本命令。


[](None)注意事项 

无。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户。通过SHOW CDBTENANT命令可以查看已创建的租户ID。
NFID|NF标识|参数可选性: 任意单选参数类型: 数字参数范围: 1-255|该参数用于唯一指示UDSF部署的NF，通过SHOW CDBTENANT命令可以查看所有租户分布的NF信息。
MODULE|模块号|参数可选性: 任意单选参数类型: 数字参数范围: 1-65535|该参数用于指示节点对应的模块号。模块号供内部使用，节点号供外部使用。查询时可以不输入，表示查询租户下的所有节点信息。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
INDEXID|索引号|参数可选性: 任选参数类型: 数字参数范围: 1-65535|用于唯一标识一条节点记录信息。
NFID|NF标识|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一指示UDSF部署的NF，通过SHOW CDBTENANT命令可以查看所有租户分布的NF信息。
NODEID|节点ID|参数可选性: 任选参数类型: 数字参数范围: 0-4294967295|该参数用于指示节点号。
MODULE|模块号|参数可选性: 任选参数类型: 数字参数范围: 1-65535|该参数用于指示节点对应的模块号。模块号供内部使用，节点号供外部使用。查询时可以不输入，表示查询租户下的所有节点信息。
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户。通过SHOW CDBTENANT命令可以查看已创建的租户ID。
DOMAIN|域|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于指示CDN节点归属左域还是右域。
STATE|状态|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于指示节点当前状态，支持以下状态：NORMAL：正常状态INIT：初始态，CDN节点还未获取到配置。WAIT：等待态，CDN节点还未获取到分片分布。OFFLINE：离线态，CDN节点被离线，业务不再发往该节点。ABNORMAL：异常状态，节点断链或上电失败，处于该状态的节点无法处理业务。
CPU|CPU(%)|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于指示该节点当前CPU占用率。
MEM|MEM(%)|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于指示该节点当前内存库占用比例。
VM_POD_NAME|虚机/POD名|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于指示该节点所在虚机或者POD名。
BUFFUSED|数据区使用率(%)|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于指示该节点的数据区使用率。
TPS|TPS|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于指示该节点每秒收到的业务消息数。
OUTP|输出|参数可选性: 任选参数类型: 字符串|该参数用于指示命令执行失败时输出的结果。




[](None)命令举例 


`
查询租户1下模块号为3的节点的当前运行状态。

(No.1) : SHOW CDBNODE:TENANTID=1,MODULE=3
-----------------Ncudr_SystemManagement_0----------------
索引号  节点号  模块号  租户ID   域        状态     CPU(%)   MEM(%)    虚机/POD名         数据区使用率     TPS
1       65539   3       1        LEFT      NORMAL   7        19        ZTE_CUDR_1_CDU_0   80%              30000
记录数：1
执行成功耗时: 0.412 秒

` 


#### 查询数据分布(SHOW CDB DISTRIBUTION) 
#### 查询数据分布(SHOW CDB DISTRIBUTION) 


[](None)功能说明 

该命令用于查询CDN节点上的数据分布信息。当操作维护人员需要了解节点上的数据分片的分布信息或分片状态时，可以执行本命令。


[](None)注意事项 

多租户时，输入参数中必须指定租户ID。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户，通过SHOW CDBTENANT命令可以查看已创建的租户ID。
NFID|NF标识|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一指示UDSF部署的NF，通过SHOW CDBTENANT命令可以查看所有租户分布的NF信息。如果不输入NFID,则表示查询所有NF的分片分布信息。
STARTSLOTID|起始分片ID|参数可选性: 任选参数类型: 数字参数范围: 1-1024默认值: 1|该参数用于指定待查询的起始分片ID。
ENDSLOTID|结束分片ID|参数可选性: 任选参数类型: 数字参数范围: 1-1024默认值: 1024|该参数用于指定待查询的终止分片ID。
SLOTSTATE|分片状态|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-255|该参数用于指定分片状态。包含以下状态：NORMAL：正常状态MERGE：数据合并状态，该状态下可以正常处理业务。OTHER：其他状态，除NORMAL和MERGE以外的其他状态。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
INDEXID|索引号|参数可选性: 任选参数类型: 数字参数范围: 1-65535|用于唯一标识一条分布记录信息。
NFID|NF标识|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一指示UDSF部署的NF，通过SHOW CDBTENANT命令可以查看所有租户分布的NF信息。
SLOTID|分片ID|参数可选性: 任选参数类型: 数字参数范围: 1-65535|该参数用于标识分片ID。
REPLICA|副本ID|参数可选性: 任选参数类型: 数字参数范围: 1-65535|该参数用于标识分片的副本ID。用户数据最多有四个副本，对应ID分别为1、2、3、4，其中3/4副本只在弹缩过程中出现。
NODEID|节点ID|参数可选性: 任选参数类型: 数字参数范围: 0-4294967295|该参数用于指示分片归属的CDN节点号。通过SHOW CDBNODE命令可以查看到所有的节点。
STATE|状态|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于指示当前分片的状态。包含：NORMAL：正常状态，可以正常处理业务。INITIAL：初始态，不能处理业务。WAIT：等待态，等待在线恢复数据，不能处理业务。RESTORE：在线恢复态，从其他节点恢复数据，不能处理业务。MERGE：数据合并态，和其他节点上的数据进行合并，可以正常处理业务。WAIT_INIT: 等待在线恢复态，从其他节点恢复数据，不能处理业务
OUTP|输出|参数可选性: 任选参数类型: 字符串|该参数用于指示命令执行失败时输出的结果。




[](None)命令举例 


`
查询租户1分片分布。

(No.1) : SHOW CDB DISTRIBUTION:TENANTID=1
-----------------Ncudr_SystemManagement_0----------------
索引号 NF ID  分片ID 副本ID 节点ID    状态     
1     1       1      1      65539     NORMAL
2     1       1      2      65540     NORMAL
3     255     1      1      1507591   NORMAL
4     255     1      2      1507600   NORMAL
Total Records:4

` 


#### 查询系统历史可用信息(SHOW CDB VALID) 
#### 查询系统历史可用信息(SHOW CDB VALID) 


[](None)功能说明 

该命令用于查询系统当前是否正常运行，以及历史运行信息。当操作维护人员需要了解系统的运行信息时，可以执行本命令。


[](None)注意事项 

无。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任意单选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户。通过SHOW CDBTENANT命令可以查看已创建的租户ID。
TENANTNAME|租户名|参数可选性: 任意单选参数类型: 字符串参数范围: 1-128|该参数用于表示租户名称。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户。通过SHOW CDBTENANT命令可以查看已创建的租户ID。
TENANTNAME|租户名|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于表示租户名称。
SWITCHINFO|切换信息|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于表示系统从有效切换到无效或无效切换到有效的切换信息。
TIME|时间|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于表示系统有效性切换的时间。
OUTP|输出|参数可选性: 任选参数类型: 字符串|该参数用于指示命令执行失败时输出的结果。




[](None)命令举例 


`
查询CDB系统运行状态。

(No.32) : SHOW CDB VALID:
-----------------Ncudr_SystemManagement_0----------------
租户ID  租户名    切换信息          时间
1       tenant_1  Unvalid -> Valid  2019-09-12 17:19:56
1       tenant_1  Valid -> Unvalid  2019-09-12 17:19:32
1       tenant_1  Unvalid -> Valid  2019-09-10 21:36:11
记录数：3

执行成功耗时: 0.091 秒

` 


### UDSF数据维护 
### UDSF数据维护 


[](None)背景知识 


UDSF提供了一组数据维护类的命令，用于查看和维护数据库中数据。执行此组命令可以为维护人员分析系统状态提供一些依据。 




[](None)功能说明 


UDSF数据维护提供了一组数据维护命令，包含： 

查看用户数：查看内存数据库中用户数目。 

 
查看记录数：查看内存数据库中各表的记录数目。包含：用户数据表记录数、别名数据表记录数以及反向别名表记录数。 

 
dump功能：将内存库数据库中的数据dump到硬盘。包含：开始dump、查看dump进度和取消dump操作三个子命令。 

 
一致性检查功能：检查UDSF数据一致性。包含“开始执行一致性检查、查看一致性检查进度和取消一致性检查三个子命令。 

 
清除数据库功能： 当系统出现故障，垃圾数据过多，数据无法删除，可以使用此命令删除数据库中的数据。 

 
重置数据库功能： 当配置错误导致数据分布错误时，可以使用此命令将CDB恢复到初始状态。 

 
UDSF日志采集：提供UDSF日志采集功能，可以按租户，也可以采集全部的UDSF的系统运行日志。 




[](None)子主题： 






#### 查询用户数(SHOW CDB USERNUM) 
#### 查询用户数(SHOW CDB USERNUM) 


[](None)功能说明 

该命令用于查询各个节点上第一和第二副本的PI数量。当操作维护人员需要查询当前内存库中PI数量时可以使用本命令。


[](None)注意事项 

无。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NODEID|节点ID|参数可选性: 必选参数类型: 数字参数范围: 1-4294967295|该参数用于唯一指示CDN节点号，通过SHOW CDBNODE命令可以查看所有的CDN节点。
PITYPE|PI类型|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于指示需要查询的PI类型。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NODEID|节点ID|参数可选性: 任选参数类型: 数字|该参数用于唯一指示CDN节点号，通过SHOW CDBNODE命令可以查看所有的CDN节点。
REPLICA_ID|副本ID|参数可选性: 任选参数类型: 数字参数范围: 1-65535|该参数用于指示分片的副本ID。用户数据最多有四个副本，对应ID分别为1、2、3、4，其中3/4副本只在弹缩过程中出现。
PI_NUM|PI数量|参数可选性: 任选参数类型: 数字|该参数用于指示查询到的PI数量。
OVERDATE_NUM|过期PI数量|参数可选性: 任选参数类型: 数字|该参数用于指示查询到的过期PI数量。一般业务网元存放数据时会携带有效期(TTL), 数据存放TTL时间之后会过期，此时对应的PI即为过期PI。
NO_REDUNDANCY_NUM|指定不容灾PI数量|参数可选性: 任选参数类型: 数字默认值: 0|该参数用于指示查询到的无需容灾的PI数量。这些特殊的PI相关的数据不会同步到容灾局。
OUTP|输出|参数可选性: 任选参数类型: 字符串|该参数用于指示命令执行失败时输出的结果。




[](None)命令举例 


`
查询ID为65539的节点上PI类型为1的PI数量。

(No.1) : SHOW CDB USERNUM:NODEID=65539,PITYPE=1
-----------------Ncudr_SystemManagement_0----------------
节点号   副本ID   PI数量     过期数量     指定不容灾数量
65539    1       100        0              0             
65539    2       200        0              0             
记录数：2
执行成功 耗时: 2.963 秒

` 


#### 查询记录数(SHOW CDB RECORDNUM) 
#### 查询记录数(SHOW CDB RECORDNUM) 


[](None)功能说明 

该命令用于查询CDN节点上用户表中的记录数。当操作维护人员需要查询每一个用户表中记录的数量时，可以采用此命令。


[](None)注意事项 

无。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户。通过SHOW CDBTENANT命令可以查看已创建的租户ID。
NFID|NF标识|参数可选性: 任意单选参数类型: 数字参数范围: 1-255|该参数用于唯一指示UDSF部署的NF，通过SHOW CDBTENANT命令可以查看所有租户分布的NF信息。
NODEID|节点ID|参数可选性: 任意单选参数类型: 数字参数范围: 1-4294967295|该参数用于唯一指示CDN节点号，通过SHOW CDBNODE命令可以查看所有的CDN节点。
CONSISTENCY|一致性状态|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 1-255默认值: 0|该参数用于过滤输出结果。  same :只显示所有副本数据一致的分片。  different:只显示有副本数据不一致的分片。  all:显示所有.




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户。通过SHOW CDBTENANT命令可以查看已创建的租户ID。
NFID|NF标识|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一指示UDSF部署的NF，通过SHOW CDBTENANT命令可以查看所有租户分布的NF信息。
REPLICAID|副本ID|参数可选性: 任选参数类型: 数字|该参数用于指示分片的副本ID。用户数据最多有四个副本，对应ID分别为1、2、3、4，其中3/4副本只在弹缩过程中出现。
CDB_DATA|数据表|参数可选性: 任选参数类型: 数字|该参数用于表示CDB_DATA表记录数
CDB_ALIAS|别名表|参数可选性: 任选参数类型: 数字|该参数用于表示CDB_ALIAS表记录数
CDB_REALIAS|反向别名表|参数可选性: 任选参数类型: 数字|该参数用于表示CDB_REALIAS表记录数
SLOTID|分片ID|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于标识分片ID。通过SHOW CDB DISTRIBUTION命令可以查看各个节点上的分片ID。
NODEID|节点ID|参数可选性: 任选参数类型: 数字|该参数用于指示节点号。节点号在部署时生成。
OUTP|输出|参数可选性: 任选参数类型: 字符串|该参数用于指示命令执行失败时输出的结果。




[](None)命令举例 


`
查询租户1的节点65539上的各个表在每一个分片的记录数。

(No.5) : SHOW CDB RECORDNUM:TENANTID=1,NODEID=65539
-----------------Ncudr_SystemManagement_0----------------
租户ID   NF标识 分片ID 副本ID    节点ID    数据表    别名表    反向别名表
1       1      1     1         65539    0        0          0
1       1      3     1         65539    0        0          0
1       1      5     1         65539    0        0          0
1       1      7     1         65539    0        0          0
记录数：4
执行成功耗时: 0.412 秒

` 


#### 开始DUMP(START CDB DUMP) 
#### 开始DUMP(START CDB DUMP) 


[](None)功能说明 

该命令用于触发dump操作，将内存数据dump到磁盘。维护人员执行此命令后，系统开始进行dump操作。


[](None)注意事项 


 
dump操作会对系统性能有一些影响，请不要在业务高峰期执行dump操作。 

 
磁盘空间小于10G时，dump失败。 

 


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NODEID|节点ID|参数可选性: 必选参数类型: 数字参数范围: 1-4294967295|该参数用于表示节点号。通过SHOW CDBNODE命令可以查看节点号。
DUMPRECORD|是否下载字段信息|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: NO|该参数用于表示是否要将用户数据表（CDB_DATA）中的record字段dump到磁盘，取值为“yes”或“no”。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
OUTP|输出|参数可选性: 必选参数类型: 字符串|该参数用于指示命令执行后输出的结果。




[](None)命令举例 


`
执行dump操作，将节点ID为65540的节点中的数据dump到磁盘，并且不包括record字段。
START CDB DUMP:NODEID=65540,DUMPRECORD="NO"
` 


#### 终止DUMP(CANCEL CDB DUMP) 
#### 终止DUMP(CANCEL CDB DUMP) 


[](None)功能说明 

该命令用于取消正在进行的dump操作。


[](None)注意事项 

无。


[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
OUTP|输出|参数可选性: 必选参数类型: 字符串|该参数用于指示命令执行后输出的结果。




[](None)命令举例 


`
取消正在进行的dump操作。
CANCEL CDB DUMP
` 


#### 查询DUMP进度(QUERY CDB DUMP) 
#### 查询DUMP进度(QUERY CDB DUMP) 


[](None)功能说明 

该命令用于查询dump操作进度。


[](None)注意事项 

无。


[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NODEID|节点ID|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于表示节点号。通过SHOW CDBNODE命令可以查看节点号。
PROGRESS|进度|参数可选性: 任选参数类型: 字符串参数范围: 0-256|dump操作的进度（百分比）。
TIMESTAMP|时间戳|参数可选性: 任选参数类型: 字符串参数范围: 0-256|dump操作结束的时间点。如果dump还未结束，则为查询操作发生的时间点。
STATUS|状态|参数可选性: 任选参数类型: 字符串参数范围: 0-256|dump操作状态。取值枚举如下：init : dump处于初始态，未执行。waiting : dump处于等待状态，未执行。starting : dump开始。progress : dump进行中。cancel : dump被取消。failed : dump失败。done : dump完成。
INFO|信息|参数可选性: 任选参数类型: 字符串参数范围: 0-256|dump操作信息。
OUTP|输出|参数可选性: 任选参数类型: 字符串|该参数用于指示命令执行后输出的结果。




[](None)命令举例 


`
查询dump进度。

(No.22) : QUERY CDB DUMP
-----------------Ncudr_SystemManagement_0----------------
节点ID  进度  时间戳                  状态   信息
65539   100%  2019-09-12 17:04:48     Done   dump success, dump_begin_time:2019-09-12 17:04:45
total   100%  2019-09-12 17:04:48     Done
记录数：2
输出
result files in directory /IDE0/cudr_1/dump/module_xxx

执行成功耗时: 0.144 秒

` 


#### 开始一致性检查(START CDB CONSIST) 
#### 开始一致性检查(START CDB CONSIST) 


[](None)功能说明 

该命令用于触发一致性检查。当维护人员执行此命令时，系统开始进行一致性检查操作。


[](None)注意事项 

多租户时，输入参数中必须指定租户ID或者节点ID。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户。通过SHOW CDBTENANT命令可以查看已创建的租户ID。
NODEID|节点ID|参数可选性: 任选参数类型: 数字参数范围: 1-4294967295|该参数用于表示节点号。通过SHOW CDBNODE命令可以查看节点号。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
OUTP|输出|参数可选性: 任选参数类型: 字符串|该参数用于指示命令执行后输出的结果。




[](None)命令举例 


`
开始在租户1的节点65540上执行数据一致性检查。
START CDB CONSIST:TENANTID=1,NODEID=65540
` 


#### 终止一致性检查(CANCEL CDB CONSIST) 
#### 终止一致性检查(CANCEL CDB CONSIST) 


[](None)功能说明 

该命令用于取消正在执行的一致性检查任务。操作维护人员在执行一致性检查任务时，如果业务量突然增加，需要取消一致性检查时，可以执行此命令。


[](None)注意事项 

无。


[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
OUTP|输出|参数可选性: 必选参数类型: 字符串|该参数用于指示命令执行后输出的结果。




[](None)命令举例 


`
取消一致性检查操作。
CANCEL CDB CONSIST
` 


#### 查询一致性检查进度(QUERY CDB CONSIST) 
#### 查询一致性检查进度(QUERY CDB CONSIST) 


[](None)功能说明 

该命令用于查询一致性检查操作执行的进度。


[](None)注意事项 

无。


[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
NODEID|节点ID|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于表示节点号。通过SHOW CDBNODE命令可以查看节点号。
PROGRESS|进度|参数可选性: 任选参数类型: 字符串参数范围: 0-256|一致性检查操作的进度（百分比）。
TIMESTAMP|时间戳|参数可选性: 任选参数类型: 字符串参数范围: 0-256|一致性检查操作结束的时间点。如果一致性检查还未结束，则为查询操作发生的时间点。
STATUS|状态|参数可选性: 任选参数类型: 字符串参数范围: 0-256|一致性检查操作状态。取值枚举如下：init : 一致性检查处于初始态，未执行。waiting : 一致性检查处于等待状态，未执行。starting : 一致性检查开始。progress : 一致性检查进行中。cancel : 一致性检查被取消。failed : 一致性检查失败。done : 一致性检查完成。
INFO|信息|参数可选性: 任选参数类型: 字符串参数范围: 0-256|一致性检查执行信息。
OUTP|输出|参数可选性: 任选参数类型: 字符串|该参数用于指示命令执行后输出的结果。




[](None)命令举例 


`
查询一致性检查执行的进度。

(No.1) : QUERY CDB CONSIST
-----------------Ncudr_SystemManagement_0----------------
节点ID 进度        时间戳                      状态          信息
65540  100%        2019-08-29 05:43:40  Done   rcc success,  0 records are inconsistent, beg_rcc_time:2019-08-29 05:43:37
total  100%        2019-08-29 05:43:40  Done
 
记录数：2

输出
result files in directory /IDE0/cudr_1/rcc/module_xxx

执行成功耗时: 0.104 秒

` 


#### 清除数据库(TRUNCATE CDB) 
#### 清除数据库(TRUNCATE CDB) 


[](None)功能说明 

该命令用于清除内存数据库中的数据。当系统出现故障，数据无法正常删除，导致系统中缓存的垃圾数据过多时，维护人员可以通过此命令删除数据库中的数据。


[](None)注意事项 


 
多租户时，输入参数中必须指定租户ID。 

 
该命令执行后，数据库中数据会被删除，需慎重使用。 

 
该命令执行时，需要关闭自动弹缩功能。 

 
该命令执行时，不能同时执行dump、一致性检查、用户数查询等命令。 

 


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户。通过SHOW CDBTENANT命令可以查看已创建的租户ID。
DOMAIN|域|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 1-2|该参数用于指示CDN节点归属左域还是右域。
CLEAR_NF_RANGE|生效范围|参数可选性: 任选参数类型: 枚举，参见枚举定义参数范围: 0-1默认值: LOCAL_NF|该参数用于指示是仅本局清库，还是本局和跨局同时清库，LOCAL NF是本局清库，ALL NF是全局清库，默认值是本局清库。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
OUTP|操作结果|参数可选性: 必选参数类型: 字符串|该参数用于指示命令执行后输出的结果。




[](None)命令举例 


`
清除租户ID为1的内存数据库中的数据。
TRUNCATE CDB:TENANTID=1
` 


#### 重置UDSF所有数据(RESET CDB) 
#### 重置UDSF所有数据(RESET CDB) 


[](None)功能说明 

该命令用于重置CDB指定租户数据，使该租户数据恢复到初始值。当租户参数配置错误导致数据分布错误时，可执行此命令重置该租户。


[](None)注意事项 

该命令执行后，数据库中对应租户的数据会全部丢失，需慎重使用。默认重置所有CDB租户数据。
执行此命令前，需确保所有租户配置已修改正确，并同步。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于唯一标识一个租户。该参数默认表示重置所有租户的数据。通过SHOW CDBTENANT命令可以查看已创建的租户ID。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
OUTP|输出|参数可选性: 必选参数类型: 字符串|该参数用于指示命令执行后输出的结果。




[](None)命令举例 


`
重置CDB所有的租户到初始运行状态
RESET CDB
` 


#### 日志采集(UDSFLOG COLLECT) 
#### 日志采集(UDSFLOG COLLECT) 


[](None)功能说明 

该命令用于采集UDSF日志。可以按租户采集CDN节点日志，以及CCC节点和CGW节点的正常日志和异常日志，也可以用来采集所有租户的日志。


[](None)注意事项 

采集日志可能会引起CDN节点上CPU升高，操作时请注意避开业务高峰期。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|该参数用于指示待采集日志的租户的ID。通过SHOW CDBTENANT命令可以查看已创建的租户ID。如果不输入，则表示采集全部租户的日志。




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
STEP|步骤|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于指示日志采集过程中执行的步骤。
RESULT|操作结果|参数可选性: 任选参数类型: 字符串参数范围: 0-256|该参数用于指示日志采集中每个步骤的执行结果。
OUTP|输出|参数可选性: 任选参数类型: 字符串|该参数用于指示命令执行失败时输出的结果。




[](None)命令举例 


`
采集租户ID为1的租户下所有CDN节点日志、CC节点和CGW节点上的正常日志和异常日志。UDSFLOG COLLECT:TENANTID=1;
` 


### UDSF探针命令 
### UDSF探针命令 


[](None)背景知识 


UDSF探针是一组维护命令，用于查看和修改UDSF内存数据库中的数据。 




[](None)功能说明 


目前已经提供的UDSF探针命令包含： 

查询记录：用于根据索引查询记录内容。 

 
删除记录：用于根据索引删除记录。 




[](None)子主题： 






#### 查询表数据(CDB PROBE TUPLEBYINDEX) 
#### 查询表数据(CDB PROBE TUPLEBYINDEX) 


[](None)功能说明 

该命令用于根据索引查询记录内容。


[](None)注意事项 

多租户时，输入参数中必须指定租户ID或者模块号。


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
MODULE|模块号|参数可选性: 任选参数类型: 数字参数范围: 1-65535|输入的模块号，用于唯一标识一个模块。
TENANTID|租户ID|参数可选性: 任选参数类型: 数字参数范围: 1-255|输入的租户ID，用于唯一标识一个租户。
TABLENAME|表名|参数可选性: 必选参数类型: 枚举，参见枚举定义参数范围: 0-256|待查询的用户表名。取值为枚举：CDB_DATA：数据表 CDB_ALIAS：别名表 CDB_REALIAS:反向别名表
INDEXINFO|索引信息|参数可选性: 必选参数类型: 字符串参数范围: 1-5120|待查询的用户记录的索引，可输入PI+PITYPE或者NPI+NPITYPE。输入示意：PI+PITYPE：INDEXINFO="PI=1111"&"PITYPE=\01"NPI+NPITYPE：INDEXINFO="NPI=\ff\ff"&"NPITYPE=\ff\ff"




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
TUPLENO|记录号|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的记录号。
MODULE|模块号|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的模块号。
SLOT|分片ID|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的分片号。
PITYPE|PITYPE|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的PI类型。
PI|PI|参数可选性: 任选参数类型: 字符串参数范围: 0-8192|输出的PI值。
NPITYPE|NPITYPE|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的NPI类型。
NPI|NPI|参数可选性: 任选参数类型: 字符串参数范围: 0-8192|输出的NPI值。
PATH|PATH|参数可选性: 任选参数类型: 字符串参数范围: 0-8192|输出记录的PATH。
VERSION|版本号|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的记录的版本号。
TTL|TTL|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的记录的有效期。
EXTERNINFO|扩展信息|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的记录的扩展信息。
TIMESTAMP|时间戳|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的记录最后修改的时间戳。
FIELDID|字段ID|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的记录中字段ID。
LENGTH|数据长度|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的记录中字段长度。
DATA|数据内容|参数可选性: 任选参数类型: 字符串参数范围: 0-16000|输出的记录中字段内容。
USERTTL|用户TTL|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的用户的有效期。
USERTIMESTAMP|用户时间戳|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的用户最后修改的时间戳。
EXPIRED|过期标志|参数可选性: 任选参数类型: 字符串参数范围: 0-256|输出的数据过期标志。
REDUNDANCY|容灾标记|参数可选性: 任选参数类型: 字符串参数范围: 0-1|输出的数据容灾标志。
OUTP|输出|参数可选性: 任选参数类型: 字符串|命令执行失败时输出的结果。




[](None)命令举例 


`
查询租户1下模块号为3的节点中CDB_ALIAS表中指定NPI的数据。

(No.1) : CDB PROBE TUPLEBYINDEX:MODULE=3,TENANTID=1,TABLENAME="CDB_ALIAS",INDEXINFO="NPI=12345"&"NPITYPE=\01"
-----------------Ncudr_SystemManagement_0----------------
记录号  模块号  分片ID  NPITYPE   NPI       PITYPE    PI   时间戳
1       3       3       1         12345     1         1    2016-09-07 08：40：21.123 
记录数：1
执行成功耗时: 0.412 秒

` 


#### 删除表数据(CDB PROBE DELTUPLE) 
#### 删除表数据(CDB PROBE DELTUPLE) 


[](None)功能说明 

该命令用于根据索引删除记录。当系统中出现垃圾或者多余数据需要删除时，可以使用此命令删除数据。


[](None)注意事项 

该命令产生数据库操作日志，所以改动的数据会同步到当前分片的其他副本。 


[](None)输入参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
MODULE|模块号|参数可选性: 必选参数类型: 数字参数范围: 1-65535|输入的模块号，用于唯一标识一个模块。
TABLENAME|表名|参数可选性: 必选参数类型: 枚举，参见枚举定义参数范围: 0-256|待删除数据的用户表名。取值为枚举："CDB_DATA"/"CDB_ALIAS"/"CDB_REALIAS"
INDEXINFO|索引信息|参数可选性: 必选参数类型: 字符串参数范围: 0-5120|待删除的用户记录的索引。输入示意：INDEXINFO="PI=1111"&"PITYPE=\01"&"NPI=\ff\ff"




[](None)输出参数说明 


[](None)标识|名称|类型|说明
---|---|---|---
OUTP|输出|参数可选性: 必选参数类型: 字符串|命令执行后输出的结果。




[](None)命令举例 


`
删除租户1下模块号为3的节点中CDB_ALIAS表中指定的NPI数据。
CDB PROBE DELTUPLE:MODULE=3,TABLENAME="CDB_ALIAS",INDEXINFO="NPITYPE=1"&"NPI=12345"
` 


